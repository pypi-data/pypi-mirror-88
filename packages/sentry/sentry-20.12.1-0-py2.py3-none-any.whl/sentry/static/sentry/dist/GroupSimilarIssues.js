(window.sntryWpJsonp=window.sntryWpJsonp||[]).push([[93],{2126:function(e,t,r){"use strict";var n=r(25),i=r.n(n).a.createActions(["fetch","showAllSimilarItems","toggleUnmerge","toggleMerge","unmerge","merge","toggleCollapseFingerprint","toggleCollapseFingerprints"]);t.a=i},2127:function(e,t,r){"use strict";var n=r(28),i=r.n(n),a=r(7),s=r.n(a),o=r(33),c=r.n(o),l=r(276),u=r.n(l),f=r(25),g=r.n(f),m=r(35),d=r(2126),p=r(56);function b(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?b(Object(r),!0).forEach((function(t){s()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var v={listenables:[d.a],api:new p.a,init:function(){var e=this,t=this.getInitialState();Object.entries(t).forEach((function(t){var r=c()(t,2),n=r[0],i=r[1];e[n]=i}))},getInitialState:function(){return{mergedItems:[],unmergeList:new Map,unmergeState:new Map,unmergeDisabled:!0,unmergeLastCollapsed:!1,enableFingerprintCompare:!1,similarItems:[],filteredSimilarItems:[],similarLinks:"",mergeState:new Map,mergeList:[],mergedLinks:"",mergeDisabled:!1,loading:!0,error:!1}},setStateForId:function(e,t,r){return(Array.isArray(t)?t:[t]).map((function(t){var n=h(h({},e.has(t)&&e.get(t)||{}),r);return e.set(t,n),n}))},isAllUnmergedSelected:function(){var e=Array.from(this.unmergeState.values()).filter((function(e){return e.busy}))||[];return this.unmergeList.size===this.mergedItems.filter((function(e){return!!e.latestEvent})).length-e.length},onFetch:function(e){var t=this,r=e||this.toFetchArray;this.init(),this.triggerFetchState();var n=r.map((function(e){var r=e.endpoint,n=e.queryParams,i=e.dataKey;return new Promise((function(e,a){t.api.request(r,{method:"GET",data:n,success:function(t,r,n){e({dataKey:i,data:t,links:n?n.getResponseHeader("Link"):null})},error:function(e){var t,r=(null===(t=e.responseJSON)||void 0===t?void 0:t.detail)||!0;a(r)}})}))})),i={merged:function(e){return t.setStateForId(t.unmergeState,e.id,{busy:"locked"===e.state}),e},similar:function(e){var t=c()(e,2),r=t[0],n=t[1],i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.keys(e);return!t.map((function(t){return e[t]})).find((function(e){return e>=.6}))}(n),a=Object.keys(n).map((function(e){return[e,n[e]]})).reduce((function(e,t){var r=c()(t,2),n=r[0],i=r[1],a=String(n).split(":"),s=c()(a,1)[0];return e[s]||(e[s]=[]),e[s].push([n,i]),e}),{}),s=Object.keys(a).map((function(e){return[e,a[e]]})).reduce((function(e,t){var r=c()(t,2),n=r[0],i=r[1].filter((function(e){return null!==c()(e,2)[1]})),a=i.reduce((function(e,t){return e+c()(t,2)[1]}),0)/i.length;return e[n]=a,e}),{});return{issue:r,score:n,scoresByInterface:a,aggregate:s,isBelowThreshold:i}}};return e&&(this.toFetchArray=e),Promise.all(n).then((function(e){e.forEach((function(e){var r=e.dataKey,n=e.data,a=e.links,s=n.map(i[r]);t["".concat(r,"Items")]=s,t["".concat(r,"Links")]=a})),t.loading=!1,t.error=!1,t.triggerFetchState()}),(function(){t.loading=!1,t.error=!0,t.triggerFetchState()}))},onToggleMerge:function(e){var t=!1,r=this.mergeState.has(e)?this.mergeState.get(e):void 0;!0!==(null==r?void 0:r.busy)&&(this.mergeList.includes(e)?this.mergeList=this.mergeList.filter((function(t){return t!==e})):(this.mergeList=[].concat(i()(this.mergeList),[e]),t=!0),this.setStateForId(this.mergeState,e,{checked:t}),this.triggerMergeState())},onToggleUnmerge:function(e){var t=c()(e,2),r=t[0],n=t[1],i=!1,a=this.unmergeState.get(r);!0!==(null==a?void 0:a.busy)&&(this.unmergeList.has(r)?this.unmergeList.delete(r):(this.unmergeList.set(r,n),i=!0),this.setStateForId(this.unmergeState,r,{checked:i}),this.unmergeDisabled=0===this.unmergeList.size||this.isAllUnmergedSelected(),this.enableFingerprintCompare=2===this.unmergeList.size,this.triggerUnmergeState())},onUnmerge:function(e){var t=this,r=e.groupId,n=e.loadingMessage,i=e.successMessage,a=e.errorMessage,s=Array.from(this.unmergeList.keys());return new Promise((function(e,o){t.isAllUnmergedSelected()?o(new Error("Not allowed to unmerge ALL events")):(t.unmergeDisabled=!0,t.setStateForId(t.unmergeState,s,{checked:!1,busy:!0}),t.triggerUnmergeState(),Object(m.b)(n),t.api.request("/issues/".concat(r,"/hashes/"),{method:"DELETE",query:{id:s},success:function(){Object(m.d)(i),t.setStateForId(t.unmergeState,s,{checked:!1,busy:!0}),t.unmergeList.clear()},error:function(){Object(m.a)(a),t.setStateForId(t.unmergeState,s,{checked:!0,busy:!1})},complete:function(){t.unmergeDisabled=!1,e(t.triggerUnmergeState())}}))}))},onMerge:function(e){var t=this,r=e.params,n=e.query,a=e.projectId;if(r){var s=this.mergeList;return this.mergeDisabled=!0,this.setStateForId(this.mergeState,s,{busy:!0}),this.triggerMergeState(),new Promise((function(e){var o=r.orgId,c=r.groupId;t.api.merge({orgId:o,projectId:a||r.projectId,itemIds:[].concat(i()(s),[c]),query:n},{success:function(e){var r;(null==e?void 0:null===(r=e.merge)||void 0===r?void 0:r.parent)&&t.trigger({mergedParent:e.merge.parent}),t.setStateForId(t.mergeState,s,{checked:!1,busy:!0}),t.mergeList=[]},error:function(){t.setStateForId(t.mergeState,s,{checked:!0,busy:!1})},complete:function(){t.mergeDisabled=!1,e(t.triggerMergeState())}})}))}},onToggleCollapseFingerprints:function(){this.setStateForId(this.unmergeState,this.mergedItems.map((function(e){return e.id})),{collapsed:!this.unmergeLastCollapsed}),this.unmergeLastCollapsed=!this.unmergeLastCollapsed,this.trigger({unmergeLastCollapsed:this.unmergeLastCollapsed,unmergeState:this.unmergeState})},onToggleCollapseFingerprint:function(e){var t=this.unmergeState.has(e)&&this.unmergeState.get(e).collapsed;this.setStateForId(this.unmergeState,e,{collapsed:!t}),this.trigger({unmergeState:this.unmergeState})},triggerFetchState:function(){var e=h({similarItems:this.similarItems.filter((function(e){return!e.isBelowThreshold})),filteredSimilarItems:this.similarItems.filter((function(e){return e.isBelowThreshold}))},u()(this,["mergedItems","mergedLinks","similarLinks","mergeState","unmergeState","loading","error"]));return this.trigger(e),e},triggerUnmergeState:function(){var e=u()(this,["unmergeDisabled","unmergeState","unmergeList","enableFingerprintCompare","unmergeLastCollapsed"]);return this.trigger(e),e},triggerMergeState:function(){var e=u()(this,["mergeDisabled","mergeState","mergeList"]);return this.trigger(e),e}};t.a=g.a.createStore(v)},2208:function(e,t,r){"use strict";var n=r(3),i=r(2),a=r.n(i),s=Object(n.a)("div",{target:"e1uibv5p0",label:"FlowLayout"})("display:flex;flex:1;align-items:center;flex-direction:",(function(e){return e.vertical?"column":null}),";justify-content:",(function(e){return e.center?"center":null}),";overflow:",(function(e){return e.truncate?"hidden":null}),";");s.propTypes={center:a.a.bool,vertical:a.a.bool,truncate:a.a.bool},s.defaultProps={truncate:!0},t.a=s},2209:function(e,t,r){"use strict";var n=r(6),i=r.n(n),a=r(16),s=r.n(a),o=(r(1),r(34)),c=r.n(o),l=r(0),u=function(e){var t=e.responsive,r=void 0!==t&&t,n=e.center,a=void 0===n||n,o=e.children,u=e.className,f=s()(e,["responsive","center","children","className"]),g=c()("spread-layout",u,{center:a,"allow-responsive":r});return Object(l.f)("div",i()({},f,{className:g}),o)};u.displayName="SpreadLayout",t.a=u},2291:function(e,t,r){"use strict";var n=r(3),i=Object(n.a)("div",{target:"e1pdx9kr0",label:"Toolbar"})("background:",(function(e){return e.theme.backgroundSecondary}),";border:1px solid ",(function(e){return e.theme.border}),";border-bottom:none;border-radius:3px 3px 0 0;box-shadow:0 1px 0 ",(function(e){return e.theme.border}),";margin:0;");t.a=i},2913:function(e,t,r){"use strict";r.r(t);var n=r(6),i=r.n(n),a=r(16),s=r.n(a),o=r(1),c=r.n(o),l=r(107),u=r(7),f=r.n(u),g=r(33),m=r.n(g),d=r(9),p=r.n(d),b=r(10),h=r.n(b),v=r(12),y=r.n(v),j=r(13),O=r.n(j),S=r(5),I=r.n(S),k=r(3),w=r(11),x=r(80),L=r(2126),C=r(72),D=r(29),F=r(109),P=r(123),M=r(44),N=r(4),A=r(2127),R=r(8),E=r(52),q=r(304),T=r(673),U=r(164),z=r(0);function W(e){var t=e.className;return Object(z.f)("div",{className:t},Object(z.f)("span",null,Object(N.b)("Similar")),Object(z.f)(B,{colorIndex:4}),Object(z.f)(B,{colorIndex:3}),Object(z.f)(B,{colorIndex:2}),Object(z.f)(B,{colorIndex:1}),Object(z.f)(B,{colorIndex:0}),Object(z.f)("span",null,Object(N.b)("Not Similar")))}W.displayName="SimilarSpectrum";var G=Object(k.a)(W,{target:"enx6bph0",label:"StyledSimilarSpectrum"})("display:flex;font-size:",(function(e){return e.theme.fontSizeSmall}),";"),B=Object(k.a)("span",{target:"enx6bph1",label:"SpectrumItem"})("border-radius:2px;margin:5px;width:14px;",(function(e){return"background-color: ".concat(e.theme.similarity.colors[e.colorIndex],";")}),";"),H=G,V=r(34),K=r.n(V),J=r(65),Q=r(309),X=r(192),Y=r(1069),Z=r(734),$=r(2208),_=r(210),ee=r(1060),te={"exception:message:character-shingles":Object(N.b)("Exception Message"),"exception:stacktrace:pairs":Object(N.b)("Stack Trace Frames"),"exception:stacktrace:application-chunks":Object(N.b)("In-App Frames"),"message:message:character-shingles":Object(N.b)("Log Message"),"similarity:*:type:character-5-shingle":Object(N.b)("Exception Type"),"similarity:*:value:character-5-shingle":Object(N.b)("Exception Message"),"similarity:*:stacktrace:frames-pairs":Object(N.b)("Stack Trace Frames"),"similarity:*:message:character-5-shingle":Object(N.b)("Log Message")},re=function(e){var t=e.scoreList,r=void 0===t?[]:t;if(0===r.length)return null;var n=0,i=0;return Object(z.f)(c.a.Fragment,null,r.map((function(e){var t=m()(e,2),r=t[0],a=t[1],s=te[r.replace(/similarity:\d\d\d\d-\d\d-\d\d/,"similarity:*")];return s?Object(z.f)(ne,{key:r},Object(z.f)("div",null,s),Object(z.f)(ie,{score:null===a?a:Math.round(4*a)})):(null!==a&&(n+=a,i+=1),null)})),i>0&&n>0&&Object(z.f)(ne,null,Object(z.f)("div",null,Object(N.b)("Other")),Object(z.f)(ie,{score:Math.round(4*n/i)})))};re.displayName="SimilarScoreCard";var ne=Object(k.a)("div",{target:"e1vycly80",label:"Wrapper"})("display:flex;justify-content:space-between;margin:",Object(R.a)(.25)," 0;"),ie=Object(k.a)("div",{target:"e1vycly81",label:"Score"})("height:16px;width:48px;border-radius:2px;background-color:",(function(e){return null===e.score?e.theme.similarity.empty:e.theme.similarity.colors[e.score]}),";"),ae=re,se=r(2209);function oe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ce(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?oe(Object(r),!0).forEach((function(t){f()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):oe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function le(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=I()(e);if(t){var i=I()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return O()(this,r)}}var ue={visible:!0,checked:!1,busy:!1},fe=function(e){y()(r,e);var t=le(r);function r(){var e;p()(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=t.call.apply(t,[this].concat(i))).state=ue,e.listener=A.a.listen((function(t){return e.onGroupChange(t)}),void 0),e.handleToggle=function(){var t=e.props.issue;e.state.busy||L.a.toggleMerge(t.id)},e.handleShowDiff=function(t){var r=e.props,n=r.orgId,i=r.groupId,a=r.issue,s=r.project,o=a.id;Object(J.g)({baseIssueId:i,targetIssueId:o,project:s,orgId:n}),t.stopPropagation()},e.handleCheckClick=function(){},e.onGroupChange=function(t){var r=t.mergeState;if(r){var n=e.props.issue,i=r.has(n.id)&&r.get(n.id);i&&Object.keys(i).forEach((function(t){i[t]!==e.state[t]&&e.setState((function(e){return ce(ce({},e),{},f()({},t,i[t]))}))}))}},e}return h()(r,[{key:"componentWillUnmount",value:function(){Object(E.a)(this.listener)}},{key:"render",value:function(){var e=this.props,t=e.aggregate,r=e.scoresByInterface,n=e.issue,i=e.v2,a=this.state,s=a.visible,o=a.busy,c=i?["similarity"]:["exception","message"];if(!s)return null;var l=K()("group","similar-issue",{isResolved:"resolved"===n.status,busy:o});return Object(z.f)(se.a,{"data-test-id":"similar-item-row",className:l,onClick:this.handleToggle,responsive:!0},Object(z.f)($.a,{truncate:!0},Object(z.f)($.a,{truncate:!0},Object(z.f)(ve,null,Object(z.f)(Q.a,{id:n.id,value:n.id,checked:this.state.checked,onChange:this.handleCheckClick})),Object(z.f)(ye,{className:"event-details"},Object(z.f)(Z.a,{data:n,includeLink:!0,size:"normal"}),Object(z.f)(Y.a,{data:ce(ce({},n),{},{lastSeen:""}),showAssignee:!0}))),Object(z.f)(he,{onClick:this.handleShowDiff,size:"small"},Object(N.b)("Diff"))),Object(z.f)(me,null,Object(z.f)(be,{value:n.count}),c.map((function(e){var n=null==t?void 0:t[e],i=(null==r?void 0:r[e])||[],a="number"!=typeof n||Number.isNaN(n)?0:n;return Object(z.f)(pe,{key:e},Object(z.f)(_.d,{body:i.length&&Object(z.f)(ae,{scoreList:i})},Object(z.f)(ee.a,{vertical:!0,score:Math.round(5*a)})))}))))}}]),r}(c.a.Component);fe.displayName="Item";var ge=fe,me=Object(k.a)("div",{target:"egki5oq0",label:"Columns"})({name:"wsif3o",styles:"display:flex;align-items:center;flex-shrink:0;min-width:300px;width:300px;"}),de=Object(z.e)("flex:1;flex-shrink:0;display:flex;justify-content:center;padding:",Object(R.a)(.5)," 0;;label:columnStyle;"),pe=Object(k.a)("div",{target:"egki5oq1",label:"Column"})(de),be=Object(k.a)(X.a,{target:"egki5oq2",label:"StyledCount"})(de),he=Object(k.a)(D.a,{target:"egki5oq3",label:"StyledButton"})("margin-right:",Object(R.a)(.25),";"),ve=Object(k.a)("div",{target:"egki5oq4",label:"ActionColumn"})({name:"os1vbx",styles:"text-align:center;width:54px;"}),ye=Object(k.a)("div",{target:"egki5oq5",label:"EventDetails"})({name:"1rr4qq7",styles:"flex:1;"}),je=r(206),Oe=r(2291),Se=r(1062);function Ie(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=I()(e);if(t){var i=I()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return O()(this,r)}}var ke={mergeCount:0},we=function(e){y()(r,e);var t=Ie(r);function r(){var e;p()(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=t.call.apply(t,[this].concat(i))).state=ke,e.onGroupChange=function(t){var r=t.mergeList;(null==r?void 0:r.length)&&r.length!==e.state.mergeCount&&e.setState({mergeCount:r.length})},e.listener=A.a.listen(e.onGroupChange,void 0),e}return h()(r,[{key:"componentWillUnmount",value:function(){Object(E.a)(this.listener)}},{key:"render",value:function(){var e=this.props,t=e.onMerge,r=e.v2,n=this.state.mergeCount;return Object(z.f)(Oe.a,null,Object(z.f)(se.a,{responsive:!0},Object(z.f)(Ce,null,Object(z.f)($.a,null,Object(z.f)(Le,null,Object(z.f)(je.a,{"data-test-id":"merge",disabled:0===n,message:Object(N.b)("Are you sure you want to merge these issues?"),onConfirm:t},Object(z.f)(D.a,{size:"small",title:Object(N.b)("Merging %s issues",n)},Object(N.b)("Merge %s","(".concat(n||0,")"))))))),Object(z.f)(De,null,Object(z.f)(Fe,{className:"event-count-header"},Object(N.b)("Events")),r?Object(z.f)(Fe,{className:"event-similar-header"},Object(N.b)("Score")):Object(z.f)(c.a.Fragment,null,Object(z.f)(Fe,{className:"event-similar-header"},Object(N.b)("Exception")),Object(z.f)(Fe,{className:"event-similar-header"},Object(N.b)("Message"))))))}}]),r}(c.a.Component);we.displayName="SimilarToolbar";var xe=we,Le=Object(k.a)("div",{target:"e1axhvm50",label:"Actions"})("margin-left:",Object(R.a)(3),";padding:",Object(R.a)(.5)," 0;"),Ce=Object(k.a)($.a,{target:"e1axhvm51",label:"StyledFlowLayout"})({name:"1rr4qq7",styles:"flex:1;"}),De=Object(k.a)("div",{target:"e1axhvm52",label:"Columns"})({name:"wsif3o",styles:"display:flex;align-items:center;flex-shrink:0;min-width:300px;width:300px;"}),Fe=Object(k.a)(Se.a,{target:"e1axhvm53",label:"StyledToolbarHeader"})("flex:1;flex-shrink:0;display:flex;justify-content:center;padding:",Object(R.a)(.5)," 0;");function Pe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=I()(e);if(t){var i=I()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return O()(this,r)}}var Me=function(e){y()(r,e);var t=Pe(r);function r(){var e;p()(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=t.call.apply(t,[this].concat(i))).state={showAllItems:!1},e.renderEmpty=function(){return Object(z.f)(U.a,null,Object(z.f)(U.c,null,Object(z.f)(q.a,{small:!0,withIcon:!1},Object(N.b)("No issues with a similar stack trace have been found."))))},e.handleShowAll=function(){e.setState({showAllItems:!0})},e}return h()(r,[{key:"render",value:function(){var e=this.props,t=e.orgId,r=e.groupId,n=e.project,a=e.items,s=e.filteredItems,o=e.pageLinks,c=e.onMerge,l=e.v2,u=this.state.showAllItems,f=!!s.length,g=a.length>0||f,m=a.concat(u&&s||[]);return g?Object(z.f)(Ae,{className:"similar-list-container"},Object(z.f)(Re,null,Object(z.f)(H,null)),Object(z.f)(xe,{v2:l,onMerge:c}),Object(z.f)("div",{className:"similar-list"},m.map((function(e){return Object(z.f)(ge,i()({key:e.issue.id,orgId:t,v2:l,groupId:r,project:n},e))})),f&&!u&&Object(z.f)(Ee,null,Object(z.f)(D.a,{onClick:this.handleShowAll},Object(N.b)("Show %s issues below threshold",s.length)))),Object(z.f)(T.a,{pageLinks:o})):this.renderEmpty()}}]),r}(c.a.Component);Me.displayName="List",Me.defaultProps={filteredItems:[]};var Ne=Me,Ae=Object(k.a)("div",{target:"e191i7fr0",label:"Wrapper"})("margin-bottom:",Object(R.a)(2),";"),Re=Object(k.a)("div",{target:"e191i7fr1",label:"Header"})("display:flex;justify-content:flex-end;margin-bottom:",Object(R.a)(1),";"),Ee=Object(k.a)("div",{target:"e191i7fr2",label:"Footer"})("display:flex;justify-content:center;padding:",Object(R.a)(1.5),";");function qe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Te(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?qe(Object(r),!0).forEach((function(t){f()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):qe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ue(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=I()(e);if(t){var i=I()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return O()(this,r)}}var ze=function(e){y()(r,e);var t=Ue(r);function r(){var e;p()(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=t.call.apply(t,[this].concat(i))).state={similarItems:[],filteredSimilarItems:[],similarLinks:null,loading:!0,error:!1,v2:!1},e.onGroupingChange=function(t){var r=t.mergedParent,n=t.similarItems,i=t.similarLinks,a=t.filteredSimilarItems,s=t.loading,o=t.error;if(n)e.setState({similarItems:n,similarLinks:i,filteredSimilarItems:a,loading:null!=s&&s,error:null!=o&&o});else if(r)if(r===e.props.params.groupId);else{var c=e.props.params;w.browserHistory.push("/organizations/".concat(c.orgId,"/issues/").concat(r,"/similar/"))}},e.listener=A.a.listen(e.onGroupingChange,void 0),e.handleMerge=function(){var t=e.props,r=t.params,n=t.location.query;if(r){var i=e.state.similarItems.length?e.state.similarItems:e.state.filteredSimilarItems,a=m()(i,1)[0];L.a.merge({params:r,query:n,projectId:a.issue.project.slug})}},e.toggleSimilarityVersion=function(){e.setState((function(e){return{v2:!e.v2}}),e.fetchData)},e}return h()(r,[{key:"componentDidMount",value:function(){this.fetchData()}},{key:"componentWillReceiveProps",value:function(e){e.params.groupId===this.props.params.groupId&&e.location.search===this.props.location.search||this.fetchData()}},{key:"componentWillUnmount",value:function(){Object(E.a)(this.listener)}},{key:"fetchData",value:function(){var e=this.props,t=e.params,r=e.location;this.setState({loading:!0,error:!1});var n=[];if(this.hasSimilarityFeature()){var i=this.state.v2?"2":"1";n.push({endpoint:"/issues/".concat(t.groupId,"/similar/?").concat(x.stringify(Te(Te({},r.query),{},{limit:50,version:i}))),dataKey:"similar"})}L.a.fetch(n)}},{key:"hasSimilarityV2Feature",value:function(){return this.props.project.features.includes("similarity-view-v2")}},{key:"hasSimilarityFeature",value:function(){return this.props.project.features.includes("similarity-view")}},{key:"render",value:function(){var e=this.props,t=e.params,r=e.project,n=t.orgId,i=t.groupId,a=this.state,s=a.similarItems,o=a.filteredSimilarItems,l=a.loading,u=a.error,f=a.v2,g=a.similarLinks,m=this.hasSimilarityV2Feature(),d=l,p=u&&!d,b=!p&&!d,h=this.hasSimilarityFeature()&&(s.length>=0||o.length>=0)&&b;return Object(z.f)(c.a.Fragment,null,Object(z.f)(C.b,{type:"warning"},Object(N.b)("This is an experimental feature. Data may not be immediately available while we process merges.")),Object(z.f)(Be,null,Object(z.f)(Ge,null,Object(N.b)("Issues with a similar stack trace")),m&&Object(z.f)(F.a,{merged:!0,active:f?"new":"old"},Object(z.f)(D.a,{barId:"old",size:"small",onClick:this.toggleSimilarityVersion},Object(N.b)("Old Algorithm")),Object(z.f)(D.a,{barId:"new",size:"small",onClick:this.toggleSimilarityVersion},Object(N.b)("New Algorithm")))),d&&Object(z.f)(M.default,null),p&&Object(z.f)(P.a,{message:Object(N.b)("Unable to load similar issues, please try again later"),onRetry:this.fetchData}),h&&Object(z.f)(Ne,{items:s,filteredItems:o,onMerge:this.handleMerge,orgId:n,project:r,groupId:i,pageLinks:g,v2:f}))}}]),r}(c.a.Component);ze.displayName="SimilarStackTrace";var We=ze,Ge=Object(k.a)("h4",{target:"e1xsq7ua0",label:"Title"})({name:"gx0lhm",styles:"margin-bottom:0;"}),Be=Object(k.a)("div",{target:"e1xsq7ua1",label:"HeaderWrapper"})("display:flex;align-items:center;justify-content:space-between;margin-bottom:",Object(R.a)(2),";"),He=function(e){var t=e.project,r=s()(e,["project"]);return Object(z.f)(l.a,{features:["similarity-view"],project:t},Object(z.f)(We,i()({project:t},r)))};He.displayName="GroupSimilarIssues";t.default=He}}]);
//# sourceMappingURL=GroupSimilarIssues.js.map