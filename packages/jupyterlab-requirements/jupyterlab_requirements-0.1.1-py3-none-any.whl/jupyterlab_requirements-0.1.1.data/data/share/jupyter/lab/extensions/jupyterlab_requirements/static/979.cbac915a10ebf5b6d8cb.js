(self.webpackChunkjupyterlab_requirements=self.webpackChunkjupyterlab_requirements||[]).push([[979],{979:(e,t,s)=>{"use strict";s.r(t),s.d(t,{commandIDs:()=>U,default:()=>J});var a=s(157),n=s(271),i=s.n(n),l=s(211),o=s(916),r=s(486),c=s.n(r);const d="thoth-row-button";class h extends n.Component{constructor(e){super(e),this.state={name:"",version:"*"},this.handleChange=this.handleChange.bind(this)}handleChange(e){"package_name"==e.target.name&&this.setState({name:e.target.value}),"package_version"==e.target.name&&this.setState({version:e.target.value})}handleItemDeleted(e){this.props.deleteSavedRow(e)}handleItemEdited(e,t){this.props.editSavedRow(e,t)}render(){var e=this;return n.createElement("tr",null,n.createElement("td",null,n.createElement("input",{className:"thoth-package-name-input",disabled:!0,type:"text",name:"package_name",value:this.props.name})),n.createElement("td",null,n.createElement("input",{className:"thoth-constraint-input",disabled:!0,type:"text",name:"package_version",value:this.props.version})),n.createElement("td",null,this.props.installed),n.createElement("td",null,n.createElement("td",null,n.createElement("button",{className:"thoth-row-button-deactivated"},"Add")),n.createElement("td",null,n.createElement("button",{title:"Edit saved package",className:d,onClick:e.handleItemEdited.bind(e,this.props.name,this.props.version)},"Edit")),n.createElement("td",null,n.createElement("button",{title:"Delete saved package",className:d,onClick:e.handleItemDeleted.bind(e,this.props.name)},"Delete"))))}}const g="thoth-row-button";class p extends n.Component{constructor(e){super(e),this.state={name:"",version:"*"},this.handleItemAdded=this.handleItemAdded.bind(this),this.handleChange=this.handleChange.bind(this)}handleChange(e){"package_name"==e.target.name&&this.setState({name:e.target.value}),"package_version"==e.target.name&&this.setState({version:e.target.value})}handleItemAdded(){var e=this.state.name.toString(),t=this.state.version.toString();this.props.storeRow(e,t)}handleItemDeleted(e){this.props.deleteRow(e)}render(){var e=this;return n.createElement("tr",null,n.createElement("td",null,n.createElement("input",{className:"thoth-package-name-input",type:"text",name:"package_name",value:this.state.name,onChange:this.handleChange})),n.createElement("td",null,n.createElement("input",{className:"thoth-constraint-input",type:"text",name:"package_version",value:this.state.version,onChange:this.handleChange})),n.createElement("td",null,this.props.installed),n.createElement("td",null,n.createElement("td",null,n.createElement("button",{title:"Include new package",className:g,onClick:e.handleItemAdded.bind(e)},"Add")),n.createElement("td",null,n.createElement("button",{className:"thoth-row-button-deactivated"},"Edit")),n.createElement("td",null,n.createElement("button",{title:"Delete new package",className:g,onClick:e.handleItemDeleted.bind(e,this.state.name)},"Delete"))))}}const m="thoth-table";class u extends n.Component{constructor(e){super(e),this.state={headers:["Package","Constraint","Installed","Actions"]}}renderTableHeader(){return this.state.headers.map(((e,t)=>n.createElement("th",{key:t},e.toUpperCase())))}renderRows(){var e=this,t=this.props.packages,s=this.props.initial_packages,a=this.props.installed_packages,i=[];for(let[l,o]of Object.entries(s))c().has(a,l)?i.push(n.createElement(h,{name:l,version:o,installed:"Y",packages:t,editSavedRow:e.props.editSavedRow,deleteSavedRow:e.props.deleteSavedRow})):i.push(n.createElement(h,{name:l,version:o,installed:"N",packages:t,editSavedRow:e.props.editSavedRow,deleteSavedRow:e.props.deleteSavedRow}));for(let[s,a]of Object.entries(t))i.push(n.createElement(p,{name:s,installed:"N",packages:t,storeRow:e.props.storeRow,deleteRow:e.props.deleteRow}));return i}render(){return n.createElement("table",{id:m,className:m},n.createElement("thead",null,this.renderTableHeader()),n.createElement("tbody",null,this.renderRows()))}}class k extends n.Component{constructor(e){super(e)}render(){return n.createElement(u,{packages:this.props.packages,initial_packages:this.props.initial_packages,installed_packages:this.props.installed_packages,storeRow:this.props.storeRow,editSavedRow:this.props.editSavedRow,deleteRow:this.props.deleteRow,deleteSavedRow:this.props.deleteSavedRow})}}class _ extends n.Component{constructor(e){super(e)}saveRequirements(){this.props.onSave()}render(){return n.createElement("button",{title:"Save dependencies",className:"thoth-save-button",onClick:this.saveRequirements.bind(this)},"Save")}}class v extends n.Component{constructor(e){super(e)}onInstall(){this.props.install()}render(){return n.createElement("button",{title:"Install dependencies",className:"thoth-install-button",onClick:this.onInstall.bind(this)},"Install")}}class w extends n.Component{constructor(e){super(e)}addNewEmptyRow(){this.props.addNewRow()}render(){return n.createElement("button",{title:"Add new line! Only one empty line is displayed.",className:"thoth-new-package-button",onClick:this.addNewEmptyRow.bind(this)},"New")}}class E{constructor(e="pypi",t="https://pypi.org/simple",s=!0,a,n){this.name=e,this.url=t,this.verify_ssl=s,this.warehouse=a,this.warehouse_api_url=n}}function R(e){const t=e.content.model.metadata.get("language_info");console.log("language_info:",t);const s=c().get(t,"version");console.log("python version identified:",s);const a=s.match(/\d.\d/);if(console.log("match identified:",a),null==a)throw new Error(`Python version '${s}' does not match required pattern.`);return a[0]}function S(e,t){const s=e.model.metadata;if(0!=s.has("requirements"))return console.log("Notebook requirements already exist. Updating..."),console.log(),void 0===t.packages?void s.set("requirements",{}):void s.set("requirements",JSON.stringify(t));s.set("requirements",JSON.stringify(t)),console.log("Notebook requirements have been set successfully.")}function b(e,t){const s=e.model.metadata;0==s.has("requirements_lock")||console.debug("Notebook requirement_lock already exist. Updating."),s.set("requirements_lock",JSON.stringify(t)),console.log("Notebook requirements_lock have been set successfully.")}var f=s(648),y=s(858);async function q(e="",t={}){const s=y.ServerConnection.makeSettings(),a=f.URLExt.join(s.baseUrl,"jupyterlab-requirements",e);let n;try{n=await y.ServerConnection.makeRequest(a,t,s)}catch(e){throw new y.ServerConnection.NetworkError(e)}const i=await n.json();if(!n.ok)throw new y.ServerConnection.ResponseError(n,i.message);return i}const N="thoth-ok-button",I="thoth-kernel-name-input";class O extends n.Component{constructor(e){super(e),this.onStart=this.onStart.bind(this),this.changeUIstate=this.changeUIstate.bind(this),this.addNewRow=this.addNewRow.bind(this),this.editSavedRow=this.editSavedRow.bind(this),this.storeRow=this.storeRow.bind(this),this.deleteRow=this.deleteRow.bind(this),this.deleteSavedRow=this.deleteSavedRow.bind(this),this.onSave=this.onSave.bind(this),this.checkInstalledPackages=this.checkInstalledPackages.bind(this),this.lock_using_thoth=this.lock_using_thoth.bind(this),this.lock_using_pipenv=this.lock_using_pipenv.bind(this),this.install=this.install.bind(this),this.setKernel=this.setKernel.bind(this),this.createConfig=this.createConfig.bind(this),this.setKernelName=this.setKernelName.bind(this),this.state={kernel_name:"jupyterlab_requirements",status:"loading",packages:{},initial_packages:{},installed_packages:{},requirements:{packages:{},requires:{python_version:R(this.props.panel)},sources:[new E]},error_msg:void 0}}changeUIstate(e,t,s,a,n,i,l){var o=this.state;console.log("initial",o),c().set(o,"status",e),c().set(o,"packages",t),c().set(o,"initial_packages",s),c().set(o,"installed_packages",a),c().set(o,"requirements",n),c().set(o,"kernel_name",i),c().set(o,"error_msg",l),console.log("new",o),this.setState(o)}setKernelName(e){const t=e.target.value;this.setState({kernel_name:t})}addNewRow(){const e=this.state.packages;c().set(e,"",""),console.log("added package",e),this.changeUIstate("editing",e,this.state.initial_packages,this.state.installed_packages,this.state.requirements,this.state.kernel_name)}editSavedRow(e,t){const s=this.state.initial_packages,a=this.state.packages;c().unset(s,e),c().set(a,e,t),console.log("After editing (initial)",s),console.log("After editing (current)",a),this.changeUIstate("editing",a,s,this.state.installed_packages,this.state.requirements,this.state.kernel_name)}deleteRow(e){const t=this.state.packages;c().unset(t,e),console.log("After deleting",t),this.changeUIstate("editing",t,this.state.initial_packages,this.state.installed_packages,this.state.requirements,this.state.kernel_name)}deleteSavedRow(e){const t=this.state.initial_packages;c().unset(t,e),console.log("After deleting saved",t),this.changeUIstate("editing",this.state.packages,t,this.state.installed_packages,this.state.requirements,this.state.kernel_name)}storeRow(e,t){let s=this.state.packages;c().set(s,e,t);const a={};c().forIn(s,(function(e,t){console.log(t+" goes "+e),""!=t&&c().set(a,t,e)})),console.log("new packages",a),this.changeUIstate("editing",a,this.state.initial_packages,this.state.installed_packages,this.state.requirements,this.state.kernel_name)}onSave(){const e=this.state.requirements,t=this.state.packages;console.log("added_packages",t);const s=this.state.initial_packages;console.log("initial_packages",s);const a={};c().forIn(s,(function(e,t){0==c().has(s,"")&&c().set(a,t,e)}));const n={};if(c().forIn(t,(function(e,s){0==c().has(t,"")&&(c().set(a,s,e),c().set(n,s,e))})),c().size(a)>0){if(c().isEqual(a,this.state.installed_packages))return void this.changeUIstate("stable",this.state.packages,this.state.initial_packages,this.state.installed_packages,this.state.requirements,this.state.kernel_name);console.log("total packages",a);var i={packages:a,requires:e.requires,sources:e.sources};return console.log("Requirements before installing are: ",i),S(this.props.panel,i),this.props.panel.context.save(),void this.changeUIstate("saved",{},a,this.state.installed_packages,i,this.state.kernel_name)}var l={packages:a,requires:e.requires,sources:e.sources};return console.log("Requirements are: ",l),S(this.props.panel,l),void this.changeUIstate("failed_no_reqs",n,this.state.initial_packages,this.state.installed_packages,this.state.requirements,this.state.kernel_name)}async install(){try{const e=await async function(e,t={}){const s={kernel_name:e};try{return await q("kernel/install",{body:JSON.stringify(s),method:"POST"})}catch(e){console.error(`Error on POST /jupyterlab-requirements/kernel/install.\n${e}`)}}(this.state.kernel_name);return console.log("Install message",e),void this.changeUIstate("setting_kernel",{},this.state.initial_packages,this.state.initial_packages,this.state.requirements,this.state.kernel_name)}catch(e){console.log("Error installing requirements",e),this.changeUIstate("failed",this.state.packages,this.state.initial_packages,this.state.installed_packages,this.state.requirements,this.state.kernel_name,"Error install dependencies in the new virtual environment, please contact Thoth team.")}}async store_dependencies_on_disk(e,t){const s=await async function(e,t,s,a={}){const n={kernel_name:e,requirements:t,requirement_lock:s};try{return await q("file/dependencies",{body:JSON.stringify(n),method:"POST"})}catch(e){console.error(`Error on POST /jupyterlab-requirements/file/dependencies.\n${e}`)}}(this.state.kernel_name,JSON.stringify(e),JSON.stringify(t));console.log("Store message",s)}async setKernel(){try{const e=await async function(e,t={}){const s={kernel_name:e};try{return await q("kernel/create",{body:JSON.stringify(s),method:"POST"})}catch(e){console.error(`Error on POST /jupyterlab-requirements/kernel/create.\n${e}`)}}(this.state.kernel_name);return console.log("Kernel message",e),void this.changeUIstate("ready",{},this.state.initial_packages,this.state.initial_packages,this.state.requirements,this.state.kernel_name)}catch(e){return console.log("Error creating jupyter kernel",e),void this.changeUIstate("failed",this.state.packages,this.state.initial_packages,this.state.installed_packages,this.state.requirements,this.state.kernel_name,"Error setting new environment in a jupyter kernel, please contact Thoth team.")}}async lock_using_thoth(){this.changeUIstate("locking_requirements",this.state.packages,this.state.initial_packages,this.state.installed_packages,this.state.requirements,this.state.kernel_name);const e=await this.createConfig();console.log("thoth config submitted",JSON.stringify(e));const t=this.state.requirements;console.log("Requirements submitted",JSON.stringify(t));try{const s=await async function(e,t,s,a={}){const n={kernel_name:e,thoth_config:t,requirements:s};try{const e=await q("thoth/resolution",{body:JSON.stringify(n),method:"POST"});return JSON.parse(JSON.stringify(e))}catch(e){console.error(`Error on POST /jupyterlab-requirements/thoth/resolution.\n${e}`)}}(this.state.kernel_name,JSON.stringify(e),JSON.stringify(t));console.log("Advise received",s),0==s.error?(S(this.props.panel,s.requirements),b(this.props.panel,s.requirement_lock),function(e,t){const s=e.model.metadata;0==s.has("thoth_config")||console.debug("Notebook Thoth config already exist. Updating."),s.set("thoth_config",JSON.stringify(t)),console.log("Notebook Thoth config have been set successfully.")}(this.props.panel,e),this.changeUIstate("installing_requirements",{},this.state.initial_packages,this.state.installed_packages,s.requirements,this.state.kernel_name)):this.lock_using_pipenv()}catch(e){console.log("Error locking requirements with Thoth",e),this.lock_using_pipenv()}}async lock_using_pipenv(){this.changeUIstate("locking_requirements_using_pipenv",this.state.packages,this.state.initial_packages,this.state.installed_packages,this.state.requirements,this.state.kernel_name);const e=this.state.requirements;console.log("Requirements for pipenv",JSON.stringify(e));try{const t=await async function(e,t,s={}){const a={kernel_name:e,requirements:t};try{const e=await q("pipenv",{body:JSON.stringify(a),method:"POST"});return JSON.parse(JSON.stringify(e))}catch(e){console.error(`Error on POST /jupyterlab-requirements/pipenv.\n${e}`)}}(this.state.kernel_name,JSON.stringify(e));return console.log("Result received",t),0==t.error?(b(this.props.panel,t.requirements_lock),void this.changeUIstate("installing_requirements",{},this.state.initial_packages,this.state.installed_packages,e,this.state.kernel_name)):void this.changeUIstate("failed",this.state.packages,this.state.initial_packages,this.state.installed_packages,this.state.requirements,this.state.kernel_name,"No resolution engine was able to install dependendices, please contact Thoth team.")}catch(e){return console.log("Error locking requirements with pipenv",e),void this.changeUIstate("failed",this.state.packages,this.state.initial_packages,this.state.installed_packages,this.state.requirements,this.state.kernel_name,"No resolution engine was able to install dependendices, please contact Thoth team.")}}async onStart(e){var t=this.props.initial_requirements;console.log("initial requirements",t);var s=t.packages;if(0==c().size(s))return void this.changeUIstate(status="initial",this.state.packages,s,this.state.installed_packages,t,this.state.kernel_name);const a=this.props.initial_requirements_lock;if(null==a)return void this.changeUIstate(status="only_install",this.state.packages,s,this.state.installed_packages,t,this.state.kernel_name);const n={};c().forIn(a.default,(function(e,t){c().set(n,t,e.version.replace("==",""))})),console.log(n);const i=function(e){const t=e.content.model.metadata.get("kernelspec");console.log("kernel info:",t);const s=c().get(t,"name");return console.log("kernel_name identified:",s),s}(this.props.panel);return 1==await this.checkInstalledPackages(i,n)?void this.changeUIstate("stable",this.state.packages,s,s,t,i):void this.changeUIstate("only_install",this.state.packages,s,this.state.installed_packages,t,i)}async checkInstalledPackages(e,t){const s=await async function(e,t={}){const s={kernel_name:e};try{const e=await q("kernel/packages",{body:JSON.stringify(s),method:"POST"});return JSON.parse(JSON.stringify(e))}catch(e){console.error(`Error on POST /jupyterlab-requirements/kernel/packages.\n${e}`)}}(e);console.log("packages installed (pip list)",s);const a={};return c().forIn(s,(function(e,s){c().has(t,s.toLowerCase())&&c().get(t,s.toLowerCase())==e&&c().set(a,s,e)})),console.log("Installed packages:",a),!!c().isEqual(c().size(t),c().size(a))}async createConfig(){const e=await async function(e,t={}){const s={kernel_name:e};try{const e=await q("thoth/config",{body:JSON.stringify(s),method:"POST"});return JSON.parse(JSON.stringify(e))}catch(e){console.error(`Error on POST /jupyterlab-requirements/thoth/config.\n${e}`)}}(this.state.kernel_name);return console.log("Config file",e),e}render(){let e="float:left";return"loading"==this.state.status?(this.onStart(this.props.panel),n.createElement("div",null,"Loading...")):"initial"==this.state.status?n.createElement("div",null,n.createElement("div",{className:e},n.createElement(w,{addNewRow:this.addNewRow})),n.createElement("div",null,n.createElement("p",null," No dependencies found! Click New to add package. "))):"no_reqs_to_save"==this.state.status?n.createElement("div",null,n.createElement("div",null,n.createElement(k,{initial_packages:this.state.initial_packages,installed_packages:this.state.installed_packages,packages:this.state.packages,storeRow:this.storeRow,deleteRow:this.deleteRow,editSavedRow:this.editSavedRow,deleteSavedRow:this.deleteSavedRow})),n.createElement("div",null,n.createElement(w,{addNewRow:this.addNewRow})),n.createElement("div",null,n.createElement(_,{onSave:this.onSave,changeUIstate:this.changeUIstate})),n.createElement("p",null," Dependencies missing! Click New to add package. ")):"only_install"==this.state.status?n.createElement("div",null,n.createElement("div",null,n.createElement(k,{initial_packages:this.state.initial_packages,installed_packages:this.state.installed_packages,packages:this.state.packages,storeRow:this.storeRow,deleteRow:this.deleteRow,editSavedRow:this.editSavedRow,deleteSavedRow:this.deleteSavedRow})),n.createElement("div",null,n.createElement(w,{addNewRow:this.addNewRow})),n.createElement("div",null,n.createElement(v,{changeUIstate:this.changeUIstate,install:this.lock_using_thoth})),n.createElement("div",null,n.createElement("p",null,"Dependencies found in notebook metadata but lock file is missing. ")),n.createElement("br",null)," OPTIONS",n.createElement("div",null,"Kernel name ",n.createElement("input",{title:"Kernel name",className:I,type:"text",name:"kernel_name",value:this.state.kernel_name,onChange:this.setKernelName}))):"editing"==this.state.status?n.createElement("div",null,n.createElement("div",null,n.createElement(k,{initial_packages:this.state.initial_packages,installed_packages:this.state.installed_packages,packages:this.state.packages,storeRow:this.storeRow,deleteRow:this.deleteRow,editSavedRow:this.editSavedRow,deleteSavedRow:this.deleteSavedRow})),n.createElement("div",null,n.createElement(w,{addNewRow:this.addNewRow})),n.createElement("div",null,n.createElement(_,{onSave:this.onSave,changeUIstate:this.changeUIstate}))):"saved"==this.state.status?n.createElement("div",null,n.createElement("div",null,n.createElement(k,{initial_packages:this.state.initial_packages,installed_packages:this.state.installed_packages,packages:this.state.packages,storeRow:this.storeRow,deleteRow:this.deleteRow,editSavedRow:this.editSavedRow,deleteSavedRow:this.deleteSavedRow})),n.createElement("div",null,n.createElement(w,{addNewRow:this.addNewRow})),n.createElement("div",null,n.createElement(v,{changeUIstate:this.changeUIstate,install:this.lock_using_thoth})),"OPTIONS",n.createElement("div",null," Kernel name",n.createElement("input",{title:"Kernel name",className:I,type:"text",name:"kernel_name",value:this.state.kernel_name,onChange:this.setKernelName}))):"locking_requirements"==this.state.status?n.createElement("div",null,n.createElement("div",null,n.createElement(k,{initial_packages:this.state.initial_packages,installed_packages:this.state.installed_packages,packages:this.state.packages,storeRow:this.storeRow,deleteRow:this.deleteRow,editSavedRow:this.editSavedRow,deleteSavedRow:this.deleteSavedRow})),n.createElement("fieldset",null,n.createElement("p",null,"Contacting thoth for advise... please be patient!"))):"installing_requirements"==this.state.status?(this.install(),n.createElement("div",null,n.createElement("div",null,n.createElement(k,{initial_packages:this.state.initial_packages,installed_packages:this.state.installed_packages,packages:this.state.packages,storeRow:this.storeRow,deleteRow:this.deleteRow,editSavedRow:this.editSavedRow,deleteSavedRow:this.deleteSavedRow})),n.createElement("fieldset",null,n.createElement("p",null,"Requirements locked and saved!",n.createElement("br",null),"Installing new requirements...")))):"setting_kernel"==this.state.status?(this.setKernel(),n.createElement("div",null,n.createElement("div",null,n.createElement(k,{initial_packages:this.state.initial_packages,installed_packages:this.state.installed_packages,packages:this.state.packages,storeRow:this.storeRow,deleteRow:this.deleteRow,editSavedRow:this.editSavedRow,deleteSavedRow:this.deleteSavedRow})),n.createElement("fieldset",null,n.createElement("p",null,"Requirements locked and saved!",n.createElement("br",null),"Requirements installed!",n.createElement("br",null),"Setting new kernel for your notebook...")))):"failed_no_reqs"==this.state.status?n.createElement("div",null,n.createElement("div",{className:e},n.createElement("button",{title:"Add requirements.",className:N,onClick:()=>this.changeUIstate("loading",this.state.packages,this.state.initial_packages,this.state.installed_packages,this.state.requirements,this.state.kernel_name)},"Ok")),n.createElement("div",null,n.createElement("p",null,"No requirements have been added please click add after inserting package name!"))):"locking_requirements_using_pipenv"==this.state.status?n.createElement("div",null,n.createElement("p",null,"Thoth resolution engine failed... pipenv will be used to lock and install dependencies!")):"failed"==this.state.status?n.createElement("div",null,n.createElement("div",null,n.createElement(k,{initial_packages:this.state.initial_packages,installed_packages:this.state.installed_packages,packages:this.state.packages,storeRow:this.storeRow,deleteRow:this.deleteRow,editSavedRow:this.editSavedRow,deleteSavedRow:this.deleteSavedRow})),n.createElement("div",{className:e},n.createElement("button",{title:"Finish.",className:N,onClick:()=>this.changeUIstate("loading",this.state.packages,this.state.initial_packages,this.state.installed_packages,this.state.requirements,this.state.kernel_name)},"Ok")),n.createElement("div",null,n.createElement("p",null,this.state.error_msg))):"stable"==this.state.status?n.createElement("div",null,n.createElement(k,{initial_packages:this.state.initial_packages,installed_packages:this.state.installed_packages,packages:this.state.packages,storeRow:this.storeRow,deleteRow:this.deleteRow,editSavedRow:this.editSavedRow,deleteSavedRow:this.deleteSavedRow}),n.createElement("div",null,n.createElement(w,{addNewRow:this.addNewRow})),n.createElement("div",null,n.createElement("p",null," Everything installed and ready to use!"))):("ready"==this.state.status&&this.props.panel.sessionContext.session.changeKernel({name:this.state.kernel_name}),n.createElement("div",null,n.createElement(k,{initial_packages:this.state.initial_packages,installed_packages:this.state.installed_packages,packages:this.state.packages,storeRow:this.storeRow,deleteRow:this.deleteRow,editSavedRow:this.editSavedRow,deleteSavedRow:this.deleteSavedRow}),n.createElement("div",{className:e},n.createElement("button",{title:"Reload Page and assign kernel.",className:N,onClick:()=>this.changeUIstate("stable",this.state.packages,this.state.initial_packages,this.state.installed_packages,this.state.requirements,this.state.kernel_name)},"Ok")),n.createElement("div",null,n.createElement("fieldset",null,n.createElement("p",null,"Requirements locked and saved!",n.createElement("br",null),"Requirements installed!",n.createElement("br",null),"New kernel created!",n.createElement("br",null),"Click ok to start working on your notebook.",n.createElement("br",null))))))}}class C{constructor(){this.openWidget=async()=>{const e=this.panel.content.model.toString();console.log("metadata",e);const t=await(s=this.panel,new Promise((async(e,t)=>{try{const t=s.model.metadata.get("requirements");if(void 0===t)return console.log("requirements key is not in notebook metadata! Initialize requirements for user..."),e({packages:{},requires:{python_version:R(s)},sources:[new E]});let a=JSON.parse(t.toString());return 0==c().size(a)?(console.log("requirements key is not in notebook metadata! Initialize requirements for user..."),e({packages:{},requires:{python_version:R(s)},sources:[new E]})):(console.log("requirements key is in notebook metadata!"),e(a))}catch(e){t(e)}})));var s;console.log("requirements",t);const n=await function(e){return new Promise((async(t,s)=>{try{const s=e.model.metadata.get("requirements_lock");void 0===s&&(console.log("requirement_lock key is not in notebook metadata!"),t(null));var a=JSON.parse(s.toString());console.log("requirements_lock key is in notebook metadata!"),t(a)}catch(e){s(e)}}))}(this.panel);console.log("requirements_lock",n);const r=function(e){let t=e.model.metadata.get("thoth_config");return null==t?(console.log("thoth_config key is not in notebook metadata!"),null):JSON.parse(JSON.stringify(t))}(this.panel);console.log("Thoth config from notebook metadata",r);const d=a.ReactWidget.create(i().createElement(O,{panel:this.panel,initial_requirements:t,initial_requirements_lock:n,initial_config_file:r}));l.MessageLoop.sendMessage(d,o.Widget.Msg.UpdateRequest);const h={title:"Manage Dependencies",body:d,buttons:[a.Dialog.cancelButton()]};new a.Dialog(h).launch(),this.panel.context.save()}}createNew(e,t){this.panel=e;const s=new a.ToolbarButton({label:"Manage Dependencies ...",onClick:this.openWidget,tooltip:"Manage Dependencies ..."});return e.toolbar.insertItem(10,"dependencyManagement",s),s}}const U={dependencyManagement:"notebook:manage-dependencies"},J={id:"jupyterlab_requirements",autoStart:!0,activate:function(e){const t=new C;e.docRegistry.addWidgetExtension("Notebook",t),e.contextMenu.addItem({selector:".jp-Notebook",command:U.dependencyManagement,rank:-.5})}}}}]);