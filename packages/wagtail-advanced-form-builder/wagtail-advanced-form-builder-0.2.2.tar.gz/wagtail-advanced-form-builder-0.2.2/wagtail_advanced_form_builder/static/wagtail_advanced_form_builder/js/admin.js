!function(e){var t={};function i(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(s,r,function(t){return e[t]}.bind(null,r));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/wagtail_advanced_form_builder/static/wagtail_advanced_form_builder/",i(i.s=1)}([,function(e,t){class i{constructor(){this.registeredFieldNames=[],this.fields=$(".waf--field"),this.formRulesContainers=$(".waf--form-rules"),this.uniqueFieldCounter=0}swapRulesInputsForSelectDropdowns(){if(this.registeredFieldNames.length){$(".waf--form-rules .waf--rule-condition").each((e,t)=>{const i=$(t),s=[],r=i.parents(".waf--field").find('input[type="text"]').first().val(),n=i.parents("#form-list").first().find(".waf--html-field"),l=[];n.each((e,t)=>{l.push($(t).find('input[type="text"]').first().val())});for(let e=0;e<this.registeredFieldNames.length;e++)if(this.registeredFieldNames[e]!==r&&-1===l.indexOf(this.registeredFieldNames[e])){const t=document.createElement("option");t.value=this.registeredFieldNames[e],t.text=this.registeredFieldNames[e],s.push(t)}const d=i.find('input[type="text"][name$="field_name"]').first();if(d.length){d.parent().parent().addClass("choice_field widget-select");const e=d.val(),t=document.createElement("select");t.id=d.attr("id"),t.name=d.attr("name");for(let e=0;e<s.length;e++)t.appendChild(s[e]);d.replaceWith(t),$(t).val(e)}else{const e=i.find("select").first(),t=e.val();e.empty();for(let t=0;t<s.length;t++)e[0].appendChild(s[t]);e.val(t)}})}}toggleRulesContainers(){this.formRulesContainers=$(".waf--form-rules"),this.registeredFieldNames.length>1?(this.formRulesContainers.show(),this.formRulesContainers.siblings("label").show(),this.swapRulesInputsForSelectDropdowns()):(this.formRulesContainers.hide(),this.formRulesContainers.siblings("label").hide())}registerFieldNames(){this.registeredFieldNames=[],this.fields=$(".waf--field"),this.fields.each((e,t)=>{const i=$(t);let s=i.parents('div[id^="form-"][id$="-container"]').first();s.length||(s=i.parents('div[id^="field-list"]').first());if("1"!==s.find('input[type="hidden"][id$="-deleted"]').first().attr("value")){const e=i.find('input[type="text"]').first(),t=e.val();void 0!==t&&""!==t&&this.registeredFieldNames.push(t),e.unbind("keyup change"),e.on("keyup change",function(e,t,i){let s;return function(){const r=this,n=arguments,l=function(){s=null,i||e.apply(r,n)},d=i&&!s;clearTimeout(s),s=setTimeout(l,t),d&&e.apply(r,n)}}(()=>{this.registerFieldNames()},500))}}),this.toggleRulesContainers()}initField(e){const t=e.parents(".c-sf-container__block-container").first(),i=e.find("> .field"),s=t.find(".c-sf-block__header");if(!t.find("[data-expand-trigger]").length){e.attr("id","field-list-"+this.uniqueFieldCounter);let t=!1;i.each((e,i)=>{if(e>0){const e=$(i);e.find("div.error").length||(e.hide(),t=!0)}}),$(`<a href="#" data-expand-trigger="field-list-${this.uniqueFieldCounter}">${t?"Configure field":"Collapse field"}</a>`).insertBefore(s.find("h3").first()),this.uniqueFieldCounter+=1}}initFieldDisplay(){this.fields.each((e,t)=>{this.initField($(t))})}initExpandTrigger(e){const t=e.attr("data-expand-trigger"),i=$("#"+t).find("> .field");"Collapse field"===e.html()?(i.each((function(e){e>0&&$(this).hide()})),e.html("Configure field")):(i.each((function(){$(this).show()})),e.html("Collapse field"))}initExpandTriggers(){this.expandTriggers=$("[data-expand-trigger]"),this.expandTriggers.on("click",e=>{e.preventDefault(),this.initExpandTrigger($(e.currentTarget))})}}class s{constructor(){this.mutationObserverConfig={attributes:!0,childList:!0,characterData:!0,subTree:!0},this.streamfieldList=$("#form-list")[0],this.formRulesLists=$("[id$=-rules-conditions-list]")}monitorMutations(){this.newFieldMutationObserver=new MutationObserver(e=>{e.forEach(e=>{const t=e.addedNodes;if(null!==t){this.fieldRegistry.registerFieldNames();const e=$(t);e.each((t,i)=>{const s=$(i);this.fieldRegistry.initField(s);const r=e.find("[data-expand-trigger]");r.unbind("click"),r.on("click",e=>{e.preventDefault(),this.fieldRegistry.initExpandTrigger($(e.currentTarget))})}),e.find("[id$=-rules-conditions-list]").each((e,t)=>{this.newRuleMutationObserver.observe(t,this.mutationObserverConfig)})}})}),this.newFieldMutationObserver.observe(this.streamfieldList,this.mutationObserverConfig),this.newRuleMutationObserver=new MutationObserver(e=>{e.forEach(e=>{null!==e.addedNodes&&this.fieldRegistry.registerFieldNames()})}),this.formRulesLists.each((e,t)=>{this.newRuleMutationObserver.observe(t,this.mutationObserverConfig)}),$(this.streamfieldList).find('[id^="form-"][id$="-delete"]').on("click",e=>{this.fieldRegistry.registerFieldNames()})}init(){this.fieldRegistry=new i,this.fieldRegistry.registerFieldNames(),this.fieldRegistry.initFieldDisplay(),this.fieldRegistry.initExpandTriggers(),this.monitorMutations()}}$(document).ready((function(){(new s).init()}))}]);