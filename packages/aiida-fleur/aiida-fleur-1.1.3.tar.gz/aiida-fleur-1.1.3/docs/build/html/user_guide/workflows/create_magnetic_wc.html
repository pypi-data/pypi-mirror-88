

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Fleur Create Magnetic Film workchain &mdash; AiiDA-FLEUR 1.1.3 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within AiiDA-FLEUR 1.1.3 documentation"
          href="../../_static/opensearch.xml"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Fleur Spin-Spiral Dispersion workchain" href="ssdisp_wc.html" />
    <link rel="prev" title="Fleur core-hole workflow" href="corehole_wc.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> AiiDA-FLEUR
          

          
          </a>

          
            
            
              <div class="version">
                1.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../ug_index.html">User’s guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../getting_started/getting_started.html">Getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/fleur_data_plugins.html">AiiDA-FLEUR Data Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../calculations/fleur_calculation_plugins.html">AiiDA-FLEUR Calculations</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="wc_index.html">AiiDA-FLEUR WorkChains</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="wc_index.html#general-design">General design</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="wc_index.html#workchain-classification">Workchain classification</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="wc_index.html#basic-technical-workchains">Basic (Technical) Workchains</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="wc_index.html#more-advanced-scientific-workchains">More advanced (Scientific) Workchains</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/cmd_index.html">Verdi command line extentions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tools/tools_index.html">Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/tutorials.html">Tutorials</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hints/hints_faq.html">Hints</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hints/exit_codes.html">Exit codes</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../devel_guide/dg_index.html">Developer’s guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../module_guide/mg_index.html">Source code Documentation (API reference)</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">AiiDA-FLEUR</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../ug_index.html">User’s guide</a> &raquo;</li>
        
          <li><a href="wc_index.html">AiiDA-FLEUR WorkChains</a> &raquo;</li>
        
      <li>Fleur Create Magnetic Film workchain</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="fleur-create-magnetic-film-workchain">
<span id="create-magnetic-wc"></span><h1><a class="toc-backref" href="#id1">Fleur Create Magnetic Film workchain</a><a class="headerlink" href="#fleur-create-magnetic-film-workchain" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p><strong>Current version</strong>: 0.1.1</p></li>
<li><p><strong>Class</strong>: FleurCreateMagneticWorkChain</p></li>
<li><p><strong>String to pass to the</strong> <a class="reference external" href="https://aiida-core.readthedocs.io/en/latest/reference/apidoc/aiida.plugins.html#aiida.plugins.WorkflowFactory" title="(in AiiDA v1.5)"><code class="xref py py-func docutils literal notranslate"><span class="pre">WorkflowFactory()</span></code></a>: <code class="docutils literal notranslate"><span class="pre">fleur.create_magnetic</span></code></p></li>
<li><p><strong>Workflow type</strong>: Scientific workchain</p></li>
</ul>
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#fleur-create-magnetic-film-workchain" id="id1">Fleur Create Magnetic Film workchain</a></p>
<ul>
<li><p><a class="reference internal" href="#description-purpose" id="id2">Description/Purpose</a></p></li>
<li><p><a class="reference internal" href="#input-nodes" id="id3">Input nodes</a></p></li>
<li><p><a class="reference internal" href="#output-nodes" id="id4">Output nodes</a></p></li>
<li><p><a class="reference internal" href="#supported-input-configurations" id="id5">Supported input configurations</a></p></li>
<li><p><a class="reference internal" href="#error-handling" id="id6">Error handling</a></p></li>
<li><p><a class="reference internal" href="#example-usage" id="id7">Example usage</a></p></li>
</ul>
</li>
</ul>
</div>
<p>Import Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aiida_fleur.workflows.create_magnetic_film</span> <span class="kn">import</span> <span class="n">FleurCreateMagneticWorkChain</span>
<span class="c1">#or</span>
<span class="n">WorkflowFactory</span><span class="p">(</span><span class="s1">&#39;fleur.create_magnetic&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="description-purpose">
<h2><a class="toc-backref" href="#id2">Description/Purpose</a><a class="headerlink" href="#description-purpose" title="Permalink to this headline">¶</a></h2>
<p>The workchain constructs a relaxed film structure which is ready-to-use in the subsequent
magnetic workchains, such as <a class="reference internal" href="dmi_wc.html#dmi-wc"><span class="std std-ref">DMI</span></a>, <a class="reference internal" href="mae_wc.html#mae-wc"><span class="std std-ref">MAE</span></a> or <a class="reference internal" href="ssdisp_wc.html#ssdisp-wc"><span class="std std-ref">SSDisp</span></a>
workchains.</p>
<p>The main inputs include information about the substrate (structure type, miller indices, element)
and deposited material. The main logic of the workchain is depicted on the figure below:</p>
<a class="reference internal image-reference" href="../../_images/create_magnetic_scheme.png"><img alt="../../_images/create_magnetic_scheme.png" class="align-center" src="../../_images/create_magnetic_scheme.png" style="width: 100%;" /></a>
<p>First, the workchain uses <a class="reference internal" href="eos_wc.html#eos-wc"><span class="std std-ref">EOS workchain</span></a> to find the equilibrium lattice parameters for
the substrate. For now only bcc and fcc substrate lattices are supported. Note, the algorithm always
uses conventional unit cells e.g. one gets 4 atoms in the unit cell for fcc lattice (see the figure
above).</p>
<p>After that, the workchain constructs a film which will be used for interlayer distance
relaxation via the <a class="reference internal" href="relax_wc.html#relax-wc"><span class="std std-ref">relaxation workchain</span></a>. The algorithm creates a film using given
miller indices and the ground state lattice constant and replaces some layers with another
elements given
in the input. For now only single-element layer replacements are possible i.e. each resulting layer
can be made of a single element. It is not possible to create e.g. B-N monolayer using this
workchain. If
we refer to the figure above, in ideal case one constructs a structure with an inversion or
z-reflection symmetry to calculate interlayer distances 1-4. However, the workchain does not
ensure an inversion or z-reflection symmetry, that is user responsibility to make it. For
instance, if you want to achieve one of these symmetries you should pass positive and negative
numbers of layer in the replacements dictionary of the wf parameters, see an example in
<a class="reference internal" href="#defaults-para-create"><span class="std std-ref">defaults</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>z-reflection or inversion symmetries are not ensured by the workchain even if you
specify symmetric replacements. Sometimes you need to remove a few layers before replacements.
For example, consider the case of fcc (110) film: if <code class="docutils literal notranslate"><span class="pre">size</span></code> is equal to (1, 1, 4) there are
will
be 8 layers in the template before the replacements since there are 2 layers in the unit cell.
That means the x,y positions of the first atom
are equal to (0.0, 0.0) when the 8th atom coordinates are equal to  (0.5, 0.5).
Thus, to achieve
z-reflection symmetry one needs to remove the 8th layer by specifying <code class="docutils literal notranslate"><span class="pre">'pop_last_layers'</span> <span class="pre">:</span> <span class="pre">1</span></code>
in the wf parameters.</p>
</div>
<p>Finally, using the result of the
relaxation workchain, a magnetic structure having no z-reflection symmetry is
created. For this the workchain takes first N layers from the relaxed structure and attaches M
substrate layers to the bottom. The final structure is z-centralised.</p>
</div>
<div class="section" id="input-nodes">
<h2><a class="toc-backref" href="#id3">Input nodes</a><a class="headerlink" href="#input-nodes" title="Permalink to this headline">¶</a></h2>
<p>The FleurCreateMagneticWorkChain employs
<a class="reference external" href="https://aiida.readthedocs.io/projects/aiida-core/en/latest/working/workflows.html#working-workchains-expose-inputs-outputs">exposed</a> feature of the AiiDA-core, thus inputs for the
<a class="reference internal" href="eos_wc.html#eos-wc"><span class="std std-ref">EOS</span></a> and <a class="reference internal" href="relax_wc.html#relax-wc"><span class="std std-ref">relaxation</span></a> workchains should be passed in the namespaces
<code class="docutils literal notranslate"><span class="pre">eos</span></code> and <code class="docutils literal notranslate"><span class="pre">relax</span></code> correspondingly (see <a class="reference internal" href="#example-use-create-magnetic"><span class="std std-ref">example of usage</span></a>).
Please note that the <cite>structure</cite> input node
is excluded from the EOS namespace and from the Relax SCF namespace
since corresponding input structures are created within the CreateMagnetic workchain.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 14%" />
<col style="width: 24%" />
<col style="width: 56%" />
<col style="width: 6%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>name</p></th>
<th class="head"><p>type</p></th>
<th class="head"><p>description</p></th>
<th class="head"><p>required</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>eos</p></td>
<td><p>namespace</p></td>
<td><p>inputs for nested EOS WC. structure input is excluded.</p></td>
<td><p>no</p></td>
</tr>
<tr class="row-odd"><td><p>relax</p></td>
<td><p>namespace</p></td>
<td><p>inputs for nested Relax WC. structure input of SCF sub-namespace is excluded</p></td>
<td><p>no</p></td>
</tr>
<tr class="row-even"><td><p>wf_parameters</p></td>
<td><p><a class="reference external" href="https://aiida-core.readthedocs.io/en/latest/reference/apidoc/aiida.orm.html#aiida.orm.Dict" title="(in AiiDA v1.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code></a></p></td>
<td><p>Settings of the workchain</p></td>
<td><p>no</p></td>
</tr>
<tr class="row-odd"><td><p>eos_output</p></td>
<td><p><a class="reference external" href="https://aiida-core.readthedocs.io/en/latest/reference/apidoc/aiida.orm.html#aiida.orm.Dict" title="(in AiiDA v1.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code></a></p></td>
<td><p><a class="reference internal" href="eos_wc.html#eos-wc"><span class="std std-ref">EOS</span></a> output dictionary</p></td>
<td><p>no</p></td>
</tr>
<tr class="row-even"><td><p>optimized_structure</p></td>
<td><p><a class="reference external" href="https://aiida-core.readthedocs.io/en/latest/reference/apidoc/aiida.orm.html#aiida.orm.StructureData" title="(in AiiDA v1.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">StructureData</span></code></a></p></td>
<td><p>relaxed film structure</p></td>
<td><p>no</p></td>
</tr>
<tr class="row-odd"><td><p>distance_suggestion</p></td>
<td><p><a class="reference external" href="https://aiida-core.readthedocs.io/en/latest/reference/apidoc/aiida.orm.html#aiida.orm.Dict" title="(in AiiDA v1.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code></a></p></td>
<td><p>interatomic distance suggestion, output of
py:func:<cite>~aiida_fleur.tools.StructureData_util.request_average_bond_length_store()</cite></p></td>
<td><p>no</p></td>
</tr>
</tbody>
</table>
<p>Similarly to other workchains,
FleurCreateMagneticWorkChain behaves
differently depending on the input nodes setup. The list of supported input configurations is
given in the section <a class="reference internal" href="#layout-create-magnetic"><span class="std std-ref">Supported input configurations</span></a>.</p>
<div class="section" id="workchain-parameters-and-its-defaults">
<span id="defaults-para-create"></span><h3>Workchain parameters and its defaults<a class="headerlink" href="#workchain-parameters-and-its-defaults" title="Permalink to this headline">¶</a></h3>
<div class="section" id="wf-parameters">
<h4><code class="docutils literal notranslate"><span class="pre">wf_parameters</span></code><a class="headerlink" href="#wf-parameters" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">wf_parameters</span></code>: <a class="reference external" href="https://aiida-core.readthedocs.io/en/latest/reference/apidoc/aiida.orm.html#aiida.orm.Dict" title="(in AiiDA v1.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code></a> - Settings of the workflow behavior. All possible
keys and their defaults are listed below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="s1">&#39;lattice&#39;</span><span class="p">:</span> <span class="s1">&#39;fcc&#39;</span><span class="p">,</span>                  <span class="c1"># type of the substrate lattice: &#39;bcc&#39; or &#39;fcc&#39;</span>
<span class="s1">&#39;miller&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>             <span class="c1"># miller indices to orient the lattice</span>
           <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
           <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>
<span class="s1">&#39;host_symbol&#39;</span><span class="p">:</span> <span class="s1">&#39;Pt&#39;</span><span class="p">,</span>               <span class="c1"># chemical element of the substrate</span>
<span class="s1">&#39;latticeconstant&#39;</span><span class="p">:</span> <span class="mf">4.0</span><span class="p">,</span>            <span class="c1"># initial guess for the substrate lattice constant</span>
<span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>                 <span class="c1"># sets the size of the film unit cell for relax step</span>
<span class="s1">&#39;replacements&#39;</span><span class="p">:</span> <span class="p">{</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;Fe&#39;</span><span class="p">,</span>         <span class="c1"># sets the layer number to be replaced by another element</span>
                 <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;Fe&#39;</span><span class="p">},</span>        <span class="c1"># NOTE: negative number means that replacement will take place</span>
                                   <span class="c1">#       on layers on the other side from the held layers</span>

<span class="s1">&#39;decimals&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>                    <span class="c1"># set the accuracy of writing atom positions</span>
<span class="s1">&#39;pop_last_layers&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>              <span class="c1"># number of bottom layers to be removed before relaxation</span>
<span class="s1">&#39;hold_n_first_layers&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>          <span class="c1"># number of bottom layers to be held during the relaxation</span>
                                   <span class="c1"># (relaxXYZ = &#39;FFF&#39;)</span>

<span class="s1">&#39;total_number_layers&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>          <span class="c1"># use this total number of layers</span>
<span class="s1">&#39;num_relaxed_layers&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>           <span class="c1"># use this number of relaxed interlayer distances</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="output-nodes">
<h2><a class="toc-backref" href="#id4">Output nodes</a><a class="headerlink" href="#output-nodes" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">magnetic_structure</span></code>: <a class="reference external" href="https://aiida-core.readthedocs.io/en/latest/reference/apidoc/aiida.orm.html#aiida.orm.StructureData" title="(in AiiDA v1.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">StructureData</span></code></a>- the relaxed film structure.</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="supported-input-configurations">
<span id="layout-create-magnetic"></span><h2><a class="toc-backref" href="#id5">Supported input configurations</a><a class="headerlink" href="#supported-input-configurations" title="Permalink to this headline">¶</a></h2>
<p>CreateMagnetic workchain has several
input combinations that implicitly define the workchain layout. <strong>eos</strong>, <strong>relax</strong>,
<strong>optimized_structure</strong> and <strong>eos_output</strong> are analysed. Depending
on the given setup of the inputs, one of four supported scenarios will happen:</p>
<ol class="arabic">
<li><p><strong>eos</strong> + <strong>relax</strong> + <strong>distance_suggestion</strong>:</p>
<blockquote>
<div><p>The EOS will be used to calculate the equilibrium structure
of the substrate, then Relax WC will be used to relax the interlayer distances. Finally,
the non-symmetrical magnetic structure will be created. A good choice if there is nothing
to begin with. <strong>distance_suggestion</strong> will be used to guess a better starting interlayer
distances before submitting Relax WC.</p>
</div></blockquote>
</li>
<li><p><strong>eos_output</strong> + <strong>relax</strong> + <strong>distance_suggestion</strong>:</p>
<blockquote>
<div><p>The equilibrium substrate structure will be extracted from the <strong>eos_output</strong>,
then Relax WC will be used to relax the interlayer distances. Finally,
the non-symmetrical magnetic structure will be created. A good choice if EOS was previously done
for the substrate. <strong>distance_suggestion</strong> will be used to guess a better starting interlayer
distances before submitting Relax WC.</p>
</div></blockquote>
</li>
<li><p><strong>optimized_structure</strong>:</p>
<blockquote>
<div><p><strong>optimized_structure</strong> will be treated as a result of Relax WC and directly used to
construct the final non-symmetrical magnetic structure. A good choice if everything
was done except the very last step.</p>
</div></blockquote>
</li>
<li><p><strong>relax</strong>:</p>
<blockquote>
<div><p>Relax WC will be submitted using inputs of the namespace, which means one can for instance
continue a relaxation procedure. After Relax WC is finished, the
non-symmetrical magnetic structure will be created. A good choice if something wrong happened
in one of the relaxation steps of another CreateMagnetic workchain submission.</p>
</div></blockquote>
</li>
</ol>
<p>All the other input configuration will end up with an exit code 231, protecting user from
misunderstanding.</p>
</div>
<div class="section" id="error-handling">
<h2><a class="toc-backref" href="#id6">Error handling</a><a class="headerlink" href="#error-handling" title="Permalink to this headline">¶</a></h2>
<p>A list of implemented <a class="reference internal" href="../hints/exit_codes.html#exit-codes"><span class="std std-ref">exit codes</span></a>:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 6%" />
<col style="width: 94%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Code</p></th>
<th class="head"><p>Meaning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>230</p></td>
<td><p>Invalid workchain parameters</p></td>
</tr>
<tr class="row-odd"><td><p>231</p></td>
<td><p>Invalid input configuration</p></td>
</tr>
<tr class="row-even"><td><p>380</p></td>
<td><p>Specified substrate is not bcc or fcc, only them are supported</p></td>
</tr>
<tr class="row-odd"><td><p>382</p></td>
<td><p>Relaxation calculation failed.</p></td>
</tr>
<tr class="row-even"><td><p>383</p></td>
<td><p>EOS WorkChain failed.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="example-usage">
<span id="example-use-create-magnetic"></span><h2><a class="toc-backref" href="#id7">Example usage</a><a class="headerlink" href="#example-usage" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">aiida.orm</span> <span class="kn">import</span> <span class="n">load_node</span><span class="p">,</span> <span class="n">Dict</span>
<span class="kn">from</span> <span class="nn">aiida.engine</span> <span class="kn">import</span> <span class="n">submit</span>

<span class="kn">from</span> <span class="nn">aiida_fleur.workflows.create_magnetic_film</span> <span class="kn">import</span> <span class="n">FleurCreateMagneticWorkChain</span>

<span class="n">fleur_code</span> <span class="o">=</span> <span class="n">load_node</span><span class="p">(</span><span class="n">FLEUR_PK</span><span class="p">)</span>
<span class="n">inpgen_code</span> <span class="o">=</span> <span class="n">load_node</span><span class="p">(</span><span class="n">INPGEN_PK</span><span class="p">)</span>

<span class="n">wf_para</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;lattice&#39;</span><span class="p">:</span> <span class="s1">&#39;fcc&#39;</span><span class="p">,</span>
    <span class="s1">&#39;miller&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
               <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
               <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>
    <span class="s1">&#39;host_symbol&#39;</span><span class="p">:</span> <span class="s1">&#39;Pt&#39;</span><span class="p">,</span>
    <span class="s1">&#39;latticeconstant&#39;</span><span class="p">:</span> <span class="mf">4.0</span><span class="p">,</span>
    <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
    <span class="s1">&#39;replacements&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;Fe&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;Fe&#39;</span><span class="p">},</span>
    <span class="s1">&#39;decimals&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s1">&#39;pop_last_layers&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>

    <span class="s1">&#39;total_number_layers&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="s1">&#39;num_relaxed_layers&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">wf_para</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">(</span><span class="nb">dict</span><span class="o">=</span><span class="n">wf_para</span><span class="p">)</span>

<span class="n">wf_eos</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;points&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
          <span class="s1">&#39;step&#39;</span><span class="p">:</span> <span class="mf">0.015</span><span class="p">,</span>
          <span class="s1">&#39;guess&#39;</span><span class="p">:</span> <span class="mf">1.00</span>
          <span class="p">}</span>

<span class="n">wf_eos_scf</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fleur_runmax&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
              <span class="s1">&#39;density_converged&#39;</span><span class="p">:</span> <span class="mf">0.0002</span><span class="p">,</span>
              <span class="s1">&#39;serial&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
              <span class="s1">&#39;itmax_per_run&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
              <span class="s1">&#39;inpxml_changes&#39;</span><span class="p">:</span> <span class="p">[]</span>
              <span class="p">}</span>

<span class="n">wf_eos_scf</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">(</span><span class="nb">dict</span><span class="o">=</span><span class="n">wf_eos_scf</span><span class="p">)</span>

<span class="n">wf_eos</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">(</span><span class="nb">dict</span><span class="o">=</span><span class="n">wf_eos</span><span class="p">)</span>

<span class="n">calc_eos</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;comp&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;kmax&#39;</span><span class="p">:</span> <span class="mf">3.8</span><span class="p">,</span>
                     <span class="p">},</span>
            <span class="s1">&#39;kpt&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;div1&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
                    <span class="s1">&#39;div2&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
                    <span class="s1">&#39;div3&#39;</span><span class="p">:</span> <span class="mi">4</span>
                    <span class="p">}</span>
            <span class="p">}</span>

<span class="n">calc_eos</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">(</span><span class="nb">dict</span><span class="o">=</span><span class="n">calc_eos</span><span class="p">)</span>

<span class="n">options_eos</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;resources&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;num_machines&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;num_mpiprocs_per_machine&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;num_cores_per_mpiproc&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">},</span>
               <span class="s1">&#39;queue_name&#39;</span><span class="p">:</span> <span class="s1">&#39;devel&#39;</span><span class="p">,</span>
               <span class="s1">&#39;custom_scheduler_commands&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
               <span class="s1">&#39;max_wallclock_seconds&#39;</span><span class="p">:</span>  <span class="mi">1</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="p">}</span>

<span class="n">options_eos</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">(</span><span class="nb">dict</span><span class="o">=</span><span class="n">options_eos</span><span class="p">)</span>

<span class="n">wf_relax</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;film_distance_relaxation&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;force_criterion&#39;</span><span class="p">:</span> <span class="mf">0.049</span><span class="p">,</span>
            <span class="s1">&#39;relax_iter&#39;</span><span class="p">:</span> <span class="mi">5</span>
            <span class="p">}</span>

<span class="n">wf_relax_scf</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fleur_runmax&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                <span class="s1">&#39;serial&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;use_relax_xml&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s1">&#39;itmax_per_run&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
                <span class="s1">&#39;alpha_mix&#39;</span><span class="p">:</span> <span class="mf">0.015</span><span class="p">,</span>
                <span class="s1">&#39;relax_iter&#39;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
                <span class="s1">&#39;force_converged&#39;</span><span class="p">:</span> <span class="mf">0.001</span><span class="p">,</span>
                <span class="s1">&#39;force_dict&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;qfix&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                               <span class="s1">&#39;forcealpha&#39;</span><span class="p">:</span> <span class="mf">0.75</span><span class="p">,</span>
                               <span class="s1">&#39;forcemix&#39;</span><span class="p">:</span> <span class="s1">&#39;straight&#39;</span><span class="p">},</span>
                <span class="s1">&#39;inpxml_changes&#39;</span><span class="p">:</span> <span class="p">[]</span>
                <span class="p">}</span>

<span class="n">wf_relax</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">(</span><span class="nb">dict</span><span class="o">=</span><span class="n">wf_relax</span><span class="p">)</span>
<span class="n">wf_relax_scf</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">(</span><span class="nb">dict</span><span class="o">=</span><span class="n">wf_relax_scf</span><span class="p">)</span>

<span class="n">calc_relax</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;comp&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;kmax&#39;</span><span class="p">:</span> <span class="mf">4.0</span><span class="p">,</span>
                       <span class="p">},</span>
              <span class="s1">&#39;kpt&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;div1&#39;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>
                      <span class="s1">&#39;div2&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
                      <span class="s1">&#39;div3&#39;</span><span class="p">:</span> <span class="mi">1</span>
                      <span class="p">},</span>
              <span class="s1">&#39;atom&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;element&#39;</span><span class="p">:</span> <span class="s1">&#39;Pt&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;rmt&#39;</span><span class="p">:</span> <span class="mf">2.2</span><span class="p">,</span>
                       <span class="s1">&#39;lmax&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
                       <span class="s1">&#39;lnonsph&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
                       <span class="s1">&#39;econfig&#39;</span><span class="p">:</span> <span class="s1">&#39;[Kr] 5s2 4d10 4f14 5p6| 5d9 6s1&#39;</span><span class="p">,</span>
                       <span class="p">},</span>
              <span class="s1">&#39;atom2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;element&#39;</span><span class="p">:</span> <span class="s1">&#39;Fe&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;rmt&#39;</span><span class="p">:</span> <span class="mf">2.1</span><span class="p">,</span>
                        <span class="s1">&#39;lmax&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
                        <span class="s1">&#39;lnonsph&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
                        <span class="s1">&#39;econfig&#39;</span><span class="p">:</span> <span class="s1">&#39;[Ne] 3s2 3p6| 3d6 4s2&#39;</span><span class="p">,</span>
                        <span class="p">},</span>
              <span class="p">}</span>

<span class="n">calc_relax</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">(</span><span class="nb">dict</span><span class="o">=</span><span class="n">calc_relax</span><span class="p">)</span>

<span class="n">options_relax</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;resources&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;num_machines&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;num_mpiprocs_per_machine&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;num_cores_per_mpiproc&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">},</span>
                 <span class="s1">&#39;queue_name&#39;</span><span class="p">:</span> <span class="s1">&#39;devel&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;custom_scheduler_commands&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;max_wallclock_seconds&#39;</span><span class="p">:</span>  <span class="mi">1</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="p">}</span>

<span class="n">inputs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;eos&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;scf&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;wf_parameters&#39;</span><span class="p">:</span> <span class="n">wf_eos_scf</span><span class="p">,</span>
            <span class="s1">&#39;calc_parameters&#39;</span><span class="p">:</span> <span class="n">calc_eos</span><span class="p">,</span>
            <span class="s1">&#39;options&#39;</span><span class="p">:</span> <span class="n">options_eos</span><span class="p">,</span>
            <span class="s1">&#39;inpgen&#39;</span><span class="p">:</span> <span class="n">inpgen_code</span><span class="p">,</span>
            <span class="s1">&#39;fleur&#39;</span><span class="p">:</span> <span class="n">fleur_code</span>
        <span class="p">},</span>
        <span class="s1">&#39;wf_parameters&#39;</span><span class="p">:</span> <span class="n">wf_eos</span>
    <span class="p">},</span>
    <span class="s1">&#39;relax&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;scf&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;wf_parameters&#39;</span><span class="p">:</span> <span class="n">wf_relax_scf</span><span class="p">,</span>
            <span class="s1">&#39;calc_parameters&#39;</span><span class="p">:</span> <span class="n">calc_relax</span><span class="p">,</span>
            <span class="s1">&#39;options&#39;</span><span class="p">:</span> <span class="n">options_relax</span><span class="p">,</span>
            <span class="s1">&#39;inpgen&#39;</span><span class="p">:</span> <span class="n">inpgen_code</span><span class="p">,</span>
            <span class="s1">&#39;fleur&#39;</span><span class="p">:</span> <span class="n">fleur_code</span>
        <span class="p">},</span>
        <span class="s1">&#39;wf_parameters&#39;</span><span class="p">:</span> <span class="n">wf_relax</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s1">&#39;wf_parameters&#39;</span><span class="p">:</span> <span class="n">wf_para</span>
<span class="p">}</span>

<span class="n">res</span> <span class="o">=</span> <span class="n">submit</span><span class="p">(</span><span class="n">FleurCreateMagneticWorkChain</span><span class="p">,</span> <span class="o">**</span><span class="n">inputs</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ssdisp_wc.html" class="btn btn-neutral float-right" title="Fleur Spin-Spiral Dispersion workchain" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="corehole_wc.html" class="btn btn-neutral float-left" title="Fleur core-hole workflow" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2016-2020, FZ Jülich GmbH, Germany. All rights reserved

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>