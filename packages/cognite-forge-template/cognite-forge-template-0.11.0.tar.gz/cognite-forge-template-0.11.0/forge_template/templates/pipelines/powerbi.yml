name: "PowerBI sync Prod"

trigger:
  branches:
    include:
    - master
  paths:
    include:
    - ./powerbi/*

pool:
  vmImage: 'ubuntu-latest'

steps:
- task: UsePythonVersion@0
  inputs:
    versionSpec: '3.x'
    addToPath: true
    architecture: 'x64'
- script: |
      python -m pip install --upgrade pip
      pip install -r requirements.txt
  displayName: 'Install dependencies'
- script: |
      python infra/powerbi-sync.py --tenant_id "$(POWERBI_TENANT_ID)" --application_id "$(POWERBI_APPLICATION_ID)" --token "$(POWERBI_TOKEN)" --workspace "$(POWERBI_WORKSPACE)"
  displayName: 'Publishing to PowerBI'