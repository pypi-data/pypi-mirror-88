!function(){function t(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,n){if(!t)return;if("string"==typeof t)return e(t,n);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return e(t,n)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function n(t,e,i){return(n="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=l(t)););return t}(t,e);if(i){var a=Object.getOwnPropertyDescriptor(i,e);return a.get?a.get.call(n):a.value}})(t,e,i||t)}function i(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function o(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=l(t);if(e){var a=l(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return r(this,n)}}function r(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function b(t,e,n){return e&&u(t.prototype,e),n&&u(t,n),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[35,42],{F48D:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var i=n("mrSG"),a=n("LBBb"),c=n("8Y7J"),o=n("iELJ"),r=function(){var t=function(){function t(e){s(this,t),this.dialog=e}return b(t,[{key:"open",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return Object(i.a)(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.dialog.open(a.a,{width:"290px",data:{title:t,content:e}}).afterClosed().toPromise());case 1:case"end":return n.stop()}}),n,this)})))}}]),t}();return t.\u0275fac=function(e){return new(e||t)(c.bc(o.b))},t.\u0275prov=c.Nb({token:t,factory:t.\u0275fac,providedIn:"root"}),t}()},LBBb:function(t,e,n){"use strict";n.d(e,"a",(function(){return u}));var i=n("iELJ"),a=n("8Y7J"),c=n("SVse"),o=n("Dxy4"),r=n("TSSN");function l(t,e){if(1&t&&(a.Xb(0,"div"),a.Xb(1,"h2",1),a.Sc(2),a.Wb(),a.Sb(3,"mat-dialog-content",2),a.Xb(4,"mat-dialog-actions"),a.Xb(5,"button",3),a.Sc(6),a.kc(7,"translate"),a.Wb(),a.Xb(8,"button",4),a.Sc(9),a.kc(10,"translate"),a.Wb(),a.Wb(),a.Wb()),2&t){var n=a.jc();a.Fb(2),a.Tc(n.data.title),a.Fb(1),a.rc("innerHTML",n.data.content,a.Hc),a.Fb(2),a.rc("mat-dialog-close",!0),a.Fb(1),a.Tc(a.lc(7,6,"OK")),a.Fb(2),a.rc("mat-dialog-close",!1),a.Fb(1),a.Tc(a.lc(10,8,"Cancel"))}}var u=function(){var t=function t(e,n){s(this,t),this.dialogRef=e,this.data=n};return t.\u0275fac=function(e){return new(e||t)(a.Rb(i.h),a.Rb(i.a))},t.\u0275cmp=a.Lb({type:t,selectors:[["os-prompt-dialog"]],decls:1,vars:1,consts:[[4,"ngIf"],["mat-dialog-title",""],[3,"innerHTML"],["mat-button","","color","warn",3,"mat-dialog-close"],["mat-button","",3,"mat-dialog-close"]],template:function(t,e){1&t&&a.Qc(0,l,11,10,"div",0),2&t&&a.rc("ngIf",e.data)},directives:[c.t,i.i,i.f,i.c,o.b,i.d],pipes:[r.j],encapsulation:2}),t}()},moyA:function(t,e,c){"use strict";c.r(e),c.d(e,"MotionWorkflowModule",(function(){return Nt}));var r=c("SVse"),u=c("PCNd"),f=c("iInd"),m=c("OaSA"),d=c("lJxs"),p=c("ZvXm"),g=c("s3dr"),v=c("F48D"),h=c("gtli"),w=c("Izkr"),k=c("mV3u"),y=c("8Y7J"),S=c("cUpR"),M=c("TSSN"),W=c("zHaW"),C=c("iELJ"),_=c("mksl"),F=c("Dxy4"),X=c("Tj54"),O=c("rJgo"),j=c("pMoy"),P=c("f44v"),R=c("Q2Ze"),D=c("e6WT"),x=c("s7LF"),T=c("IZUe"),I=["workflowDialog"];function Q(t,e){if(1&t&&(y.Xb(0,"h2"),y.Sc(1),y.kc(2,"translate"),y.Wb()),2&t){var n=y.jc();y.Fb(1),y.Uc(" ",y.lc(2,1,n.workflow.name)," ")}}function E(t,e){1&t&&(y.Xb(0,"th",20),y.Sc(1),y.kc(2,"translate"),y.Wb()),2&t&&(y.Fb(1),y.Tc(y.lc(2,1,"Permissions")))}function $(t,e){if(1&t&&(y.Xb(0,"td",21),y.Xb(1,"div",22),y.Sc(2),y.kc(3,"translate"),y.Wb(),y.Wb()),2&t){var n=e.$implicit;y.Fb(2),y.Uc(" ",y.lc(3,1,n.name)," ")}}function L(t,e){if(1&t){var n=y.Yb();y.Xb(0,"th",25),y.fc("click",(function(){y.Gc(n);var t=y.jc().$implicit;return y.jc(2).onClickStateName(t)})),y.Xb(1,"div",26),y.Xb(2,"div",27),y.Sc(3),y.kc(4,"translate"),y.Wb(),y.Wb(),y.Wb()}if(2&t){var i=y.jc().$implicit;y.Fb(3),y.Uc(" ",y.lc(4,1,i.name)," ")}}function A(t,e){if(1&t){var n=y.Yb();y.Xb(0,"div",27),y.Xb(1,"mat-checkbox",29),y.fc("change",(function(t){y.Gc(n);var e=y.jc().$implicit,i=y.jc().$implicit;return y.jc(2).onToggleStatePerm(i,e.selector,t)})),y.Wb(),y.Wb()}if(2&t){var i=y.jc().$implicit,a=y.jc().$implicit;y.Fb(1),y.rc("checked",a[i.selector])}}function N(t,e){if(1&t){var n=y.Yb();y.Xb(0,"div"),y.Xb(1,"div",27),y.Sc(2),y.kc(3,"translate"),y.Wb(),y.Xb(4,"div",30),y.fc("click",(function(){y.Gc(n);var t=y.jc().$implicit,e=y.jc().$implicit;return y.jc(2).onClickInputPerm(t,e)})),y.Wb(),y.Wb()}if(2&t){var i=y.jc().$implicit,a=y.jc().$implicit;y.Fb(2),y.Uc(" ",y.lc(3,1,a[i.selector])||"\u2013"," ")}}var B=function(t){return{state:t}};function Y(t,e){if(1&t&&(y.Xb(0,"div",27),y.Xb(1,"mat-basic-chip",31),y.Sc(2),y.kc(3,"translate"),y.Wb(),y.Wb()),2&t){var n=y.jc().$implicit,i=y.jc().$implicit;y.jc(2);var a=y.Cc(11);y.Fb(1),y.rc("matMenuTriggerFor",a)("matMenuTriggerData",y.xc(7,B,i))("disableRipple",!0)("ngClass",i[n.selector]),y.Fb(1),y.Uc(" ",y.lc(3,5,i[n.selector])," ")}}function U(t,e){1&t&&(y.Xb(0,"div"),y.Sc(1," - "),y.Wb())}function G(t,e){1&t&&(y.Xb(0,"span"),y.Sc(1,",\xa0"),y.Wb())}function J(t,e){if(1&t&&(y.Xb(0,"div"),y.Sc(1),y.kc(2,"translate"),y.Qc(3,G,2,0,"span",2),y.Wb()),2&t){var n=e.$implicit,i=e.last;y.Fb(1),y.Uc(" ",y.lc(2,2,n.name),""),y.Fb(2),y.rc("ngIf",!i)}}function H(t,e){if(1&t&&(y.Xb(0,"div"),y.Qc(1,J,4,4,"div",33),y.Wb()),2&t){var n=y.jc(3).$implicit;y.Fb(1),y.rc("ngForOf",n.next_states)}}function V(t,e){if(1&t&&(y.Xb(0,"div"),y.Xb(1,"div",27),y.Qc(2,U,2,0,"div",2),y.Qc(3,H,2,1,"div",2),y.Wb(),y.Sb(4,"div",32),y.Wb()),2&t){var n=y.jc(2).$implicit;y.jc(2);var i=y.Cc(14);y.Fb(2),y.rc("ngIf",!n.next_states.length),y.Fb(1),y.rc("ngIf",n.next_states.length),y.Fb(1),y.rc("matMenuTriggerFor",i)("matMenuTriggerData",y.xc(4,B,n))}}function z(t,e){if(1&t&&(y.Xb(0,"div"),y.Xb(1,"div",27),y.Sc(2),y.kc(3,"translate"),y.Wb(),y.Sb(4,"div",32),y.Wb()),2&t){var n=y.jc(2).$implicit,i=y.jc(2),a=y.Cc(20);y.Fb(2),y.Uc(" ",y.lc(3,3,i.getMergeAmendmentLabel(n.merge_amendment_into_final))," "),y.Fb(2),y.rc("matMenuTriggerFor",a)("matMenuTriggerData",y.xc(5,B,n))}}function q(t,e){1&t&&(y.Xb(0,"div"),y.Sc(1," - "),y.Wb())}function Z(t,e){1&t&&(y.Xb(0,"span"),y.Sc(1,",\xa0"),y.Wb())}function K(t,e){if(1&t&&(y.Xb(0,"div"),y.Sc(1),y.kc(2,"translate"),y.Qc(3,Z,2,0,"span",2),y.Wb()),2&t){var n=e.$implicit,i=e.last,a=y.jc(6);y.Fb(1),y.Uc(" ",y.lc(2,2,a.getRestrictionLabel(n))," "),y.Fb(2),y.rc("ngIf",!i)}}function tt(t,e){if(1&t&&(y.Xb(0,"div"),y.Qc(1,K,4,4,"div",33),y.Wb()),2&t){var n=y.jc(3).$implicit;y.Fb(1),y.rc("ngForOf",n.restriction)}}function et(t,e){if(1&t&&(y.Xb(0,"div"),y.Xb(1,"div",27),y.Qc(2,q,2,0,"div",2),y.Qc(3,tt,2,1,"div",2),y.Wb(),y.Sb(4,"div",32),y.Wb()),2&t){var n=y.jc(2).$implicit;y.jc(2);var i=y.Cc(17);y.Fb(2),y.rc("ngIf",!n.restriction.length),y.Fb(1),y.rc("ngIf",n.restriction.length),y.Fb(1),y.rc("matMenuTriggerFor",i)("matMenuTriggerData",y.xc(4,B,n))}}function nt(t,e){if(1&t&&(y.Xb(0,"td",21),y.Qc(1,A,2,1,"div",28),y.Qc(2,N,5,3,"div",2),y.Qc(3,Y,4,9,"div",28),y.Qc(4,V,5,6,"div",2),y.Qc(5,z,5,7,"div",2),y.Qc(6,et,5,6,"div",2),y.Wb()),2&t){var n=e.$implicit;y.Fb(1),y.rc("ngIf","check"===n.type),y.Fb(1),y.rc("ngIf","input"===n.type),y.Fb(1),y.rc("ngIf","color"===n.type),y.Fb(1),y.rc("ngIf","state"===n.type),y.Fb(1),y.rc("ngIf","amendment"===n.type),y.Fb(1),y.rc("ngIf","restriction"===n.type)}}function it(t,e){if(1&t&&(y.Vb(0,23),y.Qc(1,L,5,3,"th",24),y.Qc(2,nt,7,6,"td",16),y.Ub()),2&t){var n=e.$implicit,i=y.jc(2);y.rc("matColumnDef",i.getColumnDef(n))}}function at(t,e){1&t&&y.Sb(0,"tr",34)}function ct(t,e){1&t&&y.Sb(0,"tr",35)}function ot(t,e){if(1&t&&(y.Xb(0,"div"),y.Xb(1,"div",11),y.Xb(2,"strong"),y.Xb(3,"span"),y.Sc(4),y.kc(5,"translate"),y.Wb(),y.Sc(6,": "),y.Xb(7,"span"),y.Sc(8),y.kc(9,"translate"),y.Wb(),y.Wb(),y.Wb(),y.Xb(10,"div",12),y.Xb(11,"table",13),y.Vb(12,14),y.Qc(13,E,3,3,"th",15),y.Qc(14,$,4,3,"td",16),y.Ub(),y.Qc(15,it,3,1,"ng-container",17),y.Qc(16,at,1,0,"tr",18),y.Qc(17,ct,1,0,"tr",19),y.Wb(),y.Wb(),y.Wb()),2&t){var n=y.jc();y.Fb(4),y.Tc(y.lc(5,7,"First state")),y.Fb(4),y.Tc(y.lc(9,9,n.workflow.first_state.name)),y.Fb(3),y.rc("dataSource",n.getTableDataSource()),y.Fb(4),y.rc("ngForOf",n.workflow.states)("ngForTrackBy",n.trackByIndex),y.Fb(1),y.rc("matHeaderRowDef",n.headerRowDef),y.Fb(1),y.rc("matRowDefColumns",n.headerRowDef)}}var rt=function(){return{action:"delete"}};function lt(t,e){1&t&&(y.Xb(0,"button",43),y.Xb(1,"span"),y.Sc(2),y.kc(3,"translate"),y.Wb(),y.Wb()),2&t&&(y.rc("mat-dialog-close",y.wc(4,rt)),y.Fb(2),y.Tc(y.lc(3,2,"Delete")))}var st=function(t){return{action:"update",value:t}};function ut(t,e){if(1&t){var n=y.Yb();y.Xb(0,"h1",36),y.Xb(1,"span"),y.Sc(2),y.kc(3,"translate"),y.Wb(),y.Wb(),y.Xb(4,"div",37),y.Xb(5,"p"),y.Sc(6),y.kc(7,"translate"),y.Wb(),y.Xb(8,"mat-form-field"),y.Xb(9,"input",38),y.fc("ngModelChange",(function(t){return y.Gc(n),y.jc().dialogData.value=t})),y.Wb(),y.Wb(),y.Wb(),y.Xb(10,"div",39),y.Xb(11,"button",40),y.Xb(12,"span"),y.Sc(13),y.kc(14,"translate"),y.Wb(),y.Wb(),y.Xb(15,"button",41),y.Xb(16,"span"),y.Sc(17),y.kc(18,"translate"),y.Wb(),y.Wb(),y.Qc(19,lt,4,5,"button",42),y.Wb()}if(2&t){var i=y.jc();y.Fb(2),y.Tc(y.lc(3,9,i.dialogData.title)),y.Fb(4),y.Tc(y.lc(7,11,i.dialogData.description)),y.Fb(3),y.rc("ngModel",i.dialogData.value),y.Fb(2),y.rc("disabled",""===i.dialogData.value&&!i.dialogData.allowEmpty)("mat-dialog-close",y.xc(17,st,i.dialogData.value)),y.Fb(2),y.Tc(y.lc(14,13,"Save")),y.Fb(2),y.rc("mat-dialog-close",null),y.Fb(2),y.Tc(y.lc(18,15,"Cancel")),y.Fb(2),y.rc("ngIf",i.dialogData.deletable)}}function bt(t,e){1&t&&(y.Xb(0,"mat-icon"),y.Sc(1,"check"),y.Wb())}function ft(t,e){if(1&t){var n=y.Yb();y.Xb(0,"button",45),y.fc("click",(function(){y.Gc(n);var t=e.$implicit,i=y.jc().state;return y.jc().onSelectColor(i,t)})),y.Qc(1,bt,2,0,"mat-icon",2),y.Xb(2,"span"),y.Sc(3),y.kc(4,"translate"),y.Wb(),y.Wb()}if(2&t){var i=e.$implicit,a=y.jc().state;y.Fb(1),y.rc("ngIf",i===a.css_class),y.Fb(2),y.Tc(y.lc(4,2,i))}}function mt(t,e){if(1&t&&y.Qc(0,ft,5,4,"button",44),2&t){var n=y.jc();y.rc("ngForOf",n.labelColors)}}function dt(t,e){1&t&&(y.Xb(0,"mat-icon"),y.Sc(1,"check"),y.Wb())}function pt(t,e){if(1&t){var n=y.Yb();y.Xb(0,"button",45),y.fc("click",(function(){y.Gc(n);var t=y.jc().$implicit,e=y.jc().state;return y.jc().onSetNextState(t,e)})),y.Qc(1,dt,2,0,"mat-icon",2),y.Xb(2,"span"),y.Sc(3),y.kc(4,"translate"),y.Wb(),y.Wb()}if(2&t){var i=y.jc().$implicit,a=y.jc().state;y.Fb(1),y.rc("ngIf",a.next_states_id.includes(i.id)),y.Fb(2),y.Tc(y.lc(4,2,i.name))}}function gt(t,e){if(1&t&&(y.Xb(0,"div"),y.Qc(1,pt,5,4,"button",46),y.Wb()),2&t){var n=e.$implicit,i=y.jc().state;y.Fb(1),y.rc("ngIf",n.name!==i.name)}}function vt(t,e){if(1&t&&y.Qc(0,gt,2,1,"div",33),2&t){var n=y.jc();y.rc("ngForOf",n.workflow.states)}}function ht(t,e){1&t&&(y.Xb(0,"mat-icon"),y.Sc(1,"check"),y.Wb())}function wt(t,e){if(1&t){var n=y.Yb();y.Xb(0,"button",45),y.fc("click",(function(){y.Gc(n);var t=e.$implicit,i=y.jc().state;return y.jc().onSetRestriction(t.key,i)})),y.Qc(1,ht,2,0,"mat-icon",2),y.Xb(2,"span"),y.Sc(3),y.kc(4,"translate"),y.Wb(),y.Wb()}if(2&t){var i=e.$implicit,a=y.jc().state;y.Fb(1),y.rc("ngIf",a.restriction.includes(i.key)),y.Fb(2),y.Tc(y.lc(4,2,i.label))}}function kt(t,e){if(1&t&&y.Qc(0,wt,5,4,"button",44),2&t){var n=y.jc();y.rc("ngForOf",n.restrictions)}}function yt(t,e){1&t&&(y.Xb(0,"mat-icon"),y.Sc(1,"check"),y.Wb())}function St(t,e){if(1&t){var n=y.Yb();y.Xb(0,"div"),y.Xb(1,"button",45),y.fc("click",(function(){y.Gc(n);var t=e.$implicit,i=y.jc().state;return y.jc().setMergeAmendment(t.merge,i)})),y.Qc(2,yt,2,0,"mat-icon",2),y.Xb(3,"span"),y.Sc(4),y.kc(5,"translate"),y.Wb(),y.Wb(),y.Wb()}if(2&t){var i=e.$implicit,a=y.jc().state;y.Fb(2),y.rc("ngIf",i.merge===a.merge_amendment_into_final),y.Fb(2),y.Tc(y.lc(5,2,i.label))}}function Mt(t,e){if(1&t&&y.Qc(0,St,6,4,"div",33),2&t){var n=y.jc();y.rc("ngForOf",n.amendmentIntoFinal)}}var Wt,Ct=((Wt=function(t){a(n,t);var e=o(n);function n(t,i,a,c,o,r,l,u,b){var f;return s(this,n),(f=e.call(this,t,i,a)).translate=i,f.promptService=c,f.dialog=o,f.workflowRepo=r,f.stateRepo=l,f.route=u,f.cd=b,f.headerRowDef=[],f.labelColors=["grey","red","green","lightblue","yellow"],f.statePermissionsList=[{name:"Recommendation label",selector:"recommendation_label",type:"input"},{name:"Allow support",selector:"allow_support",type:"check"},{name:"Allow create poll",selector:"allow_create_poll",type:"check"},{name:"Allow submitter edit",selector:"allow_submitter_edit",type:"check"},{name:"Do not set identifier",selector:"dont_set_identifier",type:"check"},{name:"Show state extension field",selector:"show_state_extension_field",type:"check"},{name:"Show recommendation extension field",selector:"show_recommendation_extension_field",type:"check"},{name:"Show amendment in parent motion",selector:"merge_amendment_into_final",type:"amendment"},{name:"Restrictions",selector:"restriction",type:"restriction"},{name:"Label color",selector:"css_class",type:"color"},{name:"Next states",selector:"next_states_id",type:"state"}],f.restrictions=[{key:h.b.motionsCanManage,label:"Can manage motions"},{key:h.b.motionsCanSeeInternal,label:"Can see motions in internal state"},{key:h.b.motionsCanManageMetadata,label:"Can manage motion metadata"},{key:h.b.motionsIsSubmitter,label:"Submitters"}],f.amendmentIntoFinal=[{merge:h.a.NO,label:"No"},{merge:h.a.UNDEFINED,label:"-"},{merge:h.a.YES,label:"Yes"}],f}return b(n,[{key:"ngOnInit",value:function(){var t=this,e=parseInt(this.route.snapshot.paramMap.get("id"),10);this.subscriptions.push(this.workflowRepo.getViewModelObservable(e).subscribe((function(e){e&&(t.workflow=e,t.updateRowDef(),t.cd.markForCheck())})),this.stateRepo.getViewModelListObservable().pipe(Object(d.a)((function(e){return e.filter((function(e){return t.workflow.states_id.includes(e.id)}))}))).subscribe((function(e){e&&t.cd.markForCheck()})))}},{key:"onClickStateName",value:function(t){var e=this;this.openEditDialog(t.name,"Rename state","",!0).subscribe((function(n){if(n)if(e.cd.detectChanges(),"update"===n.action)e.stateRepo.update({name:n.value},t).then((function(){}),e.raiseError);else if("delete"===n.action){var i=e.translate.instant("Delete")+" ".concat(t.name,"?");e.promptService.open("Are you sure",i).then((function(n){n&&e.stateRepo.delete(t).then((function(){}),e.raiseError)}))}}))}},{key:"onNewStateButton",value:function(){var t=this;this.openEditDialog("",this.translate.instant("New state"),this.translate.instant("Name")).subscribe((function(e){if(e&&"update"===e.action){var n=new h.c({name:e.value,workflow_id:t.workflow.id});t.stateRepo.create(n).then((function(){}),t.raiseError)}}))}},{key:"onEditWorkflowButton",value:function(){var t=this;this.openEditDialog(this.workflow.name,"Edit name","Please enter a new workflow name:").subscribe((function(e){e&&"update"===e.action&&t.workflowRepo.update({name:e.value},t.workflow).then((function(){}),t.raiseError)}))}},{key:"onClickInputPerm",value:function(t,e){var n=this;this.openEditDialog(e[t.selector],"Edit",t.name,!1,!0).subscribe((function(a){""===a.value&&(a.value=null),a&&"update"===a.action&&n.stateRepo.update(i({},t.selector,a.value),e).then((function(){}),n.raiseError)}))}},{key:"onToggleStatePerm",value:function(t,e,n){this.stateRepo.update(i({},e,n.checked),t).then((function(){}),this.raiseError)}},{key:"onSelectColor",value:function(t,e){this.stateRepo.update({css_class:e},t).then((function(){}),this.raiseError)}},{key:"onSetNextState",value:function(t,e){var n=e.next_states_id.map((function(t){return t})),i=n.findIndex((function(e){return e===t.id}));i<0?n.push(t.id):n.splice(i,1),this.stateRepo.update({next_states_id:n},e).then((function(){}),this.raiseError)}},{key:"onSetRestriction",value:function(t,e){var n=e.restriction.map((function(t){return t})),i=n.findIndex((function(e){return e===t}));i<0?n.push(t):n.splice(i,1),this.stateRepo.update({restriction:n},e).then((function(){}),this.raiseError)}},{key:"getRestrictionLabel",value:function(t){var e=this.restrictions.find((function(e){return e.key===t}));return e?e.label:""}},{key:"setMergeAmendment",value:function(t,e){this.stateRepo.update({merge_amendment_into_final:t},e).then((function(){}),this.raiseError)}},{key:"openEditDialog",value:function(t,e,n,i,a){return this.dialogData={title:e||"",description:n||"",value:t,deletable:i,allowEmpty:a},this.dialog.open(this.workflowDialog,w.a).afterClosed()}},{key:"getMergeAmendmentLabel",value:function(t){return this.amendmentIntoFinal.find((function(e){return e.merge===t})).label}},{key:"getTableDataSource",value:function(){var t=new m.p;return t.data=this.statePermissionsList,t}},{key:"updateRowDef",value:function(){var t=this;this.headerRowDef=["perm"],this.workflow&&this.workflow.states.forEach((function(e){t.headerRowDef.push(t.getColumnDef(e))}))}},{key:"getColumnDef",value:function(t){return"".concat(t.name).concat(t.id)}},{key:"trackElement",value:function(t){return t}}]),n}(k.a)).\u0275fac=function(t){return new(t||Wt)(y.Rb(S.c),y.Rb(M.k),y.Rb(W.a),y.Rb(v.a),y.Rb(C.b),y.Rb(g.a),y.Rb(p.a),y.Rb(f.a),y.Rb(y.h))},Wt.\u0275cmp=y.Lb({type:Wt,selectors:[["os-workflow-detail"]],viewQuery:function(t,e){var n;1&t&&y.Mc(I,!0),2&t&&y.Bc(n=y.gc())&&(e.workflowDialog=n.first)},features:[y.Cb],decls:22,vars:4,consts:[[3,"nav","hasMainButton","mainEvent"],[1,"title-slot"],[4,"ngIf"],[1,"extra-controls-slot"],["mat-icon-button","",3,"click"],["workflowDialog",""],["matMenuContent",""],["colorMenu","matMenu"],["nextStatesMenu","matMenu"],["restrictionMenu","matMenu"],["mergeAmendmentMenu","matMenu"],[1,"title-line"],[1,"scrollable-matrix"],["mat-table","",3,"dataSource"],["matColumnDef","perm","sticky",""],["mat-header-cell","","class","group-head-table-cell",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],[3,"matColumnDef",4,"ngFor","ngForOf","ngForTrackBy"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell","",1,"group-head-table-cell"],["mat-cell",""],[1,"permission-name"],[3,"matColumnDef"],["mat-header-cell","",3,"click",4,"matHeaderCellDef"],["mat-header-cell","",3,"click"],[1,"clickable-cell","stretch-to-fill-parent"],[1,"inner-table"],["class","inner-table",4,"ngIf"],[3,"checked","change"],[1,"clickable-cell","stretch-to-fill-parent",3,"click"],[3,"matMenuTriggerFor","matMenuTriggerData","disableRipple","ngClass"],[1,"clickable-cell","stretch-to-fill-parent",3,"matMenuTriggerFor","matMenuTriggerData"],[4,"ngFor","ngForOf"],["mat-header-row",""],["mat-row",""],["mat-dialog-title",""],["mat-dialog-content","",1,"os-form-card-mobile"],["matInput","","osAutofocus","",3,"ngModel","ngModelChange"],["mat-dialog-actions",""],["type","submit","mat-button","","color","accent",3,"disabled","mat-dialog-close"],["type","button","mat-button","",3,"mat-dialog-close"],["type","button","mat-button","","color","warn",3,"mat-dialog-close",4,"ngIf"],["type","button","mat-button","","color","warn",3,"mat-dialog-close"],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["mat-menu-item","",3,"click"],["mat-menu-item","",3,"click",4,"ngIf"]],template:function(t,e){1&t&&(y.Xb(0,"os-head-bar",0),y.fc("mainEvent",(function(){return e.onNewStateButton()})),y.Xb(1,"div",1),y.Qc(2,Q,3,3,"h2",2),y.Wb(),y.Xb(3,"div",3),y.Xb(4,"button",4),y.fc("click",(function(){return e.onEditWorkflowButton()})),y.Xb(5,"mat-icon"),y.Sc(6,"edit"),y.Wb(),y.Wb(),y.Wb(),y.Wb(),y.Qc(7,ot,18,11,"div",2),y.Qc(8,ut,20,19,"ng-template",null,5,y.Rc),y.Xb(10,"mat-menu",6,7),y.Qc(12,mt,1,1,"ng-template",6),y.Wb(),y.Xb(13,"mat-menu",6,8),y.Qc(15,vt,1,1,"ng-template",6),y.Wb(),y.Xb(16,"mat-menu",6,9),y.Qc(18,kt,1,1,"ng-template",6),y.Wb(),y.Xb(19,"mat-menu",6,10),y.Qc(21,Mt,1,1,"ng-template",6),y.Wb()),2&t&&(y.rc("nav",!1)("hasMainButton",!0),y.Fb(2),y.rc("ngIf",e.workflow),y.Fb(5),y.rc("ngIf",e.workflow))},directives:[_.a,r.t,F.b,X.a,O.f,O.b,m.o,m.c,m.i,m.b,r.s,m.k,m.n,m.h,m.a,j.a,P.a,O.e,r.q,m.j,m.m,C.i,C.f,R.c,D.b,x.d,T.a,x.t,x.w,C.c,C.d,O.c],pipes:[M.j],styles:[".title-line[_ngcontent-%COMP%]{font-weight:500;font-size:16px}.title-line[_ngcontent-%COMP%]   .icon-prefix[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{display:-ms-inline-flexbox;display:inline-flex;vertical-align:middle;font-size:16px;height:16px;width:16px}.title-line[_ngcontent-%COMP%]   .favorite-star[_ngcontent-%COMP%]{padding-right:3px}.mat-table[_ngcontent-%COMP%]{width:100%}.mat-table[_ngcontent-%COMP%]   .mat-header-row[_ngcontent-%COMP%]   .mat-column-anchor[_ngcontent-%COMP%]{display:none}.mat-table[_ngcontent-%COMP%]   .mat-row[_ngcontent-%COMP%]{position:relative}.mat-table[_ngcontent-%COMP%]   .mat-row[_ngcontent-%COMP%]   .mat-column-anchor[_ngcontent-%COMP%]{position:absolute!important;top:0;right:0;bottom:0;left:0;opacity:.1;z-index:1}.mat-table[_ngcontent-%COMP%]   .mat-row[_ngcontent-%COMP%]   .mat-column-anchor[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:block;height:100%;width:100%}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]{position:relative}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]   .fill[_ngcontent-%COMP%]{position:absolute;display:inherit;height:100%;width:100%;line-height:0}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]   .fill[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{margin-top:auto;margin-bottom:auto}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{z-index:2}.mat-table[_ngcontent-%COMP%]   .mat-table-sticky[_ngcontent-%COMP%]{z-index:3!important}.title-line[_ngcontent-%COMP%]{margin:20px 25px}table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   .mat-header-cell[_ngcontent-%COMP%]{min-width:200px;position:relative}table[_ngcontent-%COMP%]   .clickable-cell[_ngcontent-%COMP%]{display:-ms-flexbox;display:flex;cursor:pointer}table[_ngcontent-%COMP%]   .clickable-cell[_ngcontent-%COMP%]:hover{background-color:rgba(0,0,0,.025)}table[_ngcontent-%COMP%]   .inner-table[_ngcontent-%COMP%]{text-align:center;-ms-flex-align:center;align-items:center;margin:auto;overflow:hidden;padding:0 10px}table[_ngcontent-%COMP%]   .mat-column-perm[_ngcontent-%COMP%]{min-width:150px}table[_ngcontent-%COMP%]   .mat-column-perm[_ngcontent-%COMP%]   .permission-name[_ngcontent-%COMP%]{margin-right:10px}.mat-chip[_ngcontent-%COMP%]:hover{cursor:pointer}.scrollable-matrix[_ngcontent-%COMP%]{overflow-y:scroll;overflow-x:auto;height:calc(100vh - 128px)}"],changeDetection:0}),Wt),_t=c("mrSG"),Ft=c("AqIO"),Xt=c("hsNs"),Ot=c("wL0i"),jt=c("0Obk"),Pt=c("4LpT");function Rt(t,e){if(1&t&&y.Sb(0,"a",7),2&t){var n=y.jc().row;y.rc("routerLink",n.id)}}function Dt(t,e){if(1&t&&(y.Xb(0,"div",5),y.Qc(1,Rt,1,1,"a",6),y.Xb(2,"div"),y.Sc(3),y.kc(4,"translate"),y.Wb(),y.Wb()),2&t){var n=e.value,i=y.jc();y.Fb(1),y.rc("ngIf",!i.isMultiSelect),y.Fb(2),y.Tc(y.lc(4,2,n))}}function xt(t,e){if(1&t){var n=y.Yb();y.Xb(0,"div",5),y.Xb(1,"button",8),y.fc("click",(function(){y.Gc(n);var t=e.row;return y.jc().onDeleteWorkflow(t)})),y.Xb(2,"mat-icon",9),y.Sc(3,"delete"),y.Wb(),y.Wb(),y.Wb()}}function Tt(t,e){if(1&t){var n=y.Yb();y.Xb(0,"h1",10),y.Xb(1,"span"),y.Sc(2),y.kc(3,"translate"),y.Wb(),y.Wb(),y.Xb(4,"div",11),y.Xb(5,"p"),y.Sc(6),y.kc(7,"translate"),y.Wb(),y.Xb(8,"mat-form-field"),y.Xb(9,"input",12),y.fc("ngModelChange",(function(t){return y.Gc(n),y.jc().newWorkflowTitle=t})),y.Wb(),y.Wb(),y.Wb(),y.Xb(10,"div",13),y.Xb(11,"button",14),y.Xb(12,"span"),y.Sc(13),y.kc(14,"translate"),y.Wb(),y.Wb(),y.Xb(15,"button",15),y.Xb(16,"span"),y.Sc(17),y.kc(18,"translate"),y.Wb(),y.Wb(),y.Wb()}if(2&t){var i=y.jc();y.Fb(2),y.Tc(y.lc(3,8,"New workflow")),y.Fb(4),y.Tc(y.lc(7,10,"Please enter a name for the new workflow:")),y.Fb(3),y.rc("ngModel",i.newWorkflowTitle),y.Fb(2),y.rc("disabled",""===i.newWorkflowTitle)("mat-dialog-close",i.newWorkflowTitle),y.Fb(2),y.Tc(y.lc(14,12,"Save")),y.Fb(2),y.rc("mat-dialog-close",null),y.Fb(2),y.Tc(y.lc(18,14,"Cancel"))}}var It,Qt,Et,$t=function(){return["menu"]},Lt=[{path:"",component:(It=function(t){a(i,t);var e=o(i);function i(t,n,a,c,o,r,l){var u;return s(this,i),(u=e.call(this,t,n,a,c)).translate=n,u.dialog=o,u.workflowRepo=r,u.promptService=l,u.tableColumnDefinition=[{prop:"name",width:"auto"},{prop:"delete"}],u.filterProps=["name","states"],u}return b(i,[{key:"ngOnInit",value:function(){n(l(i.prototype),"setTitle",this).call(this,"Workflows")}},{key:"onNewButton",value:function(t){var e=this;this.newWorkflowTitle="",this.dialog.open(t,w.a).afterClosed().subscribe((function(t){t&&e.workflowRepo.create(new Xt.a({name:t})).then((function(){}),e.raiseError)}))}},{key:"onDeleteWorkflow",value:function(t){return Object(_t.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.translate.instant("Are you sure you want to delete this workflow?"),i=t.getTitle(),e.next=3,this.promptService.open(n,i);case 3:if(e.t0=e.sent,!e.t0){e.next=6;break}this.workflowRepo.delete(t).then((function(){}),this.raiseError);case 6:case"end":return e.stop()}}),e,this)})))}}]),i}(Ot.a),It.\u0275fac=function(t){return new(t||It)(y.Rb(S.c),y.Rb(M.k),y.Rb(W.a),y.Rb(Ft.a),y.Rb(C.b),y.Rb(g.a),y.Rb(v.a))},It.\u0275cmp=y.Lb({type:It,selectors:[["os-workflow-list"]],features:[y.Cb],decls:10,vars:14,consts:[["prevUrl","../..",3,"nav","hasMainButton","mainEvent"],[1,"title-slot"],["listStorageKey","workflow",3,"listObservableProvider","columns","allowProjector","hiddenInMobile","showListOfSpeakers","filterProps","dataSourceChange"],["class","cell-slot fill",4,"pblNgridCellDef"],["newWorkflowDialog",""],[1,"cell-slot","fill"],["class","detail-link",3,"routerLink",4,"ngIf"],[1,"detail-link",3,"routerLink"],["type","button","mat-icon-button","",3,"click"],["color","warn"],["mat-dialog-title",""],["mat-dialog-content",""],["matInput","","osAutofocus","","required","",3,"ngModel","ngModelChange"],["mat-dialog-actions",""],["type","submit","mat-button","","color","accent",3,"disabled","mat-dialog-close"],["type","button","mat-button","",3,"mat-dialog-close"]],template:function(t,e){if(1&t){var n=y.Yb();y.Xb(0,"os-head-bar",0),y.fc("mainEvent",(function(){y.Gc(n);var t=y.Cc(9);return e.onNewButton(t)})),y.Xb(1,"div",1),y.Xb(2,"h2"),y.Sc(3),y.kc(4,"translate"),y.Wb(),y.Wb(),y.Wb(),y.Xb(5,"os-list-view-table",2),y.fc("dataSourceChange",(function(t){return e.onDataSourceChange(t)})),y.Qc(6,Dt,5,4,"div",3),y.Qc(7,xt,4,0,"div",3),y.Wb(),y.Qc(8,Tt,19,16,"ng-template",null,4,y.Rc)}2&t&&(y.rc("nav",!1)("hasMainButton",!0),y.Fb(3),y.Tc(y.lc(4,11,"Workflows")),y.Fb(2),y.rc("listObservableProvider",e.workflowRepo)("columns",e.tableColumnDefinition)("allowProjector",!1)("hiddenInMobile",y.wc(13,$t))("showListOfSpeakers",!1)("filterProps",e.filterProps),y.Fb(1),y.rc("pblNgridCellDef","name"),y.Fb(1),y.rc("pblNgridCellDef","delete"))},directives:[_.a,jt.a,Pt.b,r.t,f.i,F.b,X.a,C.i,C.f,R.c,D.b,x.d,T.a,x.E,x.t,x.w,C.c,C.d],pipes:[M.j],styles:[""]}),It),pathMatch:"full"},{path:":id",component:Ct}],At=((Et=function t(){s(this,t)}).\u0275mod=y.Pb({type:Et}),Et.\u0275inj=y.Ob({factory:function(t){return new(t||Et)},imports:[[f.j.forChild(Lt)],f.j]}),Et),Nt=((Qt=function t(){s(this,t)}).\u0275mod=y.Pb({type:Qt}),Qt.\u0275inj=y.Ob({factory:function(t){return new(t||Qt)},imports:[[r.c,At,u.a]]}),Qt)},wL0i:function(e,n,i){"use strict";i.d(n,"a",(function(){return c}));var c=function(e){a(i,e);var n=o(i);function i(t,e,a,c){var o;return s(this,i),(o=n.call(this,t,e,a)).storage=c,o.canMultiSelect=!1,o._multiSelectMode=!1,o.singleButtonWidth="40px",o.badgeButtonWidth="45px",o.selectedRows=[],o}return b(i,[{key:"onDataSourceChange",value:function(t){this.dataSource=t}},{key:"toggleMultiSelect",value:function(){!this.canMultiSelect||this.isMultiSelect?(this._multiSelectMode=!1,this.deselectAll()):this._multiSelectMode=!0}},{key:"selectAll",value:function(){var e;(e=this.dataSource.selection).select.apply(e,t(this.dataSource.filteredData))}},{key:"deselectAll",value:function(){this.dataSource&&this.dataSource.selection.clear()}},{key:"isMultiSelect",get:function(){return this._multiSelectMode}}]),i}(i("mV3u").a)}}])}();