!function(){function t(t,n){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=function(t,n){if(!t)return;if("string"==typeof t)return e(t,n);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return e(t,n)}(t))||n&&t&&"number"==typeof t.length){i&&(t=i);var a=0,o=function(){};return{s:o,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,c=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return s=t.done,t},e:function(t){c=!0,r=t},f:function(){try{s||null==i.return||i.return()}finally{if(c)throw r}}}}function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function a(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{"30jZ":function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var i=n("4X/P");function a(t){switch(t.type){case i.b.TYPE_REPLACEMENT:return"Replacement";case i.b.TYPE_INSERTION:return"Insertion";case i.b.TYPE_DELETION:return"Deletion";default:return t.other_description}}},y50V:function(e,i,o){"use strict";o.d(i,"a",(function(){return k}));var r,s,c,l,u=o("BBYV"),h=o("dOok"),d=o("8Y7J"),f=o("TSSN"),m=((r=function(){function e(t,i,a){n(this,e),this.motionRepo=t,this.translate=i,this.htmlToPdfService=a}return a(e,[{key:"renderDiffLines",value:function(t){if(t.diffLines&&t.diffLines.length){var e=t.diffLines.map((function(t){return t.text})).join("<br />[...]<br />");return this.htmlToPdfService.convertHtml(e)}}},{key:"amendmentToTableRow",value:function(t){var e="";return t.recommendation&&(e+=t.recommendation.show_recommendation_extension_field&&t.recommendationExtension?" "+this.motionRepo.getExtendedRecommendationLabel(t):this.translate.instant(t.recommendation.recommendation_label)),[{text:t.identifierOrTitle},{text:t.getChangeLines()},{text:t.submittersAsUsers.toString()},{stack:this.renderDiffLines(t)},{text:e}]}},{key:"overviewToDocDef",value:function(e,n){var i,a={text:e,style:"title"},o=[[{text:this.translate.instant("Motion"),style:"tableHeader"},{text:this.translate.instant("Line"),style:"tableHeader"},{text:this.translate.instant("Submitters"),style:"tableHeader"},{text:this.translate.instant("Changes"),style:"tableHeader"},{text:this.translate.instant("Recommendation"),style:"tableHeader"}]],r=[],s=t(n);try{for(s.s();!(i=s.n()).done;){var c=i.value;r.push(this.amendmentToTableRow(c))}}catch(l){s.e(l)}finally{s.f()}return[a,{table:{widths:["auto","auto","auto","*","auto"],headerRows:1,dontBreakRows:!0,body:o.concat(r)},layout:"switchColorTableLayout"}]}}]),e}()).\u0275fac=function(t){return new(t||r)(d.bc(h.a),d.bc(f.k),d.bc(u.a))},r.\u0275prov=d.Nb({token:r,factory:r.\u0275fac,providedIn:"root"}),r),p=o("a9GI"),v=o("+KbT"),g=o("iTQr"),b=o("pSLD"),y=o("+B0n"),T=o("Mluu"),S=o("a9XT"),x=o("GEzB"),R=o("j7f2"),w=o("6ako"),_=o("30jZ"),L=o("ykax"),C=o("3Y4h"),D=((l=function(){function e(t,i,a,o,r,s,c,l,u,h,d,f){n(this,e),this.translate=t,this.motionRepo=i,this.statuteRepo=a,this.changeRecoRepo=o,this.configService=r,this.pdfDocumentService=s,this.htmlToPdfService=c,this.linenumberingService=l,this.commentRepo=u,this.pollKeyVerbose=h,this.parsePollNumber=d,this.motionPollService=f,this.getRecommendationTypeName=_.a}return a(e,[{key:"motionToDocDef",value:function(t,e){var n,i=e&&e.lnMode?e.lnMode:null,a=e&&e.crMode?e.crMode:null,o=e?e.metaInfo:null,r=e?e.content:null,s=e?e.comments:null,c=this.configService.instant("motions_line_length"),l=this.configService.instant("motions_export_follow_recommendation"),u=[];t.isStatuteAmendment()&&(i=C.d.None,a=C.b.Diff),i||(i=this.configService.instant("motions_default_line_numbering")),a||(a=this.configService.instant("motions_recommendation_text_mode"));var h=this.createTitle(t,a,c),d=null!==(n=null==o?void 0:o.includes("id"))&&void 0!==n?n:this.configService.instant("motions_show_sequential_numbers");if(u=[h,this.createSubtitle(t,d)],o&&o.length>0||!o){var f=this.createMetaInfoTable(t,c,a,o,l);u.push(f)}if(!r||r.includes("text")){if(t.showPreamble){var m=this.createPreamble(t);u.push(m)}var p=this.createText(t,c,i,a);u.push(p)}if(!r||r.includes("reason")){var v=this.createReason(t,i);u.push(v)}return o&&o.includes("allcomments")&&(s=this.commentRepo.getViewModelList().map((function(t){return t.id}))),s&&u.push(this.createComments(t,s)),u}},{key:"createTitle",value:function(t,e,n){var i=this.getUnifiedChanges(t,n).find((function(t){return null==t?void 0:t.isTitleChange()})),a=this.changeRecoRepo.getTitleWithChanges(t.title,i,e),o=t.identifier?" "+t.identifier:"",r="";return"A4"===this.configService.instant("general_export_pdf_pagesize")&&(r+=this.translate.instant("Motion")+" "),{text:r+="".concat(o,": ").concat(a),style:"title"}}},{key:"createSubtitle",value:function(t,e){var n=[];return e&&n.push("".concat(this.translate.instant("Sequential number"),": ").concat(t.id)),t.parent_id&&(e&&n.push(" \u2022 "),n.push("".concat(this.translate.instant("Amendment to")," ").concat(t.parent.identifier||t.parent.title))),{text:n,style:"subtitle"}}},{key:"createMetaInfoTable",value:function(t,e,n,i,a){var o,r,s=this,c=[];if(!i||i.includes("submitters")){var l=t.submittersAsUsers.map((function(t){return t.full_name})).join(", ");c.push([{text:this.translate.instant("Submitters")+":",style:"boldText"},{text:l}])}if((!i||i.includes("supporters"))&&this.configService.instant("motions_min_supporters")&&t.supporters.length>0){var u=t.supporters.map((function(t){return t.full_name})).join(", ");c.push([{text:this.translate.instant("Supporters")+":",style:"boldText"},{text:u}])}(i&&!i.includes("state")||c.push([{text:this.translate.instant("State")+":",style:"boldText"},{text:this.motionRepo.getExtendedStateLabel(t)}]),!t.recommendation||i&&!i.includes("recommendation")||(o=t.isStatuteAmendment()?this.configService.instant("motions_statute_recommendations_by"):this.configService.instant("motions_recommendations_by"),c.push([{text:o+":",style:"boldText"},{text:this.motionRepo.getExtendedRecommendationLabel(t)}])),!t.category||i&&!i.includes("category"))||(r=t.category.parent?"".concat(t.category.parent.toString(),"\n").concat(this.translate.instant("Subcategory"),": ").concat(t.category.toString()):t.category.toString(),c.push([{text:this.translate.instant("Category")+":",style:"boldText"},{text:r}]));if(t.tags.length&&(!i||i.includes("tags"))){var h=t.tags.map((function(t){return t})).join(", ");c.push([{text:this.translate.instant("Tags")+":",style:"boldText"},{text:h}])}!t.motion_block||i&&!i.includes("motion_block")||c.push([{text:this.translate.instant("Motion block")+":",style:"boldText"},{text:t.motion_block.title}]),!t.origin||i&&!i.includes("origin")||c.push([{text:this.translate.instant("Origin")+":",style:"boldText"},{text:t.origin}]),!t.polls.length||i&&!i.includes("polls")||t.polls.forEach((function(t){if(t.hasVotes){var e=s.motionPollService.generateTableData(t),n=[],i=[],a=[];e.forEach((function(e){var o=s.translate.instant(s.pollKeyVerbose.transform(e.votingOption)),r=e.value[0],c=s.parsePollNumber.transform(r.amount);if(n.push(o+":"),r.showPercent){var l=s.motionPollService.getVoteValueInPercent(r.amount,t);i.push(null!==l?"(".concat(l,")"):"")}else i.push("");a.push(c)})),c.push([{text:t.title,style:"boldText"},{columns:[{text:n.join("\n"),width:"auto"},{text:i.join("\n"),width:"auto",alignment:"right"},{text:a.join("\n"),width:"auto",alignment:"right"}],columnGap:7}])}}));var d=this.getUnifiedChanges(t,e);if(n===C.b.Diff&&d.length>0){var f=[],m=[];d.forEach((function(t){if(t.isTitleChange()){var e=t;f.push(s.translate.instant("Title")+": "),m.push("(".concat(s.translate.instant("Change recommendation"),") - ").concat(s.translate.instant(s.getRecommendationTypeName(e))))}else{var n;if(n=t.getLineFrom()>=t.getLineTo()-1?t.getLineFrom():t.getLineFrom()+" - "+(t.getLineTo()-1),t.getChangeType()===x.a.TYPE_CHANGE_RECOMMENDATION){var i=t;f.push("".concat(s.translate.instant("Line")," ").concat(n,": ")),m.push("(".concat(s.translate.instant("Change recommendation"),") - ").concat(s.translate.instant(s.getRecommendationTypeName(i))))}else if(t.getChangeType()===x.a.TYPE_AMENDMENT){var a=t,o="(".concat(s.translate.instant("Amendment")," ").concat(a.getIdentifier(),") -");a.isRejected()?o+=" "+s.translate.instant("Rejected"):a.isAccepted()&&(o+=" "+s.translate.instant(a.stateName),f.push("".concat(s.translate.instant("Line")," ").concat(n,": ")),m.push(o))}}})),m.length>0&&c.push([{text:this.translate.instant("Summary of changes:"),style:"boldText"},{columns:[{text:f.join("\n"),width:"auto"},{text:m.join("\n"),width:"auto"}],columnGap:7}])}if(a&&c.push([{text:this.translate.instant("Decision")+":",style:"boldText"},{margin:[5,2,0,2],columns:[{width:8,canvas:this.pdfDocumentService.drawCircle(6.5,4)},{width:"auto",text:this.translate.instant("As recommendation")},{width:20,text:""},{width:8,canvas:this.pdfDocumentService.drawCircle(6.5,4)},{width:"auto",text:this.translate.instant("Divergent:")}]}]),c.length>0)return{table:{widths:["35%","65%"],body:c},margin:[0,0,0,20],layout:"metaboxLayout"}}},{key:"createPreamble",value:function(t){var e=this.configService.instant("motions_preamble");return{text:""+this.translate.instant(e),margin:[0,10,0,10]}}},{key:"createText",value:function(e,n,i,a){var o="";if(e.isParagraphBasedAmendment()){var r,s=this.changeRecoRepo.getChangeRecoOfMotion(e.id),c=t(this.motionRepo.getAmendmentParagraphLines(e,n,a,s,!1));try{for(c.s();!(r=c.n()).done;){var l=r.value;o+="<h3>"+this.motionRepo.getAmendmentParagraphLinesTitle(l)+"</h3>",o+='<div class="paragraphcontext">'.concat(l.textPre,"</div>"),o+=l.text,o+='<div class="paragraphcontext">'.concat(l.textPost,"</div>")}}catch(v){c.e(v)}finally{c.f()}}else if(e.isStatuteAmendment()){var u=this.statuteRepo.getViewModelList();o=this.motionRepo.formatStatuteAmendment(u,e,n)}else{var h=this.getUnifiedChanges(e,n),d=h.filter((function(t){return!t.isTitleChange()})),f=h.find((function(t){return t.isTitleChange()}));if(a===C.b.Diff&&f){var m=this.changeRecoRepo.getTitleChangesAsDiff(e.title,f);o+="<span><strong>"+this.translate.instant("Changed title")+":</strong><br>"+m+"</span><br>"}var p=this.motionRepo.formatMotion(e.id,a,d,n);o+=this.linenumberingService.splitInlineElementsAtLineBreaks(p)}return this.htmlToPdfService.convertHtml(o,i)}},{key:"getUnifiedChanges",value:function(t,e){var n=this,i=this.changeRecoRepo.getChangeRecoOfMotion(t.id),a=this.motionRepo.getAmendmentsInstantly(t.id).flatMap((function(t){var i=n.changeRecoRepo.getChangeRecoOfMotion(t.id).filter((function(t){return t.showInFinalView()}));return n.motionRepo.getAmendmentAmendedParagraphs(t,e,i)}));return i.concat(a).filter((function(t){return!!t})).sort((function(t,e){return t.getLineFrom()-e.getLineFrom()}))}},{key:"createReason",value:function(t,e){if(t.reason){var n=[];return n.push({text:this.translate.instant("Reason"),style:"heading3",margin:[0,25,0,10]}),n.push(this.htmlToPdfService.addPlainText(t.reason)),n}return{}}},{key:"callListToDoc",value:function(t){var e=this;t.sort((function(t,e){return t.weight-e.weight}));var n={text:this.translate.instant("Call list"),style:"title"},i=[[{text:this.translate.instant("Called"),style:"tableHeader"},{text:this.translate.instant("Called with"),style:"tableHeader"},{text:this.translate.instant("Submitters"),style:"tableHeader"},{text:this.translate.instant("Title"),style:"tableHeader"},{text:this.translate.instant("Recommendation"),style:"tableHeader"},{text:this.translate.instant("Notes"),style:"tableHeader"}]],a=[],o="";return t.forEach((function(t){if(!t.sort_parent_id){var n=t.tags?t.tags.map((function(t){return t.name})).join(", "):"";n!==o&&(a.push([{text:n,colSpan:6,style:"heading3",margin:[0,10,0,10]},"","","","",""]),o=n)}a.push(e.createCallListRow(t))})),[n,{table:{widths:["auto","auto","auto","*","auto","auto"],headerRows:1,dontBreakRows:!0,body:i.concat(a)},layout:"switchColorTableLayout"}]}},{key:"createCallListRow",value:function(t){return[{text:t.sort_parent_id?"":t.identifierOrTitle},{text:t.sort_parent_id?t.identifierOrTitle:""},{text:t.submitters.length?t.submittersAsUsers.map((function(t){return t.short_name})).join(", "):""},{text:t.title},{text:t.recommendation?this.motionRepo.getExtendedRecommendationLabel(t):""},{text:""}]}},{key:"textToDocDef",value:function(t,e,n){var i=this.configService.instant("motions_line_length"),a=this.configService.instant("motions_recommendation_text_mode"),o=this.createTitle(e,a,i),r=this.createSubtitle(e),s=this.createMetaInfoTable(e,i,a,["submitters","state","category"]),c=this.htmlToPdfService.convertHtml(t,C.d.None);return[o,r,s,{text:this.translate.instant(n),style:"heading2"},c]}},{key:"createComments",value:function(e,n){var i,a=[],o=t(n);try{for(o.s();!(i=o.n()).done;){var r=i.value,s="",c="";if(r===C.f)s=this.translate.instant("Personal note"),c=e&&e.personalNote&&e.personalNote.note;else{var l=this.commentRepo.getViewModel(r),u=e.getCommentForSection(l);s=l.name,c=u&&u.comment}s&&c&&(a.push({text:s,style:"heading3",margin:[0,25,0,10]}),a.push(this.htmlToPdfService.addPlainText(c)))}}catch(h){o.e(h)}finally{o.f()}return a}}]),e}()).\u0275fac=function(t){return new(t||l)(d.bc(f.k),d.bc(h.a),d.bc(T.a),d.bc(b.a),d.bc(v.a),d.bc(p.b),d.bc(u.a),d.bc(S.a),d.bc(y.a),d.bc(w.a),d.bc(R.a),d.bc(L.a))},l.\u0275prov=d.Nb({token:l,factory:l.\u0275fac,providedIn:"root"}),l),P=((c=function(){function e(t,i,a,o,r,s){n(this,e),this.translate=t,this.configService=i,this.motionPdfService=a,this.pdfService=o,this.motionRepo=r,this.categoryRepo=s,this.categoryObserver=this.categoryRepo.getViewModelListBehaviorSubject()}return a(e,[{key:"motionListToDocDef",value:function(t,e){for(var n=[],i=[],a=e.pdfOptions.includes("toc"),o=e.pdfOptions.includes("addBreaks"),r=0;r<t.length;++r)try{var s=this.motionPdfService.motionToDocDef(t[r],e);s[0].id=""+t[r].id,i.push(s),r<t.length-1&&o?i.push(this.pdfService.getPageBreak()):r<t.length-1&&!o&&i.push(this.pdfService.getSpacer())}catch(l){var c="".concat(this.translate.instant("Error during PDF creation of motion:")," ").concat(t[r].identifierOrTitle);throw console.error(c+"\nDebugInfo:\n",l),new p.c(c)}return t.length>1&&(!e.pdfOptions||a)&&n.push(this.pdfService.createTitle("motions_export_title"),this.pdfService.createPreamble("motions_export_preamble"),this.createToc(t)),n=n.concat(i)}},{key:"createToc",value:function(e,n){var i=this,a=[],o=this.categoryObserver.value,r={text:this.translate.instant("Table of contents"),style:"heading2"},s=this.configService.instant("motions_export_submitter_recommendation"),c=s?this.getTocHeaderDefinition():void 0,l=s?p.a.LIGHT_HORIZONTAL_LINES:p.a.DEFAULT;if(o&&o.length){var u,h=[],d=t(o.sort((function(t,e){return t.weight-e.weight})));try{var f=function(){var n=u.value,a=e.filter((function(t){return n===t.category}));if(a&&a.length){h.length&&h.push(i.pdfService.getPageBreak()),h.push({table:{body:[[{text:n.nameWithParentAbove,style:n.parent?"tocSubcategoryTitle":"tocCategoryTitle"}]]},layout:s?"lightHorizontalLines":"noBorders"});var o,r=[],d=t(a);try{for(d.s();!(o=d.n()).done;){var f=o.value;r.push(s?i.appendSubmittersAndRecommendation(f,p.d.CATEGORY_SECTION):i.pdfService.createTocLine(""+(f.identifier?f.identifier:""),f.title,""+f.id,p.d.CATEGORY_SECTION))}}catch(m){d.e(m)}finally{d.f()}h.push(i.pdfService.createTocTableDef(r,p.d.CATEGORY_SECTION,l,c?JSON.parse(JSON.stringify(c)):null))}};for(d.s();!(u=d.n()).done;)f()}catch(T){d.e(T)}finally{d.f()}var m=e.filter((function(t){return!t.category})).map((function(t){return i.pdfService.createTocLine(""+(t.identifier?t.identifier:""),t.title,""+t.id)}));m.length>0&&(h.push(this.pdfService.getPageBreak()),h.push(this.pdfService.createTocTableDef(m,p.d.CATEGORY_SECTION))),a.push(h)}else{var v,g=[],b=t(e);try{for(b.s();!(v=b.n()).done;){var y=v.value;g.push(s?this.appendSubmittersAndRecommendation(y):this.pdfService.createTocLine(""+(y.identifier?y.identifier:""),y.title,""+y.id))}}catch(T){b.e(T)}finally{b.f()}a.push(this.pdfService.createTocTableDef(g,p.d.CATEGORY_SECTION,l,c))}return[r,a,this.pdfService.getPageBreak()]}},{key:"getTocHeaderDefinition",value:function(){return[{text:this.translate.instant("Identifier"),style:"tocHeaderRow"},{style:"tocHeaderRow",text:["".concat(this.translate.instant("Title")," \xb7 ").concat(this.translate.instant("Submitters")," \xb7 "),{text:""+this.translate.instant("Recommendation"),italics:!0}]},{text:this.translate.instant("Page"),style:"tocHeaderRow",alignment:"right"}]}},{key:"appendSubmittersAndRecommendation",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p.d.DEFAULT,n="",i="";i=t.state.isFinalState?this.motionRepo.getExtendedStateLabel(t):this.motionRepo.getExtendedRecommendationLabel(t);for(var a=0;a<t.submitters.length;++a)n+=a!==t.submitters.length-1?t.submitters[a].getTitle()+", ":t.submitters[a].getTitle();return this.pdfService.createTocLine(""+(t.identifier?t.identifier:""),t.title,""+t.id,e,this.pdfService.createTocLineInline(n),this.pdfService.createTocLineInline(i,!0))}}]),e}()).\u0275fac=function(t){return new(t||c)(d.bc(f.k),d.bc(v.a),d.bc(D),d.bc(p.b),d.bc(h.a),d.bc(g.a))},c.\u0275prov=d.Nb({token:c,factory:c.\u0275fac,providedIn:"root"}),c),k=((s=function(){function t(e,i,a,o,r,s){n(this,t),this.translate=e,this.configService=i,this.motionPdfService=a,this.amendmentListPdfService=o,this.pdfCatalogService=r,this.pdfDocumentService=s}return a(t,[{key:"exportSingleMotion",value:function(t,e){var n=this.motionPdfService.motionToDocDef(t,e),i="".concat(this.translate.instant("Motion")," ").concat(t.identifierOrTitle);this.pdfDocumentService.download(n,i,{title:i})}},{key:"exportMotionCatalog",value:function(t,e){var n=this.pdfCatalogService.motionListToDocDef(t,e),i=this.configService.instant("motions_export_title"),a=this.translate.instant(i);this.pdfDocumentService.download(n,a,{title:a},e)}},{key:"exportPdfCallList",value:function(t){var e=this.motionPdfService.callListToDoc(t),n=this.translate.instant("Call list");this.pdfDocumentService.downloadLandscape(e,n,{title:n})}},{key:"exportPersonalNote",value:function(t,e){var n=this.motionPdfService.textToDocDef(t.note,e,"Personal note"),i="".concat(e.identifierOrTitle," - ").concat(this.translate.instant("Personal note"));this.pdfDocumentService.download(n,i,{title:i})}},{key:"exportComment",value:function(t,e){var n=e.getCommentForSection(t);if(n&&n.comment){var i=this.motionPdfService.textToDocDef(n.comment,e,t.name),a="".concat(e.identifierOrTitle," - ").concat(t.name);this.pdfDocumentService.download(i,a,{title:a})}}},{key:"exportAmendmentList",value:function(t,e){var n;n=e?"".concat(this.translate.instant("Amendments to")," ").concat(e.getListTitle()):""+this.translate.instant("Amendments");var i=this.amendmentListPdfService.overviewToDocDef(n,t);this.pdfDocumentService.downloadLandscape(i,n,{title:n})}}]),t}()).\u0275fac=function(t){return new(t||s)(d.bc(f.k),d.bc(v.a),d.bc(D),d.bc(m),d.bc(P),d.bc(p.b))},s.\u0275prov=d.Nb({token:s,factory:s.\u0275fac,providedIn:"root"}),s)}}])}();