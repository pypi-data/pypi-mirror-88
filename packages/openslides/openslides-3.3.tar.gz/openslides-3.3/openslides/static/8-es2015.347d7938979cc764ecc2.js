(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{"30jZ":function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var i=n("4X/P");function s(t){switch(t.type){case i.b.TYPE_REPLACEMENT:return"Replacement";case i.b.TYPE_INSERTION:return"Insertion";case i.b.TYPE_DELETION:return"Deletion";default:return t.other_description}}},y50V:function(t,e,n){"use strict";n.d(e,"a",(function(){return R}));var i=n("BBYV"),s=n("dOok"),o=n("8Y7J"),a=n("TSSN");let r=(()=>{class t{constructor(t,e,n){this.motionRepo=t,this.translate=e,this.htmlToPdfService=n}renderDiffLines(t){if(t.diffLines&&t.diffLines.length){const e=t.diffLines.map(t=>t.text).join("<br />[...]<br />");return this.htmlToPdfService.convertHtml(e)}}amendmentToTableRow(t){let e="";return t.recommendation&&(e+=t.recommendation.show_recommendation_extension_field&&t.recommendationExtension?" "+this.motionRepo.getExtendedRecommendationLabel(t):this.translate.instant(t.recommendation.recommendation_label)),[{text:t.identifierOrTitle},{text:t.getChangeLines()},{text:t.submittersAsUsers.toString()},{stack:this.renderDiffLines(t)},{text:e}]}overviewToDocDef(t,e){const n={text:t,style:"title"},i=[[{text:this.translate.instant("Motion"),style:"tableHeader"},{text:this.translate.instant("Line"),style:"tableHeader"},{text:this.translate.instant("Submitters"),style:"tableHeader"},{text:this.translate.instant("Changes"),style:"tableHeader"},{text:this.translate.instant("Recommendation"),style:"tableHeader"}]],s=[];for(const o of e)s.push(this.amendmentToTableRow(o));return[n,{table:{widths:["auto","auto","auto","*","auto"],headerRows:1,dontBreakRows:!0,body:i.concat(s)},layout:"switchColorTableLayout"}]}}return t.\u0275fac=function(e){return new(e||t)(o.bc(s.a),o.bc(a.k),o.bc(i.a))},t.\u0275prov=o.Nb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var c=n("a9GI"),l=n("+KbT"),h=n("iTQr"),d=n("pSLD"),m=n("+B0n"),u=n("Mluu"),f=n("a9XT"),p=n("GEzB"),g=n("j7f2"),b=n("6ako"),T=n("30jZ"),x=n("ykax"),S=n("3Y4h");let v=(()=>{class t{constructor(t,e,n,i,s,o,a,r,c,l,h,d){this.translate=t,this.motionRepo=e,this.statuteRepo=n,this.changeRecoRepo=i,this.configService=s,this.pdfDocumentService=o,this.htmlToPdfService=a,this.linenumberingService=r,this.commentRepo=c,this.pollKeyVerbose=l,this.parsePollNumber=h,this.motionPollService=d,this.getRecommendationTypeName=T.a}motionToDocDef(t,e){var n;let i=e&&e.lnMode?e.lnMode:null,s=e&&e.crMode?e.crMode:null;const o=e?e.metaInfo:null,a=e?e.content:null;let r=e?e.comments:null;const c=this.configService.instant("motions_line_length"),l=this.configService.instant("motions_export_follow_recommendation");let h=[];t.isStatuteAmendment()&&(i=S.d.None,s=S.b.Diff),i||(i=this.configService.instant("motions_default_line_numbering")),s||(s=this.configService.instant("motions_recommendation_text_mode"));const d=this.createTitle(t,s,c),m=null!==(n=null==o?void 0:o.includes("id"))&&void 0!==n?n:this.configService.instant("motions_show_sequential_numbers");if(h=[d,this.createSubtitle(t,m)],o&&o.length>0||!o){const e=this.createMetaInfoTable(t,c,s,o,l);h.push(e)}if(!a||a.includes("text")){if(t.showPreamble){const e=this.createPreamble(t);h.push(e)}const e=this.createText(t,c,i,s);h.push(e)}if(!a||a.includes("reason")){const e=this.createReason(t,i);h.push(e)}return o&&o.includes("allcomments")&&(r=this.commentRepo.getViewModelList().map(t=>t.id)),r&&h.push(this.createComments(t,r)),h}createTitle(t,e,n){const i=this.getUnifiedChanges(t,n).find(t=>null==t?void 0:t.isTitleChange()),s=this.changeRecoRepo.getTitleWithChanges(t.title,i,e),o=t.identifier?" "+t.identifier:"";let a="";return"A4"===this.configService.instant("general_export_pdf_pagesize")&&(a+=this.translate.instant("Motion")+" "),a+=`${o}: ${s}`,{text:a,style:"title"}}createSubtitle(t,e){const n=[];return e&&n.push(`${this.translate.instant("Sequential number")}: ${t.id}`),t.parent_id&&(e&&n.push(" \u2022 "),n.push(`${this.translate.instant("Amendment to")} ${t.parent.identifier||t.parent.title}`)),{text:n,style:"subtitle"}}createMetaInfoTable(t,e,n,i,s){const o=[];if(!i||i.includes("submitters")){const e=t.submittersAsUsers.map(t=>t.full_name).join(", ");o.push([{text:this.translate.instant("Submitters")+":",style:"boldText"},{text:e}])}if((!i||i.includes("supporters"))&&this.configService.instant("motions_min_supporters")&&t.supporters.length>0){const e=t.supporters.map(t=>t.full_name).join(", ");o.push([{text:this.translate.instant("Supporters")+":",style:"boldText"},{text:e}])}if(i&&!i.includes("state")||o.push([{text:this.translate.instant("State")+":",style:"boldText"},{text:this.motionRepo.getExtendedStateLabel(t)}]),t.recommendation&&(!i||i.includes("recommendation"))){let e;e=t.isStatuteAmendment()?this.configService.instant("motions_statute_recommendations_by"):this.configService.instant("motions_recommendations_by"),o.push([{text:e+":",style:"boldText"},{text:this.motionRepo.getExtendedRecommendationLabel(t)}])}if(t.category&&(!i||i.includes("category"))){let e="";e=t.category.parent?`${t.category.parent.toString()}\n${this.translate.instant("Subcategory")}: ${t.category.toString()}`:t.category.toString(),o.push([{text:this.translate.instant("Category")+":",style:"boldText"},{text:e}])}if(t.tags.length&&(!i||i.includes("tags"))){const e=t.tags.map(t=>t).join(", ");o.push([{text:this.translate.instant("Tags")+":",style:"boldText"},{text:e}])}!t.motion_block||i&&!i.includes("motion_block")||o.push([{text:this.translate.instant("Motion block")+":",style:"boldText"},{text:t.motion_block.title}]),!t.origin||i&&!i.includes("origin")||o.push([{text:this.translate.instant("Origin")+":",style:"boldText"},{text:t.origin}]),!t.polls.length||i&&!i.includes("polls")||t.polls.forEach(t=>{if(t.hasVotes){const e=this.motionPollService.generateTableData(t),n=[],i=[],s=[];e.forEach(e=>{const o=this.translate.instant(this.pollKeyVerbose.transform(e.votingOption)),a=e.value[0],r=this.parsePollNumber.transform(a.amount);if(n.push(o+":"),a.showPercent){const e=this.motionPollService.getVoteValueInPercent(a.amount,t);i.push(null!==e?`(${e})`:"")}else i.push("");s.push(r)}),o.push([{text:t.title,style:"boldText"},{columns:[{text:n.join("\n"),width:"auto"},{text:i.join("\n"),width:"auto",alignment:"right"},{text:s.join("\n"),width:"auto",alignment:"right"}],columnGap:7}])}});const a=this.getUnifiedChanges(t,e);if(n===S.b.Diff&&a.length>0){const t=[],e=[];a.forEach(n=>{if(n.isTitleChange()){const i=n;t.push(this.translate.instant("Title")+": "),e.push(`(${this.translate.instant("Change recommendation")}) - ${this.translate.instant(this.getRecommendationTypeName(i))}`)}else{let i;if(i=n.getLineFrom()>=n.getLineTo()-1?n.getLineFrom():n.getLineFrom()+" - "+(n.getLineTo()-1),n.getChangeType()===p.a.TYPE_CHANGE_RECOMMENDATION){const s=n;t.push(`${this.translate.instant("Line")} ${i}: `),e.push(`(${this.translate.instant("Change recommendation")}) - ${this.translate.instant(this.getRecommendationTypeName(s))}`)}else if(n.getChangeType()===p.a.TYPE_AMENDMENT){const s=n;let o=`(${this.translate.instant("Amendment")} ${s.getIdentifier()}) -`;s.isRejected()?o+=" "+this.translate.instant("Rejected"):s.isAccepted()&&(o+=" "+this.translate.instant(s.stateName),t.push(`${this.translate.instant("Line")} ${i}: `),e.push(o))}}}),e.length>0&&o.push([{text:this.translate.instant("Summary of changes:"),style:"boldText"},{columns:[{text:t.join("\n"),width:"auto"},{text:e.join("\n"),width:"auto"}],columnGap:7}])}if(s&&o.push([{text:this.translate.instant("Decision")+":",style:"boldText"},{margin:[5,2,0,2],columns:[{width:8,canvas:this.pdfDocumentService.drawCircle(6.5,4)},{width:"auto",text:this.translate.instant("As recommendation")},{width:20,text:""},{width:8,canvas:this.pdfDocumentService.drawCircle(6.5,4)},{width:"auto",text:this.translate.instant("Divergent:")}]}]),o.length>0)return{table:{widths:["35%","65%"],body:o},margin:[0,0,0,20],layout:"metaboxLayout"}}createPreamble(t){const e=this.configService.instant("motions_preamble");return{text:""+this.translate.instant(e),margin:[0,10,0,10]}}createText(t,e,n,i){let s="";if(t.isParagraphBasedAmendment()){const n=this.changeRecoRepo.getChangeRecoOfMotion(t.id),o=this.motionRepo.getAmendmentParagraphLines(t,e,i,n,!1);for(const t of o)s+="<h3>"+this.motionRepo.getAmendmentParagraphLinesTitle(t)+"</h3>",s+=`<div class="paragraphcontext">${t.textPre}</div>`,s+=t.text,s+=`<div class="paragraphcontext">${t.textPost}</div>`}else if(t.isStatuteAmendment()){const n=this.statuteRepo.getViewModelList();s=this.motionRepo.formatStatuteAmendment(n,t,e)}else{const n=this.getUnifiedChanges(t,e),o=n.filter(t=>!t.isTitleChange()),a=n.find(t=>t.isTitleChange());if(i===S.b.Diff&&a){const e=this.changeRecoRepo.getTitleChangesAsDiff(t.title,a);s+="<span><strong>"+this.translate.instant("Changed title")+":</strong><br>"+e+"</span><br>"}const r=this.motionRepo.formatMotion(t.id,i,o,e);s+=this.linenumberingService.splitInlineElementsAtLineBreaks(r)}return this.htmlToPdfService.convertHtml(s,n)}getUnifiedChanges(t,e){const n=this.changeRecoRepo.getChangeRecoOfMotion(t.id),i=this.motionRepo.getAmendmentsInstantly(t.id).flatMap(t=>{const n=this.changeRecoRepo.getChangeRecoOfMotion(t.id).filter(t=>t.showInFinalView());return this.motionRepo.getAmendmentAmendedParagraphs(t,e,n)});return n.concat(i).filter(t=>!!t).sort((t,e)=>t.getLineFrom()-e.getLineFrom())}createReason(t,e){if(t.reason){const e=[];return e.push({text:this.translate.instant("Reason"),style:"heading3",margin:[0,25,0,10]}),e.push(this.htmlToPdfService.addPlainText(t.reason)),e}return{}}callListToDoc(t){t.sort((t,e)=>t.weight-e.weight);const e={text:this.translate.instant("Call list"),style:"title"},n=[[{text:this.translate.instant("Called"),style:"tableHeader"},{text:this.translate.instant("Called with"),style:"tableHeader"},{text:this.translate.instant("Submitters"),style:"tableHeader"},{text:this.translate.instant("Title"),style:"tableHeader"},{text:this.translate.instant("Recommendation"),style:"tableHeader"},{text:this.translate.instant("Notes"),style:"tableHeader"}]],i=[];let s="";return t.forEach(t=>{if(!t.sort_parent_id){const e=t.tags?t.tags.map(t=>t.name).join(", "):"";e!==s&&(i.push([{text:e,colSpan:6,style:"heading3",margin:[0,10,0,10]},"","","","",""]),s=e)}i.push(this.createCallListRow(t))}),[e,{table:{widths:["auto","auto","auto","*","auto","auto"],headerRows:1,dontBreakRows:!0,body:n.concat(i)},layout:"switchColorTableLayout"}]}createCallListRow(t){return[{text:t.sort_parent_id?"":t.identifierOrTitle},{text:t.sort_parent_id?t.identifierOrTitle:""},{text:t.submitters.length?t.submittersAsUsers.map(t=>t.short_name).join(", "):""},{text:t.title},{text:t.recommendation?this.motionRepo.getExtendedRecommendationLabel(t):""},{text:""}]}textToDocDef(t,e,n){const i=this.configService.instant("motions_line_length"),s=this.configService.instant("motions_recommendation_text_mode"),o=this.createTitle(e,s,i),a=this.createSubtitle(e),r=this.createMetaInfoTable(e,i,s,["submitters","state","category"]),c=this.htmlToPdfService.convertHtml(t,S.d.None);return[o,a,r,{text:this.translate.instant(n),style:"heading2"},c]}createComments(t,e){const n=[];for(const i of e){let e="",s="";if(i===S.f)e=this.translate.instant("Personal note"),s=t&&t.personalNote&&t.personalNote.note;else{const n=this.commentRepo.getViewModel(i),o=t.getCommentForSection(n);e=n.name,s=o&&o.comment}e&&s&&(n.push({text:e,style:"heading3",margin:[0,25,0,10]}),n.push(this.htmlToPdfService.addPlainText(s)))}return n}}return t.\u0275fac=function(e){return new(e||t)(o.bc(a.k),o.bc(s.a),o.bc(u.a),o.bc(d.a),o.bc(l.a),o.bc(c.b),o.bc(i.a),o.bc(f.a),o.bc(m.a),o.bc(b.a),o.bc(g.a),o.bc(x.a))},t.\u0275prov=o.Nb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),y=(()=>{class t{constructor(t,e,n,i,s,o){this.translate=t,this.configService=e,this.motionPdfService=n,this.pdfService=i,this.motionRepo=s,this.categoryRepo=o,this.categoryObserver=this.categoryRepo.getViewModelListBehaviorSubject()}motionListToDocDef(t,e){let n=[];const i=[],s=e.pdfOptions.includes("toc"),o=e.pdfOptions.includes("addBreaks");for(let r=0;r<t.length;++r)try{const n=this.motionPdfService.motionToDocDef(t[r],e);n[0].id=""+t[r].id,i.push(n),r<t.length-1&&o?i.push(this.pdfService.getPageBreak()):r<t.length-1&&!o&&i.push(this.pdfService.getSpacer())}catch(a){const e=`${this.translate.instant("Error during PDF creation of motion:")} ${t[r].identifierOrTitle}`;throw console.error(e+"\nDebugInfo:\n",a),new c.c(e)}return t.length>1&&(!e.pdfOptions||s)&&n.push(this.pdfService.createTitle("motions_export_title"),this.pdfService.createPreamble("motions_export_preamble"),this.createToc(t)),n=n.concat(i),n}createToc(t,e){const n=[],i=this.categoryObserver.value,s={text:this.translate.instant("Table of contents"),style:"heading2"},o=this.configService.instant("motions_export_submitter_recommendation"),a=o?this.getTocHeaderDefinition():void 0,r=o?c.a.LIGHT_HORIZONTAL_LINES:c.a.DEFAULT;if(i&&i.length){const e=[];for(const n of i.sort((t,e)=>t.weight-e.weight)){const i=t.filter(t=>n===t.category);if(i&&i.length){e.length&&e.push(this.pdfService.getPageBreak()),e.push({table:{body:[[{text:n.nameWithParentAbove,style:n.parent?"tocSubcategoryTitle":"tocCategoryTitle"}]]},layout:o?"lightHorizontalLines":"noBorders"});const t=[];for(const e of i)t.push(o?this.appendSubmittersAndRecommendation(e,c.d.CATEGORY_SECTION):this.pdfService.createTocLine(""+(e.identifier?e.identifier:""),e.title,""+e.id,c.d.CATEGORY_SECTION));e.push(this.pdfService.createTocTableDef(t,c.d.CATEGORY_SECTION,r,a?JSON.parse(JSON.stringify(a)):null))}}const s=t.filter(t=>!t.category).map(t=>this.pdfService.createTocLine(""+(t.identifier?t.identifier:""),t.title,""+t.id));s.length>0&&(e.push(this.pdfService.getPageBreak()),e.push(this.pdfService.createTocTableDef(s,c.d.CATEGORY_SECTION))),n.push(e)}else{const e=[];for(const n of t)e.push(o?this.appendSubmittersAndRecommendation(n):this.pdfService.createTocLine(""+(n.identifier?n.identifier:""),n.title,""+n.id));n.push(this.pdfService.createTocTableDef(e,c.d.CATEGORY_SECTION,r,a))}return[s,n,this.pdfService.getPageBreak()]}getTocHeaderDefinition(){return[{text:this.translate.instant("Identifier"),style:"tocHeaderRow"},{style:"tocHeaderRow",text:[`${this.translate.instant("Title")} \xb7 ${this.translate.instant("Submitters")} \xb7 `,{text:""+this.translate.instant("Recommendation"),italics:!0}]},{text:this.translate.instant("Page"),style:"tocHeaderRow",alignment:"right"}]}appendSubmittersAndRecommendation(t,e=c.d.DEFAULT){let n="",i="";i=t.state.isFinalState?this.motionRepo.getExtendedStateLabel(t):this.motionRepo.getExtendedRecommendationLabel(t);for(let s=0;s<t.submitters.length;++s)n+=s!==t.submitters.length-1?t.submitters[s].getTitle()+", ":t.submitters[s].getTitle();return this.pdfService.createTocLine(""+(t.identifier?t.identifier:""),t.title,""+t.id,e,this.pdfService.createTocLineInline(n),this.pdfService.createTocLineInline(i,!0))}}return t.\u0275fac=function(e){return new(e||t)(o.bc(a.k),o.bc(l.a),o.bc(v),o.bc(c.b),o.bc(s.a),o.bc(h.a))},t.\u0275prov=o.Nb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),R=(()=>{class t{constructor(t,e,n,i,s,o){this.translate=t,this.configService=e,this.motionPdfService=n,this.amendmentListPdfService=i,this.pdfCatalogService=s,this.pdfDocumentService=o}exportSingleMotion(t,e){const n=this.motionPdfService.motionToDocDef(t,e),i=`${this.translate.instant("Motion")} ${t.identifierOrTitle}`;this.pdfDocumentService.download(n,i,{title:i})}exportMotionCatalog(t,e){const n=this.pdfCatalogService.motionListToDocDef(t,e),i=this.configService.instant("motions_export_title"),s=this.translate.instant(i);this.pdfDocumentService.download(n,s,{title:s},e)}exportPdfCallList(t){const e=this.motionPdfService.callListToDoc(t),n=this.translate.instant("Call list");this.pdfDocumentService.downloadLandscape(e,n,{title:n})}exportPersonalNote(t,e){const n=this.motionPdfService.textToDocDef(t.note,e,"Personal note"),i=`${e.identifierOrTitle} - ${this.translate.instant("Personal note")}`;this.pdfDocumentService.download(n,i,{title:i})}exportComment(t,e){const n=e.getCommentForSection(t);if(n&&n.comment){const i=this.motionPdfService.textToDocDef(n.comment,e,t.name),s=`${e.identifierOrTitle} - ${t.name}`;this.pdfDocumentService.download(i,s,{title:s})}}exportAmendmentList(t,e){let n;n=e?`${this.translate.instant("Amendments to")} ${e.getListTitle()}`:""+this.translate.instant("Amendments");const i=this.amendmentListPdfService.overviewToDocDef(n,t);this.pdfDocumentService.downloadLandscape(i,n,{title:n})}}return t.\u0275fac=function(e){return new(e||t)(o.bc(a.k),o.bc(l.a),o.bc(v),o.bc(r),o.bc(y),o.bc(c.b))},t.\u0275prov=o.Nb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()}}]);