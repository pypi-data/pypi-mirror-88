# For the PyTest configuration, I've followed this example
# https://github.com/pytest-dev/pytest-cov/tree/master/examples/src-layout

[tox]
minversion = 2.0
envlist = 
  clean
  py36
  coverage

depends =
    {py36,lint}: clean
    coverage: py36

[tool:pytest]
testpaths = tests
addopts =
    --cov-report=term-missing

[testenv]
deps = 
    -rrequirements.txt
    -rdev-requirements.txt
commands = pytest --cov --cov-append -c tests/pytest.ini

[testenv:clean]
deps = coverage
skip_install = true
commands = coverage erase

[testenv:coverage]
skip_install = true
deps = coverage
commands =
    coverage xml --rcfile=.coveragerc
    coverage report --rcfile=.coveragerc --fail-under=80

[testenv:lint]
basepython=python3.6
deps =
    -rrequirements.txt
    -rdev-requirements.txt
whitelist_externals = /bin/bash
commands=
    bash -c \'pylint --rcfile=.pylintrc ./src | tee pylint_out.txt || pylint-exit -wfail -efail $? \'