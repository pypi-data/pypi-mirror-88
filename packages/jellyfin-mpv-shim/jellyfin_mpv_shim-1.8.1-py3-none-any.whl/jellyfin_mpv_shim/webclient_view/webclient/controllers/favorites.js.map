{"version":3,"sources":["controllers/favorites.js"],"names":["define","appRouter","cardBuilder","dom","globalize","connectionManager","appHost","layoutManager","focusManager","getFetchDataFn","section","apiClient","this","options","SortBy","types","SortOrder","Filters","Recursive","Fields","CollapseBoxSetItems","ExcludeLocationTypes","EnableTotalRecordCount","userId","getCurrentUserId","getArtists","getPeople","IncludeItemTypes","getItems","getRouteUrl","serverId","itemTypes","isFavorite","getItemsHtmlFn","items","supportsImageAnalysis","supports","preferVisualCards","autoCardLayout","showTitle","leadingButtons","tv","name","translate","id","icon","routeUrl","lines","showYear","showParentTitle","getCardsHtml","preferThumb","shape","centerText","overlayText","scalable","coverImage","overlayPlayButton","overlayMoreButton","action","allowBottomPadding","cardLayout","FavoritesTab","view","params","currentApiClient","sectionsContainer","querySelector","createSections","instance","elem","i","length","sections","html","sectionClass","innerHTML","elems","querySelectorAll","itemsContainer","fetchData","bind","getItemsHtml","parentContainer","parentWithClass","prototype","onResume","promises","push","resume","Promise","all","then","autoFocus","onPause","pause","destroy"],"mappings":"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","file":"favorites.js","sourcesContent":["define(['appRouter', 'cardBuilder', 'dom', 'globalize', 'connectionManager', 'apphost', 'layoutManager', 'focusManager', 'emby-itemscontainer', 'emby-scroller'], function (appRouter, cardBuilder, dom, globalize, connectionManager, appHost, layoutManager, focusManager) {\n    'use strict';\n\n    function enableScrollX() {\n        return true;\n    }\n\n    function getThumbShape() {\n        return enableScrollX() ? 'overflowBackdrop' : 'backdrop';\n    }\n\n    function getPosterShape() {\n        return enableScrollX() ? 'overflowPortrait' : 'portrait';\n    }\n\n    function getSquareShape() {\n        return enableScrollX() ? 'overflowSquare' : 'square';\n    }\n\n    function getSections() {\n        return [{\n            name: 'HeaderFavoriteMovies',\n            types: 'Movie',\n            shape: getPosterShape(),\n            showTitle: true,\n            showYear: true,\n            overlayPlayButton: true,\n            overlayText: false,\n            centerText: true\n        }, {\n            name: 'HeaderFavoriteShows',\n            types: 'Series',\n            shape: getPosterShape(),\n            showTitle: true,\n            showYear: true,\n            overlayPlayButton: true,\n            overlayText: false,\n            centerText: true\n        }, {\n            name: 'HeaderFavoriteEpisodes',\n            types: 'Episode',\n            shape: getThumbShape(),\n            preferThumb: false,\n            showTitle: true,\n            showParentTitle: true,\n            overlayPlayButton: true,\n            overlayText: false,\n            centerText: true\n        }, {\n            name: 'HeaderFavoriteVideos',\n            types: 'Video',\n            shape: getThumbShape(),\n            preferThumb: true,\n            showTitle: true,\n            overlayPlayButton: true,\n            overlayText: false,\n            centerText: true\n        }, {\n            name: 'HeaderFavoriteCollections',\n            types: 'BoxSet',\n            shape: getPosterShape(),\n            showTitle: true,\n            overlayPlayButton: true,\n            overlayText: false,\n            centerText: true\n        }, {\n            name: 'HeaderFavoritePlaylists',\n            types: 'Playlist',\n            shape: getSquareShape(),\n            preferThumb: false,\n            showTitle: true,\n            overlayText: false,\n            showParentTitle: false,\n            centerText: true,\n            overlayPlayButton: true,\n            coverImage: true\n        }, {\n            name: 'HeaderFavoritePeople',\n            types: 'Person',\n            shape: getPosterShape(),\n            preferThumb: false,\n            showTitle: true,\n            overlayText: false,\n            showParentTitle: false,\n            centerText: true,\n            overlayPlayButton: true,\n            coverImage: true\n        }, {\n            name: 'HeaderFavoriteArtists',\n            types: 'MusicArtist',\n            shape: getSquareShape(),\n            preferThumb: false,\n            showTitle: true,\n            overlayText: false,\n            showParentTitle: false,\n            centerText: true,\n            overlayPlayButton: true,\n            coverImage: true\n        }, {\n            name: 'HeaderFavoriteAlbums',\n            types: 'MusicAlbum',\n            shape: getSquareShape(),\n            preferThumb: false,\n            showTitle: true,\n            overlayText: false,\n            showParentTitle: true,\n            centerText: true,\n            overlayPlayButton: true,\n            coverImage: true\n        }, {\n            name: 'HeaderFavoriteSongs',\n            types: 'Audio',\n            shape: getSquareShape(),\n            preferThumb: false,\n            showTitle: true,\n            overlayText: false,\n            showParentTitle: true,\n            centerText: true,\n            overlayMoreButton: true,\n            action: 'instantmix',\n            coverImage: true\n        }, {\n            name: 'HeaderFavoriteBooks',\n            types: 'Book',\n            shape: getPosterShape(),\n            showTitle: true,\n            showYear: true,\n            overlayPlayButton: true,\n            overlayText: false,\n            centerText: true\n        }];\n    }\n\n    function getFetchDataFn(section) {\n        return function () {\n            var apiClient = this.apiClient;\n            var options = {\n                SortBy: (section.types, 'SeriesName,SortName'),\n                SortOrder: 'Ascending',\n                Filters: 'IsFavorite',\n                Recursive: true,\n                Fields: 'PrimaryImageAspectRatio,BasicSyncInfo',\n                CollapseBoxSetItems: false,\n                ExcludeLocationTypes: 'Virtual',\n                EnableTotalRecordCount: false\n            };\n            options.Limit = 20;\n            var userId = apiClient.getCurrentUserId();\n\n            if ('MusicArtist' === section.types) {\n                return apiClient.getArtists(userId, options);\n            }\n\n            if ('Person' === section.types) {\n                return apiClient.getPeople(userId, options);\n            }\n\n            options.IncludeItemTypes = section.types;\n            return apiClient.getItems(userId, options);\n        };\n    }\n\n    function getRouteUrl(section, serverId) {\n        return appRouter.getRouteUrl('list', {\n            serverId: serverId,\n            itemTypes: section.types,\n            isFavorite: true\n        });\n    }\n\n    function getItemsHtmlFn(section) {\n        return function (items) {\n            var supportsImageAnalysis = appHost.supports('imageanalysis');\n            var cardLayout = (appHost.preferVisualCards || supportsImageAnalysis) && section.autoCardLayout && section.showTitle;\n            cardLayout = false;\n            var serverId = this.apiClient.serverId();\n            var leadingButtons = layoutManager.tv ? [{\n                name: globalize.translate('All'),\n                id: 'more',\n                icon: 'favorite',\n                routeUrl: getRouteUrl(section, serverId)\n            }] : null;\n            var lines = 0;\n\n            if (section.showTitle) {\n                lines++;\n            }\n\n            if (section.showYear) {\n                lines++;\n            }\n\n            if (section.showParentTitle) {\n                lines++;\n            }\n\n            return cardBuilder.getCardsHtml({\n                items: items,\n                preferThumb: section.preferThumb,\n                shape: section.shape,\n                centerText: section.centerText && !cardLayout,\n                overlayText: false !== section.overlayText,\n                showTitle: section.showTitle,\n                showYear: section.showYear,\n                showParentTitle: section.showParentTitle,\n                scalable: true,\n                coverImage: section.coverImage,\n                overlayPlayButton: section.overlayPlayButton,\n                overlayMoreButton: section.overlayMoreButton && !cardLayout,\n                action: section.action,\n                allowBottomPadding: !enableScrollX(),\n                cardLayout: cardLayout,\n                leadingButtons: leadingButtons,\n                lines: lines\n            });\n        };\n    }\n\n    function FavoritesTab(view, params) {\n        this.view = view;\n        this.params = params;\n        this.apiClient = connectionManager.currentApiClient();\n        this.sectionsContainer = view.querySelector('.sections');\n        createSections(this, this.sectionsContainer, this.apiClient);\n    }\n\n    function createSections(instance, elem, apiClient) {\n        var i;\n        var length;\n        var sections = getSections();\n        var html = '';\n\n        for (i = 0, length = sections.length; i < length; i++) {\n            var section = sections[i];\n            var sectionClass = 'verticalSection';\n\n            if (!section.showTitle) {\n                sectionClass += ' verticalSection-extrabottompadding';\n            }\n\n            html += '<div class=\"' + sectionClass + ' hide\">';\n            html += '<div class=\"sectionTitleContainer sectionTitleContainer-cards padded-left\">';\n\n            if (layoutManager.tv) {\n                html += '<h2 class=\"sectionTitle sectionTitle-cards\">' + globalize.translate(section.name) + '</h2>';\n            } else {\n                html += '<a is=\"emby-linkbutton\" href=\"' + getRouteUrl(section, apiClient.serverId()) + '\" class=\"more button-flat button-flat-mini sectionTitleTextButton\">';\n                html += '<h2 class=\"sectionTitle sectionTitle-cards\">';\n                html += globalize.translate(section.name);\n                html += '</h2>';\n                html += '<span class=\"material-icons chevron_right\"></span>';\n                html += '</a>';\n            }\n\n            html += '</div>';\n            html += '<div is=\"emby-scroller\" class=\"padded-top-focusscale padded-bottom-focusscale\" data-centerfocus=\"true\"><div is=\"emby-itemscontainer\" class=\"itemsContainer scrollSlider focuscontainer-x\" data-monitor=\"markfavorite\"></div></div>';\n            html += '</div>';\n        }\n\n        elem.innerHTML = html;\n        var elems = elem.querySelectorAll('.itemsContainer');\n\n        for (i = 0, length = elems.length; i < length; i++) {\n            var itemsContainer = elems[i];\n            itemsContainer.fetchData = getFetchDataFn(sections[i]).bind(instance);\n            itemsContainer.getItemsHtml = getItemsHtmlFn(sections[i]).bind(instance);\n            itemsContainer.parentContainer = dom.parentWithClass(itemsContainer, 'verticalSection');\n        }\n    }\n\n    FavoritesTab.prototype.onResume = function (options) {\n        var promises = (this.apiClient, []);\n        var view = this.view;\n        var elems = this.sectionsContainer.querySelectorAll('.itemsContainer');\n\n        for (var i = 0, length = elems.length; i < length; i++) {\n            promises.push(elems[i].resume(options));\n        }\n\n        Promise.all(promises).then(function () {\n            if (options.autoFocus) {\n                focusManager.autoFocus(view);\n            }\n        });\n    };\n\n    FavoritesTab.prototype.onPause = function () {\n        var elems = this.sectionsContainer.querySelectorAll('.itemsContainer');\n\n        for (var i = 0, length = elems.length; i < length; i++) {\n            elems[i].pause();\n        }\n    };\n\n    FavoritesTab.prototype.destroy = function () {\n        this.view = null;\n        this.params = null;\n        this.apiClient = null;\n        var elems = this.sectionsContainer.querySelectorAll('.itemsContainer');\n\n        for (var i = 0, length = elems.length; i < length; i++) {\n            elems[i].fetchData = null;\n            elems[i].getItemsHtml = null;\n            elems[i].parentContainer = null;\n        }\n\n        this.sectionsContainer = null;\n    };\n\n    return FavoritesTab;\n});\n"]}