"use strict";define(["browser","layoutManager","userSettings","inputManager","loading","cardBuilder","dom","apphost","imageLoader","libraryMenu","playbackManager","mainTabsManager","globalize","scrollStyles","emby-itemscontainer","emby-tabs","emby-button","flexStyles"],(function(browser,layoutManager,userSettings,inputManager,loading,cardBuilder,dom,appHost,imageLoader,libraryMenu,playbackManager,mainTabsManager,globalize){function itemsPerRow(){var screenWidth=dom.getWindowSize().innerWidth;return screenWidth>=1920?9:screenWidth>=1200?12:screenWidth>=1e3?10:8}function enableScrollX(){return!layoutManager.desktop}function getSquareShape(){return enableScrollX()?"overflowSquare":"square"}function loadSuggestionsTab(page,tabContent,parentId){console.debug("loadSuggestionsTab"),function loadLatest(page,parentId){loading.show();var userId=ApiClient.getCurrentUserId(),options={IncludeItemTypes:"Audio",Limit:enableScrollX()?3*itemsPerRow():2*itemsPerRow(),Fields:"PrimaryImageAspectRatio,BasicSyncInfo",ParentId:parentId,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb",EnableTotalRecordCount:!1};ApiClient.getJSON(ApiClient.getUrl("Users/"+userId+"/Items/Latest",options)).then((function(items){var elem=page.querySelector("#recentlyAddedSongs");appHost.supports("imageanalysis");elem.innerHTML=cardBuilder.getCardsHtml({items:items,showUnplayedIndicator:!1,showLatestItemsPopup:!1,shape:getSquareShape(),showTitle:!0,showParentTitle:!0,lazy:!0,centerText:!0,overlayPlayButton:!0,allowBottomPadding:!enableScrollX(),cardLayout:!1,coverImage:!0}),imageLoader.lazyChildren(elem),loading.hide(),require(["autoFocuser"],(function(autoFocuser){autoFocuser.autoFocus(page)}))}))}(tabContent,parentId),function loadRecentlyPlayed(page,parentId){var options={SortBy:"DatePlayed",SortOrder:"Descending",IncludeItemTypes:"Audio",Limit:itemsPerRow(),Recursive:!0,Fields:"PrimaryImageAspectRatio,AudioInfo",Filters:"IsPlayed",ParentId:parentId,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb",EnableTotalRecordCount:!1};ApiClient.getItems(ApiClient.getCurrentUserId(),options).then((function(result){var elem=page.querySelector("#recentlyPlayed");result.Items.length?elem.classList.remove("hide"):elem.classList.add("hide");var itemsContainer=elem.querySelector(".itemsContainer");appHost.supports("imageanalysis");itemsContainer.innerHTML=cardBuilder.getCardsHtml({items:result.Items,showUnplayedIndicator:!1,shape:getSquareShape(),showTitle:!0,showParentTitle:!0,action:"instantmix",lazy:!0,centerText:!0,overlayMoreButton:!0,allowBottomPadding:!enableScrollX(),cardLayout:!1,coverImage:!0}),imageLoader.lazyChildren(itemsContainer)}))}(tabContent,parentId),function loadFrequentlyPlayed(page,parentId){var options={SortBy:"PlayCount",SortOrder:"Descending",IncludeItemTypes:"Audio",Limit:itemsPerRow(),Recursive:!0,Fields:"PrimaryImageAspectRatio,AudioInfo",Filters:"IsPlayed",ParentId:parentId,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb",EnableTotalRecordCount:!1};ApiClient.getItems(ApiClient.getCurrentUserId(),options).then((function(result){var elem=page.querySelector("#topPlayed");result.Items.length?elem.classList.remove("hide"):elem.classList.add("hide");var itemsContainer=elem.querySelector(".itemsContainer");appHost.supports("imageanalysis");itemsContainer.innerHTML=cardBuilder.getCardsHtml({items:result.Items,showUnplayedIndicator:!1,shape:getSquareShape(),showTitle:!0,showParentTitle:!0,action:"instantmix",lazy:!0,centerText:!0,overlayMoreButton:!0,allowBottomPadding:!enableScrollX(),cardLayout:!1,coverImage:!0}),imageLoader.lazyChildren(itemsContainer)}))}(tabContent,parentId),require(["components/favoriteitems"],(function(favoriteItems){favoriteItems.render(tabContent,ApiClient.getCurrentUserId(),parentId,["favoriteArtists","favoriteAlbums","favoriteSongs"])}))}function getTabs(){return[{name:globalize.translate("TabSuggestions")},{name:globalize.translate("TabAlbums")},{name:globalize.translate("TabAlbumArtists")},{name:globalize.translate("TabArtists")},{name:globalize.translate("TabPlaylists")},{name:globalize.translate("TabSongs")},{name:globalize.translate("TabGenres")},{name:globalize.translate("ButtonSearch"),cssClass:"searchTabButton"}]}return function(view,params){function onBeforeTabChange(e){!function preLoadTab(page,index){getTabController(page,index,(function(controller){-1==renderedTabs.indexOf(index)&&controller.preRender&&controller.preRender()}))}(view,parseInt(e.detail.selectedTabIndex))}function onTabChange(e){!function loadTab(page,index){currentTabIndex=index,getTabController(page,index,(function(controller){null,-1==renderedTabs.indexOf(index)&&(renderedTabs.push(index),controller.renderTab())}))}(view,parseInt(e.detail.selectedTabIndex))}function getTabContainers(){return view.querySelectorAll(".pageTabContent")}function getTabController(page,index,callback){var depends=[];switch(index){case 0:break;case 1:depends.push("controllers/music/musicalbums");break;case 2:case 3:depends.push("controllers/music/musicartists");break;case 4:depends.push("controllers/music/musicplaylists");break;case 5:depends.push("controllers/music/songs");break;case 6:depends.push("controllers/music/musicgenres");break;case 7:depends.push("scripts/searchtab")}require(depends,(function(controllerFactory){var tabContent;0==index&&(tabContent=view.querySelector(".pageTabContent[data-index='"+index+"']"),self.tabContent=tabContent);var controller=tabControllers[index];controller||(tabContent=view.querySelector(".pageTabContent[data-index='"+index+"']"),controller=0===index?self:7===index?new controllerFactory(view,tabContent,{collectionType:"music",parentId:params.topParentId}):new controllerFactory(view,params,tabContent),2==index?controller.mode="albumartists":3==index&&(controller.mode="artists"),tabControllers[index]=controller,controller.initTab&&controller.initTab()),callback(controller)}))}function onInputCommand(e){switch(e.detail.command){case"search":e.preventDefault(),Dashboard.navigate("search.html?collectionType=music&parentId="+params.topParentId)}}var self=this,currentTabIndex=parseInt(params.tab||function getDefaultTabIndex(folderId){switch(userSettings.get("landing-"+folderId)){case"albums":return 1;case"albumartists":return 2;case"artists":return 3;case"playlists":return 4;case"songs":return 5;case"genres":return 6;default:return 0}}(params.topParentId));self.initTab=function(){for(var elem,containers=view.querySelector(".pageTabContent[data-index='0']").querySelectorAll(".itemsContainer"),i=0,length=containers.length;i<length;i++)elem=containers[i],browser.mobile?(elem.classList.add("hiddenScrollX"),layoutManager.tv&&elem.classList.add("smoothScrollX"),elem.classList.add("scrollX"),elem.classList.remove("vertical-wrap")):(elem.classList.remove("hiddenScrollX"),elem.classList.remove("smoothScrollX"),elem.classList.remove("scrollX"),elem.classList.add("vertical-wrap"))},self.renderTab=function(){!function reload(){loading.show(),loadSuggestionsTab(0,view.querySelector(".pageTabContent[data-index='0']"),params.topParentId)}()};var tabControllers=[],renderedTabs=[];view.addEventListener("viewshow",(function(e){if(e.detail.isRestored,function initTabs(){mainTabsManager.setTabs(view,currentTabIndex,getTabs,getTabContainers,onBeforeTabChange,onTabChange)}(),!view.getAttribute("data-title")){var parentId=params.topParentId;parentId?ApiClient.getItem(ApiClient.getCurrentUserId(),parentId).then((function(item){view.setAttribute("data-title",item.Name),libraryMenu.setTitle(item.Name)})):(view.setAttribute("data-title",globalize.translate("TabMusic")),libraryMenu.setTitle(globalize.translate("TabMusic")))}inputManager.on(window,onInputCommand)})),view.addEventListener("viewbeforehide",(function(e){inputManager.off(window,onInputCommand)})),view.addEventListener("viewdestroy",(function(e){tabControllers.forEach((function(t){t.destroy&&t.destroy()}))}))}}));
//# sourceMappingURL=musicrecommended.js.map
