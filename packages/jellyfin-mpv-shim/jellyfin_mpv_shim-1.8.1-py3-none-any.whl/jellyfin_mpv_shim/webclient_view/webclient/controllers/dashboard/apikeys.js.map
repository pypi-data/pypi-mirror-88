{"version":3,"sources":["controllers/dashboard/apikeys.js"],"names":["define","datetime","loading","libraryMenu","dom","globalize","loadData","page","show","ApiClient","getJSON","getUrl","then","result","renderKeys","keys","rows","map","item","html","AccessToken","translate","AppName","date","parseISO8601Date","DateCreated","toLocaleDateString","getDisplayTime","join","querySelector","innerHTML","hide","Items","pageIdOn","this","addEventListener","showNewKeyPrompt","require","prompt","title","label","description","value","ajax","type","url","App","e","btnRevoke","parentWithClass","target","revoke","key","confirm","getAttribute"],"mappings":"AAAA,aAAAA,OAAO,CAAC,WAAY,UAAW,cAAe,MAAO,YAAa,gBAAgB,SAAUC,SAAUC,QAASC,YAAaC,IAAKC,WAwC7H,SAASC,SAASC,MACdL,QAAQM,OACRC,UAAUC,QAAQD,UAAUE,OAAO,cAAcC,MAAK,SAAUC,SAzBpE,SAASC,WAAWP,KAAMQ,MACtB,IAAIC,KAAOD,KAAKE,KAAI,SAAUC,MAC1B,IAAIC,KAAO,GACXA,MAAQ,4DACRA,MAAQ,mCACRA,MAAQ,sDAAwDD,KAAKE,YAAc,kEAAoEf,UAAUgB,UAAU,gBAAkB,uBAAyBhB,UAAUgB,UAAU,gBAAkB,YAC5PF,MAAQ,QACRA,MAAQ,kEACRA,MAAQD,KAAKE,YACbD,MAAQ,QACRA,MAAQ,kEACRA,MAAQD,KAAKI,SAAW,GACxBH,MAAQ,QACRA,MAAQ,kEACR,IAAII,KAAOtB,SAASuB,iBAAiBN,KAAKO,aAAa,GAGvD,OAFAN,MAAQlB,SAASyB,mBAAmBH,MAAQ,IAAMtB,SAAS0B,eAAeJ,OAC1EJ,MAAQ,SACO,WAChBS,KAAK,IACRrB,KAAKsB,cAAc,eAAeC,UAAYd,KAC9Cd,QAAQ6B,OAMJjB,CAAWP,KAAMM,OAAOmB,UAuBhCC,SAAS,WAAY,eAAe,WAChC,IAAI1B,KAAO2B,KACX3B,KAAKsB,cAAc,cAAcM,iBAAiB,SAAS,YArB/D,SAASC,iBAAiB7B,MACtB8B,QAAQ,CAAC,WAAW,SAAUC,QAC1BA,OAAO,CACHC,MAAOlC,UAAUgB,UAAU,mBAC3BmB,MAAOnC,UAAUgB,UAAU,gBAC3BoB,YAAapC,UAAUgB,UAAU,yBAClCT,MAAK,SAAU8B,OACdjC,UAAUkC,KAAK,CACXC,KAAM,OACNC,IAAKpC,UAAUE,OAAO,YAAa,CAC/BmC,IAAKJ,UAEV9B,MAAK,WACJN,SAASC,eASjB6B,CAAiB7B,SAErBA,KAAKsB,cAAc,eAAeM,iBAAiB,SAAS,SAAUY,GAClE,IAAIC,UAAY5C,IAAI6C,gBAAgBF,EAAEG,OAAQ,aAE1CF,WAvEZ,SAASG,OAAO5C,KAAM6C,KAClBf,QAAQ,CAAC,YAAY,SAAUgB,SAC3BA,QAAQhD,UAAUgB,UAAU,8BAA+BhB,UAAUgB,UAAU,8BAA8BT,MAAK,WAC9GV,QAAQM,OACRC,UAAUkC,KAAK,CACXC,KAAM,SACNC,IAAKpC,UAAUE,OAAO,aAAeyC,OACtCxC,MAAK,WACJN,SAASC,eAgEb4C,CAAO5C,KAAMyC,UAAUM,aAAa,qBAIhDrB,SAAS,iBAAkB,eAAe,WACtC3B,SAAS4B","file":"apikeys.js","sourcesContent":["define(['datetime', 'loading', 'libraryMenu', 'dom', 'globalize', 'emby-button'], function (datetime, loading, libraryMenu, dom, globalize) {\n    'use strict';\n\n    function revoke(page, key) {\n        require(['confirm'], function (confirm) {\n            confirm(globalize.translate('MessageConfirmRevokeApiKey'), globalize.translate('HeaderConfirmRevokeApiKey')).then(function () {\n                loading.show();\n                ApiClient.ajax({\n                    type: 'DELETE',\n                    url: ApiClient.getUrl('Auth/Keys/' + key)\n                }).then(function () {\n                    loadData(page);\n                });\n            });\n        });\n    }\n\n    function renderKeys(page, keys) {\n        var rows = keys.map(function (item) {\n            var html = '';\n            html += '<tr class=\"detailTableBodyRow detailTableBodyRow-shaded\">';\n            html += '<td class=\"detailTableBodyCell\">';\n            html += '<button type=\"button\" is=\"emby-button\" data-token=\"' + item.AccessToken + '\" class=\"raised raised-mini btnRevoke\" data-mini=\"true\" title=\"' + globalize.translate('ButtonRevoke') + '\" style=\"margin:0;\">' + globalize.translate('ButtonRevoke') + '</button>';\n            html += '</td>';\n            html += '<td class=\"detailTableBodyCell\" style=\"vertical-align:middle;\">';\n            html += item.AccessToken;\n            html += '</td>';\n            html += '<td class=\"detailTableBodyCell\" style=\"vertical-align:middle;\">';\n            html += item.AppName || '';\n            html += '</td>';\n            html += '<td class=\"detailTableBodyCell\" style=\"vertical-align:middle;\">';\n            var date = datetime.parseISO8601Date(item.DateCreated, true);\n            html += datetime.toLocaleDateString(date) + ' ' + datetime.getDisplayTime(date);\n            html += '</td>';\n            return html += '</tr>';\n        }).join('');\n        page.querySelector('.resultBody').innerHTML = rows;\n        loading.hide();\n    }\n\n    function loadData(page) {\n        loading.show();\n        ApiClient.getJSON(ApiClient.getUrl('Auth/Keys')).then(function (result) {\n            renderKeys(page, result.Items);\n        });\n    }\n\n    function showNewKeyPrompt(page) {\n        require(['prompt'], function (prompt) {\n            prompt({\n                title: globalize.translate('HeaderNewApiKey'),\n                label: globalize.translate('LabelAppName'),\n                description: globalize.translate('LabelAppNameExample')\n            }).then(function (value) {\n                ApiClient.ajax({\n                    type: 'POST',\n                    url: ApiClient.getUrl('Auth/Keys', {\n                        App: value\n                    })\n                }).then(function () {\n                    loadData(page);\n                });\n            });\n        });\n    }\n\n    pageIdOn('pageinit', 'apiKeysPage', function () {\n        var page = this;\n        page.querySelector('.btnNewKey').addEventListener('click', function () {\n            showNewKeyPrompt(page);\n        });\n        page.querySelector('.tblApiKeys').addEventListener('click', function (e) {\n            var btnRevoke = dom.parentWithClass(e.target, 'btnRevoke');\n\n            if (btnRevoke) {\n                revoke(page, btnRevoke.getAttribute('data-token'));\n            }\n        });\n    });\n    pageIdOn('pagebeforeshow', 'apiKeysPage', function () {\n        loadData(this);\n    });\n});\n"]}