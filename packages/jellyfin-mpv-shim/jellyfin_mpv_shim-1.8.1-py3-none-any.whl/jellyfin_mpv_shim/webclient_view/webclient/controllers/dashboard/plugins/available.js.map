{"version":3,"sources":["controllers/dashboard/plugins/available.js"],"names":["define","loading","libraryMenu","globalize","populateList","options","availablePlugins","installedPlugins","forEach","plugin","index","array","category","categoryDisplayName","getHeaderText","replace","translate","sort","a","b","name","currentCategory","html","i","length","getPluginHtml","noItemsElement","classList","remove","catalogElement","innerHTML","hide","href","externalUrl","encodeURIComponent","guid","context","installedPlugin","filter","ip","Id","Version","getTabs","window","PluginCatalog","renderCatalog","view","params","addEventListener","setTabs","reloadList","page","show","promise1","ApiClient","getAvailablePlugins","promise2","getInstalledPlugins","Promise","all","then","responses","querySelector","this"],"mappings":"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","file":"available.js","sourcesContent":["define(['loading', 'libraryMenu', 'globalize', 'cardStyle', 'emby-button', 'emby-checkbox', 'emby-select'], function (loading, libraryMenu, globalize) {\n    'use strict';\n\n    function reloadList(page) {\n        loading.show();\n        var promise1 = ApiClient.getAvailablePlugins();\n        var promise2 = ApiClient.getInstalledPlugins();\n        Promise.all([promise1, promise2]).then(function (responses) {\n            populateList({\n                catalogElement: page.querySelector('#pluginTiles'),\n                noItemsElement: page.querySelector('#noPlugins'),\n                availablePlugins: responses[0],\n                installedPlugins: responses[1]\n            });\n        });\n    }\n\n    function getHeaderText(category) {\n        category = category.replace(' ', '');\n        if ('Channel' === category) {\n            category = 'Channels';\n        } else if ('Theme' === category) {\n            category = 'Themes';\n        } else if ('LiveTV' === category) {\n            category = 'HeaderLiveTV';\n        } else if ('ScreenSaver' === category) {\n            category = 'HeaderScreenSavers';\n        }\n\n        return globalize.translate(category);\n    }\n\n    function populateList(options) {\n        var availablePlugins = options.availablePlugins;\n        var installedPlugins = options.installedPlugins;\n\n        var categories = [];\n        availablePlugins.forEach(function (plugin, index, array) {\n            plugin.category = plugin.category || 'General';\n            plugin.categoryDisplayName = getHeaderText(plugin.category);\n            array[index] = plugin;\n        });\n\n        availablePlugins.sort(function (a, b) {\n            if (a.category > b.category) {\n                return 1;\n            } else if (b.category > a.category) {\n                return -1;\n            }\n            if (a.name > b.name) {\n                return 1;\n            } else if (b.name > a.name) {\n                return -1;\n            }\n            return 0;\n        });\n\n        var currentCategory = null;\n        var html = '';\n\n        for (var i = 0; i < availablePlugins.length; i++) {\n            var plugin = availablePlugins[i];\n            var category = plugin.categoryDisplayName;\n            if (category != currentCategory) {\n                if (currentCategory) {\n                    html += '</div>';\n                    html += '</div>';\n                }\n                html += '<div class=\"verticalSection\">';\n                html += '<h2 class=\"sectionTitle sectionTitle-cards\">' + category + '</h2>';\n                html += '<div class=\"itemsContainer vertical-wrap\">';\n                currentCategory = category;\n            }\n            html += getPluginHtml(plugin, options, installedPlugins);\n        }\n        html += '</div>';\n        html += '</div>';\n\n        if (!availablePlugins.length && options.noItemsElement) {\n            options.noItemsElement.classList.remove('hide');\n        }\n\n        options.catalogElement.innerHTML = html;\n        loading.hide();\n    }\n\n    function getPluginHtml(plugin, options, installedPlugins) {\n        var html = '';\n        var href = plugin.externalUrl ? plugin.externalUrl : 'addplugin.html?name=' + encodeURIComponent(plugin.name) + '&guid=' + plugin.guid;\n\n        if (options.context) {\n            href += '&context=' + options.context;\n        }\n\n        var target = plugin.externalUrl ? ' target=\"_blank\"' : '';\n        html += \"<div class='card backdropCard'>\";\n        html += '<div class=\"cardBox visualCardBox\">';\n        html += '<div class=\"cardScalable visualCardBox-cardScalable\">';\n        html += '<div class=\"cardPadder cardPadder-backdrop\"></div>';\n        html += '<a class=\"cardContent cardImageContainer\" is=\"emby-linkbutton\" href=\"' + href + '\"' + target + '>';\n        html += '<span class=\"cardImageIcon material-icons folder\"></span>';\n        html += '</a>';\n        html += '</div>';\n        html += '<div class=\"cardFooter\">';\n        html += \"<div class='cardText'>\";\n        html += plugin.name;\n        html += '</div>';\n        var installedPlugin = installedPlugins.filter(function (ip) {\n            return ip.Id == plugin.guid;\n        })[0];\n        html += \"<div class='cardText cardText-secondary'>\";\n        html += installedPlugin ? globalize.translate('LabelVersionInstalled', installedPlugin.Version) : '&nbsp;';\n        html += '</div>';\n        html += '</div>';\n        html += '</div>';\n        return html += '</div>';\n    }\n\n    function getTabs() {\n        return [{\n            href: 'installedplugins.html',\n            name: globalize.translate('TabMyPlugins')\n        }, {\n            href: 'availableplugins.html',\n            name: globalize.translate('TabCatalog')\n        }, {\n            href: 'repositories.html',\n            name: globalize.translate('TabRepositories')\n        }];\n    }\n\n    window.PluginCatalog = {\n        renderCatalog: populateList\n    };\n\n    return function (view, params) {\n        view.addEventListener('viewshow', function () {\n            libraryMenu.setTabs('plugins', 1, getTabs);\n            reloadList(this);\n        });\n    };\n});\n"]}