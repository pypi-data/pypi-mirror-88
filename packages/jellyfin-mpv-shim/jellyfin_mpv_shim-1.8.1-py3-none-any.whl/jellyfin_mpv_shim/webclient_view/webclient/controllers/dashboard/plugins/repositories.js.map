{"version":3,"sources":["controllers/dashboard/plugins/repositories.js"],"names":["define","_exports","_loading","_libraryMenu","_globalize","_dialogHelper","_embyButton","_embyCheckbox","_embySelect","_formDialogStyle","_listViewStyle","_interopRequireDefault","obj","__esModule","default","Object","defineProperty","value","_default","view","params","addEventListener","libraryMenu","setTabs","getTabs","reloadList","this","save","$","on","button","repositories","filter","r","Url","id","saveList","querySelector","dialog","dialogHelper","createDialog","scrollY","size","modal","removeOnClose","html","concat","globalize","translate","innerHTML","close","push","Name","Enabled","open","page","loading","show","ApiClient","getJSON","getUrl","then","list","populateList","options","i","length","getRepositoryHtml","noneElement","classList","remove","listElement","hide","catch","error","console","ajax","type","url","data","JSON","stringify","contentType","response","repository","href","name"],"mappings":"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","file":"repositories.js","sourcesContent":["import loading from 'loading';\nimport libraryMenu from 'libraryMenu';\nimport globalize from 'globalize';\nimport dialogHelper from 'dialogHelper';\nimport 'emby-button';\nimport 'emby-checkbox';\nimport 'emby-select';\nimport 'formDialogStyle';\nimport 'listViewStyle';\n\nlet repositories = [];\n\nfunction reloadList(page) {\n    loading.show();\n    ApiClient.getJSON(ApiClient.getUrl('Repositories')).then(list => {\n        repositories = list;\n        populateList({\n            listElement: page.querySelector('#repositories'),\n            noneElement: page.querySelector('#none'),\n            repositories: repositories\n        });\n    }).catch(error => {\n        console.error('error loading repositories');\n        page.querySelector('#none').classList.remove('hide');\n        loading.hide();\n    });\n}\n\nfunction saveList(page) {\n    loading.show();\n    ApiClient.ajax({\n        type: 'POST',\n        url: ApiClient.getUrl('Repositories'),\n        data: JSON.stringify(repositories),\n        contentType: 'application/json'\n    }).then(response => {\n        reloadList(page);\n    }).catch(error => {\n        console.error('error saving repositories');\n        loading.hide();\n    });\n}\n\nfunction populateList(options) {\n    var html = '';\n\n    html += '<div class=\"paperList\">';\n    for (var i = 0; i < options.repositories.length; i++) {\n        html += getRepositoryHtml(options.repositories[i]);\n    }\n\n    html += '</div>';\n    if (!options.repositories.length) {\n        options.noneElement.classList.remove('hide');\n    }\n\n    options.listElement.innerHTML = html;\n    loading.hide();\n}\n\nfunction getRepositoryHtml(repository) {\n    var html = '';\n\n    html += '<div class=\"listItem listItem-border\">';\n    html += `<a is=\"emby-linkbutton\" style=\"margin:0;padding:0\" class=\"clearLink listItemIconContainer\" href=\"${repository.Url}\">`;\n    html += '<span class=\"material-icons listItemIcon open_in_new\"></span>';\n    html += '</a>';\n    html += '<div class=\"listItemBody two-line\">';\n    html += `<h3 class=\"listItemBodyText\">${repository.Name}</h3>`;\n    html += `<div class=\"listItemBodyText secondary\">${repository.Url}</div>`;\n    html += '</div>';\n    html += `<button type=\"button\" is=\"paper-icon-button-light\" id=\"${repository.Url}\" class=\"btnDelete\" title=\"${globalize.translate('ButtonDelete')}\"><span class=\"material-icons delete\"></span></button>`;\n    html += '</div>';\n\n    return html;\n}\n\nfunction getTabs() {\n    return [{\n        href: 'installedplugins.html',\n        name: globalize.translate('TabMyPlugins')\n    }, {\n        href: 'availableplugins.html',\n        name: globalize.translate('TabCatalog')\n    }, {\n        href: 'repositories.html',\n        name: globalize.translate('TabRepositories')\n    }];\n}\n\nexport default function(view, params) {\n    view.addEventListener('viewshow', function () {\n        libraryMenu.setTabs('plugins', 2, getTabs);\n        reloadList(this);\n\n        var save = this;\n        $('#repositories', view).on('click', '.btnDelete', function() {\n            var button = this;\n            repositories = repositories.filter(function (r) {\n                return r.Url !== button.id;\n            });\n\n            saveList(save);\n        });\n    });\n\n    view.querySelector('.btnNewRepository').addEventListener('click', () => {\n        let dialog = dialogHelper.createDialog({\n            scrollY: false,\n            size: 'large',\n            modal: false,\n            removeOnClose: true\n        });\n\n        let html = '';\n\n        html += '<div class=\"formDialogHeader\">';\n        html += '<button type=\"button\" is=\"paper-icon-button-light\" class=\"btnCancel autoSize\" tabindex=\"-1\"><span class=\"material-icons arrow_back\"></span></button>';\n        html += `<h3 class=\"formDialogHeaderTitle\">${globalize.translate('HeaderNewRepository')}</h3>`;\n        html += '</div>';\n        html += '<form class=\"newPluginForm\" style=\"margin:4em\">';\n        html += '<div class=\"inputContainer\">';\n        html += `<input is=\"emby-input\" id=\"txtRepositoryName\" label=\"${globalize.translate('LabelRepositoryName')}\" type=\"text\" required />`;\n        html += `<div class=\"fieldDescription\">${globalize.translate('LabelRepositoryNameHelp')}</div>`;\n        html += '</div>';\n        html += '<div class=\"inputContainer\">';\n        html += `<input is=\"emby-input\" id=\"txtRepositoryUrl\" label=\"${globalize.translate('LabelRepositoryUrl')}\" type=\"url\" required />`;\n        html += `<div class=\"fieldDescription\">${globalize.translate('LabelRepositoryUrlHelp')}</div>`;\n        html += '</div>';\n        html += `<button is=\"emby-button\" type=\"submit\" class=\"raised button-submit block\"><span>${globalize.translate('ButtonSave')}</span></button>`;\n        html += '</div>';\n        html += '</form>';\n\n        dialog.innerHTML = html;\n        dialog.querySelector('.btnCancel').addEventListener('click', () => {\n            dialogHelper.close(dialog);\n        });\n\n        dialog.querySelector('.newPluginForm').addEventListener('submit', () => {\n            repositories.push({\n                Name: dialog.querySelector('#txtRepositoryName').value,\n                Url: dialog.querySelector('#txtRepositoryUrl').value,\n                Enabled: true\n            });\n\n            saveList(view);\n            dialogHelper.close(dialog);\n            return false;\n        });\n\n        dialogHelper.open(dialog);\n    });\n}\n"]}