"use strict";define(["appSettings","browser","events","htmlMediaHelper","webSettings","globalize"],(function(appSettings,browser,events,htmlMediaHelper,webSettings,globalize){function getBaseProfileOptions(item){var disableHlsVideoAudioCodecs=[];return item&&htmlMediaHelper.enableHlsJsPlayer(item.RunTimeTicks,item.MediaType)&&(browser.edge&&disableHlsVideoAudioCodecs.push("mp3"),disableHlsVideoAudioCodecs.push("ac3"),disableHlsVideoAudioCodecs.push("eac3"),disableHlsVideoAudioCodecs.push("opus")),{enableMkvProgressive:!1,disableHlsVideoAudioCodecs:disableHlsVideoAudioCodecs}}function generateDeviceId(){var keys=[];if(keys.push(navigator.userAgent),keys.push((new Date).getTime()),self.btoa){var result=function replaceAll(originalString,strReplace,strWith){var strReplace2=function escapeRegExp(str){return str.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}(strReplace),reg=new RegExp(strReplace2,"ig");return originalString.replace(reg,strWith)}(btoa(keys.join("|")),"=","1");return Promise.resolve(result)}return Promise.resolve((new Date).getTime())}function onAppVisible(){isHidden&&(isHidden=!1,console.debug("triggering app resume event"),events.trigger(appHost,"resume"))}function onAppHidden(){isHidden||(isHidden=!0,console.debug("app is hidden"))}var features,exitPromise,_deviceId,_deviceName,supportedFeatures=(features=[],navigator.share&&features.push("sharing"),browser.edgeUwp||browser.tv||browser.xboxOne||browser.ps4||features.push("filedownload"),browser.operaTv||browser.tizen||browser.orsay||browser.web0s?features.push("exit"):(features.push("exitmenu"),features.push("plugins")),browser.operaTv||browser.tizen||browser.orsay||browser.web0s||browser.ps4||(features.push("externallinks"),features.push("externalpremium")),browser.operaTv||features.push("externallinkdisplay"),function supportsVoiceInput(){return!browser.tv&&(window.SpeechRecognition||window.webkitSpeechRecognition||window.mozSpeechRecognition||window.oSpeechRecognition||window.msSpeechRecognition)}()&&features.push("voiceinput"),function supportsHtmlMediaAutoplay(){return!!(browser.edgeUwp||browser.tizen||browser.web0s||browser.orsay||browser.operaTv||browser.ps4||browser.xboxOne)||!browser.mobile}()&&(features.push("htmlaudioautoplay"),features.push("htmlvideoautoplay")),browser.edgeUwp&&features.push("sync"),function supportsFullscreen(){if(browser.tv)return!1;var element=document.documentElement;return element.requestFullscreen||element.mozRequestFullScreen||element.webkitRequestFullscreen||element.msRequestFullscreen||document.createElement("video").webkitEnterFullscreen}()&&features.push("fullscreenchange"),(browser.chrome||browser.edge&&!browser.slow)&&(browser.noAnimation||browser.edgeUwp||browser.xboxOne||features.push("imageanalysis")),(browser.tv||browser.xboxOne||browser.ps4||browser.mobile)&&features.push("physicalvolumecontrol"),browser.tv||browser.xboxOne||browser.ps4||features.push("remotecontrol"),browser.operaTv||browser.tizen||browser.orsay||browser.web0s||browser.edgeUwp||features.push("remotevideo"),features.push("displaylanguage"),features.push("otherapppromotions"),features.push("displaymode"),features.push("targetblank"),features.push("screensaver"),webSettings.enableMultiServer().then((function(enabled){enabled&&features.push("multiserver")})),!browser.orsay&&(browser.firefox||browser.ps4||browser.edge||function supportsCue(){try{var video=document.createElement("video"),style=document.createElement("style");style.textContent="video::cue {background: inherit}",document.body.appendChild(style),document.body.appendChild(video);var cue=window.getComputedStyle(video,"::cue").background;return document.body.removeChild(style),document.body.removeChild(video),!!cue.length}catch(err){return console.error("error detecting cue support: "+err),!1}}())&&features.push("subtitleappearancesettings"),browser.orsay||features.push("subtitleburnsettings"),browser.tv||browser.ps4||browser.xboxOne||features.push("fileinput"),(browser.chrome||browser.edgeChromium)&&features.push("chromecast"),features);function doExit(){try{window.NativeShell?window.NativeShell.AppHost.exit():browser.tizen?tizen.application.getCurrentApplication().exit():browser.web0s?webOS.platformBack():window.close()}catch(err){console.error("error closing application: "+err)}}var hidden,visibilityChange,appHost={getWindowState:function getWindowState(){return document.windowState||"Normal"},setWindowState:function setWindowState(state){alert("setWindowState is not supported and should not be called")},exit:function exit(){window.appMode&&browser.tizen?function askForExit(){exitPromise||require(["actionsheet"],(function(actionsheet){exitPromise=actionsheet.show({title:globalize.translate("MessageConfirmAppExit"),items:[{id:"yes",name:globalize.translate("Yes")},{id:"no",name:globalize.translate("No")}]}).then((function(value){"yes"===value&&doExit()})).finally((function(){exitPromise=null}))}))}():doExit()},supports:function supports(command){return window.NativeShell?window.NativeShell.AppHost.supports(command):-1!==supportedFeatures.indexOf(command.toLowerCase())},preferVisualCards:browser.android||browser.chrome,getSyncProfile:function getSyncProfile(){return new Promise((function(resolve){require(["browserdeviceprofile","appSettings"],(function(profileBuilder,appSettings){var profile;window.NativeShell?profile=window.NativeShell.AppHost.getSyncProfile(profileBuilder,appSettings):(profile=profileBuilder()).MaxStaticMusicBitrate=appSettings.maxStaticMusicBitrate(),resolve(profile)}))}))},getDefaultLayout:function getDefaultLayout(){return window.NativeShell?window.NativeShell.AppHost.getDefaultLayout():"desktop"},getDeviceProfile:function getDeviceProfile(item,options){return options=options||{},self.Windows?function getDeviceProfileForWindowsUwp(item){return new Promise((function(resolve,reject){require(["browserdeviceprofile","environments/windows-uwp/mediacaps"],(function(profileBuilder,uwpMediaCaps){var profileOptions=getBaseProfileOptions(item);profileOptions.supportsDts=uwpMediaCaps.supportsDTS(),profileOptions.supportsTrueHd=uwpMediaCaps.supportsDolby(),profileOptions.audioChannels=uwpMediaCaps.getAudioChannels(),resolve(profileBuilder(profileOptions))}))}))}(item):new Promise((function(resolve){require(["browserdeviceprofile"],(function(profileBuilder){var profile;if(window.NativeShell)profile=window.NativeShell.AppHost.getDeviceProfile(profileBuilder);else{var builderOpts=getBaseProfileOptions(item);builderOpts.enableSsaRender=item&&!options.isRetry&&"allcomplexformats"!==appSettings.get("subtitleburnin"),profile=profileBuilder(builderOpts)}resolve(profile)}))}))},init:function init(){if(window.NativeShell)return window.NativeShell.AppHost.init();_deviceName=function getDeviceName(){var deviceName;return deviceName=browser.tizen?"Samsung Smart TV":browser.web0s?"LG Smart TV":browser.operaTv?"Opera TV":browser.xboxOne?"Xbox One":browser.ps4?"Sony PS4":browser.chrome?"Chrome":browser.edgeChromium?"Edge Chromium":browser.edge?"Edge":browser.firefox?"Firefox":browser.opera?"Opera":browser.safari?"Safari":"Web Browser",browser.ipad?deviceName+=" iPad":browser.iphone?deviceName+=" iPhone":browser.android&&(deviceName+=" Android"),deviceName}(),function getDeviceId(){var key="_deviceId2",deviceId=appSettings.get(key);return deviceId?Promise.resolve(deviceId):generateDeviceId().then((function(deviceId){return appSettings.set(key,deviceId),deviceId}))}().then((function(id){_deviceId=id}))},deviceName:function deviceName(){return window.NativeShell?window.NativeShell.AppHost.deviceName():_deviceName},deviceId:function deviceId(){return window.NativeShell?window.NativeShell.AppHost.deviceId():_deviceId},appName:function appName(){return window.NativeShell?window.NativeShell.AppHost.appName():"Jellyfin Web"},appVersion:function appVersion(){return window.NativeShell?window.NativeShell.AppHost.appVersion():"10.6.2"},getPushTokenInfo:function getPushTokenInfo(){return{}},setThemeColor:function setThemeColor(color){var metaThemeColor=document.querySelector("meta[name=theme-color]");metaThemeColor&&metaThemeColor.setAttribute("content",color)},setUserScalable:function setUserScalable(scalable){if(!browser.tv){var att=scalable?"width=device-width, initial-scale=1, minimum-scale=1, user-scalable=yes":"width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no";document.querySelector("meta[name=viewport]").setAttribute("content",att)}}},isHidden=!1;return void 0!==document.hidden?(hidden="hidden",visibilityChange="visibilitychange"):void 0!==document.webkitHidden&&(hidden="webkitHidden",visibilityChange="webkitvisibilitychange"),document.addEventListener(visibilityChange,(function(){document[hidden]?onAppHidden():onAppVisible()}),!1),self.addEventListener&&(self.addEventListener("focus",onAppVisible),self.addEventListener("blur",onAppHidden)),appHost}));
//# sourceMappingURL=apphost.js.map
