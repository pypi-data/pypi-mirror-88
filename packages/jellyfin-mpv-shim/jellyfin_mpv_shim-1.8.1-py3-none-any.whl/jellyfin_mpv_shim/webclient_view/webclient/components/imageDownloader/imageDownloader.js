"use strict";define(["dom","loading","apphost","dialogHelper","connectionManager","imageLoader","browser","layoutManager","scrollHelper","globalize","require","emby-checkbox","paper-icon-button-light","emby-button","formDialogStyle","cardStyle"],(function(dom,loading,appHost,dialogHelper,connectionManager,imageLoader,browser,layoutManager,scrollHelper,globalize,require){var currentItemId,currentItemType,currentResolve,currentReject,selectedProvider,enableFocusTransform=!browser.slow&&!browser.edge,hasChanges=!1,browsableImagePageSize=browser.slow?6:30,browsableImageStartIndex=0,browsableImageType="Primary";function getBaseRemoteOptions(){var options={};return options.itemId=currentItemId,options}function reloadBrowsableImages(page,apiClient){loading.show();var options=getBaseRemoteOptions();options.type=browsableImageType,options.startIndex=browsableImageStartIndex,options.limit=browsableImagePageSize,options.IncludeAllLanguages=page.querySelector("#chkAllLanguages").checked;var provider=selectedProvider||"";provider&&(options.ProviderName=provider),apiClient.getAvailableRemoteImages(options).then((function(result){!function renderRemoteImages(page,apiClient,imagesResult,imageType,startIndex,limit){page.querySelector(".availableImagesPaging").innerHTML=function getPagingHtml(startIndex,limit,totalRecordCount){var html="",recordsEnd=Math.min(startIndex+limit,totalRecordCount),showControls=totalRecordCount>limit;html+='<div class="listPaging">',html+='<span style="margin-right: 10px;">';var startAtDisplay=totalRecordCount?startIndex+1:0;html+=globalize.translate("ListPaging",startAtDisplay,recordsEnd,totalRecordCount),html+="</span>",showControls&&(html+='<div data-role="controlgroup" data-type="horizontal" style="display:inline-block;">',html+='<button is="paper-icon-button-light" title="'+globalize.translate("Previous")+'" class="btnPreviousPage autoSize" '+(startIndex?"":"disabled")+'><span class="material-icons arrow_back"></span></button>',html+='<button is="paper-icon-button-light" title="'+globalize.translate("Next")+'" class="btnNextPage autoSize" '+(startIndex+limit>=totalRecordCount?"disabled":"")+'><span class="material-icons arrow_forward"></span></button>',html+="</div>");return html+="</div>"}(startIndex,limit,imagesResult.TotalRecordCount);for(var html="",i=0,length=imagesResult.Images.length;i<length;i++)html+=getRemoteImageHtml(imagesResult.Images[i],imageType,apiClient);var availableImagesList=page.querySelector(".availableImagesList");availableImagesList.innerHTML=html,imageLoader.lazyChildren(availableImagesList);var btnNextPage=page.querySelector(".btnNextPage"),btnPreviousPage=page.querySelector(".btnPreviousPage");btnNextPage&&btnNextPage.addEventListener("click",(function(){browsableImageStartIndex+=browsableImagePageSize,reloadBrowsableImages(page,apiClient)}));btnPreviousPage&&btnPreviousPage.addEventListener("click",(function(){browsableImageStartIndex-=browsableImagePageSize,reloadBrowsableImages(page,apiClient)}))}(page,apiClient,result,browsableImageType,options.startIndex,options.limit),page.querySelector("#selectBrowsableImageType").value=browsableImageType;var providersHtml=result.Providers.map((function(p){return'<option value="'+p+'">'+p+"</option>"})),selectImageProvider=page.querySelector("#selectImageProvider");selectImageProvider.innerHTML='<option value="">'+globalize.translate("All")+"</option>"+providersHtml,selectImageProvider.value=provider,loading.hide()}))}function downloadRemoteImage(page,apiClient,url,type,provider){var options=getBaseRemoteOptions();options.Type=type,options.ImageUrl=url,options.ProviderName=provider,loading.show(),apiClient.downloadRemoteImage(options).then((function(){hasChanges=!0;var dlg=dom.parentWithClass(page,"dialog");dialogHelper.close(dlg)}))}function getDisplayUrl(url,apiClient){return apiClient.getUrl("Images/Remote",{imageUrl:url})}function getRemoteImageHtml(image,imageType,apiClient){var tagName=layoutManager.tv?"button":"div",enableFooterButtons=!layoutManager.tv,html="",cssClass="card scalableCard imageEditorCard",shape="backdrop";return cssClass+=" "+(shape="Backdrop"===imageType||"Art"===imageType||"Thumb"===imageType||"Logo"===imageType?"backdrop":"Banner"===imageType?"banner":"Disc"===imageType?"square":"Episode"===currentItemType?"backdrop":"MusicAlbum"===currentItemType||"MusicArtist"===currentItemType?"square":"portrait")+"Card "+shape+"Card-scalable","button"===tagName?(cssClass+=" btnImageCard",layoutManager.tv&&(cssClass+=" show-focus",enableFocusTransform&&(cssClass+=" show-animation")),html+='<button type="button" class="'+cssClass+'"'):html+='<div class="'+cssClass+'"',html+=' data-imageprovider="'+image.ProviderName+'" data-imageurl="'+image.Url+'" data-imagetype="'+image.Type+'"',html+=">",html+='<div class="cardBox visualCardBox">',html+='<div class="cardScalable visualCardBox-cardScalable" style="background-color:transparent;">',html+='<div class="cardPadder-'+shape+'"></div>',html+='<div class="cardContent">',layoutManager.tv||!appHost.supports("externallinks")?html+='<div class="cardImageContainer lazy" data-src="'+getDisplayUrl(image.Url,apiClient)+'" style="background-position:center center;background-size:contain;"></div>':html+='<a is="emby-linkbutton" target="_blank" href="'+getDisplayUrl(image.Url,apiClient)+'" class="button-link cardImageContainer lazy" data-src="'+getDisplayUrl(image.Url,apiClient)+'" style="background-position:center center;background-size:contain"></a>',html+="</div>",html+="</div>",html+='<div class="cardFooter visualCardBox-cardFooter">',html+='<div class="cardText cardTextCentered">'+image.ProviderName+"</div>",(image.Width||image.Height||image.Language)&&(html+='<div class="cardText cardText-secondary cardTextCentered">',image.Width&&image.Height?(html+=image.Width+" x "+image.Height,image.Language&&(html+=" • "+image.Language)):image.Language&&(html+=image.Language),html+="</div>"),null!=image.CommunityRating&&(html+='<div class="cardText cardText-secondary cardTextCentered">',"Likes"===image.RatingType?html+=image.CommunityRating+(1===image.CommunityRating?" like":" likes"):image.CommunityRating?(html+=image.CommunityRating.toFixed(1),image.VoteCount&&(html+=" • "+image.VoteCount+(1===image.VoteCount?" vote":" votes"))):html+="Unrated",html+="</div>"),enableFooterButtons&&(html+='<div class="cardText cardTextCentered">',html+='<button is="paper-icon-button-light" class="btnDownloadRemoteImage autoSize" raised" title="'+globalize.translate("Download")+'"><span class="material-icons cloud_download"></span></button>',html+="</div>"),html+="</div>",html+="</div>",html+="</"+tagName+">"}function showEditor(itemId,serverId,itemType){loading.show(),require(["text!./imageDownloader.template.html"],(function(template){var apiClient=connectionManager.getApiClient(serverId);currentItemId=itemId,currentItemType=itemType;var dialogOptions={removeOnClose:!0};layoutManager.tv?dialogOptions.size="fullscreen":dialogOptions.size="small";var dlg=dialogHelper.createDialog(dialogOptions);dlg.innerHTML=globalize.translateDocument(template,"core"),layoutManager.tv&&scrollHelper.centerFocus.on(dlg,!1),dlg.addEventListener("close",onDialogClosed),dialogHelper.open(dlg);var editorContent=dlg.querySelector(".formDialogContent");!function initEditor(page,apiClient){page.querySelector("#selectBrowsableImageType").addEventListener("change",(function(){browsableImageType=this.value,browsableImageStartIndex=0,selectedProvider=null,reloadBrowsableImages(page,apiClient)})),page.querySelector("#selectImageProvider").addEventListener("change",(function(){browsableImageStartIndex=0,selectedProvider=this.value,reloadBrowsableImages(page,apiClient)})),page.querySelector("#chkAllLanguages").addEventListener("change",(function(){browsableImageStartIndex=0,reloadBrowsableImages(page,apiClient)})),page.addEventListener("click",(function(e){var btnDownloadRemoteImage=dom.parentWithClass(e.target,"btnDownloadRemoteImage");if(btnDownloadRemoteImage){var card=dom.parentWithClass(btnDownloadRemoteImage,"card");downloadRemoteImage(page,apiClient,card.getAttribute("data-imageurl"),card.getAttribute("data-imagetype"),card.getAttribute("data-imageprovider"))}else{var btnImageCard=dom.parentWithClass(e.target,"btnImageCard");btnImageCard&&downloadRemoteImage(page,apiClient,btnImageCard.getAttribute("data-imageurl"),btnImageCard.getAttribute("data-imagetype"),btnImageCard.getAttribute("data-imageprovider"))}}))}(editorContent,apiClient),dlg.querySelector(".btnCancel").addEventListener("click",(function(){dialogHelper.close(dlg)})),reloadBrowsableImages(editorContent,apiClient)}))}function onDialogClosed(){layoutManager.tv&&scrollHelper.centerFocus.off(this,!1),loading.hide(),hasChanges?currentResolve():currentReject()}return{show:function show(itemId,serverId,itemType,imageType){return new Promise((function(resolve,reject){currentResolve=resolve,currentReject=reject,hasChanges=!1,browsableImageStartIndex=0,browsableImageType=imageType||"Primary",selectedProvider=null,showEditor(itemId,serverId,itemType)}))}}}));
//# sourceMappingURL=imageDownloader.js.map
