{"version":3,"sources":["components/mediaLibraryCreator/mediaLibraryCreator.js"],"names":["define","loading","dialogHelper","dom","$","libraryoptionseditor","globalize","onAddLibrary","isCreating","pathInfos","length","require","alert","text","translate","type","show","dlg","parentWithClass","this","name","val","libraryOptions","getLibraryOptions","querySelector","PathInfos","ApiClient","addVirtualFolder","currentOptions","refresh","then","hasChanges","hide","close","toast","onToggleAdvancedChange","setAdvancedVisible","checked","onAddButtonClick","page","directoryBrowser","picker","enableNetworkSharePath","callback","path","networkSharePath","addMediaLocation","pathLower","toLowerCase","filter","p","Path","pathInfo","NetworkPath","push","renderPaths","getFolderHtml","index","html","foldersHtml","map","join","folderList","innerHTML","classList","remove","add","onRemoveClick","e","button","target","parseInt","getAttribute","locationLower","onDialogClosed","currentResolve","editor","options","Promise","resolve","reject","xhr","XMLHttpRequest","open","onload","template","response","createDialog","size","modal","removeOnClose","scrollY","translateDocument","initEditor","collectionTypeOptions","getCollectionTypeOptionsHtml","i","value","on","parents","setContentType","selectedIndex","replace","folderOption","message","addEventListener","initLibraryOptions","embed","trigger","call","send"],"mappings":"AAAA,aAAAA,OAAO,CAAC,UAAW,eAAgB,MAAO,SAAU,uDAAwD,YAAa,cAAe,aAAc,cAAe,0BAA2B,gBAAiB,kBAAmB,cAAe,eAAe,SAAUC,QAASC,aAAcC,IAAKC,EAAGC,qBAAsBC,WAG7T,SAASC,eACL,GAAIC,WACA,OAAO,EAGX,GAAwB,GAApBC,UAAUC,OAQV,OAPAC,QAAQ,CAAC,UAAU,SAAUC,OACzBA,MAAM,CACFC,KAAMP,UAAUQ,UAAU,6BAC1BC,KAAM,cAIP,EAGXP,YAAa,EACbP,QAAQe,OACR,IAAIC,IAAMd,IAAIe,gBAAgBC,KAAM,sBAChCC,KAAOhB,EAAE,YAAaa,KAAKI,MAC3BN,KAAOX,EAAE,wBAAyBa,KAAKI,MAE/B,SAARN,OACAA,KAAO,MAGX,IAAIO,eAAiBjB,qBAAqBkB,kBAAkBN,IAAIO,cAAc,oBAe9E,OAdAF,eAAeG,UAAYhB,UAC3BiB,UAAUC,iBAAiBP,KAAML,KAAMa,eAAeC,QAASP,gBAAgBQ,MAAK,WAChFC,YAAa,EACbvB,YAAa,EACbP,QAAQ+B,OACR9B,aAAa+B,MAAMhB,QACpB,WACCN,QAAQ,CAAC,UAAU,SAAUuB,OACzBA,MAAM5B,UAAUQ,UAAU,2CAG9BN,YAAa,EACbP,QAAQ+B,WAEL,EAwCX,SAASG,yBACL,IAAIlB,IAAMd,IAAIe,gBAAgBC,KAAM,sBACpCd,qBAAqB+B,mBAAmBnB,IAAIO,cAAc,mBAAoBL,KAAKkB,SAGvF,SAASC,mBACL,IAAIC,KAAOpC,IAAIe,gBAAgBC,KAAM,sBAErCR,QAAQ,CAAC,qBAAqB,SAAU6B,kBACpC,IAAIC,OAAS,IAAID,iBACjBC,OAAOzB,KAAK,CACR0B,wBAAwB,EACxBC,SAAU,SAAAA,SAAUC,KAAMC,kBAClBD,MAsCpB,SAASE,iBAAiBP,KAAMK,KAAMC,kBAClC,IAAIE,UAAYH,KAAKI,cAKrB,IAJiBvC,UAAUwC,QAAO,SAAUC,GACxC,OAAOA,EAAEC,KAAKH,eAAiBD,aAGnBrC,OAAQ,CACpB,IAAI0C,SAAW,CACXD,KAAMP,MAGNC,mBACAO,SAASC,YAAcR,kBAG3BpC,UAAU6C,KAAKF,UACfG,YAAYhB,OArDAO,CAAiBP,KAAMK,KAAMC,kBAGjCJ,OAAOR,cAMvB,SAASuB,cAAcJ,SAAUK,OAC7B,IAAIC,KAAO,GAYX,OAXAA,MAAQ,4EACRA,MAAQ,gBAAkBN,SAASC,YAAc,wBAA0B,gBAAkB,KAC7FK,MAAQ,iCAAmCN,SAASD,KAAO,SAEvDC,SAASC,cACTK,MAAQ,2CAA6CN,SAASC,YAAc,UAGhFK,MAAQ,SACRA,MAAQ,wGAA0GD,MAAQ,gEAC1HC,MAAQ,SAIZ,SAASH,YAAYhB,MACjB,IAAIoB,YAAclD,UAAUmD,IAAIJ,eAAeK,KAAK,IAChDC,WAAavB,KAAKf,cAAc,eACpCsC,WAAWC,UAAYJ,YAEnBA,YACAG,WAAWE,UAAUC,OAAO,QAE5BH,WAAWE,UAAUE,IAAI,QAwBjC,SAASC,cAAcC,GACnB,IAAIC,OAASlE,IAAIe,gBAAgBkD,EAAEE,OAAQ,iBACvCb,MAAQc,SAASF,OAAOG,aAAa,eAErCC,cADWhE,UAAUgD,OAAON,KACHH,cAC7BvC,UAAYA,UAAUwC,QAAO,SAAUC,GACnC,OAAOA,EAAEC,KAAKH,eAAiByB,iBAEnClB,YAAYpD,IAAIe,gBAAgBmD,OAAQ,uBAG5C,SAASK,iBACLC,eAAe5C,YAgDnB,IACI4C,eACA/C,eAFAnB,UAAY,GAGZsB,YAAa,EACbvB,YAAa,EACjB,OA3CA,SAASoE,SACLzD,KAAKH,KAAO,SAAU6D,SAClB,OAAO,IAAIC,SAAQ,SAAUC,QAASC,QAClCpD,eAAiBiD,QACjBF,eAAiBI,QACjBhD,YAAa,EACb,IAAIkD,IAAM,IAAIC,eACdD,IAAIE,KAAK,MAAO,oEAAoE,GAEpFF,IAAIG,OAAS,SAAUhB,GACnB,IAAIiB,SAAWlE,KAAKmE,SAChBrE,IAAMf,aAAaqF,aAAa,CAChCC,KAAM,QACNC,OAAO,EACPC,eAAe,EACfC,SAAS,IAEb1E,IAAI+C,UAAUE,IAAI,aAClBjD,IAAI+C,UAAUE,IAAI,sBAClBjD,IAAI+C,UAAUE,IAAI,sBAClBjD,IAAI+C,UAAUE,IAAI,cAClBjD,IAAI8C,UAAYzD,UAAUsF,kBAAkBP,UAjJ5D,SAASQ,WAAWtD,KAAMuD,uBACtB1F,EAAE,wBAAyBmC,MAAMmB,KAPrC,SAASqC,6BAA6BD,uBAClC,OAAOA,sBAAsBlC,KAAI,SAAUoC,GACvC,MAAO,kBAAoBA,EAAEC,MAAQ,KAAOD,EAAE5E,KAAO,eACtDyC,KAAK,IAI8BkC,CAA6BD,wBAAwBzE,IAAI,IAAI6E,GAAG,UAAU,WAC5G,IAAID,MAAQ9E,KAAK8E,MACbhF,IAAMb,EAAEe,MAAMgF,QAAQ,WAAW,GASrC,GARA9F,qBAAqB+F,eAAenF,IAAIO,cAAc,mBAA6B,SAATyE,MAAmB,GAAKA,OAE9FA,MACAhF,IAAIO,cAAc,mBAAmBwC,UAAUC,OAAO,QAEtDhD,IAAIO,cAAc,mBAAmBwC,UAAUE,IAAI,QAG1C,SAAT+B,MAAkB,CAClB,IAAIxC,MAAQtC,KAAKkF,cAEjB,IAAc,GAAV5C,MAAa,CACb,IAAIrC,KAAOD,KAAK0D,QAAQpB,OAAOM,UAAUuC,QAAQ,IAAK,IAAIA,QAAQ,QAAS,KAC3ElG,EAAE,YAAaa,KAAKI,IAAID,MACxB,IAAImF,aAAeT,sBAAsB7C,QAAO,SAAU+C,GACtD,OAAOA,EAAEC,OAASA,SACnB,GACH7F,EAAE,kCAAmCa,KAAKyC,KAAK6C,aAAaC,SAAW,SAInFjE,KAAKf,cAAc,iBAAiBiF,iBAAiB,QAASnE,kBAC9DC,KAAKf,cAAc,cAAciF,iBAAiB,QAASlG,cAC3DgC,KAAKf,cAAc,eAAeiF,iBAAiB,QAAStC,eAC5D5B,KAAKf,cAAc,gBAAgBiF,iBAAiB,SAAUtE,wBAsHlD0D,CAAW5E,IAAK4D,QAAQiB,uBACxB7E,IAAIwF,iBAAiB,QAAS/B,gBAC9BxE,aAAaiF,KAAKlE,KAClBA,IAAIO,cAAc,cAAciF,iBAAiB,SAAS,WACtDvG,aAAa+B,MAAMhB,QAEvBR,UAAY,GACZ8C,YAAYtC,KApC5B,SAASyF,mBAAmBzF,KACxBZ,qBAAqBsG,MAAM1F,IAAIO,cAAc,oBAAoBM,MAAK,WAClE1B,EAAE,wBAAyBa,KAAK2F,QAAQ,UACxCzE,uBAAuB0E,KAAK5F,IAAIO,cAAc,oBAkCtCkF,CAAmBzF,MAGvBgE,IAAI6B","file":"mediaLibraryCreator.js","sourcesContent":["define(['loading', 'dialogHelper', 'dom', 'jQuery', 'components/libraryoptionseditor/libraryoptionseditor', 'globalize', 'emby-toggle', 'emby-input', 'emby-select', 'paper-icon-button-light', 'listViewStyle', 'formDialogStyle', 'emby-button', 'flexStyles'], function (loading, dialogHelper, dom, $, libraryoptionseditor, globalize) {\n    'use strict';\n\n    function onAddLibrary() {\n        if (isCreating) {\n            return false;\n        }\n\n        if (pathInfos.length == 0) {\n            require(['alert'], function (alert) {\n                alert({\n                    text: globalize.translate('PleaseAddAtLeastOneFolder'),\n                    type: 'error'\n                });\n            });\n\n            return false;\n        }\n\n        isCreating = true;\n        loading.show();\n        var dlg = dom.parentWithClass(this, 'dlg-librarycreator');\n        var name = $('#txtValue', dlg).val();\n        var type = $('#selectCollectionType', dlg).val();\n\n        if (type == 'mixed') {\n            type = null;\n        }\n\n        var libraryOptions = libraryoptionseditor.getLibraryOptions(dlg.querySelector('.libraryOptions'));\n        libraryOptions.PathInfos = pathInfos;\n        ApiClient.addVirtualFolder(name, type, currentOptions.refresh, libraryOptions).then(function () {\n            hasChanges = true;\n            isCreating = false;\n            loading.hide();\n            dialogHelper.close(dlg);\n        }, function () {\n            require(['toast'], function (toast) {\n                toast(globalize.translate('ErrorAddingMediaPathToVirtualFolder'));\n            });\n\n            isCreating = false;\n            loading.hide();\n        });\n        return false;\n    }\n\n    function getCollectionTypeOptionsHtml(collectionTypeOptions) {\n        return collectionTypeOptions.map(function (i) {\n            return '<option value=\"' + i.value + '\">' + i.name + '</option>';\n        }).join('');\n    }\n\n    function initEditor(page, collectionTypeOptions) {\n        $('#selectCollectionType', page).html(getCollectionTypeOptionsHtml(collectionTypeOptions)).val('').on('change', function () {\n            var value = this.value;\n            var dlg = $(this).parents('.dialog')[0];\n            libraryoptionseditor.setContentType(dlg.querySelector('.libraryOptions'), value == 'mixed' ? '' : value);\n\n            if (value) {\n                dlg.querySelector('.libraryOptions').classList.remove('hide');\n            } else {\n                dlg.querySelector('.libraryOptions').classList.add('hide');\n            }\n\n            if (value != 'mixed') {\n                var index = this.selectedIndex;\n\n                if (index != -1) {\n                    var name = this.options[index].innerHTML.replace('*', '').replace('&amp;', '&');\n                    $('#txtValue', dlg).val(name);\n                    var folderOption = collectionTypeOptions.filter(function (i) {\n                        return i.value == value;\n                    })[0];\n                    $('.collectionTypeFieldDescription', dlg).html(folderOption.message || '');\n                }\n            }\n        });\n        page.querySelector('.btnAddFolder').addEventListener('click', onAddButtonClick);\n        page.querySelector('.btnSubmit').addEventListener('click', onAddLibrary);\n        page.querySelector('.folderList').addEventListener('click', onRemoveClick);\n        page.querySelector('.chkAdvanced').addEventListener('change', onToggleAdvancedChange);\n    }\n\n    function onToggleAdvancedChange() {\n        var dlg = dom.parentWithClass(this, 'dlg-librarycreator');\n        libraryoptionseditor.setAdvancedVisible(dlg.querySelector('.libraryOptions'), this.checked);\n    }\n\n    function onAddButtonClick() {\n        var page = dom.parentWithClass(this, 'dlg-librarycreator');\n\n        require(['directorybrowser'], function (directoryBrowser) {\n            var picker = new directoryBrowser();\n            picker.show({\n                enableNetworkSharePath: true,\n                callback: function (path, networkSharePath) {\n                    if (path) {\n                        addMediaLocation(page, path, networkSharePath);\n                    }\n\n                    picker.close();\n                }\n            });\n        });\n    }\n\n    function getFolderHtml(pathInfo, index) {\n        var html = '';\n        html += '<div class=\"listItem listItem-border lnkPath\" style=\"padding-left:.5em;\">';\n        html += '<div class=\"' + (pathInfo.NetworkPath ? 'listItemBody two-line' : 'listItemBody') + '\">';\n        html += '<div class=\"listItemBodyText\">' + pathInfo.Path + '</div>';\n\n        if (pathInfo.NetworkPath) {\n            html += '<div class=\"listItemBodyText secondary\">' + pathInfo.NetworkPath + '</div>';\n        }\n\n        html += '</div>';\n        html += '<button type=\"button\" is=\"paper-icon-button-light\"\" class=\"listItemButton btnRemovePath\" data-index=\"' + index + '\"><span class=\"material-icons remove_circle\"></span></button>';\n        html += '</div>';\n        return html;\n    }\n\n    function renderPaths(page) {\n        var foldersHtml = pathInfos.map(getFolderHtml).join('');\n        var folderList = page.querySelector('.folderList');\n        folderList.innerHTML = foldersHtml;\n\n        if (foldersHtml) {\n            folderList.classList.remove('hide');\n        } else {\n            folderList.classList.add('hide');\n        }\n    }\n\n    function addMediaLocation(page, path, networkSharePath) {\n        var pathLower = path.toLowerCase();\n        var pathFilter = pathInfos.filter(function (p) {\n            return p.Path.toLowerCase() == pathLower;\n        });\n\n        if (!pathFilter.length) {\n            var pathInfo = {\n                Path: path\n            };\n\n            if (networkSharePath) {\n                pathInfo.NetworkPath = networkSharePath;\n            }\n\n            pathInfos.push(pathInfo);\n            renderPaths(page);\n        }\n    }\n\n    function onRemoveClick(e) {\n        var button = dom.parentWithClass(e.target, 'btnRemovePath');\n        var index = parseInt(button.getAttribute('data-index'));\n        var location = pathInfos[index].Path;\n        var locationLower = location.toLowerCase();\n        pathInfos = pathInfos.filter(function (p) {\n            return p.Path.toLowerCase() != locationLower;\n        });\n        renderPaths(dom.parentWithClass(button, 'dlg-librarycreator'));\n    }\n\n    function onDialogClosed() {\n        currentResolve(hasChanges);\n    }\n\n    function initLibraryOptions(dlg) {\n        libraryoptionseditor.embed(dlg.querySelector('.libraryOptions')).then(function () {\n            $('#selectCollectionType', dlg).trigger('change');\n            onToggleAdvancedChange.call(dlg.querySelector('.chkAdvanced'));\n        });\n    }\n\n    function editor() {\n        this.show = function (options) {\n            return new Promise(function (resolve, reject) {\n                currentOptions = options;\n                currentResolve = resolve;\n                hasChanges = false;\n                var xhr = new XMLHttpRequest();\n                xhr.open('GET', 'components/mediaLibraryCreator/mediaLibraryCreator.template.html', true);\n\n                xhr.onload = function (e) {\n                    var template = this.response;\n                    var dlg = dialogHelper.createDialog({\n                        size: 'small',\n                        modal: false,\n                        removeOnClose: true,\n                        scrollY: false\n                    });\n                    dlg.classList.add('ui-body-a');\n                    dlg.classList.add('background-theme-a');\n                    dlg.classList.add('dlg-librarycreator');\n                    dlg.classList.add('formDialog');\n                    dlg.innerHTML = globalize.translateDocument(template);\n                    initEditor(dlg, options.collectionTypeOptions);\n                    dlg.addEventListener('close', onDialogClosed);\n                    dialogHelper.open(dlg);\n                    dlg.querySelector('.btnCancel').addEventListener('click', function () {\n                        dialogHelper.close(dlg);\n                    });\n                    pathInfos = [];\n                    renderPaths(dlg);\n                    initLibraryOptions(dlg);\n                };\n\n                xhr.send();\n            });\n        };\n    }\n\n    var pathInfos = [];\n    var currentResolve;\n    var currentOptions;\n    var hasChanges = false;\n    var isCreating = false;\n    return editor;\n});\n"]}