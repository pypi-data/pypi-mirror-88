"use strict";define(["playbackManager","layoutManager","text!./subtitlesync.template.html","css!./subtitlesync"],(function(playbackManager,layoutManager,template,css){var player,subtitleSyncSlider,subtitleSyncTextField,subtitleSyncCloseButton,subtitleSyncContainer;function init(instance){var parent=document.createElement("div");document.body.appendChild(parent),parent.innerHTML=template,subtitleSyncSlider=parent.querySelector(".subtitleSyncSlider"),subtitleSyncTextField=parent.querySelector(".subtitleSyncTextField"),subtitleSyncCloseButton=parent.querySelector(".subtitleSync-closeButton"),subtitleSyncContainer=parent.querySelector(".subtitleSyncContainer"),layoutManager.tv&&(subtitleSyncSlider.classList.add("focusable"),setTimeout((function(){subtitleSyncSlider.enableKeyboardDragging()}),0)),subtitleSyncContainer.classList.add("hide"),subtitleSyncTextField.updateOffset=function(offset){this.textContent=offset+"s"},subtitleSyncTextField.addEventListener("click",(function(){this.hasFocus=!0})),subtitleSyncTextField.addEventListener("keydown",(function(event){if("Enter"===event.key){var inputOffset=/[-+]?\d+\.?\d*/g.exec(this.textContent);inputOffset?(inputOffset=inputOffset[0],this.textContent=inputOffset+"s",inputOffset=parseFloat(inputOffset),playbackManager.setSubtitleOffset(inputOffset,player),subtitleSyncSlider.updateOffset(function getPercentageFromOffset(value){var percentValue=value/30;return percentValue*=50,percentValue+=50,Math.min(100,Math.max(0,percentValue.toFixed()))}(inputOffset))):this.textContent=(playbackManager.getPlayerSubtitleOffset(player)||0)+"s",this.hasFocus=!1,event.preventDefault()}else this.hasFocus=!0,null===event.key.match(/[+-\d.s]/)&&event.preventDefault();event.stopPropagation()})),subtitleSyncTextField.blur=function(){!this.hasFocus&&this.prototype&&this.prototype.blur()},subtitleSyncSlider.updateOffset=function(percent){this.value=void 0===percent?50:percent},subtitleSyncSlider.addEventListener("change",(function(){playbackManager.setSubtitleOffset(getOffsetFromPercentage(this.value),player),subtitleSyncTextField.updateOffset(getOffsetFromPercentage(this.value))})),subtitleSyncSlider.getBubbleHtml=function(value){var newOffset=getOffsetFromPercentage(value);return'<h1 class="sliderBubbleText">'+(newOffset>0?"+":"")+parseFloat(newOffset)+"s</h1>"},subtitleSyncCloseButton.addEventListener("click",(function(){playbackManager.disableShowingSubtitleOffset(player),SubtitleSync.prototype.toggle("forceToHide")})),instance.element=parent}function getOffsetFromPercentage(value){var offset=(value-50)/50;return(offset*=30).toFixed(1)}function SubtitleSync(currentPlayer){player=currentPlayer,init(this)}return SubtitleSync.prototype.destroy=function(){SubtitleSync.prototype.toggle("forceToHide"),player&&(playbackManager.disableShowingSubtitleOffset(player),playbackManager.setSubtitleOffset(0,player));var elem=this.element;elem&&(elem.parentNode.removeChild(elem),this.element=null)},SubtitleSync.prototype.toggle=function(action){if(player&&playbackManager.supportSubtitleOffset(player))switch(action){case void 0:if(playbackManager.isShowingSubtitleOffsetEnabled(player)&&playbackManager.canHandleOffsetOnCurrentSubtitle(player)){playbackManager.getPlayerSubtitleOffset(player)||subtitleSyncTextField.hasFocus||(subtitleSyncSlider.value="50",subtitleSyncTextField.textContent="0s",playbackManager.setSubtitleOffset(0,player)),subtitleSyncContainer.classList.remove("hide");break}case"hide":if(subtitleSyncTextField.hasFocus)break;case"forceToHide":subtitleSyncContainer.classList.add("hide")}},SubtitleSync}));
//# sourceMappingURL=subtitlesync.js.map
