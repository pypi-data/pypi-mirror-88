"use strict";function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(arr,i){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(arr)){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function _createForOfIteratorHelper(o,allowArrayLike){var it;if("undefined"==typeof Symbol||null==o[Symbol.iterator]){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function F(){};return{s:F,n:function n(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function e(_e2){throw _e2},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function s(){it=o[Symbol.iterator]()},n:function n(){var step=it.next();return normalCompletion=step.done,step},e:function e(_e3){didErr=!0,err=_e3},f:function f(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}define(["itemHelper","mediaInfo","indicators","connectionManager","layoutManager","globalize","datetime","cardBuilder","css!./listview","emby-ratingbutton","emby-playstatebutton"],(function(itemHelper,mediaInfo,indicators,connectionManager,layoutManager,globalize,datetime,cardBuilder){function getIndex(item,options){if("disc"===options.index)return null==item.ParentIndexNumber?"":globalize.translate("ValueDiscNumber",item.ParentIndexNumber);var code,name,sortBy=(options.sortBy||"").toLowerCase();return 0===sortBy.indexOf("sortname")?"Episode"===item.Type?"":(code=(name=(item.SortName||item.Name||"?")[0].toUpperCase()).charCodeAt(0))<65||code>90?"#":name.toUpperCase():0===sortBy.indexOf("officialrating")?item.OfficialRating||globalize.translate("Unrated"):0===sortBy.indexOf("communityrating")?null==item.CommunityRating?globalize.translate("Unrated"):Math.floor(item.CommunityRating):0===sortBy.indexOf("criticrating")?null==item.CriticRating?globalize.translate("Unrated"):Math.floor(item.CriticRating):0===sortBy.indexOf("albumartist")&&item.AlbumArtist?(code=(name=item.AlbumArtist[0].toUpperCase()).charCodeAt(0))<65||code>90?"#":name.toUpperCase():""}function getImageUrl(item,width){var itemId,apiClient=connectionManager.getApiClient(item.ServerId),options={maxWidth:2*width,type:"Primary"};return item.ImageTags&&item.ImageTags.Primary?(options.tag=item.ImageTags.Primary,itemId=item.Id):item.AlbumId&&item.AlbumPrimaryImageTag?(options.tag=item.AlbumPrimaryImageTag,itemId=item.AlbumId):item.SeriesId&&item.SeriesPrimaryImageTag?(options.tag=item.SeriesPrimaryImageTag,itemId=item.SeriesId):item.ParentPrimaryImageTag&&(options.tag=item.ParentPrimaryImageTag,itemId=item.ParentPrimaryImageItemId),itemId?apiClient.getScaledImageUrl(itemId,options):null}function getChannelImageUrl(item,width){var apiClient=connectionManager.getApiClient(item.ServerId),options={maxWidth:2*width,type:"Primary"};if(item.ChannelId&&item.ChannelPrimaryImageTag&&(options.tag=item.ChannelPrimaryImageTag),item.ChannelId)return apiClient.getScaledImageUrl(item.ChannelId,options)}function getTextLinesHtml(textlines,isLargeStyle){var _step,html="",largeTitleTagName=layoutManager.tv?"h2":"div",_iterator=_createForOfIteratorHelper(textlines.entries());try{for(_iterator.s();!(_step=_iterator.n()).done;){var _step$value=_slicedToArray(_step.value,2),i=_step$value[0];_step$value[1]&&(html+=0===i?isLargeStyle?"<"+largeTitleTagName+' class="listItemBodyText">':'<div class="listItemBodyText">':'<div class="secondary listItemBodyText">',html+=textlines[i]||"&nbsp;",html+=0===i&&isLargeStyle?"</"+largeTitleTagName+">":"</div>")}}catch(err){_iterator.e(err)}finally{_iterator.f()}return html}function getRightButtonsHtml(options){for(var html="",i=0,length=options.rightButtons.length;i<length;i++){var button=options.rightButtons[i];html+='<button is="paper-icon-button-light" class="listItemButton itemAction" data-action="custom" data-customaction="'+button.id+'" title="'+button.title+'"><span class="material-icons '+button.icon+'"></span></button>'}return html}function getId(item){return item.Id}return{getListViewHtml:function getListViewHtml(options){for(var items=options.items,groupTitle="",action=options.action||"link",isLargeStyle="large"===options.imageSize,enableOverview=options.enableOverview,clickEntireItem=!!layoutManager.tv,outerTagName=clickEntireItem?"button":"div",enableSideMediaInfo=null==options.enableSideMediaInfo||options.enableSideMediaInfo,outerHtml="",enableContentWrapper=options.enableOverview&&!layoutManager.tv,containerAlbumArtistIds=(options.containerAlbumArtists||[]).map(getId),i=0,length=items.length;i<length;i++){var item=items[i],html="";if(options.showIndex){var itemGroupTitle=getIndex(item,options);itemGroupTitle!==groupTitle&&(html&&(html+="</div>"),html+=0===i?'<h2 class="listGroupHeader listGroupHeader-first">':'<h2 class="listGroupHeader">',html+=itemGroupTitle,html+="</h2>",html+="<div>",groupTitle=itemGroupTitle)}var cssClass="listItem";(options.border||!1!==options.highlight&&!layoutManager.tv)&&(cssClass+=" listItem-border"),clickEntireItem&&(cssClass+=" itemAction listItem-button"),layoutManager.tv&&(cssClass+=" listItem-focusscale");var downloadWidth=80;isLargeStyle&&(cssClass+=" listItem-largeImage",downloadWidth=500);var playlistItemId=item.PlaylistItemId?' data-playlistitemid="'+item.PlaylistItemId+'"':"",positionTicksData=item.UserData&&item.UserData.PlaybackPositionTicks?' data-positionticks="'+item.UserData.PlaybackPositionTicks+'"':"",collectionIdData=options.collectionId?' data-collectionid="'+options.collectionId+'"':"",playlistIdData=options.playlistId?' data-playlistid="'+options.playlistId+'"':"",mediaTypeData=item.MediaType?' data-mediatype="'+item.MediaType+'"':"",collectionTypeData=item.CollectionType?' data-collectiontype="'+item.CollectionType+'"':"",channelIdData=item.ChannelId?' data-channelid="'+item.ChannelId+'"':"";if(enableContentWrapper&&(cssClass+=" listItem-withContentWrapper"),html+="<"+outerTagName+' class="'+cssClass+'"'+playlistItemId+' data-action="'+action+'" data-isfolder="'+item.IsFolder+'" data-id="'+item.Id+'" data-serverid="'+item.ServerId+'" data-type="'+item.Type+'"'+mediaTypeData+collectionTypeData+channelIdData+positionTicksData+collectionIdData+playlistIdData+">",enableContentWrapper&&(html+='<div class="listItem-content">'),!clickEntireItem&&options.dragHandle&&(html+='<span class="listViewDragHandle material-icons listItemIcon listItemIcon-transparent drag_handle"></span>'),!1!==options.image){var imgUrl="channel"===options.imageSource?getChannelImageUrl(item,downloadWidth):getImageUrl(item,downloadWidth),imageClass=isLargeStyle?"listItemImage listItemImage-large":"listItemImage";isLargeStyle&&layoutManager.tv&&(imageClass+=" listItemImage-large-tv");var playOnImageClick=options.imagePlayButton&&!layoutManager.tv;clickEntireItem||(imageClass+=" itemAction"),html+=imgUrl?'<div data-action="'+(playOnImageClick?"link":action)+'" class="'+imageClass+' lazy" data-src="'+imgUrl+'" item-icon>':'<div class="'+imageClass+" cardImageContainer "+cardBuilder.getDefaultBackgroundClass(item.Name)+'">'+cardBuilder.getDefaultText(item,options);var indicatorsHtml="";(indicatorsHtml+=indicators.getPlayedIndicatorHtml(item))&&(html+='<div class="indicators listItemIndicators">'+indicatorsHtml+"</div>"),playOnImageClick&&(html+='<button is="paper-icon-button-light" class="listItemImageButton itemAction" data-action="resume"><span class="material-icons listItemImageButton-icon play_arrow"></span></button>');var progressHtml=indicators.getProgressBarHtml(item,{containerClass:"listItemProgressBar"});progressHtml&&(html+=progressHtml),html+="</div>"}options.showIndexNumberLeft&&(html+='<div class="listItem-indexnumberleft">',html+=item.IndexNumber||"&nbsp;",html+="</div>");var textlines=[];options.showProgramDateTime&&textlines.push(datetime.toLocaleString(datetime.parseISO8601Date(item.StartDate),{weekday:"long",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})),options.showProgramTime&&textlines.push(datetime.getDisplayTime(datetime.parseISO8601Date(item.StartDate))),options.showChannel&&item.ChannelName&&textlines.push(item.ChannelName);var parentTitle=null;options.showParentTitle&&("Episode"===item.Type?parentTitle=item.SeriesName:(item.IsSeries||item.EpisodeTitle&&item.Name)&&(parentTitle=item.Name));var displayName=itemHelper.getDisplayName(item,{includeParentInfo:options.includeParentInfoInTitle});if(options.showIndexNumber&&null!=item.IndexNumber&&(displayName=item.IndexNumber+". "+displayName),options.showParentTitle&&options.parentTitleWithTitle?(displayName&&(parentTitle&&(parentTitle+=" - "),parentTitle=(parentTitle||"")+displayName),textlines.push(parentTitle||"")):options.showParentTitle&&textlines.push(parentTitle||""),displayName&&!options.parentTitleWithTitle&&textlines.push(displayName),item.IsFolder)!1!==options.artist&&item.AlbumArtist&&"MusicAlbum"===item.Type&&textlines.push(item.AlbumArtist);else{var showArtist=!0===options.artist,artistItems=item.ArtistItems;showArtist||!1===options.artist||(artistItems&&artistItems.length?(artistItems.length>1||-1===containerAlbumArtistIds.indexOf(artistItems[0].Id))&&(showArtist=!0):showArtist=!0),showArtist&&artistItems&&"MusicAlbum"!==item.Type&&textlines.push(artistItems.map((function(a){return a.Name})).join(", "))}if("TvChannel"===item.Type&&item.CurrentProgram&&textlines.push(itemHelper.getDisplayName(item.CurrentProgram)),cssClass="listItemBody",clickEntireItem||(cssClass+=" itemAction"),!1===options.image&&(cssClass+=" listItemBody-noleftpadding"),html+='<div class="'+cssClass+'">',html+=getTextLinesHtml(textlines,isLargeStyle),!1!==options.mediaInfo&&!enableSideMediaInfo){html+='<div class="secondary listItemMediaInfo listItemBodyText">'+mediaInfo.getPrimaryMediaInfoHtml(item,{episodeTitle:!1,originalAirDate:!1,subtitles:!1})+"</div>"}if(enableOverview&&item.Overview&&(html+='<div class="secondary listItem-overview listItemBodyText">',html+=item.Overview,html+="</div>"),html+="</div>",!1!==options.mediaInfo&&enableSideMediaInfo&&(html+='<div class="secondary listItemMediaInfo">'+mediaInfo.getPrimaryMediaInfoHtml(item,{year:!1,container:!1,episodeTitle:!1,criticRating:!1,endsAt:!1})+"</div>"),options.recordButton||"Timer"!==item.Type&&"Program"!==item.Type||(html+=indicators.getTimerIndicator(item).replace("indicatorIcon","indicatorIcon listItemAside")),html+='<div class="listViewUserDataButtons">',!clickEntireItem){if(options.addToListButton&&(html+='<button is="paper-icon-button-light" class="listItemButton itemAction" data-action="addtoplaylist"><span class="material-icons playlist_add"></span></button>'),options.infoButton&&(html+='<button is="paper-icon-button-light" class="listItemButton itemAction" data-action="link"><span class="material-icons info_outline"></span></button>'),options.rightButtons&&(html+=getRightButtonsHtml(options)),!1!==options.enableUserDataButtons){var userData=item.UserData||{},likes=null==userData.Likes?"":userData.Likes;itemHelper.canMarkPlayed(item)&&!1!==options.enablePlayedButton&&(html+='<button is="emby-playstatebutton" type="button" class="listItemButton paper-icon-button-light" data-id="'+item.Id+'" data-serverid="'+item.ServerId+'" data-itemtype="'+item.Type+'" data-played="'+userData.Played+'"><span class="material-icons check"></span></button>'),itemHelper.canRate(item)&&!1!==options.enableRatingButton&&(html+='<button is="emby-ratingbutton" type="button" class="listItemButton paper-icon-button-light" data-id="'+item.Id+'" data-serverid="'+item.ServerId+'" data-itemtype="'+item.Type+'" data-likes="'+likes+'" data-isfavorite="'+userData.IsFavorite+'"><span class="material-icons favorite"></span></button>')}!1!==options.moreButton&&(html+='<button is="paper-icon-button-light" class="listItemButton itemAction" data-action="menu"><span class="material-icons more_vert"></span></button>')}html+="</div>",enableContentWrapper&&(html+="</div>",enableOverview&&item.Overview&&(html+='<div class="listItem-bottomoverview secondary">',html+=item.Overview,html+="</div>")),outerHtml+=html+="</"+outerTagName+">"}return outerHtml}}}));
//# sourceMappingURL=listview.js.map
