"use strict";define(["jQuery","loading","dialogHelper","dom","components/libraryoptionseditor/libraryoptionseditor","globalize","emby-button","listViewStyle","paper-icon-button-light","formDialogStyle","emby-toggle","flexStyles"],(function(jQuery,loading,dialogHelper,dom,libraryoptionseditor,globalize){function onEditLibrary(){if(isCreating)return!1;isCreating=!0,loading.show();var dlg=dom.parentWithClass(this,"dlg-libraryeditor"),libraryOptions=libraryoptionseditor.getLibraryOptions(dlg.querySelector(".libraryOptions"));return libraryOptions=Object.assign(currentOptions.library.LibraryOptions||{},libraryOptions),ApiClient.updateVirtualFolderOptions(currentOptions.library.ItemId,libraryOptions).then((function(){hasChanges=!0,isCreating=!1,loading.hide(),dialogHelper.close(dlg)}),(function(){isCreating=!1,loading.hide()})),!1}function onListItemClick(e){var listItem=dom.parentWithClass(e.target,"listItem");if(listItem){var index=parseInt(listItem.getAttribute("data-index")),pathInfos=(currentOptions.library.LibraryOptions||{}).PathInfos||[],pathInfo=null==index?{}:pathInfos[index]||{},originalPath=pathInfo.Path||(null==index?null:currentOptions.library.Locations[index]),btnRemovePath=dom.parentWithClass(e.target,"btnRemovePath");if(btnRemovePath)return void function onRemoveClick(btnRemovePath,location){var button=btnRemovePath,virtualFolder=currentOptions.library;require(["confirm"],(function(confirm){confirm({title:globalize.translate("HeaderRemoveMediaLocation"),text:globalize.translate("MessageConfirmRemoveMediaLocation"),confirmText:globalize.translate("ButtonDelete"),primary:"delete"}).then((function(){var refreshAfterChange=currentOptions.refresh;ApiClient.removeMediaPath(virtualFolder.Name,location,refreshAfterChange).then((function(){hasChanges=!0,refreshLibraryFromServer(dom.parentWithClass(button,"dlg-libraryeditor"))}),(function(){require(["toast"],(function(toast){toast(globalize.translate("DefaultErrorMessage"))}))}))}))}))}(btnRemovePath,originalPath);showDirectoryBrowser(dom.parentWithClass(listItem,"dlg-libraryeditor"),originalPath,pathInfo.NetworkPath)}}function getFolderHtml(pathInfo,index){var html="";return html+='<div class="listItem listItem-border lnkPath" data-index="'+index+'" style="padding-left:.5em;">',html+='<div class="'+(pathInfo.NetworkPath?"listItemBody two-line":"listItemBody")+'">',html+='<h3 class="listItemBodyText">',html+=pathInfo.Path,html+="</h3>",pathInfo.NetworkPath&&(html+='<div class="listItemBodyText secondary">'+pathInfo.NetworkPath+"</div>"),html+="</div>",html+='<button type="button" is="paper-icon-button-light" class="listItemButton btnRemovePath" data-index="'+index+'"><span class="material-icons remove_circle"></span></button>',html+="</div>"}function refreshLibraryFromServer(page){ApiClient.getVirtualFolders().then((function(result){var library=result.filter((function(f){return f.Name===currentOptions.library.Name}))[0];library&&(currentOptions.library=library,renderLibrary(page,currentOptions))}))}function renderLibrary(page,options){var pathInfos=(options.library.LibraryOptions||{}).PathInfos||[];pathInfos.length||(pathInfos=options.library.Locations.map((function(p){return{Path:p}}))),"boxsets"===options.library.CollectionType?page.querySelector(".folders").classList.add("hide"):page.querySelector(".folders").classList.remove("hide"),page.querySelector(".folderList").innerHTML=pathInfos.map(getFolderHtml).join("")}function onAddButtonClick(){showDirectoryBrowser(dom.parentWithClass(this,"dlg-libraryeditor"))}function showDirectoryBrowser(context,originalPath,networkPath){require(["directorybrowser"],(function(directoryBrowser){var picker=new directoryBrowser;picker.show({enableNetworkSharePath:!0,pathReadOnly:null!=originalPath,path:originalPath,networkSharePath:networkPath,callback:function callback(path,networkSharePath){path&&(originalPath?function updateMediaLocation(page,path,networkSharePath){var virtualFolder=currentOptions.library;ApiClient.updateMediaPath(virtualFolder.Name,{Path:path,NetworkPath:networkSharePath}).then((function(){hasChanges=!0,refreshLibraryFromServer(page)}),(function(){require(["toast"],(function(toast){toast(globalize.translate("ErrorAddingMediaPathToVirtualFolder"))}))}))}(context,originalPath,networkSharePath):function addMediaLocation(page,path,networkSharePath){var virtualFolder=currentOptions.library,refreshAfterChange=currentOptions.refresh;ApiClient.addMediaPath(virtualFolder.Name,path,networkSharePath,refreshAfterChange).then((function(){hasChanges=!0,refreshLibraryFromServer(page)}),(function(){require(["toast"],(function(toast){toast(globalize.translate("ErrorAddingMediaPathToVirtualFolder"))}))}))}(context,path,networkSharePath)),picker.close()}})}))}function onToggleAdvancedChange(){var dlg=dom.parentWithClass(this,"dlg-libraryeditor");libraryoptionseditor.setAdvancedVisible(dlg.querySelector(".libraryOptions"),this.checked)}function onDialogClosed(){currentDeferred.resolveWith(null,[hasChanges])}var currentDeferred,currentOptions,hasChanges=!1,isCreating=!1;return function editor(){this.show=function(options){var deferred=jQuery.Deferred();currentOptions=options,currentDeferred=deferred,hasChanges=!1;var xhr=new XMLHttpRequest;return xhr.open("GET","components/mediaLibraryEditor/mediaLibraryEditor.template.html",!0),xhr.onload=function(e){var template=this.response,dlg=dialogHelper.createDialog({size:"small",modal:!1,removeOnClose:!0,scrollY:!1});dlg.classList.add("dlg-libraryeditor"),dlg.classList.add("ui-body-a"),dlg.classList.add("background-theme-a"),dlg.classList.add("formDialog"),dlg.innerHTML=globalize.translateDocument(template),dlg.querySelector(".formDialogHeaderTitle").innerHTML=options.library.Name,function initEditor(dlg,options){renderLibrary(dlg,options),dlg.querySelector(".btnAddFolder").addEventListener("click",onAddButtonClick),dlg.querySelector(".folderList").addEventListener("click",onListItemClick),dlg.querySelector(".chkAdvanced").addEventListener("change",onToggleAdvancedChange),dlg.querySelector(".btnSubmit").addEventListener("click",onEditLibrary),libraryoptionseditor.embed(dlg.querySelector(".libraryOptions"),options.library.CollectionType,options.library.LibraryOptions).then((function(){onToggleAdvancedChange.call(dlg.querySelector(".chkAdvanced"))}))}(dlg,options),dlg.addEventListener("close",onDialogClosed),dialogHelper.open(dlg),dlg.querySelector(".btnCancel").addEventListener("click",(function(){dialogHelper.close(dlg)})),refreshLibraryFromServer(dlg)},xhr.send(),deferred.promise()}}}));
//# sourceMappingURL=mediaLibraryEditor.js.map
