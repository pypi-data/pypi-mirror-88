define(["exports","connectionManager","actionsheet","playbackManager","globalize","qualityoptions"],(function(_exports,_connectionManager,_actionsheet,_playbackManager,_globalize,_qualityoptions){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function showWithUser(options,player,user){var supportedCommands=_playbackManager.default.getSupportedCommands(player),menuItems=(options.mediaType,[]);if(-1!==supportedCommands.indexOf("SetAspectRatio")){var currentAspectRatioId=_playbackManager.default.getAspectRatio(player),currentAspectRatio=_playbackManager.default.getSupportedAspectRatios(player).filter((function(i){return i.id===currentAspectRatioId}))[0];menuItems.push({name:_globalize.default.translate("AspectRatio"),id:"aspectratio",asideText:currentAspectRatio?currentAspectRatio.name:null})}if(user&&user.Policy.EnableVideoPlaybackTranscoding){var secondaryQualityText=function getQualitySecondaryText(player){var state=_playbackManager.default.getPlayerState(player),videoStream=(_playbackManager.default.enableAutomaticBitrateDetection(player),_playbackManager.default.getMaxStreamingBitrate(player),_playbackManager.default.currentMediaSource(player).MediaStreams.filter((function(stream){return"Video"===stream.Type}))[0]),videoWidth=videoStream?videoStream.Width:null,videoHeight=videoStream?videoStream.Height:null,options=_qualityoptions.default.getVideoQualityOptions({currentMaxBitrate:_playbackManager.default.getMaxStreamingBitrate(player),isAutomaticBitrateEnabled:_playbackManager.default.enableAutomaticBitrateDetection(player),videoWidth:videoWidth,videoHeight:videoHeight,enableAuto:!0}),selectedOption=(options.map((function(o){var opt={name:o.name,id:o.bitrate,asideText:o.secondaryText};return o.selected&&(opt.selected=!0),opt})),options.filter((function(o){return o.selected})));if(!selectedOption.length)return null;var text=(selectedOption=selectedOption[0]).name;return selectedOption.autoText&&(state.PlayState&&"Transcode"!==state.PlayState.PlayMethod?text+=" - Direct":text+=" "+selectedOption.autoText),text}(player);menuItems.push({name:_globalize.default.translate("Quality"),id:"quality",asideText:secondaryQualityText})}var repeatMode=_playbackManager.default.getRepeatMode(player);return-1!==supportedCommands.indexOf("SetRepeatMode")&&_playbackManager.default.currentMediaSource(player).RunTimeTicks&&menuItems.push({name:_globalize.default.translate("RepeatMode"),id:"repeatmode",asideText:"RepeatNone"===repeatMode?_globalize.default.translate("None"):_globalize.default.translate(""+repeatMode)}),options.suboffset&&menuItems.push({name:_globalize.default.translate("SubtitleOffset"),id:"suboffset",asideText:null}),options.stats&&menuItems.push({name:_globalize.default.translate("PlaybackData"),id:"stats",asideText:null}),_actionsheet.default.show({items:menuItems,positionTo:options.positionTo}).then((function(id){return function handleSelectedOption(id,options,player){switch(id){case"quality":return function showQualityMenu(player,btn){var videoStream=_playbackManager.default.currentMediaSource(player).MediaStreams.filter((function(stream){return"Video"===stream.Type}))[0],videoWidth=videoStream?videoStream.Width:null,videoHeight=videoStream?videoStream.Height:null,options=_qualityoptions.default.getVideoQualityOptions({currentMaxBitrate:_playbackManager.default.getMaxStreamingBitrate(player),isAutomaticBitrateEnabled:_playbackManager.default.enableAutomaticBitrateDetection(player),videoWidth:videoWidth,videoHeight:videoHeight,enableAuto:!0}),menuItems=options.map((function(o){var opt={name:o.name,id:o.bitrate,asideText:o.secondaryText};return o.selected&&(opt.selected=!0),opt})),selectedId=options.filter((function(o){return o.selected}));return selectedId=selectedId.length?selectedId[0].bitrate:null,_actionsheet.default.show({items:menuItems,positionTo:btn}).then((function(id){var bitrate=parseInt(id);bitrate!==selectedId&&_playbackManager.default.setMaxStreamingBitrate({enableAutomaticBitrateDetection:!bitrate,maxBitrate:bitrate},player)}))}(player,options.positionTo);case"aspectratio":return function showAspectRatioMenu(player,btn){var currentId=_playbackManager.default.getAspectRatio(player),menuItems=_playbackManager.default.getSupportedAspectRatios(player).map((function(i){return{id:i.id,name:i.name,selected:i.id===currentId}}));return _actionsheet.default.show({items:menuItems,positionTo:btn}).then((function(id){return id?(_playbackManager.default.setAspectRatio(id,player),Promise.resolve()):Promise.reject()}))}(player,options.positionTo);case"repeatmode":return function showRepeatModeMenu(player,btn){var menuItems=[],currentValue=_playbackManager.default.getRepeatMode(player);return menuItems.push({name:_globalize.default.translate("RepeatAll"),id:"RepeatAll",selected:"RepeatAll"===currentValue}),menuItems.push({name:_globalize.default.translate("RepeatOne"),id:"RepeatOne",selected:"RepeatOne"===currentValue}),menuItems.push({name:_globalize.default.translate("None"),id:"RepeatNone",selected:"RepeatNone"===currentValue}),_actionsheet.default.show({items:menuItems,positionTo:btn}).then((function(mode){mode&&_playbackManager.default.setRepeatMode(mode,player)}))}(player,options.positionTo);case"stats":return options.onOption&&options.onOption("stats"),Promise.resolve();case"suboffset":return options.onOption&&options.onOption("suboffset"),Promise.resolve()}return Promise.reject()}(id,options,player)}))}function show(options){var player=options.player,currentItem=_playbackManager.default.currentItem(player);return currentItem&&currentItem.ServerId?_connectionManager.default.getApiClient(currentItem.ServerId).getCurrentUser().then((function(user){return showWithUser(options,player,user)})):showWithUser(options,player,null)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.show=show,_exports.default=void 0,_connectionManager=_interopRequireDefault(_connectionManager),_actionsheet=_interopRequireDefault(_actionsheet),_playbackManager=_interopRequireDefault(_playbackManager),_globalize=_interopRequireDefault(_globalize),_qualityoptions=_interopRequireDefault(_qualityoptions);var _default={show:show};_exports.default=_default}));
//# sourceMappingURL=playersettingsmenu.js.map
