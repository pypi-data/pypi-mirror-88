define(["exports","appSettings","events","browser","loading","playbackManager","appRouter","globalize","apphost"],(function(_exports,_appSettings,_events,_browser,_loading,_playbackManager,_appRouter,_globalize,_apphost){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function mirrorIfEnabled(info){if(info&&_playbackManager.default.enableDisplayMirroring()){var getPlayerInfo=_playbackManager.default.getPlayerInfo();getPlayerInfo&&(getPlayerInfo.isLocalPlayer||-1===getPlayerInfo.supportedCommands.indexOf("DisplayContent")||function mirrorItem(info,player){var item=info.item;_playbackManager.default.displayContent({ItemName:item.Name,ItemId:item.Id,ItemType:item.Type,Context:info.context},player)}(info,_playbackManager.default.getCurrentPlayer()))}}function emptyCallback(){}function getIcon(target){var deviceType=target.deviceType;switch(!deviceType&&target.isLocalPlayer&&(deviceType=_browser.default.tv?"tv":_browser.default.mobile?"smartphone":"desktop"),deviceType||(deviceType="tv"),deviceType){case"smartphone":return"smartphone";case"tablet":return"tablet";case"tv":return"tv";case"cast":return"cast";case"desktop":return"computer";default:return"tv"}}function show(button){var currentPlayerInfo=_playbackManager.default.getPlayerInfo();if(!currentPlayerInfo||currentPlayerInfo.isLocalPlayer){var currentPlayerId=currentPlayerInfo?currentPlayerInfo.id:null;_loading.default.show(),_playbackManager.default.getTargets().then((function(targets){var menuItems=targets.map((function(t){var target,name=t.name;return t.appName&&t.appName!==t.name&&(name+=" - "+t.appName),{name:name,id:t.id,selected:currentPlayerId===t.id,secondaryText:(target=t,target.user?target.user.Name:null),icon:getIcon(t)}}));require(["actionsheet"],(function(actionsheet){_loading.default.hide();var menuOptions={title:_globalize.default.translate("HeaderPlayOn"),items:menuItems,positionTo:button,resolveOnClick:!0,border:!0};!_browser.default.chrome&&!_browser.default.edgeChromium||_apphost.default.supports("castmenuhashchange")||(menuOptions.enableHistory=!1),actionsheet.show(menuOptions).then((function(id){var target=targets.filter((function(t){return t.id===id}))[0];_playbackManager.default.trySetActivePlayer(target.playerName,target),mirrorIfEnabled()}),emptyCallback)}))}))}else(function showActivePlayerMenu(playerInfo){require(["dialogHelper","dialog","emby-checkbox","emby-button"],(function(dialogHelper){!function showActivePlayerMenuInternal(dialogHelper,playerInfo){var html="",dialogOptions={removeOnClose:!0,modal:!1,entryAnimationDuration:160,exitAnimationDuration:160,autoFocus:!1},dlg=dialogHelper.createDialog(dialogOptions);dlg.classList.add("promptDialog");var currentDeviceName=playerInfo.deviceName||playerInfo.name;if(html+='<div class="promptDialogContent" style="padding:1.5em;">',html+='<h2 style="margin-top:.5em;">',html+=currentDeviceName,html+="</h2>",html+="<div>",-1!==playerInfo.supportedCommands.indexOf("DisplayContent")){html+='<label class="checkboxContainer">';var checkedHtml=_playbackManager.default.enableDisplayMirroring()?" checked":"";html+='<input type="checkbox" is="emby-checkbox" class="chkMirror"'+checkedHtml+"/>",html+="<span>"+_globalize.default.translate("EnableDisplayMirroring")+"</span>",html+="</label>"}html+="</div>",html+='<div style="margin-top:1em;display:flex;justify-content: flex-end;">',html+='<button is="emby-button" type="button" class="button-flat btnRemoteControl promptDialogButton">'+_globalize.default.translate("HeaderRemoteControl")+"</button>",html+='<button is="emby-button" type="button" class="button-flat btnDisconnect promptDialogButton ">'+_globalize.default.translate("Disconnect")+"</button>",html+='<button is="emby-button" type="button" class="button-flat btnCancel promptDialogButton">'+_globalize.default.translate("ButtonCancel")+"</button>",html+="</div>",html+="</div>",dlg.innerHTML=html;var chkMirror=dlg.querySelector(".chkMirror");chkMirror&&chkMirror.addEventListener("change",onMirrorChange);var destination="",btnRemoteControl=dlg.querySelector(".btnRemoteControl");btnRemoteControl&&btnRemoteControl.addEventListener("click",(function(){destination="nowplaying",dialogHelper.close(dlg)}));dlg.querySelector(".btnDisconnect").addEventListener("click",(function(){destination="disconnectFromPlayer",dialogHelper.close(dlg)})),dlg.querySelector(".btnCancel").addEventListener("click",(function(){dialogHelper.close(dlg)})),dialogHelper.open(dlg).then((function(){"nowplaying"===destination?_appRouter.default.showNowPlaying():"disconnectFromPlayer"===destination&&function disconnectFromPlayer(currentDeviceName){-1!==_playbackManager.default.getSupportedCommands().indexOf("EndSession")?require(["dialog"],(function(dialog){var menuItems=[];menuItems.push({name:_globalize.default.translate("Yes"),id:"yes"}),menuItems.push({name:_globalize.default.translate("No"),id:"no"}),dialog({buttons:menuItems,text:_globalize.default.translate("ConfirmEndPlayerSession",currentDeviceName)}).then((function(id){switch(id){case"yes":_playbackManager.default.getCurrentPlayer().endSession(),_playbackManager.default.setDefaultPlayerActive();break;case"no":_playbackManager.default.setDefaultPlayerActive()}}))})):_playbackManager.default.setDefaultPlayerActive()}(currentDeviceName)}),emptyCallback)}(dialogHelper,playerInfo)}))})(currentPlayerInfo)}function onMirrorChange(){_playbackManager.default.enableDisplayMirroring(this.checked)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.show=show,_exports.default=void 0,_appSettings=_interopRequireDefault(_appSettings),_events=_interopRequireDefault(_events),_browser=_interopRequireDefault(_browser),_loading=_interopRequireDefault(_loading),_playbackManager=_interopRequireDefault(_playbackManager),_appRouter=_interopRequireDefault(_appRouter),_globalize=_interopRequireDefault(_globalize),_apphost=_interopRequireDefault(_apphost),document.addEventListener("viewshow",(function(e){var item=(e.detail.state||{}).item;item&&item.ServerId&&mirrorIfEnabled({item:item})})),_events.default.on(_appSettings.default,"change",(function(e,name){"displaymirror"===name&&mirrorIfEnabled()})),_events.default.on(_playbackManager.default,"pairing",(function(e){_loading.default.show()})),_events.default.on(_playbackManager.default,"paired",(function(e){_loading.default.hide()})),_events.default.on(_playbackManager.default,"pairerror",(function(e){_loading.default.hide()}));var _default={show:show};_exports.default=_default}));
//# sourceMappingURL=playerSelectionMenu.js.map
