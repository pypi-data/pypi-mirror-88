"use strict";define(["apphost","userSettings","browser","events","backdrop","globalize","require","appSettings"],(function(appHost,userSettings,browser,events,backdrop,globalize,require,appSettings){var themeStyleElement,currentThemeId;var skinManager={getThemes:function getThemes(){return[{name:"Apple TV",id:"appletv"},{name:"Blue Radiance",id:"blueradiance"},{name:"Dark",id:"dark",isDefault:!0,isDefaultServerDashboard:!0},{name:"Light",id:"light"},{name:"Purple Haze",id:"purplehaze"},{name:"Windows Media Center",id:"wmc"}]},loadUserSkin:function loadUserSkin(options){(options=options||{}).start?Emby.Page.invokeShortcut(options.start):Emby.Page.goHome()}};var currentSound,themeResources={},lastSound=0;function onViewBeforeShow(e){e.detail&&"video-osd"===e.detail.type?document.body.classList.remove("force-scroll"):(themeResources.backdrop&&backdrop.setBackdrop(themeResources.backdrop),!browser.mobile&&userSettings.enableThemeSongs()&&(0===lastSound?themeResources.themeSong&&playSound(themeResources.themeSong):(new Date).getTime()-lastSound>3e4&&themeResources.effect&&playSound(themeResources.effect)),document.body.classList.add("force-scroll"))}function playSound(path,volume){lastSound=(new Date).getTime(),require(["howler"],(function(howler){try{var sound=new Howl({src:[path],volume:volume||.1});sound.play(),currentSound=sound}catch(err){console.error("error playing sound: "+err)}}))}return skinManager.setTheme=function(id,context){return new Promise((function(resolve,reject){if(currentThemeId&&currentThemeId===id)resolve();else{var info=function getThemeStylesheetInfo(id,isDefaultProperty){for(var defaultTheme,selectedTheme,themes=skinManager.getThemes(),i=0,length=themes.length;i<length;i++){var theme=themes[i];theme[isDefaultProperty]&&(defaultTheme=theme),id===theme.id&&(selectedTheme=theme)}return selectedTheme=selectedTheme||defaultTheme,{stylesheetPath:require.toUrl("themes/"+selectedTheme.id+"/theme.css"),themeId:selectedTheme.id}}(id,"serverdashboard"===context?"isDefaultServerDashboard":"isDefault");if(currentThemeId&&currentThemeId===info.themeId)resolve();else{var linkUrl=info.stylesheetPath;!function unloadTheme(){var elem=themeStyleElement;elem&&(elem.parentNode.removeChild(elem),themeStyleElement=null,currentThemeId=null)}();var link=document.createElement("link");link.setAttribute("rel","stylesheet"),link.setAttribute("type","text/css"),link.onload=function(){!function onThemeLoaded(){document.documentElement.classList.remove("preload");try{var color=getComputedStyle(document.querySelector(".skinHeader")).getPropertyValue("background-color");color&&appHost.setThemeColor(color)}catch(err){console.error("error setting theme color: "+err)}}(),resolve()},link.setAttribute("href",linkUrl),document.head.appendChild(link),themeStyleElement=link,currentThemeId=info.themeId,function loadThemeResources(id){lastSound=0,currentSound&&(currentSound.stop(),currentSound=null),backdrop.clear()}(info.themeId),onViewBeforeShow({})}}}))},document.addEventListener("viewshow",onViewBeforeShow),skinManager}));
//# sourceMappingURL=skinManager.js.map
