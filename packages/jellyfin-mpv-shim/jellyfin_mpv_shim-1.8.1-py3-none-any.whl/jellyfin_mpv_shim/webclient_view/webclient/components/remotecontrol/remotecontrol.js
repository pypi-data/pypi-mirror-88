"use strict";function _createForOfIteratorHelper(o,allowArrayLike){var it;if("undefined"==typeof Symbol||null==o[Symbol.iterator]){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function F(){};return{s:F,n:function n(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function e(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function s(){it=o[Symbol.iterator]()},n:function n(){var step=it.next();return normalCompletion=step.done,step},e:function e(_e2){didErr=!0,err=_e2},f:function f(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}define(["browser","datetime","backdrop","libraryBrowser","listView","imageLoader","playbackManager","nowPlayingHelper","events","connectionManager","apphost","globalize","layoutManager","userSettings","cardBuilder","itemContextMenu","cardStyle","emby-itemscontainer","css!./remotecontrol.css","emby-ratingbutton"],(function(browser,datetime,backdrop,libraryBrowser,listView,imageLoader,playbackManager,nowPlayingHelper,events,connectionManager,appHost,globalize,layoutManager,userSettings,cardBuilder,itemContextMenu){var showMuteButton=!0,showVolumeSlider=!0;function updateNowPlayingInfo(context,state,serverId){var item=state.NowPlayingItem,displayName=item?function getNowPlayingNameHtml(nowPlayingItem,includeNonNameInfo){return nowPlayingHelper.getNowPlayingNames(nowPlayingItem,includeNonNameInfo).map((function(i){return i.text})).join("<br/>")}(item).replace("<br/>"," - "):"";if(void 0!==item){var nowPlayingServerId=item.ServerId||serverId;if("Audio"==item.Type||"Audio"==item.MediaStreams[0].Type){var songName=item.Name,artistsSeries="",albumName="";if(null!=item.Artists)if(null!=item.ArtistItems){var _step,_iterator=_createForOfIteratorHelper(item.ArtistItems);try{for(_iterator.s();!(_step=_iterator.n()).done;){var artist=_step.value,artistName=artist.Name,artistId=artist.Id;artistsSeries+='<a class="button-link emby-button" is="emby-linkbutton" href="details?id='.concat(artistId,"&serverId=").concat(nowPlayingServerId,'">').concat(artistName,"</a>"),artist!==item.ArtistItems.slice(-1)[0]&&(artistsSeries+=", ")}}catch(err){_iterator.e(err)}finally{_iterator.f()}}else if(item.Artists){var _step2,_iterator2=_createForOfIteratorHelper(item.Artists);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var _artist=_step2.value;artistsSeries+="<a>".concat(_artist,"</a>"),_artist!==item.Artists.slice(-1)[0]&&(artistsSeries+=", ")}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}}null!=item.Album&&(albumName='<a class="button-link emby-button" is="emby-linkbutton" href="details?id='+item.AlbumId+"&serverId=".concat(nowPlayingServerId,'">')+item.Album+"</a>"),context.querySelector(".nowPlayingAlbum").innerHTML=albumName,context.querySelector(".nowPlayingArtist").innerHTML=artistsSeries,context.querySelector(".nowPlayingSongName").innerHTML=songName}else if("Episode"==item.Type){if(null!=item.SeasonName){var seasonName=item.SeasonName;context.querySelector(".nowPlayingSeason").innerHTML='<a class="button-link emby-button" is="emby-linkbutton" href="details?id='+item.SeasonId+"&serverId=".concat(nowPlayingServerId,'">').concat(seasonName,"</a>")}if(null!=item.SeriesName){var seriesName=item.SeriesName;null!=item.SeriesId?context.querySelector(".nowPlayingSerie").innerHTML='<a class="button-link emby-button" is="emby-linkbutton" href="details?id='+item.SeriesId+"&serverId=".concat(nowPlayingServerId,'">').concat(seriesName,"</a>"):context.querySelector(".nowPlayingSerie").innerHTML=seriesName}context.querySelector(".nowPlayingEpisode").innerHTML=item.Name}else context.querySelector(".nowPlayingPageTitle").innerHTML=displayName;displayName.length>0&&"Audio"!=item.Type&&"Episode"!=item.Type?context.querySelector(".nowPlayingPageTitle").classList.remove("hide"):context.querySelector(".nowPlayingPageTitle").classList.add("hide");var url=item?function seriesImageUrl(item,options){if("Episode"!==item.Type)return null;if((options=options||{}).type=options.type||"Primary","Primary"===options.type&&item.SeriesPrimaryImageTag)return options.tag=item.SeriesPrimaryImageTag,connectionManager.getApiClient(item.ServerId).getScaledImageUrl(item.SeriesId,options);if("Thumb"===options.type){if(item.SeriesThumbImageTag)return options.tag=item.SeriesThumbImageTag,connectionManager.getApiClient(item.ServerId).getScaledImageUrl(item.SeriesId,options);if(item.ParentThumbImageTag)return options.tag=item.ParentThumbImageTag,connectionManager.getApiClient(item.ServerId).getScaledImageUrl(item.ParentThumbItemId,options)}return null}(item,{maxHeight:600})||function imageUrl(item,options){return(options=options||{}).type=options.type||"Primary",item.ImageTags&&item.ImageTags[options.type]?(options.tag=item.ImageTags[options.type],connectionManager.getApiClient(item.ServerId).getScaledImageUrl(item.PrimaryImageItemId||item.Id,options)):item.AlbumId&&item.AlbumPrimaryImageTag?(options.tag=item.AlbumPrimaryImageTag,connectionManager.getApiClient(item.ServerId).getScaledImageUrl(item.AlbumId,options)):null}(item,{maxHeight:600}):null,contextButton=context.querySelector(".btnToggleContextMenu"),autoFocusContextButton=document.activeElement===contextButton,contextButtonClone=contextButton.cloneNode(!0);contextButton.parentNode.replaceChild(contextButtonClone,contextButton),contextButton=context.querySelector(".btnToggleContextMenu"),autoFocusContextButton&&contextButton.focus();var options={play:!1,queue:!1,stopPlayback:!!layoutManager.mobile,clearQueue:!0,openAlbum:!1,positionTo:contextButton},apiClient=connectionManager.getApiClient(item.ServerId);apiClient.getItem(apiClient.getCurrentUserId(),item.Id).then((function(fullItem){apiClient.getCurrentUser().then((function(user){contextButton.addEventListener("click",(function(){itemContextMenu.show(Object.assign({item:fullItem,user:user},options))}))}))})),function setImageUrl(context,state,url){url;var item=state.NowPlayingItem,imgContainer=context.querySelector(".nowPlayingPageImageContainer");url?(imgContainer.innerHTML='<img class="nowPlayingPageImage" src="'+url+'" />',"Audio"==item.Type?(context.querySelector(".nowPlayingPageImage").classList.add("nowPlayingPageImageAudio"),context.querySelector(".nowPlayingPageImageContainer").classList.remove("nowPlayingPageImageAudio")):(context.querySelector(".nowPlayingPageImageContainer").classList.add("nowPlayingPageImagePoster"),context.querySelector(".nowPlayingPageImage").classList.remove("nowPlayingPageImageAudio"))):imgContainer.innerHTML='<div class="nowPlayingPageImageContainerNoAlbum"><button data-action="link" class="cardImageContainer coveredImage '+cardBuilder.getDefaultBackgroundClass(item.Name)+' cardContent cardContent-shadow itemAction"><span class="cardImageIcon material-icons album"></span></button></div>'}(context,state,url),item?(backdrop.setBackdrops([item]),apiClient.getItem(apiClient.getCurrentUserId(),item.Id).then((function(fullItem){var userData=fullItem.UserData||{},likes=null==userData.Likes?"":userData.Likes;context.querySelector(".nowPlayingPageUserDataButtonsTitle").innerHTML='<button is="emby-ratingbutton" type="button" class="listItemButton paper-icon-button-light" data-id="'+fullItem.Id+'" data-serverid="'+fullItem.ServerId+'" data-itemtype="'+fullItem.Type+'" data-likes="'+likes+'" data-isfavorite="'+userData.IsFavorite+'"><span class="material-icons favorite"></span></button>',context.querySelector(".nowPlayingPageUserDataButtons").innerHTML='<button is="emby-ratingbutton" type="button" class="listItemButton paper-icon-button-light" data-id="'+fullItem.Id+'" data-serverid="'+fullItem.ServerId+'" data-itemtype="'+fullItem.Type+'" data-likes="'+likes+'" data-isfavorite="'+userData.IsFavorite+'"><span class="material-icons favorite"></span></button>'}))):(backdrop.clear(),context.querySelector(".nowPlayingPageUserDataButtons").innerHTML="")}}function buttonVisible(btn,enabled){enabled?btn.classList.remove("hide"):btn.classList.add("hide")}return function(){function updatePlayerState(player,context,state){lastPlayerState=state;var item=state.NowPlayingItem,supportedCommands=playbackManager.getPlayerInfo().supportedCommands;currentPlayerSupportedCommands=supportedCommands;var playState=state.PlayState||{},isSupportedCommands=supportedCommands.includes("DisplayMessage")||supportedCommands.includes("SendString")||supportedCommands.includes("Select");buttonVisible(context.querySelector(".btnToggleFullscreen"),item&&"Video"==item.MediaType&&supportedCommands.includes("ToggleFullscreen")),function updateAudioTracksDisplay(player,context){var supportedCommands=currentPlayerSupportedCommands;buttonVisible(context.querySelector(".btnAudioTracks"),playbackManager.audioTracks(player).length>1&&-1!=supportedCommands.indexOf("SetAudioStreamIndex"))}(player,context),function updateSubtitleTracksDisplay(player,context){var supportedCommands=currentPlayerSupportedCommands;buttonVisible(context.querySelector(".btnSubtitles"),playbackManager.subtitleTracks(player).length&&-1!=supportedCommands.indexOf("SetSubtitleStreamIndex"))}(player,context),supportedCommands.includes("DisplayMessage")&&!currentPlayer.isLocalPlayer?context.querySelector(".sendMessageSection").classList.remove("hide"):context.querySelector(".sendMessageSection").classList.add("hide"),supportedCommands.includes("SendString")&&!currentPlayer.isLocalPlayer?context.querySelector(".sendTextSection").classList.remove("hide"):context.querySelector(".sendTextSection").classList.add("hide"),supportedCommands.includes("Select")&&!currentPlayer.isLocalPlayer?context.querySelector(".navigationSection").classList.remove("hide"):context.querySelector(".navigationSection").classList.add("hide"),isSupportedCommands&&!currentPlayer.isLocalPlayer?context.querySelector(".remoteControlSection").classList.remove("hide"):context.querySelector(".remoteControlSection").classList.add("hide"),buttonVisible(context.querySelector(".btnStop"),null!=item),buttonVisible(context.querySelector(".btnNextTrack"),null!=item),buttonVisible(context.querySelector(".btnPreviousTrack"),null!=item),layoutManager.mobile?(buttonVisible(context.querySelector(".btnRewind"),!1),buttonVisible(context.querySelector(".btnFastForward"),!1)):(buttonVisible(context.querySelector(".btnRewind"),null!=item),buttonVisible(context.querySelector(".btnFastForward"),null!=item));var positionSlider=context.querySelector(".nowPlayingPositionSlider");if(positionSlider&&item&&item.RunTimeTicks&&positionSlider.setKeyboardSteps(1e6*userSettings.skipBackLength()/item.RunTimeTicks,1e6*userSettings.skipForwardLength()/item.RunTimeTicks),positionSlider&&!positionSlider.dragging){positionSlider.disabled=!playState.CanSeek;var isProgressClear=state.MediaSource&&null==state.MediaSource.RunTimeTicks;positionSlider.setIsClear(isProgressClear)}updatePlayPauseState(playState.IsPaused,null!=item),updateTimeDisplay(playState.PositionTicks,item?item.RunTimeTicks:null),updatePlayerVolumeState(context,playState.IsMuted,playState.VolumeLevel),item&&"Video"==item.MediaType?context.classList.remove("hideVideoButtons"):context.classList.add("hideVideoButtons"),updateRepeatModeDisplay(playbackManager.getRepeatMode()),onShuffleQueueModeChange(!1),updateNowPlayingInfo(context,state)}function updateRepeatModeDisplay(repeatMode){var toggleRepeatButtons=dlg.querySelectorAll(".repeatToggleButton"),innHtml='<span class="material-icons repeat"></span>',repeatOn=!0;switch(repeatMode){case"RepeatAll":break;case"RepeatOne":innHtml='<span class="material-icons repeat_one"></span>';break;case"RepeatNone":default:repeatOn=!1}var _step3,_iterator3=_createForOfIteratorHelper(toggleRepeatButtons);try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var toggleRepeatButton=_step3.value;toggleRepeatButton.classList.toggle("buttonActive",repeatOn),toggleRepeatButton.innerHTML=innHtml}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}}function updatePlayerVolumeState(context,isMuted,volumeLevel){var view=context,supportedCommands=currentPlayerSupportedCommands;-1===supportedCommands.indexOf("Mute")&&(showMuteButton=!1),-1===supportedCommands.indexOf("SetVolume")&&(showVolumeSlider=!1),currentPlayer.isLocalPlayer&&appHost.supports("physicalvolumecontrol")&&(showMuteButton=!1,showVolumeSlider=!1);var buttonMute=view.querySelector(".buttonMute"),buttonMuteIcon=buttonMute.querySelector(".material-icons");if(buttonMuteIcon.classList.remove("volume_off","volume_up"),isMuted?(buttonMute.setAttribute("title",globalize.translate("Unmute")),buttonMuteIcon.classList.add("volume_off")):(buttonMute.setAttribute("title",globalize.translate("Mute")),buttonMuteIcon.classList.add("volume_up")),showMuteButton||showVolumeSlider){buttonMute.classList.toggle("hide",!showMuteButton);var nowPlayingVolumeSlider=context.querySelector(".nowPlayingVolumeSlider"),nowPlayingVolumeSliderContainer=context.querySelector(".nowPlayingVolumeSliderContainer");nowPlayingVolumeSlider&&(nowPlayingVolumeSliderContainer.classList.toggle("hide",!showVolumeSlider),nowPlayingVolumeSlider.dragging||(nowPlayingVolumeSlider.value=volumeLevel||0))}else context.querySelector(".volumecontrol").classList.add("hide")}function updatePlayPauseState(isPaused,isActive){var btnPlayPause=dlg.querySelector(".btnPlayPause"),btnPlayPauseIcon=btnPlayPause.querySelector(".material-icons");btnPlayPauseIcon.classList.remove("play_circle_filled","pause_circle_filled"),btnPlayPauseIcon.classList.add(isPaused?"play_circle_filled":"pause_circle_filled"),buttonVisible(btnPlayPause,isActive)}function updateTimeDisplay(positionTicks,runtimeTicks){var context=dlg,positionSlider=context.querySelector(".nowPlayingPositionSlider");if(positionSlider&&!positionSlider.dragging)if(runtimeTicks){var pct=positionTicks/runtimeTicks;pct*=100,positionSlider.value=pct}else positionSlider.value=0;context.querySelector(".positionTime").innerHTML=null==positionTicks?"--:--":datetime.getDisplayRunningTime(positionTicks),context.querySelector(".runtime").innerHTML=null!=runtimeTicks?datetime.getDisplayRunningTime(runtimeTicks):"--:--"}function getPlaylistItems(player){return playbackManager.getPlaylist(player)}function onPlaybackStart(e,state){console.debug("remotecontrol event: "+e.type);onStateChanged.call(this,e,state)}function onRepeatModeChange(){updateRepeatModeDisplay(playbackManager.getRepeatMode())}function onShuffleQueueModeChange(){var _step4,updateView=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],shuffleMode=playbackManager.getQueueShuffleMode(this),context=dlg,cssClass="buttonActive",shuffleButtons=context.querySelectorAll(".btnShuffleQueue"),_iterator4=_createForOfIteratorHelper(shuffleButtons);try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var shuffleButton=_step4.value;switch(shuffleMode){case"Shuffle":shuffleButton.classList.add(cssClass);break;case"Sorted":default:shuffleButton.classList.remove(cssClass)}}}catch(err){_iterator4.e(err)}finally{_iterator4.f()}updateView&&onPlaylistUpdate()}function onPlaylistUpdate(e){!function loadPlaylist(context,player){getPlaylistItems(player).then((function(items){var html="",favoritesEnabled=!0;layoutManager.mobile&&(items.length>0?context.querySelector(".btnTogglePlaylist").classList.remove("hide"):context.querySelector(".btnTogglePlaylist").classList.add("hide"),favoritesEnabled=!1),html+=listView.getListViewHtml({items:items,smallIcon:!0,action:"setplaylistindex",enableUserDataButtons:favoritesEnabled,rightButtons:[{icon:"remove_circle_outline",title:globalize.translate("ButtonRemove"),id:"remove"}],dragHandle:!0});var itemsContainer=context.querySelector(".playlist"),focusedItemPlaylistId=itemsContainer.querySelector("button:focus");if(itemsContainer.innerHTML=html,null!==focusedItemPlaylistId){focusedItemPlaylistId=focusedItemPlaylistId.getAttribute("data-playlistitemid");var newFocusedItem=itemsContainer.querySelector('button[data-playlistitemid="'.concat(focusedItemPlaylistId,'"]'));null!==newFocusedItem&&newFocusedItem.focus()}var playlistItemId=playbackManager.getCurrentPlaylistItemId(player);if(playlistItemId){var img=itemsContainer.querySelector('.listItem[data-playlistItemId="'.concat(playlistItemId,'"] .listItemImage'));img&&(img.classList.remove("lazy"),img.classList.add("playlistIndexIndicatorImage"))}imageLoader.lazyChildren(itemsContainer)}))}(dlg,this)}function onPlaylistItemRemoved(e,info){var context=dlg;if(void 0!==info)for(var playlistItemIds=info.playlistItemIds,i=0,length=playlistItemIds.length;i<length;i++){var listItem=context.querySelector('.listItem[data-playlistItemId="'+playlistItemIds[i]+'"]');listItem&&listItem.parentNode.removeChild(listItem)}else onPlaylistUpdate()}function onPlaybackStopped(e,state){console.debug("remotecontrol event: "+e.type);state.NextMediaType||(updatePlayerState(this,dlg,{}),Emby.Page.back())}function onPlayPauseStateChanged(e){updatePlayPauseState(this.paused(),!0)}function onStateChanged(event,state){updatePlayerState(this,dlg,state),onPlaylistUpdate()}function onTimeUpdate(e){var now=(new Date).getTime();if(!(now-lastUpdateTime<700)){lastUpdateTime=now;currentRuntimeTicks=playbackManager.duration(this),updateTimeDisplay(playbackManager.currentTime(this),currentRuntimeTicks)}}function onVolumeChanged(e){updatePlayerVolumeState(dlg,this.isMuted(),this.getVolume())}function releaseCurrentPlayer(){var player=currentPlayer;player&&(events.off(player,"playbackstart",onPlaybackStart),events.off(player,"statechange",onStateChanged),events.off(player,"repeatmodechange",onRepeatModeChange),events.off(player,"shufflequeuemodechange",onShuffleQueueModeChange),events.off(player,"playlistitemremove",onPlaylistItemRemoved),events.off(player,"playlistitemmove",onPlaylistUpdate),events.off(player,"playlistitemadd",onPlaylistUpdate),events.off(player,"playbackstop",onPlaybackStopped),events.off(player,"volumechange",onVolumeChanged),events.off(player,"pause",onPlayPauseStateChanged),events.off(player,"unpause",onPlayPauseStateChanged),events.off(player,"timeupdate",onTimeUpdate),currentPlayer=null)}function bindToPlayer(context,player){if(releaseCurrentPlayer(),currentPlayer=player,player){var state=playbackManager.getPlayerState(player);onStateChanged.call(player,{type:"init"},state),events.on(player,"playbackstart",onPlaybackStart),events.on(player,"statechange",onStateChanged),events.on(player,"repeatmodechange",onRepeatModeChange),events.on(player,"shufflequeuemodechange",onShuffleQueueModeChange),events.on(player,"playlistitemremove",onPlaylistItemRemoved),events.on(player,"playlistitemmove",onPlaylistUpdate),events.on(player,"playlistitemadd",onPlaylistUpdate),events.on(player,"playbackstop",onPlaybackStopped),events.on(player,"volumechange",onVolumeChanged),events.on(player,"pause",onPlayPauseStateChanged),events.on(player,"unpause",onPlayPauseStateChanged),events.on(player,"timeupdate",onTimeUpdate);var supportedCommands=playbackManager.getPlayerInfo().supportedCommands;currentPlayerSupportedCommands=supportedCommands,function updateSupportedCommands(context,commands){for(var all=context.querySelectorAll(".btnCommand"),i=0,length=all.length;i<length;i++){var enableButton=-1!==commands.indexOf(all[i].getAttribute("data-command"));all[i].disabled=!enableButton}}(context,supportedCommands)}}function onBtnCommandClick(){currentPlayer&&(this.classList.contains("repeatToggleButton")?function toggleRepeat(){switch(playbackManager.getRepeatMode()){case"RepeatAll":playbackManager.setRepeatMode("RepeatOne");break;case"RepeatOne":playbackManager.setRepeatMode("RepeatNone");break;case"RepeatNone":playbackManager.setRepeatMode("RepeatAll")}}():playbackManager.sendCommand({Name:this.getAttribute("data-command")},currentPlayer))}function savePlaylist(){require(["playlistEditor"],(function(playlistEditor){(function getSaveablePlaylistItems(){return getPlaylistItems(currentPlayer).then((function(items){return items.filter((function(i){return i.Id&&i.ServerId}))}))})().then((function(items){var serverId=items.length?items[0].ServerId:ApiClient.serverId();(new playlistEditor).show({items:items.map((function(i){return i.Id})),serverId:serverId,enableAddToPlayQueue:!1,defaultValue:"new"})}))}))}function bindEvents(context){for(var btnCommand=context.querySelectorAll(".btnCommand"),positionSlider=context.querySelector(".nowPlayingPositionSlider"),i=0,length=btnCommand.length;i<length;i++)btnCommand[i].addEventListener("click",onBtnCommandClick);context.querySelector(".btnToggleFullscreen").addEventListener("click",(function(e){currentPlayer&&playbackManager.sendCommand({Name:e.target.getAttribute("data-command")},currentPlayer)})),context.querySelector(".btnAudioTracks").addEventListener("click",(function(e){currentPlayer&&lastPlayerState&&lastPlayerState.NowPlayingItem&&function showAudioMenu(context,player,button,item){var currentIndex=playbackManager.getAudioStreamIndex(player),menuItems=playbackManager.audioTracks(player).map((function(s){var menuItem={name:s.DisplayTitle,id:s.Index};return s.Index==currentIndex&&(menuItem.selected=!0),menuItem}));require(["actionsheet"],(function(actionsheet){actionsheet.show({items:menuItems,positionTo:button,callback:function callback(id){playbackManager.setAudioStreamIndex(parseInt(id),player)}})}))}(0,currentPlayer,e.target,lastPlayerState.NowPlayingItem)})),context.querySelector(".btnSubtitles").addEventListener("click",(function(e){currentPlayer&&lastPlayerState&&lastPlayerState.NowPlayingItem&&function showSubtitleMenu(context,player,button,item){var currentIndex=playbackManager.getSubtitleStreamIndex(player),menuItems=playbackManager.subtitleTracks(player).map((function(s){var menuItem={name:s.DisplayTitle,id:s.Index};return s.Index==currentIndex&&(menuItem.selected=!0),menuItem}));menuItems.unshift({id:-1,name:globalize.translate("ButtonOff"),selected:null==currentIndex}),require(["actionsheet"],(function(actionsheet){actionsheet.show({items:menuItems,positionTo:button,callback:function callback(id){playbackManager.setSubtitleStreamIndex(parseInt(id),player)}})}))}(0,currentPlayer,e.target,lastPlayerState.NowPlayingItem)})),context.querySelector(".btnStop").addEventListener("click",(function(){currentPlayer&&playbackManager.stop(currentPlayer)})),context.querySelector(".btnPlayPause").addEventListener("click",(function(){currentPlayer&&playbackManager.playPause(currentPlayer)})),context.querySelector(".btnNextTrack").addEventListener("click",(function(){currentPlayer&&playbackManager.nextTrack(currentPlayer)})),context.querySelector(".btnRewind").addEventListener("click",(function(){currentPlayer&&playbackManager.rewind(currentPlayer)})),context.querySelector(".btnFastForward").addEventListener("click",(function(){currentPlayer&&playbackManager.fastForward(currentPlayer)}));var _step5,_iterator5=_createForOfIteratorHelper(context.querySelectorAll(".btnShuffleQueue"));try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){_step5.value.addEventListener("click",(function(){currentPlayer&&playbackManager.toggleQueueShuffleMode(currentPlayer)}))}}catch(err){_iterator5.e(err)}finally{_iterator5.f()}context.querySelector(".btnPreviousTrack").addEventListener("click",(function(e){if(currentPlayer)if("Audio"===lastPlayerState.NowPlayingItem.MediaType&&(currentPlayer._currentTime>=5||!playbackManager.previousTrack(currentPlayer))){if(e.detail>1&&playbackManager.previousTrack(currentPlayer))return;playbackManager.seekPercent(0,currentPlayer),positionSlider.value=0}else playbackManager.previousTrack(currentPlayer)})),context.querySelector(".btnPreviousTrack").addEventListener("dblclick",(function(){currentPlayer&&playbackManager.previousTrack(currentPlayer)})),positionSlider.addEventListener("change",(function(){var value=this.value;if(currentPlayer){var newPercent=parseFloat(value);playbackManager.seekPercent(newPercent,currentPlayer)}})),positionSlider.getBubbleText=function(value){if(!lastPlayerState||!lastPlayerState.NowPlayingItem||!currentRuntimeTicks)return"--:--";var ticks=currentRuntimeTicks;return ticks/=100,ticks*=value,datetime.getDisplayRunningTime(ticks)},context.querySelector(".nowPlayingVolumeSlider").addEventListener("input",(function(e){playbackManager.setVolume(e.target.value,currentPlayer)})),context.querySelector(".buttonMute").addEventListener("click",(function(){playbackManager.toggleMute(currentPlayer)}));var playlistContainer=context.querySelector(".playlist");playlistContainer.addEventListener("action-remove",(function(e){playbackManager.removeFromPlaylist([e.detail.playlistItemId],currentPlayer)})),playlistContainer.addEventListener("itemdrop",(function(e){var newIndex=e.detail.newIndex,playlistItemId=e.detail.playlistItemId;playbackManager.movePlaylistItem(playlistItemId,newIndex,currentPlayer)})),context.querySelector(".btnSavePlaylist").addEventListener("click",savePlaylist),context.querySelector(".btnTogglePlaylist").addEventListener("click",(function(){context.querySelector(".playlist").classList.contains("hide")?(context.querySelector(".playlist").classList.remove("hide"),context.querySelector(".btnSavePlaylist").classList.remove("hide"),context.querySelector(".volumecontrol").classList.add("hide"),layoutManager.mobile&&context.querySelector(".playlistSectionButton").classList.remove("playlistSectionButtonTransparent")):(context.querySelector(".playlist").classList.add("hide"),context.querySelector(".btnSavePlaylist").classList.add("hide"),(showMuteButton||showVolumeSlider)&&context.querySelector(".volumecontrol").classList.remove("hide"),layoutManager.mobile&&context.querySelector(".playlistSectionButton").classList.add("playlistSectionButtonTransparent"))}))}function onPlayerChange(){bindToPlayer(dlg,playbackManager.getCurrentPlayer())}function onMessageSubmit(e){var form=e.target;return playbackManager.sendCommand({Name:"DisplayMessage",Arguments:{Header:form.querySelector("#txtMessageTitle").value,Text:form.querySelector("#txtMessageText",form).value}},currentPlayer),form.querySelector("input").value="",require(["toast"],(function(toast){toast("Message sent.")})),e.preventDefault(),e.stopPropagation(),!1}function onSendStringSubmit(e){var form=e.target;return playbackManager.sendCommand({Name:"SendString",Arguments:{String:form.querySelector("#txtTypeText",form).value}},currentPlayer),form.querySelector("input").value="",require(["toast"],(function(toast){toast("Text sent.")})),e.preventDefault(),e.stopPropagation(),!1}var dlg,currentPlayer,lastPlayerState,currentPlayerSupportedCommands=[],lastUpdateTime=0,currentRuntimeTicks=0;this.init=function(ownerView,context){(function init(ownerView,context){var volumecontrolHtml='<div class="volumecontrol flex align-items-center flex-wrap-wrap justify-content-center">';volumecontrolHtml+='<button is="paper-icon-button-light" class="buttonMute autoSize" title='.concat(globalize.translate("Mute"),'><span class="xlargePaperIconButton material-icons volume_up"></span></button>'),volumecontrolHtml+='<div class="sliderContainer nowPlayingVolumeSliderContainer"><input is="emby-slider" type="range" step="1" min="0" max="100" value="0" class="nowPlayingVolumeSlider"/></div>',volumecontrolHtml+="</div>";var optionsSection=context.querySelector(".playlistSectionButton");if(layoutManager.mobile?(optionsSection.querySelector(".btnTogglePlaylist").insertAdjacentHTML("afterend",volumecontrolHtml),optionsSection.classList.add("playlistSectionButtonTransparent"),context.querySelector(".btnTogglePlaylist").classList.remove("hide"),context.querySelector(".playlistSectionButton").classList.remove("justify-content-center"),context.querySelector(".playlistSectionButton").classList.add("justify-content-space-between")):(context.querySelector(".nowPlayingSecondaryButtons").insertAdjacentHTML("beforeend",volumecontrolHtml),optionsSection.classList.remove("align-items-center","justify-content-center"),optionsSection.classList.add("align-items-right","justify-content-flex-end"),context.querySelector(".playlist").classList.remove("hide"),context.querySelector(".btnSavePlaylist").classList.remove("hide"),context.classList.add("padded-bottom")),bindEvents(context),context.querySelector(".sendMessageForm").addEventListener("submit",onMessageSubmit),context.querySelector(".typeTextForm").addEventListener("submit",onSendStringSubmit),events.on(playbackManager,"playerchange",onPlayerChange),layoutManager.tv){var positionSlider=context.querySelector(".nowPlayingPositionSlider");positionSlider.classList.add("focusable"),positionSlider.enableKeyboardDragging()}})(0,dlg=context)},this.onShow=function(){!function onShow(context,tab){null,bindToPlayer(context,playbackManager.getCurrentPlayer())}(dlg,window.location.hash)},this.destroy=function(){!function onDialogClosed(e){releaseCurrentPlayer(),events.off(playbackManager,"playerchange",onPlayerChange),lastPlayerState=null}()}}}));
//# sourceMappingURL=remotecontrol.js.map
