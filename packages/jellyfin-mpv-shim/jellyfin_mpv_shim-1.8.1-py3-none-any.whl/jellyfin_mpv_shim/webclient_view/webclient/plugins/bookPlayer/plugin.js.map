{"version":3,"sources":["plugins/bookPlayer/plugin.js"],"names":["define","_exports","_connectionManager","_loading","_keyboardnavigation","_dialogHelper","_dom","_events","_style","_materialIcons","_paperIconButtonLight","_tableOfContents","_interopRequireDefault","obj","__esModule","default","asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","info","value","error","done","Promise","then","_asyncToGenerator","fn","self","this","args","arguments","apply","err","undefined","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","BookPlayer","_classCallCheck","instance","Constructor","TypeError","name","type","id","priority","onDialogClosed","bind","openTableOfContents","onWindowKeyUp","_createClass","protoProps","staticProps","prototype","play","options","_progress","_loaded","loading","show","elem","createMediaElement","setCurrentSrc","stop","unbindEvents","_mediaElement","tocElement","_tocElement","rendition","_rendition","dialogHelper","close","destroy","hide","_cancellationToken","shouldCancel","currentItem","_currentItem","currentTime","duration","getBufferedRanges","start","end","volume","isMuted","paused","seekable","e","keyboardnavigation","getKeyName","book","package","metadata","direction","prev","next","onTouchStart","touches","clientX","dom","getWindowSize","innerWidth","bindMediaElementEvents","addEventListener","once","querySelector","bindEvents","document","on","unbindMediaElementEvents","removeEventListener","off","TableOfContents","getElementById","createDialog","exitAnimationDuration","size","autoFocus","scrollY","exitAnimation","removeOnClose","innerHTML","html","open","_this","item","items","streamInfo","started","ended","mediaSource","Id","serverId","ServerId","apiClient","connectionManager","getApiClient","require","epubjs","downloadHref","getItemDownloadUrl","openAs","renderTo","width","height","_currentSrc","cancellationToken","display","epubElem","style","locations","generate","regeneratorRuntime","mark","_callee","percentageTicks","resumeLocation","wrap","_callee$","_context","abrupt","startPositionTicks","cfiFromPercentage","percentageFromCfi","cfi","events","trigger","console","canPlayMediaType","mediaType","toLowerCase","canPlayItem","Path","endsWith","_default"],"mappings":"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","file":"plugin.js","sourcesContent":["import connectionManager from 'connectionManager';\nimport loading from 'loading';\nimport keyboardnavigation from 'keyboardnavigation';\nimport dialogHelper from 'dialogHelper';\nimport dom from 'dom';\nimport events from 'events';\nimport 'css!./style';\nimport 'material-icons';\nimport 'paper-icon-button-light';\n\nimport TableOfContents from './tableOfContents';\n\nexport class BookPlayer {\n    constructor() {\n        this.name = 'Book Player';\n        this.type = 'mediaplayer';\n        this.id = 'bookplayer';\n        this.priority = 1;\n\n        this.onDialogClosed = this.onDialogClosed.bind(this);\n        this.openTableOfContents = this.openTableOfContents.bind(this);\n        this.onWindowKeyUp = this.onWindowKeyUp.bind(this);\n    }\n\n    play(options) {\n        this._progress = 0;\n        this._loaded = false;\n\n        loading.show();\n        let elem = this.createMediaElement();\n        return this.setCurrentSrc(elem, options);\n    }\n\n    stop() {\n        this.unbindEvents();\n\n        let elem = this._mediaElement;\n        let tocElement = this._tocElement;\n        let rendition = this._rendition;\n\n        if (elem) {\n            dialogHelper.close(elem);\n            this._mediaElement = null;\n        }\n\n        if (tocElement) {\n            tocElement.destroy();\n            this._tocElement = null;\n        }\n\n        if (rendition) {\n            rendition.destroy();\n        }\n\n        // Hide loader in case player was not fully loaded yet\n        loading.hide();\n        this._cancellationToken.shouldCancel = true;\n    }\n\n    currentItem() {\n        return this._currentItem;\n    }\n\n    currentTime() {\n        return this._progress * 1000;\n    }\n\n    duration() {\n        return 1000;\n    }\n\n    getBufferedRanges() {\n        return [{\n            start: 0,\n            end: 10000000\n        }];\n    }\n\n    volume() {\n        return 100;\n    }\n\n    isMuted() {\n        return false;\n    }\n\n    paused() {\n        return false;\n    }\n\n    seekable() {\n        return true;\n    }\n\n    onWindowKeyUp(e) {\n        let key = keyboardnavigation.getKeyName(e);\n\n        // TODO: depending on the event this can be the document or the rendition itself\n        let rendition = this._rendition || this;\n        let book = rendition.book;\n\n        if (this._loaded === false) return;\n        switch (key) {\n            case 'l':\n            case 'ArrowRight':\n            case 'Right':\n                book.package.metadata.direction === 'rtl' ? rendition.prev() : rendition.next();\n                break;\n            case 'j':\n            case 'ArrowLeft':\n            case 'Left':\n                book.package.metadata.direction === 'rtl' ? rendition.next() : rendition.prev();\n                break;\n            case 'Escape':\n                if (this._tocElement) {\n                    // Close table of contents on ESC if it is open\n                    this._tocElement.destroy();\n                } else {\n                    // Otherwise stop the entire book player\n                    this.stop();\n                }\n                break;\n        }\n    }\n\n    onTouchStart(e) {\n        // TODO: depending on the event this can be the document or the rendition itself\n        let rendition = this._rendition || this;\n        let book = rendition.book;\n\n        // check that the event is from the book or the document\n        if (!book || this._loaded === false) return;\n\n        // epubjs stores pages off the screen or something for preloading\n        // get the modulus of the touch event to account for the increased width\n        if (!e.touches || e.touches.length === 0) return;\n        let touch = e.touches[0].clientX % dom.getWindowSize().innerWidth;\n        if (touch < dom.getWindowSize().innerWidth / 2) {\n            book.package.metadata.direction === 'rtl' ? rendition.next() : rendition.prev();\n        } else {\n            book.package.metadata.direction === 'rtl' ? rendition.prev() : rendition.next();\n        }\n    }\n\n    onDialogClosed() {\n        this.stop();\n    }\n\n    bindMediaElementEvents() {\n        let elem = this._mediaElement;\n\n        elem.addEventListener('close', this.onDialogClosed, {once: true});\n        elem.querySelector('.btnBookplayerExit').addEventListener('click', this.onDialogClosed, {once: true});\n        elem.querySelector('.btnBookplayerToc').addEventListener('click', this.openTableOfContents);\n    }\n\n    bindEvents() {\n        this.bindMediaElementEvents();\n\n        document.addEventListener('keyup', this.onWindowKeyUp);\n        document.addEventListener('touchstart', this.onTouchStart);\n\n        // FIXME: I don't really get why document keyup event is not triggered when epub is in focus\n        this._rendition.on('keyup', this.onWindowKeyUp);\n        this._rendition.on('touchstart', this.onTouchStart);\n    }\n\n    unbindMediaElementEvents() {\n        let elem = this._mediaElement;\n\n        elem.removeEventListener('close', this.onDialogClosed);\n        elem.querySelector('.btnBookplayerExit').removeEventListener('click', this.onDialogClosed);\n        elem.querySelector('.btnBookplayerToc').removeEventListener('click', this.openTableOfContents);\n    }\n\n    unbindEvents() {\n        if (this._mediaElement) {\n            this.unbindMediaElementEvents();\n        }\n\n        document.removeEventListener('keyup', this.onWindowKeyUp);\n        document.removeEventListener('touchstart', this.onTouchStart);\n\n        if (this._rendition) {\n            this._rendition.off('keyup', this.onWindowKeyUp);\n            this._rendition.off('touchstart', this.onTouchStart);\n        }\n    }\n\n    openTableOfContents() {\n        if (this._loaded) {\n            this._tocElement = new TableOfContents(this);\n        }\n    }\n\n    createMediaElement() {\n        let elem = this._mediaElement;\n        if (elem) {\n            return elem;\n        }\n\n        elem = document.getElementById('bookPlayer');\n        if (!elem) {\n            elem = dialogHelper.createDialog({\n                exitAnimationDuration: 400,\n                size: 'fullscreen',\n                autoFocus: false,\n                scrollY: false,\n                exitAnimation: 'fadeout',\n                removeOnClose: true\n            });\n\n            elem.id = 'bookPlayer';\n\n            let html = '';\n            html += '<div class=\"topRightActionButtons\">';\n            html += '<button is=\"paper-icon-button-light\" class=\"autoSize bookplayerButton btnBookplayerExit hide-mouse-idle-tv\" tabindex=\"-1\"><i class=\"material-icons bookplayerButtonIcon close\"></i></button>';\n            html += '</div>';\n            html += '<div class=\"topLeftActionButtons\">';\n            html += '<button is=\"paper-icon-button-light\" class=\"autoSize bookplayerButton btnBookplayerToc hide-mouse-idle-tv\" tabindex=\"-1\"><i class=\"material-icons bookplayerButtonIcon toc\"></i></button>';\n            html += '</div>';\n\n            elem.innerHTML = html;\n\n            dialogHelper.open(elem);\n        }\n\n        this._mediaElement = elem;\n\n        return elem;\n    }\n\n    setCurrentSrc(elem, options) {\n        let item = options.items[0];\n        this._currentItem = item;\n        this.streamInfo = {\n            started: true,\n            ended: false,\n            mediaSource: {\n                Id: item.Id\n            }\n        };\n\n        let serverId = item.ServerId;\n        let apiClient = connectionManager.getApiClient(serverId);\n\n        return new Promise((resolve, reject) => {\n            require(['epubjs'], (epubjs) => {\n                let downloadHref = apiClient.getItemDownloadUrl(item.Id);\n                let book = epubjs.default(downloadHref, {openAs: 'epub'});\n                let rendition = book.renderTo(elem, {width: '100%', height: '97%'});\n\n                this._currentSrc = downloadHref;\n                this._rendition = rendition;\n                let cancellationToken = {\n                    shouldCancel: false\n                };\n\n                this._cancellationToken = cancellationToken;\n\n                return rendition.display().then(() => {\n                    let epubElem = document.querySelector('.epub-container');\n                    epubElem.style.display = 'none';\n\n                    this.bindEvents();\n\n                    return this._rendition.book.locations.generate(1024).then(async () => {\n                        if (cancellationToken.shouldCancel) {\n                            return reject();\n                        }\n\n                        const percentageTicks = options.startPositionTicks / 10000000;\n                        if (percentageTicks !== 0.0) {\n                            const resumeLocation = book.locations.cfiFromPercentage(percentageTicks);\n                            await rendition.display(resumeLocation);\n                        }\n\n                        this._loaded = true;\n                        epubElem.style.display = 'block';\n                        rendition.on('relocated', (locations) => {\n                            this._progress = book.locations.percentageFromCfi(locations.start.cfi);\n                            events.trigger(this, 'timeupdate');\n                        });\n\n                        loading.hide();\n\n                        return resolve();\n                    });\n                }, () => {\n                    console.error('failed to display epub');\n                    return reject();\n                });\n            });\n        });\n    }\n\n    canPlayMediaType(mediaType) {\n        return (mediaType || '').toLowerCase() === 'book';\n    }\n\n    canPlayItem(item) {\n        if (item.Path && (item.Path.endsWith('epub'))) {\n            return true;\n        }\n\n        return false;\n    }\n}\n\nexport default BookPlayer;\n"]}