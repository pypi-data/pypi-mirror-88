"use strict";define(["events","playbackManager","pluginManager","inputManager","connectionManager","userSettings"],(function(events,playbackManager,pluginManager,inputManager,connectionManager,userSettings){var lastFunctionalEvent=0;function getFunctionalEventIdleTime(){return(new Date).getTime()-lastFunctionalEvent}return events.on(playbackManager,"playbackstop",(function(e,stopInfo){var state=stopInfo.state;state.NowPlayingItem&&"Video"==state.NowPlayingItem.MediaType&&(lastFunctionalEvent=(new Date).getTime())})),new function ScreenSaverManager(){var activeScreenSaver,self=this;function hide(){activeScreenSaver&&(console.debug("Hiding screensaver"),activeScreenSaver.hide(),activeScreenSaver=null),window.removeEventListener("click",hide,!0),window.removeEventListener("mousemove",hide,!0),window.removeEventListener("keydown",hide,!0)}self.isShowing=function(){return null!=activeScreenSaver},self.show=function(){var isLoggedIn,apiClient=connectionManager.currentApiClient();apiClient&&apiClient.isLoggedIn()&&(isLoggedIn=!0);var screensaver=function getScreensaverPlugin(isLoggedIn){var option;try{option=userSettings.get("screensaver",!1)}catch(err){option=isLoggedIn?"backdropscreensaver":"logoscreensaver"}for(var plugins=pluginManager.ofType("screensaver"),i=0,length=plugins.length;i<length;i++){var plugin=plugins[i];if(plugin.id===option)return plugin}return null}(isLoggedIn);screensaver&&function showScreenSaver(screensaver){if(activeScreenSaver)throw new Error("An existing screensaver is already active.");console.debug("Showing screensaver "+screensaver.name),screensaver.show(),activeScreenSaver=screensaver,!1!==screensaver.hideOnClick&&window.addEventListener("click",hide,!0),!1!==screensaver.hideOnMouse&&window.addEventListener("mousemove",hide,!0),!1!==screensaver.hideOnKey&&window.addEventListener("keydown",hide,!0)}(screensaver)},self.hide=function(){hide()},setInterval((function onInterval(){self.isShowing()||inputManager.idleTime()<18e4||getFunctionalEventIdleTime<18e4||playbackManager.isPlayingVideo()||self.show()}),1e4)}}));
//# sourceMappingURL=screensavermanager.js.map
