{"version":3,"sources":["scripts/serverNotifications.js"],"names":["define","connectionManager","playbackManager","syncPlayManager","events","inputManager","focusManager","appRouter","serverNotifications","notifyApp","notify","processGeneralCommand","cmd","apiClient","console","debug","Name","trigger","playTrailers","itemId","getItem","getCurrentUserId","then","item","Arguments","ItemId","setRepeatMode","RepeatMode","setQueueShuffleMode","ShuffleMode","setVolume","Volume","setAudioStreamIndex","parseInt","Index","setSubtitleStreamIndex","displayContent","isPlayingLocally","showItem","serverId","displayMessage","args","TimeoutMs","require","toast","title","Header","text","Text","alert","sendText","String","onMessageReceived","e","msg","MessageType","this","serverInfo","Id","Data","PlayCommand","queueNext","ids","ItemIds","queue","play","startPositionTicks","StartPositionTicks","mediaSourceId","MediaSourceId","audioStreamIndex","AudioStreamIndex","subtitleStreamIndex","SubtitleStreamIndex","startIndex","StartIndex","Command","seek","SeekPositionTicks","UserId","i","length","UserDataList","processCommand","processGroupUpdate","bindEvents","off","on","getApiClients","forEach","newApiClient"],"mappings":"AAAA,aAAAA,OAAO,CAAC,oBAAqB,kBAAmB,kBAAmB,SAAU,eAAgB,eAAgB,cAAc,SAAUC,kBAAmBC,gBAAiBC,gBAAiBC,OAAQC,aAAcC,aAAcC,WAG1N,IAAIC,oBAAsB,GAE1B,SAASC,YACLJ,aAAaK,SA4BjB,SAASC,sBAAsBC,IAAKC,WAEhC,OADAC,QAAQC,MAAM,qBAAuBH,IAAII,MACjCJ,IAAII,MACR,IAAK,SAED,YADAX,aAAaY,QAAQ,UAEzB,IAAK,OAED,YADAZ,aAAaY,QAAQ,QAEzB,IAAK,SAED,YADAZ,aAAaY,QAAQ,MAEzB,IAAK,WAED,YADAZ,aAAaY,QAAQ,QAEzB,IAAK,WAED,YADAZ,aAAaY,QAAQ,QAEzB,IAAK,YAED,YADAZ,aAAaY,QAAQ,SAEzB,IAAK,SAED,YADAZ,aAAaY,QAAQ,UAEzB,IAAK,WAED,YADAZ,aAAaY,QAAQ,YAEzB,IAAK,gBAjCb,SAASC,aAAaL,UAAWM,QAC7BN,UAAUO,QAAQP,UAAUQ,mBAAoBF,QAAQG,MAAK,SAAUC,MACnErB,gBAAgBgB,aAAaK,SAgCzBL,CAAaL,UAAWD,IAAIY,UAAUC,QACtC,MACJ,IAAK,gBACDvB,gBAAgBwB,cAAcd,IAAIY,UAAUG,YAC5C,MACJ,IAAK,kBACDzB,gBAAgB0B,oBAAoBhB,IAAIY,UAAUK,aAClD,MACJ,IAAK,WAED,YADAxB,aAAaY,QAAQ,YAEzB,IAAK,aAED,YADAZ,aAAaY,QAAQ,cAEzB,IAAK,YAED,YADAZ,aAAaY,QAAQ,aAEzB,IAAK,cAED,YADAZ,aAAaY,QAAQ,eAEzB,IAAK,OAED,YADAZ,aAAaY,QAAQ,QAEzB,IAAK,SAED,YADAZ,aAAaY,QAAQ,UAEzB,IAAK,aAED,YADAZ,aAAaY,QAAQ,cAEzB,IAAK,YACDR,YACAP,gBAAgB4B,UAAUlB,IAAIY,UAAUO,QACxC,MACJ,IAAK,sBACDtB,YACAP,gBAAgB8B,oBAAoBC,SAASrB,IAAIY,UAAUU,QAC3D,MACJ,IAAK,yBACDzB,YACAP,gBAAgBiC,uBAAuBF,SAASrB,IAAIY,UAAUU,QAC9D,MACJ,IAAK,mBAED,YADA7B,aAAaY,QAAQ,oBAEzB,IAAK,SAED,YADAZ,aAAaY,QAAQ,QAEzB,IAAK,eAED,YADAZ,aAAaY,QAAQ,YAEzB,IAAK,kBA1Fb,SAASmB,eAAexB,IAAKC,WACpBX,gBAAgBmC,iBAAiB,CAAC,QAAS,UAC5C9B,UAAU+B,SAAS1B,IAAIY,UAAUC,OAAQZ,UAAU0B,YAyF/CH,CAAexB,IAAKC,WACpB,MACJ,IAAK,aAED,YADAR,aAAaY,QAAQ,UAEzB,IAAK,kBA7Gb,SAASuB,eAAe5B,KACpB,IAAI6B,KAAO7B,IAAIY,UACXiB,KAAKC,UACLC,QAAQ,CAAC,UAAU,SAAUC,OACzBA,MAAM,CAAEC,MAAOJ,KAAKK,OAAQC,KAAMN,KAAKO,UAG3CL,QAAQ,CAAC,UAAU,SAAUM,OACzBA,MAAM,CAAEJ,MAAOJ,KAAKK,OAAQC,KAAMN,KAAKO,UAsGvCR,CAAe5B,KACf,MACJ,IAAK,YAGL,IAAK,oBAGL,IAAK,iBAGL,IAAK,UAED,MACJ,IAAK,aAEDN,aAAa4C,SAAStC,IAAIY,UAAU2B,QACpC,MACJ,QACIrC,QAAQC,MAAM,6CAA+CH,IAAII,MAIzEP,YAGJ,SAAS2C,kBAAkBC,EAAGC,KAE1B,GAAwB,SAApBA,IAAIC,YAAwB,CAC5B9C,YACA,IAAI8B,SAHQiB,KAGaC,aAAaC,GACT,aAAzBJ,IAAIK,KAAKC,YACT1D,gBAAgB2D,UAAU,CAAEC,IAAKR,IAAIK,KAAKI,QAASxB,SAAUA,WAC7B,aAAzBe,IAAIK,KAAKC,YAChB1D,gBAAgB8D,MAAM,CAAEF,IAAKR,IAAIK,KAAKI,QAASxB,SAAUA,WAEzDrC,gBAAgB+D,KAAK,CACjBH,IAAKR,IAAIK,KAAKI,QACdG,mBAAoBZ,IAAIK,KAAKQ,mBAC7BC,cAAed,IAAIK,KAAKU,cACxBC,iBAAkBhB,IAAIK,KAAKY,iBAC3BC,oBAAqBlB,IAAIK,KAAKc,oBAC9BC,WAAYpB,IAAIK,KAAKgB,WACrBpC,SAAUA,gBAGf,GAAwB,cAApBe,IAAIC,YACc,SAArBD,IAAIK,KAAKiB,QACTvE,aAAaY,QAAQ,QACO,UAArBqC,IAAIK,KAAKiB,QAChBvE,aAAaY,QAAQ,SACO,YAArBqC,IAAIK,KAAKiB,QAChBvE,aAAaY,QAAQ,QACO,cAArBqC,IAAIK,KAAKiB,QAChBvE,aAAaY,QAAQ,aACO,SAArBqC,IAAIK,KAAKiB,QAChB1E,gBAAgB2E,KAAKvB,IAAIK,KAAKmB,mBACF,cAArBxB,IAAIK,KAAKiB,QAChBvE,aAAaY,QAAQ,QACO,kBAArBqC,IAAIK,KAAKiB,QAChBvE,aAAaY,QAAQ,YAErBR,iBAED,GAAwB,mBAApB6C,IAAIC,YAAkC,CAE7C5C,sBADU2C,IAAIK,KAtCFH,WAwCT,GAAwB,oBAApBF,IAAIC,aACX,GAAID,IAAIK,KAAKoB,SAzCDvB,KAyCsBnC,mBAC9B,IAAK,IAAI2D,EAAI,EAAGC,OAAS3B,IAAIK,KAAKuB,aAAaD,OAAQD,EAAIC,OAAQD,IAC/D5E,OAAOa,QAAQT,oBAAqB,kBAAmB,CA3CnDgD,KA2C+DF,IAAIK,KAAKuB,aAAaF,SAGtE,oBAApB1B,IAAIC,YACXpD,gBAAgBgF,eAAe7B,IAAIK,KA/CvBH,MAgDe,wBAApBF,IAAIC,YACXpD,gBAAgBiF,mBAAmB9B,IAAIK,KAjD3BH,MAmDZpD,OAAOa,QAAQT,oBAAqB8C,IAAIC,YAAa,CAnDzCC,KAmDqDF,IAAIK,OAG7E,SAAS0B,WAAWxE,WAChBT,OAAOkF,IAAIzE,UAAW,UAAWuC,mBACjChD,OAAOmF,GAAG1E,UAAW,UAAWuC,mBAOpC,OAJAnD,kBAAkBuF,gBAAgBC,QAAQJ,YAC1CjF,OAAOmF,GAAGtF,kBAAmB,oBAAoB,SAAUoD,EAAGqC,cAC1DL,WAAWK,iBAERlF","file":"serverNotifications.js","sourcesContent":["define(['connectionManager', 'playbackManager', 'syncPlayManager', 'events', 'inputManager', 'focusManager', 'appRouter'], function (connectionManager, playbackManager, syncPlayManager, events, inputManager, focusManager, appRouter) {\n    'use strict';\n\n    var serverNotifications = {};\n\n    function notifyApp() {\n        inputManager.notify();\n    }\n\n    function displayMessage(cmd) {\n        var args = cmd.Arguments;\n        if (args.TimeoutMs) {\n            require(['toast'], function (toast) {\n                toast({ title: args.Header, text: args.Text });\n            });\n        } else {\n            require(['alert'], function (alert) {\n                alert({ title: args.Header, text: args.Text });\n            });\n        }\n    }\n\n    function displayContent(cmd, apiClient) {\n        if (!playbackManager.isPlayingLocally(['Video', 'Book'])) {\n            appRouter.showItem(cmd.Arguments.ItemId, apiClient.serverId());\n        }\n    }\n\n    function playTrailers(apiClient, itemId) {\n        apiClient.getItem(apiClient.getCurrentUserId(), itemId).then(function (item) {\n            playbackManager.playTrailers(item);\n        });\n    }\n\n    function processGeneralCommand(cmd, apiClient) {\n        console.debug('Received command: ' + cmd.Name);\n        switch (cmd.Name) {\n            case 'Select':\n                inputManager.trigger('select');\n                return;\n            case 'Back':\n                inputManager.trigger('back');\n                return;\n            case 'MoveUp':\n                inputManager.trigger('up');\n                return;\n            case 'MoveDown':\n                inputManager.trigger('down');\n                return;\n            case 'MoveLeft':\n                inputManager.trigger('left');\n                return;\n            case 'MoveRight':\n                inputManager.trigger('right');\n                return;\n            case 'PageUp':\n                inputManager.trigger('pageup');\n                return;\n            case 'PageDown':\n                inputManager.trigger('pagedown');\n                return;\n            case 'PlayTrailers':\n                playTrailers(apiClient, cmd.Arguments.ItemId);\n                break;\n            case 'SetRepeatMode':\n                playbackManager.setRepeatMode(cmd.Arguments.RepeatMode);\n                break;\n            case 'SetShuffleQueue':\n                playbackManager.setQueueShuffleMode(cmd.Arguments.ShuffleMode);\n                break;\n            case 'VolumeUp':\n                inputManager.trigger('volumeup');\n                return;\n            case 'VolumeDown':\n                inputManager.trigger('volumedown');\n                return;\n            case 'ChannelUp':\n                inputManager.trigger('channelup');\n                return;\n            case 'ChannelDown':\n                inputManager.trigger('channeldown');\n                return;\n            case 'Mute':\n                inputManager.trigger('mute');\n                return;\n            case 'Unmute':\n                inputManager.trigger('unmute');\n                return;\n            case 'ToggleMute':\n                inputManager.trigger('togglemute');\n                return;\n            case 'SetVolume':\n                notifyApp();\n                playbackManager.setVolume(cmd.Arguments.Volume);\n                break;\n            case 'SetAudioStreamIndex':\n                notifyApp();\n                playbackManager.setAudioStreamIndex(parseInt(cmd.Arguments.Index));\n                break;\n            case 'SetSubtitleStreamIndex':\n                notifyApp();\n                playbackManager.setSubtitleStreamIndex(parseInt(cmd.Arguments.Index));\n                break;\n            case 'ToggleFullscreen':\n                inputManager.trigger('togglefullscreen');\n                return;\n            case 'GoHome':\n                inputManager.trigger('home');\n                return;\n            case 'GoToSettings':\n                inputManager.trigger('settings');\n                return;\n            case 'DisplayContent':\n                displayContent(cmd, apiClient);\n                break;\n            case 'GoToSearch':\n                inputManager.trigger('search');\n                return;\n            case 'DisplayMessage':\n                displayMessage(cmd);\n                break;\n            case 'ToggleOsd':\n                // todo\n                break;\n            case 'ToggleContextMenu':\n                // todo\n                break;\n            case 'TakeScreenShot':\n                // todo\n                break;\n            case 'SendKey':\n                // todo\n                break;\n            case 'SendString':\n                // todo\n                focusManager.sendText(cmd.Arguments.String);\n                break;\n            default:\n                console.debug('processGeneralCommand does not recognize: ' + cmd.Name);\n                break;\n        }\n\n        notifyApp();\n    }\n\n    function onMessageReceived(e, msg) {\n        var apiClient = this;\n        if (msg.MessageType === 'Play') {\n            notifyApp();\n            var serverId = apiClient.serverInfo().Id;\n            if (msg.Data.PlayCommand === 'PlayNext') {\n                playbackManager.queueNext({ ids: msg.Data.ItemIds, serverId: serverId });\n            } else if (msg.Data.PlayCommand === 'PlayLast') {\n                playbackManager.queue({ ids: msg.Data.ItemIds, serverId: serverId });\n            } else {\n                playbackManager.play({\n                    ids: msg.Data.ItemIds,\n                    startPositionTicks: msg.Data.StartPositionTicks,\n                    mediaSourceId: msg.Data.MediaSourceId,\n                    audioStreamIndex: msg.Data.AudioStreamIndex,\n                    subtitleStreamIndex: msg.Data.SubtitleStreamIndex,\n                    startIndex: msg.Data.StartIndex,\n                    serverId: serverId\n                });\n            }\n        } else if (msg.MessageType === 'Playstate') {\n            if (msg.Data.Command === 'Stop') {\n                inputManager.trigger('stop');\n            } else if (msg.Data.Command === 'Pause') {\n                inputManager.trigger('pause');\n            } else if (msg.Data.Command === 'Unpause') {\n                inputManager.trigger('play');\n            } else if (msg.Data.Command === 'PlayPause') {\n                inputManager.trigger('playpause');\n            } else if (msg.Data.Command === 'Seek') {\n                playbackManager.seek(msg.Data.SeekPositionTicks);\n            } else if (msg.Data.Command === 'NextTrack') {\n                inputManager.trigger('next');\n            } else if (msg.Data.Command === 'PreviousTrack') {\n                inputManager.trigger('previous');\n            } else {\n                notifyApp();\n            }\n        } else if (msg.MessageType === 'GeneralCommand') {\n            var cmd = msg.Data;\n            processGeneralCommand(cmd, apiClient);\n        } else if (msg.MessageType === 'UserDataChanged') {\n            if (msg.Data.UserId === apiClient.getCurrentUserId()) {\n                for (var i = 0, length = msg.Data.UserDataList.length; i < length; i++) {\n                    events.trigger(serverNotifications, 'UserDataChanged', [apiClient, msg.Data.UserDataList[i]]);\n                }\n            }\n        } else if (msg.MessageType === 'SyncPlayCommand') {\n            syncPlayManager.processCommand(msg.Data, apiClient);\n        } else if (msg.MessageType === 'SyncPlayGroupUpdate') {\n            syncPlayManager.processGroupUpdate(msg.Data, apiClient);\n        } else {\n            events.trigger(serverNotifications, msg.MessageType, [apiClient, msg.Data]);\n        }\n    }\n    function bindEvents(apiClient) {\n        events.off(apiClient, 'message', onMessageReceived);\n        events.on(apiClient, 'message', onMessageReceived);\n    }\n\n    connectionManager.getApiClients().forEach(bindEvents);\n    events.on(connectionManager, 'apiclientcreated', function (e, newApiClient) {\n        bindEvents(newApiClient);\n    });\n    return serverNotifications;\n});\n"]}