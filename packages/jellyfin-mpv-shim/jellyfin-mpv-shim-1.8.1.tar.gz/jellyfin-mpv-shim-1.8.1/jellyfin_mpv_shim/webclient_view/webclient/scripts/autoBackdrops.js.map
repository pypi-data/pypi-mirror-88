{"version":3,"sources":["scripts/autoBackdrops.js"],"names":["define","backdrop","userSettings","libraryMenu","cache","showBackdrop","type","parentId","apiClient","window","ApiClient","getBackdropItemIds","userId","types","key","concat","data","console","debug","JSON","parse","Promise","resolve","options","SortBy","Limit","Recursive","IncludeItemTypes","ImageTypes","ParentId","EnableTotalRecordCount","getItems","getCurrentUserId","then","result","images","Items","map","i","Id","tag","BackdropImageTags","ServerId","stringify","length","setBackdrops","clear","pageClassOn","this","classList","contains","enabled","enableBackdrops","remove","getAttribute","getTopParentId"],"mappings":"AAAA,aAAAA,OAAO,CAAC,WAAY,eAAgB,gBAAgB,SAAUC,SAAUC,aAAcC,aAGlF,IAAIC,MAAQ,GAsCZ,SAASC,aAAaC,KAAMC,UACxB,IAAIC,UAAYC,OAAOC,UAEnBF,WAnCR,SAASG,mBAAmBH,UAAWI,OAAQC,MAAON,UAClD,IAAIO,IAAG,cAAAC,OAAiBH,QAAUC,OAAS,KAAON,UAAY,KAC1DS,KAAOZ,MAAMU,KAEjB,GAAIE,KAGA,OAFAC,QAAQC,MAAR,yCAAAH,OAAuDD,MACvDE,KAAOG,KAAKC,MAAMJ,MACXK,QAAQC,QAAQN,MAG3B,IAAIO,QAAU,CACVC,OAAQ,2BACRC,MAAO,GACPC,WAAW,EACXC,iBAAkBd,MAClBe,WAAY,WACZC,SAAUtB,SACVuB,wBAAwB,GAE5B,OAAOtB,UAAUuB,SAASvB,UAAUwB,mBAAoBT,SAASU,MAAK,SAAUC,QAC5E,IAAIC,OAASD,OAAOE,MAAMC,KAAI,SAAUC,GACpC,MAAO,CACHC,GAAID,EAAEC,GACNC,IAAKF,EAAEG,kBAAkB,GACzBC,SAAUJ,EAAEI,aAIpB,OADAtC,MAAMU,KAAOK,KAAKwB,UAAUR,QACrBA,UAQPxB,CAAmBH,UAAWA,UAAUwB,mBAAoB1B,KAAMC,UAAU0B,MAAK,SAAUE,QACnFA,OAAOS,OACP3C,SAAS4C,aAAaV,OAAOE,KAAI,SAAUC,GAEvC,OADAA,EAAEG,kBAAoB,CAACH,EAAEE,KAClBF,MAGXrC,SAAS6C,WAMzBC,YAAY,WAAY,QAAQ,WACjBC,KAEDC,UAAUC,SAAS,sBAFlBF,KAGEC,UAAUC,SAAS,iBAzDpC,SAASC,UACL,OAAOjD,aAAakD,kBAyDRD,IAJDH,KASMC,UAAUI,OAAO,gBACtBpD,SAAS6C,SAHTzC,aAPD2C,KAKiBM,aAAa,qBAL9BN,KAMqBC,UAAUC,SAAS,sBAAwB,GAAK/C,YAAYoD,kBAOpFtD,SAAS6C","file":"autoBackdrops.js","sourcesContent":["define(['backdrop', 'userSettings', 'libraryMenu'], function (backdrop, userSettings, libraryMenu) {\n    'use strict';\n\n    var cache = {};\n\n    function enabled() {\n        return userSettings.enableBackdrops();\n    }\n\n    function getBackdropItemIds(apiClient, userId, types, parentId) {\n        var key = `backdrops2_${userId + (types || '') + (parentId || '')}`;\n        var data = cache[key];\n\n        if (data) {\n            console.debug(`Found backdrop id list in cache. Key: ${key}`);\n            data = JSON.parse(data);\n            return Promise.resolve(data);\n        }\n\n        var options = {\n            SortBy: 'IsFavoriteOrLiked,Random',\n            Limit: 20,\n            Recursive: true,\n            IncludeItemTypes: types,\n            ImageTypes: 'Backdrop',\n            ParentId: parentId,\n            EnableTotalRecordCount: false\n        };\n        return apiClient.getItems(apiClient.getCurrentUserId(), options).then(function (result) {\n            var images = result.Items.map(function (i) {\n                return {\n                    Id: i.Id,\n                    tag: i.BackdropImageTags[0],\n                    ServerId: i.ServerId\n                };\n            });\n            cache[key] = JSON.stringify(images);\n            return images;\n        });\n    }\n\n    function showBackdrop(type, parentId) {\n        var apiClient = window.ApiClient;\n\n        if (apiClient) {\n            getBackdropItemIds(apiClient, apiClient.getCurrentUserId(), type, parentId).then(function (images) {\n                if (images.length) {\n                    backdrop.setBackdrops(images.map(function (i) {\n                        i.BackdropImageTags = [i.tag];\n                        return i;\n                    }));\n                } else {\n                    backdrop.clear();\n                }\n            });\n        }\n    }\n\n    pageClassOn('pageshow', 'page', function () {\n        var page = this;\n\n        if (!page.classList.contains('selfBackdropPage')) {\n            if (page.classList.contains('backdropPage')) {\n                if (enabled()) {\n                    var type = page.getAttribute('data-backdroptype');\n                    var parentId = page.classList.contains('globalBackdropPage') ? '' : libraryMenu.getTopParentId();\n                    showBackdrop(type, parentId);\n                } else {\n                    page.classList.remove('backdropPage');\n                    backdrop.clear();\n                }\n            } else {\n                backdrop.clear();\n            }\n        }\n    });\n});\n"]}