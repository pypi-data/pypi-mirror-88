"use strict";require(["apphost"],(function(appHost){var _leftThumbstickUpPressed=!1,_leftThumbstickDownPressed=!1,_leftThumbstickLeftPressed=!1,_leftThumbstickRightPressed=!1,_dPadUpPressed=!1,_dPadDownPressed=!1,_dPadLeftPressed=!1,_dPadRightPressed=!1,_gamepadAPressed=!1,_gamepadBPressed=!1,ProcessedButtons=[12,13,14,15,0,1],_ButtonPressedState={getgamepadA:function(){return _gamepadAPressed},setgamepadA:function(newPressedState){raiseKeyEvent(_gamepadAPressed,newPressedState,"GamepadA",0,!1,!0),_gamepadAPressed=newPressedState},getgamepadB:function(){return _gamepadBPressed},setgamepadB:function(newPressedState){raiseKeyEvent(_gamepadBPressed,newPressedState,"GamepadB",27),_gamepadBPressed=newPressedState},getleftThumbstickUp:function(){return _leftThumbstickUpPressed},setleftThumbstickUp:function(newPressedState){raiseKeyEvent(_leftThumbstickUpPressed,newPressedState,"GamepadLeftThumbStickUp",38,!0),_leftThumbstickUpPressed=newPressedState},getleftThumbstickDown:function(){return _leftThumbstickDownPressed},setleftThumbstickDown:function(newPressedState){raiseKeyEvent(_leftThumbstickDownPressed,newPressedState,"GamepadLeftThumbStickDown",40,!0),_leftThumbstickDownPressed=newPressedState},getleftThumbstickLeft:function(){return _leftThumbstickLeftPressed},setleftThumbstickLeft:function(newPressedState){raiseKeyEvent(_leftThumbstickLeftPressed,newPressedState,"GamepadLeftThumbStickLeft",37,!0),_leftThumbstickLeftPressed=newPressedState},getleftThumbstickRight:function(){return _leftThumbstickRightPressed},setleftThumbstickRight:function(newPressedState){raiseKeyEvent(_leftThumbstickRightPressed,newPressedState,"GamepadLeftThumbStickRight",39,!0),_leftThumbstickRightPressed=newPressedState},getdPadUp:function(){return _dPadUpPressed},setdPadUp:function(newPressedState){raiseKeyEvent(_dPadUpPressed,newPressedState,"GamepadDPadUp",38,!0),_dPadUpPressed=newPressedState},getdPadDown:function(){return _dPadDownPressed},setdPadDown:function(newPressedState){raiseKeyEvent(_dPadDownPressed,newPressedState,"GamepadDPadDown",40,!0),_dPadDownPressed=newPressedState},getdPadLeft:function(){return _dPadLeftPressed},setdPadLeft:function(newPressedState){raiseKeyEvent(_dPadLeftPressed,newPressedState,"GamepadDPadLeft",37,!0),_dPadLeftPressed=newPressedState},getdPadRight:function(){return _dPadRightPressed},setdPadRight:function(newPressedState){raiseKeyEvent(_dPadRightPressed,newPressedState,"GamepadDPadRight",39,!0),_dPadRightPressed=newPressedState}},times={};function resetThrottle(key){times[key]=(new Date).getTime()}var inputLoopTimer,isElectron=-1!==navigator.userAgent.toLowerCase().indexOf("electron");function allowInput(){return!(!isElectron&&document.hidden)&&"Minimized"!==appHost.getWindowState()}function raiseEvent(name,key,keyCode){if(allowInput()){var event=document.createEvent("Event");event.initEvent(name,!0,!0),event.key=key,event.keyCode=keyCode,(document.activeElement||document.body).dispatchEvent(event)}}function raiseKeyEvent(oldPressedState,newPressedState,key,keyCode,enableRepeatKeyDown,clickonKeyUp){if(!0===newPressedState){var fire=!1;!1===oldPressedState?(fire=!0,resetThrottle(key)):enableRepeatKeyDown&&(fire=function throttle(key){var time=times[key]||0;return(new Date).getTime()-time>=200}(key)),fire&&keyCode&&raiseEvent("keydown",key,keyCode)}else!1===newPressedState&&!0===oldPressedState&&(resetThrottle(key),keyCode&&raiseEvent("keyup",key,keyCode),clickonKeyUp&&function clickElement(elem){allowInput()&&elem.click()}(document.activeElement||window))}function runInputLoop(){for(var gamepads=navigator.getGamepads(),i=0,len=gamepads.length;i<len;i++){var gamepad=gamepads[i];if(gamepad){var axes=gamepad.axes,leftStickX=axes[0],leftStickY=axes[1];leftStickX>.75?_ButtonPressedState.setleftThumbstickRight(!0):leftStickX<-.75?_ButtonPressedState.setleftThumbstickLeft(!0):leftStickY<-.75?_ButtonPressedState.setleftThumbstickUp(!0):leftStickY>.75?_ButtonPressedState.setleftThumbstickDown(!0):(_ButtonPressedState.setleftThumbstickLeft(!1),_ButtonPressedState.setleftThumbstickRight(!1),_ButtonPressedState.setleftThumbstickUp(!1),_ButtonPressedState.setleftThumbstickDown(!1));var buttons=gamepad.buttons,j=0;for(len=buttons.length;j<len;j++)if(-1!==ProcessedButtons.indexOf(j))if(buttons[j].pressed)switch(j){case 12:_ButtonPressedState.setdPadUp(!0);break;case 13:_ButtonPressedState.setdPadDown(!0);break;case 14:_ButtonPressedState.setdPadLeft(!0);break;case 15:_ButtonPressedState.setdPadRight(!0);break;case 0:_ButtonPressedState.setgamepadA(!0);break;case 1:_ButtonPressedState.setgamepadB(!0)}else switch(j){case 12:_ButtonPressedState.getdPadUp()&&_ButtonPressedState.setdPadUp(!1);break;case 13:_ButtonPressedState.getdPadDown()&&_ButtonPressedState.setdPadDown(!1);break;case 14:_ButtonPressedState.getdPadLeft()&&_ButtonPressedState.setdPadLeft(!1);break;case 15:_ButtonPressedState.getdPadRight()&&_ButtonPressedState.setdPadRight(!1);break;case 0:_ButtonPressedState.getgamepadA()&&_ButtonPressedState.setgamepadA(!1);break;case 1:_ButtonPressedState.getgamepadB()&&_ButtonPressedState.setgamepadB(!1)}}}inputLoopTimer=requestAnimationFrame(runInputLoop)}function isGamepadConnected(){for(var gamepads=navigator.getGamepads(),i=0,len=gamepads.length;i<len;i++){var gamepad=gamepads[i];if(gamepad&&gamepad.connected)return!0}return!1}function onFocusOrGamepadAttach(e){isGamepadConnected()&&document.hasFocus()&&(console.log("Gamepad connected! Starting input loop"),function startInputLoop(){inputLoopTimer||runInputLoop()}())}function onFocusOrGamepadDetach(e){isGamepadConnected()&&document.hasFocus()?console.log("Gamepad disconnected! There are gamepads still connected."):(console.log("Gamepad disconnected! No other gamepads are connected, stopping input loop"),function stopInputLoop(){cancelAnimationFrame(inputLoopTimer),inputLoopTimer=void 0}())}window.addEventListener("gamepaddisconnected",onFocusOrGamepadDetach),window.addEventListener("gamepadconnected",onFocusOrGamepadAttach),window.addEventListener("blur",onFocusOrGamepadDetach),window.addEventListener("focus",onFocusOrGamepadAttach),onFocusOrGamepadAttach(),window.navigator&&"string"==typeof window.navigator.gamepadInputEmulation&&(window.navigator.gamepadInputEmulation="gamepad")}));
//# sourceMappingURL=gamepadtokey.js.map
