{"version":3,"sources":["scripts/libraryBrowser.js"],"names":["define","userSettings","globalize","libraryBrowser","getSavedQueryKey","modifier","window","location","href","split","loadSavedQueryValues","key","query","values","get","JSON","parse","Object","assign","saveQueryValues","SortBy","SortOrder","set","stringify","saveViewSetting","value","getSavedView","showLayoutMenu","button","currentLayout","views","dispatchEvent","getAttribute","menuItems","map","v","name","translate","id","selected","require","actionsheet","show","items","positionTo","callback","CustomEvent","detail","viewStyle","bubbles","cancelable","$","trigger","getQueryPagingHtml","options","startIndex","limit","totalRecordCount","html","recordsEnd","Math","min","showControls","viewButton","filterButton","sortButton","addLayoutButton","layouts","showSortMenu","dialogHelper","onSortByChange","newValue","this","checked","changed","replace","StartIndex","onSortOrderChange","dlg","createDialog","removeOnClose","modal","entryAnimationDuration","exitAnimationDuration","classList","add","i","length","isChecked","option","radioValue","innerHTML","open","sortBys","querySelectorAll","addEventListener","sortOrders","LibraryBrowser"],"mappings":"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","file":"libraryBrowser.js","sourcesContent":["define(['userSettings', 'globalize'], function (userSettings, globalize) {\n    'use strict';\n\n    var libraryBrowser = {\n        getSavedQueryKey: function (modifier) {\n            return window.location.href.split('#')[0] + (modifier || '');\n        },\n        loadSavedQueryValues: function (key, query) {\n            var values = userSettings.get(key);\n\n            if (values) {\n                values = JSON.parse(values);\n                return Object.assign(query, values);\n            }\n\n            return query;\n        },\n        saveQueryValues: function (key, query) {\n            var values = {};\n\n            if (query.SortBy) {\n                values.SortBy = query.SortBy;\n            }\n\n            if (query.SortOrder) {\n                values.SortOrder = query.SortOrder;\n            }\n\n            userSettings.set(key, JSON.stringify(values));\n        },\n        saveViewSetting: function (key, value) {\n            userSettings.set(key + '-_view', value);\n        },\n        getSavedView: function (key) {\n            return userSettings.get(key + '-_view');\n        },\n        showLayoutMenu: function (button, currentLayout, views) {\n            var dispatchEvent = true;\n\n            if (!views) {\n                dispatchEvent = false;\n                views = button.getAttribute('data-layouts');\n                views = views ? views.split(',') : ['List', 'Poster', 'PosterCard', 'Thumb', 'ThumbCard'];\n            }\n\n            var menuItems = views.map(function (v) {\n                return {\n                    name: globalize.translate('Option' + v),\n                    id: v,\n                    selected: currentLayout == v\n                };\n            });\n\n            require(['actionsheet'], function (actionsheet) {\n                actionsheet.show({\n                    items: menuItems,\n                    positionTo: button,\n                    callback: function (id) {\n                        button.dispatchEvent(new CustomEvent('layoutchange', {\n                            detail: {\n                                viewStyle: id\n                            },\n                            bubbles: true,\n                            cancelable: false\n                        }));\n\n                        if (!dispatchEvent) {\n                            if (window.$) {\n                                $(button).trigger('layoutchange', [id]);\n                            }\n                        }\n                    }\n                });\n            });\n        },\n        getQueryPagingHtml: function (options) {\n            var startIndex = options.startIndex;\n            var limit = options.limit;\n            var totalRecordCount = options.totalRecordCount;\n            var html = '';\n            var recordsEnd = Math.min(startIndex + limit, totalRecordCount);\n            var showControls = limit < totalRecordCount;\n\n            if (html += '<div class=\"listPaging\">', showControls) {\n                html += '<span style=\"vertical-align:middle;\">';\n                html += globalize.translate('ListPaging', (totalRecordCount ? startIndex + 1 : 0), recordsEnd, totalRecordCount);\n                html += '</span>';\n            }\n\n            if (showControls || options.viewButton || options.filterButton || options.sortButton || options.addLayoutButton) {\n                html += '<div style=\"display:inline-block;\">';\n\n                if (showControls) {\n                    html += '<button is=\"paper-icon-button-light\" class=\"btnPreviousPage autoSize\" ' + (startIndex ? '' : 'disabled') + '><span class=\"material-icons arrow_back\"></span></button>';\n                    html += '<button is=\"paper-icon-button-light\" class=\"btnNextPage autoSize\" ' + (startIndex + limit >= totalRecordCount ? 'disabled' : '') + '><span class=\"material-icons arrow_forward\"></span></button>';\n                }\n\n                if (options.addLayoutButton) {\n                    html += '<button is=\"paper-icon-button-light\" title=\"' + globalize.translate('ButtonSelectView') + '\" class=\"btnChangeLayout autoSize\" data-layouts=\"' + (options.layouts || '') + '\" onclick=\"LibraryBrowser.showLayoutMenu(this, \\'' + (options.currentLayout || '') + '\\');\"><span class=\"material-icons view_comfy\"></span></button>';\n                }\n\n                if (options.sortButton) {\n                    html += '<button is=\"paper-icon-button-light\" class=\"btnSort autoSize\" title=\"' + globalize.translate('ButtonSort') + '\"><span class=\"material-icons sort_by_alpha\"></span></button>';\n                }\n\n                if (options.filterButton) {\n                    html += '<button is=\"paper-icon-button-light\" class=\"btnFilter autoSize\" title=\"' + globalize.translate('ButtonFilter') + '\"><span class=\"material-icons filter_list\"></span></button>';\n                }\n\n                html += '</div>';\n            }\n\n            return html += '</div>';\n        },\n        showSortMenu: function (options) {\n            require(['dialogHelper', 'emby-radio'], function (dialogHelper) {\n                function onSortByChange() {\n                    var newValue = this.value;\n\n                    if (this.checked) {\n                        var changed = options.query.SortBy != newValue;\n                        options.query.SortBy = newValue.replace('_', ',');\n                        options.query.StartIndex = 0;\n\n                        if (options.callback && changed) {\n                            options.callback();\n                        }\n                    }\n                }\n\n                function onSortOrderChange() {\n                    var newValue = this.value;\n\n                    if (this.checked) {\n                        var changed = options.query.SortOrder != newValue;\n                        options.query.SortOrder = newValue;\n                        options.query.StartIndex = 0;\n\n                        if (options.callback && changed) {\n                            options.callback();\n                        }\n                    }\n                }\n\n                var dlg = dialogHelper.createDialog({\n                    removeOnClose: true,\n                    modal: false,\n                    entryAnimationDuration: 160,\n                    exitAnimationDuration: 200\n                });\n                dlg.classList.add('ui-body-a');\n                dlg.classList.add('background-theme-a');\n                dlg.classList.add('formDialog');\n                var html = '';\n                html += '<div style=\"margin:0;padding:1.25em 1.5em 1.5em;\">';\n                html += '<h2 style=\"margin:0 0 .5em;\">';\n                html += globalize.translate('HeaderSortBy');\n                html += '</h2>';\n                var i;\n                var length;\n                var isChecked;\n                html += '<div>';\n                for (i = 0, length = options.items.length; i < length; i++) {\n                    var option = options.items[i];\n                    var radioValue = option.id.replace(',', '_');\n                    isChecked = (options.query.SortBy || '').replace(',', '_') == radioValue ? ' checked' : '';\n                    html += '<label class=\"radio-label-block\"><input type=\"radio\" is=\"emby-radio\" name=\"SortBy\" data-id=\"' + option.id + '\" value=\"' + radioValue + '\" class=\"menuSortBy\" ' + isChecked + ' /><span>' + option.name + '</span></label>';\n                }\n\n                html += '</div>';\n                html += '<h2 style=\"margin: 1em 0 .5em;\">';\n                html += globalize.translate('HeaderSortOrder');\n                html += '</h2>';\n                html += '<div>';\n                isChecked = 'Ascending' == options.query.SortOrder ? ' checked' : '';\n                html += '<label class=\"radio-label-block\"><input type=\"radio\" is=\"emby-radio\" name=\"SortOrder\" value=\"Ascending\" class=\"menuSortOrder\" ' + isChecked + ' /><span>' + globalize.translate('OptionAscending') + '</span></label>';\n                isChecked = 'Descending' == options.query.SortOrder ? ' checked' : '';\n                html += '<label class=\"radio-label-block\"><input type=\"radio\" is=\"emby-radio\" name=\"SortOrder\" value=\"Descending\" class=\"menuSortOrder\" ' + isChecked + ' /><span>' + globalize.translate('OptionDescending') + '</span></label>';\n                html += '</div>';\n                html += '</div>';\n                dlg.innerHTML = html;\n                dialogHelper.open(dlg);\n                var sortBys = dlg.querySelectorAll('.menuSortBy');\n\n                for (i = 0, length = sortBys.length; i < length; i++) {\n                    sortBys[i].addEventListener('change', onSortByChange);\n                }\n\n                var sortOrders = dlg.querySelectorAll('.menuSortOrder');\n\n                for (i = 0, length = sortOrders.length; i < length; i++) {\n                    sortOrders[i].addEventListener('change', onSortOrderChange);\n                }\n            });\n        }\n    };\n    window.LibraryBrowser = libraryBrowser;\n    return libraryBrowser;\n});\n"]}