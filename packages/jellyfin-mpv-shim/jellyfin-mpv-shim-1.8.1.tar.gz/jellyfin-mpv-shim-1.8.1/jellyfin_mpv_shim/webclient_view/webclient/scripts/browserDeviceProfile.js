"use strict";define(["browser"],(function(browser){function canPlayH265(videoTestElement,options){return!!(browser.tizen||browser.xboxOne||browser.web0s||options.supportsHevc)||!browser.ps4&&(!!videoTestElement.canPlayType&&(videoTestElement.canPlayType('video/mp4; codecs="hvc1.1.L120"').replace(/no/,"")||videoTestElement.canPlayType('video/mp4; codecs="hev1.1.L120"').replace(/no/,"")||videoTestElement.canPlayType('video/mp4; codecs="hvc1.1.0.L120"').replace(/no/,"")||videoTestElement.canPlayType('video/mp4; codecs="hev1.1.0.L120"').replace(/no/,"")))}var _supportsTextTracks,_canPlayHls;function canPlayHls(){return null==_canPlayHls&&(_canPlayHls=canPlayNativeHls()||function canPlayHlsWithMSE(){return null!=window.MediaSource}()),_canPlayHls}function canPlayNativeHls(){if(browser.tizen)return!0;var media=document.createElement("video");return!(!media.canPlayType("application/x-mpegURL").replace(/no/,"")&&!media.canPlayType("application/vnd.apple.mpegURL").replace(/no/,""))}function canPlayAudioFormat(format){var typeString;if("flac"===format){if(browser.tizen||browser.web0s||browser.edgeUwp)return!0}else if("wma"===format){if(browser.tizen||browser.edgeUwp)return!0}else if("asf"===format){if(browser.tizen||browser.web0s||browser.edgeUwp)return!0}else{if("opus"===format)return!browser.web0s&&(typeString='audio/ogg; codecs="opus"',!!document.createElement("audio").canPlayType(typeString).replace(/no/,""));if("alac"===format){if(browser.iOS||browser.osx)return!0}else if("mp2"===format)return!1}return typeString="webma"===format?"audio/webm":"mp2"===format?"audio/mpeg":"audio/"+format,!!document.createElement("audio").canPlayType(typeString).replace(/no/,"")}function supportsMpeg2Video(){return browser.tizen||browser.web0s||browser.edgeUwp}function supportsVc1(videoTestElement){return browser.tizen||browser.web0s||browser.edgeUwp||videoTestElement.canPlayType('video/mp4; codecs="vc-1"').replace(/no/,"")}function getDirectPlayProfileForVideoContainer(container,videoAudioCodecs,videoTestElement,options){var supported=!1,profileContainer=container,videoCodecs=[];switch(container){case"asf":supported=browser.tizen||browser.web0s||browser.edgeUwp,videoAudioCodecs=[];break;case"avi":supported=browser.tizen||browser.web0s||browser.edgeUwp,browser.tizenVersion>=4&&(videoCodecs.push("h264"),canPlayH265(videoTestElement,options)&&(videoCodecs.push("h265"),videoCodecs.push("hevc")));break;case"mpg":case"mpeg":supported=browser.tizen||browser.web0s||browser.edgeUwp;break;case"flv":supported=browser.tizen;break;case"3gp":case"mts":case"trp":case"vob":case"vro":supported=browser.tizen;break;case"mov":supported=browser.tizen||browser.web0s||browser.chrome||browser.edgeChromium||browser.edgeUwp,videoCodecs.push("h264");break;case"m2ts":supported=browser.tizen||browser.web0s||browser.edgeUwp,videoCodecs.push("h264"),supportsVc1(videoTestElement)&&videoCodecs.push("vc1"),supportsMpeg2Video()&&videoCodecs.push("mpeg2video");break;case"wmv":supported=browser.tizen||browser.web0s||browser.edgeUwp,videoAudioCodecs=[];break;case"ts":supported=function testCanPlayTs(){return browser.tizen||browser.web0s||browser.edgeUwp}(),videoCodecs.push("h264"),canPlayH265(videoTestElement,options)&&(videoCodecs.push("h265"),videoCodecs.push("hevc")),supportsVc1(videoTestElement)&&videoCodecs.push("vc1"),supportsMpeg2Video()&&videoCodecs.push("mpeg2video"),profileContainer="ts,mpegts"}return supported?{Container:profileContainer,Type:"Video",VideoCodec:videoCodecs.join(","),AudioCodec:videoAudioCodecs.join(",")}:null}return function(options){var physicalAudioChannels=(options=options||{}).audioChannels||(browser.tv||browser.ps4||browser.xboxOne?6:2),videoTestElement=document.createElement("video"),canPlayVp8=videoTestElement.canPlayType('video/webm; codecs="vp8"').replace(/no/,""),canPlayVp9=videoTestElement.canPlayType('video/webm; codecs="vp9"').replace(/no/,""),webmAudioCodecs=["vorbis"],canPlayMkv=function testCanPlayMkv(videoTestElement){return!(!browser.tizen&&!browser.web0s)||(!(!videoTestElement.canPlayType("video/x-matroska").replace(/no/,"")&&!videoTestElement.canPlayType("video/mkv").replace(/no/,""))||(!(!browser.edgeChromium||!browser.windows)||!!browser.edgeUwp))}(videoTestElement),profile={MaxStreamingBitrate:12e7,MaxStaticBitrate:1e8};profile.MusicStreamingTranscodingBitrate=Math.min(12e7,192e3),profile.DirectPlayProfiles=[];var videoAudioCodecs=[],hlsVideoAudioCodecs=[],supportsMp3VideoAudio=videoTestElement.canPlayType('video/mp4; codecs="avc1.640029, mp4a.69"').replace(/no/,"")||videoTestElement.canPlayType('video/mp4; codecs="avc1.640029, mp4a.6B"').replace(/no/,"")||videoTestElement.canPlayType('video/mp4; codecs="avc1.640029, mp3"').replace(/no/,""),supportsMp2VideoAudio=browser.edgeUwp||browser.tizen||browser.web0s,maxVideoWidth=browser.xboxOne&&self.screen?self.screen.width:null;options.maxVideoWidth&&(maxVideoWidth=options.maxVideoWidth);var canPlayAacVideoAudio=videoTestElement.canPlayType('video/mp4; codecs="avc1.640029, mp4a.40.2"').replace(/no/,"");if(function supportsAc3(videoTestElement){return!!(browser.edgeUwp||browser.tizen||browser.web0s)||videoTestElement.canPlayType('audio/mp4; codecs="ac-3"').replace(/no/,"")}(videoTestElement)){videoAudioCodecs.push("ac3");var eAc3=function supportsEac3(videoTestElement){return!(!browser.tizen&&!browser.web0s)||videoTestElement.canPlayType('audio/mp4; codecs="ec-3"').replace(/no/,"")}(videoTestElement);eAc3&&videoAudioCodecs.push("eac3"),function supportsAc3InHls(videoTestElement){return!(!browser.tizen&&!browser.web0s)||!!videoTestElement.canPlayType&&(videoTestElement.canPlayType('application/x-mpegurl; codecs="avc1.42E01E, ac-3"').replace(/no/,"")||videoTestElement.canPlayType('application/vnd.apple.mpegURL; codecs="avc1.42E01E, ac-3"').replace(/no/,""))}(videoTestElement)&&(hlsVideoAudioCodecs.push("ac3"),eAc3&&hlsVideoAudioCodecs.push("eac3"))}supportsMp3VideoAudio&&(videoAudioCodecs.push("mp3"),browser.ps4||physicalAudioChannels<=2&&hlsVideoAudioCodecs.push("mp3")),canPlayAacVideoAudio&&(-1===videoAudioCodecs.indexOf("aac")&&videoAudioCodecs.push("aac"),hlsVideoAudioCodecs.push("aac")),supportsMp3VideoAudio&&(browser.ps4||-1===hlsVideoAudioCodecs.indexOf("mp3")&&hlsVideoAudioCodecs.push("mp3")),supportsMp2VideoAudio&&videoAudioCodecs.push("mp2");var supportsDts=browser.tizen||browser.web0s||options.supportsDts||videoTestElement.canPlayType('video/mp4; codecs="dts-"').replace(/no/,"")||videoTestElement.canPlayType('video/mp4; codecs="dts+"').replace(/no/,"");browser.tizenVersion>=4&&(supportsDts=!1),supportsDts&&(videoAudioCodecs.push("dca"),videoAudioCodecs.push("dts")),(browser.tizen||browser.web0s)&&(videoAudioCodecs.push("pcm_s16le"),videoAudioCodecs.push("pcm_s24le")),options.supportsTrueHd&&videoAudioCodecs.push("truehd"),browser.tizen&&videoAudioCodecs.push("aac_latm"),canPlayAudioFormat("opus")&&(videoAudioCodecs.push("opus"),hlsVideoAudioCodecs.push("opus"),webmAudioCodecs.push("opus")),canPlayAudioFormat("flac")&&videoAudioCodecs.push("flac"),videoAudioCodecs=videoAudioCodecs.filter((function(c){return-1===(options.disableVideoAudioCodecs||[]).indexOf(c)})),hlsVideoAudioCodecs=hlsVideoAudioCodecs.filter((function(c){return-1===(options.disableHlsVideoAudioCodecs||[]).indexOf(c)}));var mp4VideoCodecs=[],webmVideoCodecs=[],hlsVideoCodecs=[];(function canPlayH264(videoTestElement){return!(!videoTestElement.canPlayType||!videoTestElement.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"').replace(/no/,""))})(videoTestElement)&&(mp4VideoCodecs.push("h264"),hlsVideoCodecs.push("h264")),canPlayH265(videoTestElement,options)&&(mp4VideoCodecs.push("h265"),mp4VideoCodecs.push("hevc"),(browser.tizen||browser.web0s)&&(hlsVideoCodecs.push("h265"),hlsVideoCodecs.push("hevc"))),supportsMpeg2Video()&&mp4VideoCodecs.push("mpeg2video"),supportsVc1(videoTestElement)&&mp4VideoCodecs.push("vc1"),browser.tizen&&mp4VideoCodecs.push("msmpeg4v2"),canPlayVp8&&(mp4VideoCodecs.push("vp8"),webmVideoCodecs.push("vp8")),canPlayVp9&&(mp4VideoCodecs.push("vp9"),webmVideoCodecs.push("vp9")),function testCanPlayAv1(videoTestElement){return browser.tizenVersion>=5.5||(browser.web0sVersion>=5&&window.outerHeight>=2160||videoTestElement.canPlayType('video/webm; codecs="av01.0.15M.10"').replace(/no/,""))}(videoTestElement)&&(mp4VideoCodecs.push("av1"),webmVideoCodecs.push("av1")),(canPlayVp8||browser.tizen)&&videoAudioCodecs.push("vorbis"),webmVideoCodecs.length&&profile.DirectPlayProfiles.push({Container:"webm",Type:"Video",VideoCodec:webmVideoCodecs.join(","),AudioCodec:webmAudioCodecs.join(",")}),mp4VideoCodecs.length&&profile.DirectPlayProfiles.push({Container:"mp4,m4v",Type:"Video",VideoCodec:mp4VideoCodecs.join(","),AudioCodec:videoAudioCodecs.join(",")}),canPlayMkv&&mp4VideoCodecs.length&&profile.DirectPlayProfiles.push({Container:"mkv",Type:"Video",VideoCodec:mp4VideoCodecs.join(","),AudioCodec:videoAudioCodecs.join(",")}),["m2ts","wmv","ts","asf","avi","mpg","mpeg","flv","3gp","mts","trp","vob","vro","mov"].map((function(container){return getDirectPlayProfileForVideoContainer(container,videoAudioCodecs,videoTestElement,options)})).filter((function(i){return null!=i})).forEach((function(i){profile.DirectPlayProfiles.push(i)})),["opus","mp3","mp2","aac","flac","alac","webma","wma","wav","ogg","oga"].filter(canPlayAudioFormat).forEach((function(audioFormat){"mp2"===audioFormat?profile.DirectPlayProfiles.push({Container:"mp2,mp3",Type:"Audio",AudioCodec:audioFormat}):"mp3"===audioFormat?profile.DirectPlayProfiles.push({Container:audioFormat,Type:"Audio",AudioCodec:audioFormat}):profile.DirectPlayProfiles.push({Container:"webma"===audioFormat?"webma,webm":audioFormat,Type:"Audio"}),"aac"!==audioFormat&&"alac"!==audioFormat||profile.DirectPlayProfiles.push({Container:"m4a,m4b",AudioCodec:audioFormat,Type:"Audio"})})),profile.TranscodingProfiles=[];var hlsBreakOnNonKeyFrames=!(!(browser.iOS||browser.osx||browser.edge)&&canPlayNativeHls());canPlayHls()&&!1!==browser.enableHlsAudio&&profile.TranscodingProfiles.push({Container:!canPlayNativeHls()||browser.edge||browser.android?"ts":"aac",Type:"Audio",AudioCodec:"aac",Context:"Streaming",Protocol:"hls",MaxAudioChannels:physicalAudioChannels.toString(),MinSegments:browser.iOS||browser.osx?"2":"1",BreakOnNonKeyFrames:hlsBreakOnNonKeyFrames}),["aac","mp3","opus","wav"].filter(canPlayAudioFormat).forEach((function(audioFormat){profile.TranscodingProfiles.push({Container:audioFormat,Type:"Audio",AudioCodec:audioFormat,Context:"Streaming",Protocol:"http",MaxAudioChannels:physicalAudioChannels.toString()})})),["opus","mp3","aac","wav"].filter(canPlayAudioFormat).forEach((function(audioFormat){profile.TranscodingProfiles.push({Container:audioFormat,Type:"Audio",AudioCodec:audioFormat,Context:"Static",Protocol:"http",MaxAudioChannels:physicalAudioChannels.toString()})})),canPlayMkv&&!browser.tizen&&!1!==options.enableMkvProgressive&&profile.TranscodingProfiles.push({Container:"mkv",Type:"Video",AudioCodec:videoAudioCodecs.join(","),VideoCodec:mp4VideoCodecs.join(","),Context:"Streaming",MaxAudioChannels:physicalAudioChannels.toString(),CopyTimestamps:!0}),canPlayMkv&&profile.TranscodingProfiles.push({Container:"mkv",Type:"Video",AudioCodec:videoAudioCodecs.join(","),VideoCodec:mp4VideoCodecs.join(","),Context:"Static",MaxAudioChannels:physicalAudioChannels.toString(),CopyTimestamps:!0}),canPlayHls()&&hlsVideoAudioCodecs.length&&!1!==options.enableHls&&profile.TranscodingProfiles.push({Container:"ts",Type:"Video",AudioCodec:hlsVideoAudioCodecs.join(","),VideoCodec:hlsVideoCodecs.join(","),Context:"Streaming",Protocol:"hls",MaxAudioChannels:physicalAudioChannels.toString(),MinSegments:browser.iOS||browser.osx?"2":"1",BreakOnNonKeyFrames:hlsBreakOnNonKeyFrames}),canPlayVp8&&profile.TranscodingProfiles.push({Container:"webm",Type:"Video",AudioCodec:"vorbis",VideoCodec:"vpx",Context:"Streaming",Protocol:"http",MaxAudioChannels:physicalAudioChannels.toString()}),profile.TranscodingProfiles.push({Container:"mp4",Type:"Video",AudioCodec:videoAudioCodecs.join(","),VideoCodec:"h264",Context:"Static",Protocol:"http"}),profile.ContainerProfiles=[],profile.CodecProfiles=[];var supportsSecondaryAudio=browser.tizen||videoTestElement.audioTracks,aacCodecProfileConditions=[];videoTestElement.canPlayType('video/mp4; codecs="avc1.640029, mp4a.40.5"').replace(/no/,"")||aacCodecProfileConditions.push({Condition:"NotEquals",Property:"AudioProfile",Value:"HE-AAC"}),supportsSecondaryAudio||aacCodecProfileConditions.push({Condition:"Equals",Property:"IsSecondaryAudio",Value:"false",IsRequired:!1}),aacCodecProfileConditions.length&&profile.CodecProfiles.push({Type:"VideoAudio",Codec:"aac",Conditions:aacCodecProfileConditions}),supportsSecondaryAudio||profile.CodecProfiles.push({Type:"VideoAudio",Conditions:[{Condition:"Equals",Property:"IsSecondaryAudio",Value:"false",IsRequired:!1}]});var maxH264Level=42,h264Profiles="high|main|baseline|constrained baseline";(browser.tizen||browser.web0s||videoTestElement.canPlayType('video/mp4; codecs="avc1.640833"').replace(/no/,""))&&(maxH264Level=51),browser.tizenVersion>=5&&window.NativeShell&&(maxH264Level=52),(browser.tizen||videoTestElement.canPlayType('video/mp4; codecs="avc1.6e0033"').replace(/no/,""))&&(browser.safari||browser.iOS||browser.web0s||browser.edge||browser.mobile||(h264Profiles+="|high 10"));var h264CodecProfileConditions=[{Condition:"NotEquals",Property:"IsAnamorphic",Value:"true",IsRequired:!1},{Condition:"EqualsAny",Property:"VideoProfile",Value:h264Profiles,IsRequired:!1},{Condition:"LessThanEqual",Property:"VideoLevel",Value:maxH264Level.toString(),IsRequired:!1}];browser.edgeUwp||browser.tizen||browser.web0s||h264CodecProfileConditions.push({Condition:"NotEquals",Property:"IsInterlaced",Value:"true",IsRequired:!1}),maxVideoWidth&&h264CodecProfileConditions.push({Condition:"LessThanEqual",Property:"Width",Value:maxVideoWidth.toString(),IsRequired:!1});var globalMaxVideoBitrate=(function getGlobalMaxVideoBitrate(){var isTizenFhd=!1;if(browser.tizen)try{isTizenFhd=!webapis.productinfo.isUdPanelSupported(),console.debug("isTizenFhd = "+isTizenFhd)}catch(error){console.error("isUdPanelSupported() error code = "+error.code)}return browser.ps4?8e6:browser.xboxOne?12e6:browser.edgeUwp?null:browser.tizen&&isTizenFhd?2e7:null}()||"").toString(),h264MaxVideoBitrate=globalMaxVideoBitrate;if(h264MaxVideoBitrate&&h264CodecProfileConditions.push({Condition:"LessThanEqual",Property:"VideoBitrate",Value:h264MaxVideoBitrate,IsRequired:!0}),browser.iOS&&browser.iOSVersion<13){var codecProfile={Type:"Video",Codec:"h264",Container:"ts",Conditions:h264CodecProfileConditions.filter((function(condition){return"VideoLevel"!==condition.Property}))};codecProfile.Conditions.push({Condition:"LessThanEqual",Property:"VideoLevel",Value:"42",IsRequired:!1}),profile.CodecProfiles.push(codecProfile)}profile.CodecProfiles.push({Type:"Video",Codec:"h264",Conditions:h264CodecProfileConditions});var globalVideoConditions=[];return globalMaxVideoBitrate&&globalVideoConditions.push({Condition:"LessThanEqual",Property:"VideoBitrate",Value:globalMaxVideoBitrate}),maxVideoWidth&&globalVideoConditions.push({Condition:"LessThanEqual",Property:"Width",Value:maxVideoWidth.toString(),IsRequired:!1}),globalVideoConditions.length&&profile.CodecProfiles.push({Type:"Video",Conditions:globalVideoConditions}),profile.SubtitleProfiles=[],function supportsTextTracks(){return!!browser.tizen||(null==_supportsTextTracks&&(_supportsTextTracks=null!=document.createElement("video").textTracks),_supportsTextTracks)}()&&profile.SubtitleProfiles.push({Format:"vtt",Method:"External"}),options.enableSsaRender&&(profile.SubtitleProfiles.push({Format:"ass",Method:"External"}),profile.SubtitleProfiles.push({Format:"ssa",Method:"External"})),profile.ResponseProfiles=[],profile.ResponseProfiles.push({Type:"Video",Container:"m4v",MimeType:"video/mp4"}),profile}}));
//# sourceMappingURL=browserDeviceProfile.js.map
