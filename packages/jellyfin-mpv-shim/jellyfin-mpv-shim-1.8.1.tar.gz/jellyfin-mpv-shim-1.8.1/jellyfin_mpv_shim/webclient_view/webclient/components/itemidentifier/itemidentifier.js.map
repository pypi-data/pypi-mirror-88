{"version":3,"sources":["components/itemidentifier/itemidentifier.js"],"names":["define","dialogHelper","loading","connectionManager","require","globalize","scrollHelper","layoutManager","focusManager","browser","currentItem","currentItemType","currentServerId","currentResolve","currentReject","currentSearchResult","enableFocusTransform","slow","edge","hasChanges","getApiClient","searchForIdentificationResults","page","i","length","value","lookupInfo","ProviderIds","identifyField","querySelectorAll","type","parseInt","getAttribute","hasId","txtLookupId","Name","SearchInfo","Id","ItemId","IncludeDisabledProviders","show","apiClient","ajax","url","getUrl","data","JSON","stringify","contentType","dataType","then","results","hide","showIdentificationSearchResults","identificationSearchResults","querySelector","classList","add","remove","html","result","getSearchResultHtml","elem","onSearchImageClick","index","this","currentResult","showIdentifyOptions","identifyResult","identifyOptionsForm","checked","lines","push","ProductionYear","resultHtml","join","ImageUrl","displayUrl","getSearchImageDisplayUrl","SearchProviderName","innerHTML","focus","finishFindNewDialog","dlg","close","searchImages","addEventListener","tv","autoFocus","toast","translate","padderClass","cssClass","numLines","AlbumArtist","provider","imageUrl","ProviderName","showEditor","itemId","template","getItem","getCurrentUserId","item","Type","dialogOptions","size","removeOnClose","scrollY","createDialog","translateDocument","onDialogClosed","centerFocus","on","Path","open","e","preventDefault","submitIdentficationResult","options","ReplaceAllImages","showIdentificationForm","getJSON","idList","idInfo","id","Key","fullName","idLabel","showEditorFindNew","itemName","itemYear","itemType","resolveFunc","showIdentificationFormFindNew","serverId","Promise","resolve","reject","showFindNew"],"mappings":"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","file":"itemidentifier.js","sourcesContent":["define(['dialogHelper', 'loading', 'connectionManager', 'require', 'globalize', 'scrollHelper', 'layoutManager', 'focusManager', 'browser', 'emby-input', 'emby-checkbox', 'paper-icon-button-light', 'css!./../formdialog', 'material-icons', 'cardStyle'], function (dialogHelper, loading, connectionManager, require, globalize, scrollHelper, layoutManager, focusManager, browser) {\n    'use strict';\n\n    var enableFocusTransform = !browser.slow && !browser.edge;\n\n    var currentItem;\n    var currentItemType;\n    var currentServerId;\n    var currentResolve;\n    var currentReject;\n    var hasChanges = false;\n    var currentSearchResult;\n\n    function getApiClient() {\n        return connectionManager.getApiClient(currentServerId);\n    }\n\n    function searchForIdentificationResults(page) {\n\n        var lookupInfo = {\n            ProviderIds: {}\n        };\n\n        var i;\n        var length;\n        var identifyField = page.querySelectorAll('.identifyField');\n        var value;\n        for (i = 0, length = identifyField.length; i < length; i++) {\n\n            value = identifyField[i].value;\n\n            if (value) {\n\n                if (identifyField[i].type === 'number') {\n                    value = parseInt(value);\n                }\n\n                lookupInfo[identifyField[i].getAttribute('data-lookup')] = value;\n            }\n        }\n\n        var hasId = false;\n\n        var txtLookupId = page.querySelectorAll('.txtLookupId');\n        for (i = 0, length = txtLookupId.length; i < length; i++) {\n\n            value = txtLookupId[i].value;\n\n            if (value) {\n                hasId = true;\n            }\n            lookupInfo.ProviderIds[txtLookupId[i].getAttribute('data-providerkey')] = value;\n        }\n\n        if (!hasId && !lookupInfo.Name) {\n            require(['toast'], function (toast) {\n                toast(globalize.translate('PleaseEnterNameOrId'));\n            });\n            return;\n        }\n\n        lookupInfo = {\n            SearchInfo: lookupInfo\n        };\n\n        if (currentItem && currentItem.Id) {\n            lookupInfo.ItemId = currentItem.Id;\n        } else {\n            lookupInfo.IncludeDisabledProviders = true;\n        }\n\n        loading.show();\n\n        var apiClient = getApiClient();\n\n        apiClient.ajax({\n            type: 'POST',\n            url: apiClient.getUrl('Items/RemoteSearch/' + currentItemType),\n            data: JSON.stringify(lookupInfo),\n            contentType: 'application/json',\n            dataType: 'json'\n\n        }).then(function (results) {\n\n            loading.hide();\n            showIdentificationSearchResults(page, results);\n        });\n    }\n\n    function showIdentificationSearchResults(page, results) {\n\n        var identificationSearchResults = page.querySelector('.identificationSearchResults');\n\n        page.querySelector('.popupIdentifyForm').classList.add('hide');\n        identificationSearchResults.classList.remove('hide');\n        page.querySelector('.identifyOptionsForm').classList.add('hide');\n        page.querySelector('.dialogContentInner').classList.remove('dialog-content-centered');\n\n        var html = '';\n        var i;\n        var length;\n        for (i = 0, length = results.length; i < length; i++) {\n\n            var result = results[i];\n            html += getSearchResultHtml(result, i);\n        }\n\n        var elem = page.querySelector('.identificationSearchResultList');\n        elem.innerHTML = html;\n\n        function onSearchImageClick() {\n            var index = parseInt(this.getAttribute('data-index'));\n\n            var currentResult = results[index];\n\n            if (currentItem != null) {\n\n                showIdentifyOptions(page, currentResult);\n            } else {\n\n                finishFindNewDialog(page, currentResult);\n            }\n        }\n\n        var searchImages = elem.querySelectorAll('.card');\n        for (i = 0, length = searchImages.length; i < length; i++) {\n\n            searchImages[i].addEventListener('click', onSearchImageClick);\n        }\n\n        if (layoutManager.tv) {\n            focusManager.autoFocus(identificationSearchResults);\n        }\n    }\n\n    function finishFindNewDialog(dlg, identifyResult) {\n        currentSearchResult = identifyResult;\n        hasChanges = true;\n        loading.hide();\n\n        dialogHelper.close(dlg);\n    }\n\n    function showIdentifyOptions(page, identifyResult) {\n\n        var identifyOptionsForm = page.querySelector('.identifyOptionsForm');\n\n        page.querySelector('.popupIdentifyForm').classList.add('hide');\n        page.querySelector('.identificationSearchResults').classList.add('hide');\n        identifyOptionsForm.classList.remove('hide');\n        page.querySelector('#chkIdentifyReplaceImages').checked = true;\n        page.querySelector('.dialogContentInner').classList.add('dialog-content-centered');\n\n        currentSearchResult = identifyResult;\n\n        var lines = [];\n        lines.push(identifyResult.Name);\n\n        if (identifyResult.ProductionYear) {\n            lines.push(identifyResult.ProductionYear);\n        }\n\n        var resultHtml = lines.join('<br/>');\n\n        if (identifyResult.ImageUrl) {\n            var displayUrl = getSearchImageDisplayUrl(identifyResult.ImageUrl, identifyResult.SearchProviderName);\n\n            resultHtml = '<div style=\"display:flex;align-items:center;\"><img src=\"' + displayUrl + '\" style=\"max-height:240px;\" /><div style=\"margin-left:1em;\">' + resultHtml + '</div>';\n        }\n\n        page.querySelector('.selectedSearchResult').innerHTML = resultHtml;\n\n        focusManager.focus(identifyOptionsForm.querySelector('.btnSubmit'));\n    }\n\n    function getSearchResultHtml(result, index) {\n\n        // TODO move card creation code to Card component\n\n        var html = '';\n        var cssClass = 'card scalableCard';\n        var cardBoxCssClass = 'cardBox';\n        var padderClass;\n\n        if (currentItemType === 'Episode') {\n            cssClass += ' backdropCard backdropCard-scalable';\n            padderClass = 'cardPadder-backdrop';\n        } else if (currentItemType === 'MusicAlbum' || currentItemType === 'MusicArtist') {\n            cssClass += ' squareCard squareCard-scalable';\n            padderClass = 'cardPadder-square';\n        } else {\n            cssClass += ' portraitCard portraitCard-scalable';\n            padderClass = 'cardPadder-portrait';\n        }\n\n        if (layoutManager.tv) {\n            cssClass += ' show-focus';\n\n            if (enableFocusTransform) {\n                cssClass += ' show-animation';\n            }\n        }\n\n        cardBoxCssClass += ' cardBox-bottompadded';\n\n        html += '<button type=\"button\" class=\"' + cssClass + '\" data-index=\"' + index + '\">';\n        html += '<div class=\"' + cardBoxCssClass + '\">';\n        html += '<div class=\"cardScalable\">';\n        html += '<div class=\"' + padderClass + '\"></div>';\n\n        html += '<div class=\"cardContent searchImage\">';\n\n        if (result.ImageUrl) {\n            var displayUrl = getSearchImageDisplayUrl(result.ImageUrl, result.SearchProviderName);\n\n            html += '<div class=\"cardImageContainer coveredImage\" style=\"background-image:url(\\'' + displayUrl + '\\');\"></div>';\n        } else {\n\n            html += '<div class=\"cardImageContainer coveredImage defaultCardBackground defaultCardBackground1\"><div class=\"cardText cardCenteredText\">' + result.Name + '</div></div>';\n        }\n        html += '</div>';\n        html += '</div>';\n\n        var numLines = 3;\n        if (currentItemType === 'MusicAlbum') {\n            numLines++;\n        }\n\n        var lines = [result.Name];\n\n        lines.push(result.SearchProviderName);\n\n        if (result.AlbumArtist) {\n            lines.push(result.AlbumArtist.Name);\n        }\n        if (result.ProductionYear) {\n            lines.push(result.ProductionYear);\n        }\n\n        for (var i = 0; i < numLines; i++) {\n\n            if (i === 0) {\n                html += '<div class=\"cardText cardText-first cardTextCentered\">';\n            } else {\n                html += '<div class=\"cardText cardText-secondary cardTextCentered\">';\n            }\n            html += lines[i] || '&nbsp;';\n            html += '</div>';\n        }\n\n        html += '</div>';\n        html += '</button>';\n        return html;\n    }\n\n    function getSearchImageDisplayUrl(url, provider) {\n        var apiClient = getApiClient();\n\n        return apiClient.getUrl('Items/RemoteSearch/Image', { imageUrl: url, ProviderName: provider });\n    }\n\n    function submitIdentficationResult(page) {\n\n        loading.show();\n\n        var options = {\n            ReplaceAllImages: page.querySelector('#chkIdentifyReplaceImages').checked\n        };\n\n        var apiClient = getApiClient();\n\n        apiClient.ajax({\n            type: 'POST',\n            url: apiClient.getUrl('Items/RemoteSearch/Apply/' + currentItem.Id, options),\n            data: JSON.stringify(currentSearchResult),\n            contentType: 'application/json'\n\n        }).then(function () {\n\n            hasChanges = true;\n            loading.hide();\n\n            dialogHelper.close(page);\n\n        }, function () {\n\n            loading.hide();\n\n            dialogHelper.close(page);\n        });\n    }\n\n    function showIdentificationForm(page, item) {\n\n        var apiClient = getApiClient();\n\n        apiClient.getJSON(apiClient.getUrl('Items/' + item.Id + '/ExternalIdInfos')).then(function (idList) {\n\n            var html = '';\n\n            for (var i = 0, length = idList.length; i < length; i++) {\n\n                var idInfo = idList[i];\n\n                var id = 'txtLookup' + idInfo.Key;\n\n                html += '<div class=\"inputContainer\">';\n\n                var fullName = idInfo.Name;\n                if (idInfo.Type) {\n                    fullName = idInfo.Name + ' ' + globalize.translate(idInfo.Type);\n                }\n\n                var idLabel = globalize.translate('LabelDynamicExternalId', fullName);\n\n                html += '<input is=\"emby-input\" class=\"txtLookupId\" data-providerkey=\"' + idInfo.Key + '\" id=\"' + id + '\" label=\"' + idLabel + '\"/>';\n\n                html += '</div>';\n            }\n\n            page.querySelector('#txtLookupName').value = '';\n\n            if (item.Type === 'Person' || item.Type === 'BoxSet') {\n\n                page.querySelector('.fldLookupYear').classList.add('hide');\n                page.querySelector('#txtLookupYear').value = '';\n            } else {\n\n                page.querySelector('.fldLookupYear').classList.remove('hide');\n                page.querySelector('#txtLookupYear').value = '';\n            }\n\n            page.querySelector('.identifyProviderIds').innerHTML = html;\n\n            page.querySelector('.formDialogHeaderTitle').innerHTML = globalize.translate('Identify');\n        });\n    }\n\n    function showEditor(itemId) {\n\n        loading.show();\n\n        require(['text!./itemidentifier.template.html'], function (template) {\n\n            var apiClient = getApiClient();\n\n            apiClient.getItem(apiClient.getCurrentUserId(), itemId).then(function (item) {\n\n                currentItem = item;\n                currentItemType = currentItem.Type;\n\n                var dialogOptions = {\n                    size: 'small',\n                    removeOnClose: true,\n                    scrollY: false\n                };\n\n                if (layoutManager.tv) {\n                    dialogOptions.size = 'fullscreen';\n                }\n\n                var dlg = dialogHelper.createDialog(dialogOptions);\n\n                dlg.classList.add('formDialog');\n                dlg.classList.add('recordingDialog');\n\n                var html = '';\n                html += globalize.translateDocument(template, 'core');\n\n                dlg.innerHTML = html;\n\n                // Has to be assigned a z-index after the call to .open()\n                dlg.addEventListener('close', onDialogClosed);\n\n                if (layoutManager.tv) {\n                    scrollHelper.centerFocus.on(dlg.querySelector('.formDialogContent'), false);\n                }\n\n                if (item.Path) {\n                    dlg.querySelector('.fldPath').classList.remove('hide');\n                } else {\n                    dlg.querySelector('.fldPath').classList.add('hide');\n                }\n\n                dlg.querySelector('.txtPath').innerHTML = item.Path || '';\n\n                dialogHelper.open(dlg);\n\n                dlg.querySelector('.popupIdentifyForm').addEventListener('submit', function (e) {\n\n                    e.preventDefault();\n                    searchForIdentificationResults(dlg);\n                    return false;\n                });\n\n                dlg.querySelector('.identifyOptionsForm').addEventListener('submit', function (e) {\n\n                    e.preventDefault();\n                    submitIdentficationResult(dlg);\n                    return false;\n                });\n\n                dlg.querySelector('.btnCancel').addEventListener('click', function (e) {\n\n                    dialogHelper.close(dlg);\n                });\n\n                dlg.classList.add('identifyDialog');\n\n                showIdentificationForm(dlg, item);\n                loading.hide();\n            });\n        });\n    }\n\n    function onDialogClosed() {\n\n        loading.hide();\n        if (hasChanges) {\n            currentResolve();\n        } else {\n            currentReject();\n        }\n    }\n\n    function showEditorFindNew(itemName, itemYear, itemType, resolveFunc) {\n\n        currentItem = null;\n        currentItemType = itemType;\n\n        require(['text!./itemidentifier.template.html'], function (template) {\n\n            var dialogOptions = {\n                size: 'small',\n                removeOnClose: true,\n                scrollY: false\n            };\n\n            if (layoutManager.tv) {\n                dialogOptions.size = 'fullscreen';\n            }\n\n            var dlg = dialogHelper.createDialog(dialogOptions);\n\n            dlg.classList.add('formDialog');\n            dlg.classList.add('recordingDialog');\n\n            var html = '';\n            html += globalize.translateDocument(template, 'core');\n\n            dlg.innerHTML = html;\n\n            if (layoutManager.tv) {\n                scrollHelper.centerFocus.on(dlg.querySelector('.formDialogContent'), false);\n            }\n\n            dialogHelper.open(dlg);\n\n            dlg.querySelector('.btnCancel').addEventListener('click', function (e) {\n\n                dialogHelper.close(dlg);\n            });\n\n            dlg.querySelector('.popupIdentifyForm').addEventListener('submit', function (e) {\n\n                e.preventDefault();\n                searchForIdentificationResults(dlg);\n                return false;\n            });\n\n            dlg.addEventListener('close', function () {\n\n                loading.hide();\n                var foundItem = hasChanges ? currentSearchResult : null;\n\n                resolveFunc(foundItem);\n            });\n\n            dlg.classList.add('identifyDialog');\n\n            showIdentificationFormFindNew(dlg, itemName, itemYear, itemType);\n        });\n    }\n\n    function showIdentificationFormFindNew(dlg, itemName, itemYear, itemType) {\n\n        dlg.querySelector('#txtLookupName').value = itemName;\n\n        if (itemType === 'Person' || itemType === 'BoxSet') {\n\n            dlg.querySelector('.fldLookupYear').classList.add('hide');\n            dlg.querySelector('#txtLookupYear').value = '';\n\n        } else {\n\n            dlg.querySelector('.fldLookupYear').classList.remove('hide');\n            dlg.querySelector('#txtLookupYear').value = itemYear;\n        }\n\n        dlg.querySelector('.formDialogHeaderTitle').innerHTML = globalize.translate('Search');\n    }\n\n    return {\n        show: function (itemId, serverId) {\n\n            return new Promise(function (resolve, reject) {\n\n                currentResolve = resolve;\n                currentReject = reject;\n                currentServerId = serverId;\n                hasChanges = false;\n\n                showEditor(itemId);\n            });\n        },\n\n        showFindNew: function (itemName, itemYear, itemType, serverId) {\n\n            return new Promise(function (resolve, reject) {\n\n                currentServerId = serverId;\n\n                hasChanges = false;\n                showEditorFindNew(itemName, itemYear, itemType, resolve);\n            });\n        }\n    };\n});\n"]}