"use strict";define(["loading","dialogHelper","dom","jQuery","components/libraryoptionseditor/libraryoptionseditor","globalize","emby-toggle","emby-input","emby-select","paper-icon-button-light","listViewStyle","formDialogStyle","emby-button","flexStyles"],(function(loading,dialogHelper,dom,$,libraryoptionseditor,globalize){function onAddLibrary(){if(isCreating)return!1;if(0==pathInfos.length)return require(["alert"],(function(alert){alert({text:globalize.translate("PleaseAddAtLeastOneFolder"),type:"error"})})),!1;isCreating=!0,loading.show();var dlg=dom.parentWithClass(this,"dlg-librarycreator"),name=$("#txtValue",dlg).val(),type=$("#selectCollectionType",dlg).val();"mixed"==type&&(type=null);var libraryOptions=libraryoptionseditor.getLibraryOptions(dlg.querySelector(".libraryOptions"));return libraryOptions.PathInfos=pathInfos,ApiClient.addVirtualFolder(name,type,currentOptions.refresh,libraryOptions).then((function(){hasChanges=!0,isCreating=!1,loading.hide(),dialogHelper.close(dlg)}),(function(){require(["toast"],(function(toast){toast(globalize.translate("ErrorAddingMediaPathToVirtualFolder"))})),isCreating=!1,loading.hide()})),!1}function onToggleAdvancedChange(){var dlg=dom.parentWithClass(this,"dlg-librarycreator");libraryoptionseditor.setAdvancedVisible(dlg.querySelector(".libraryOptions"),this.checked)}function onAddButtonClick(){var page=dom.parentWithClass(this,"dlg-librarycreator");require(["directorybrowser"],(function(directoryBrowser){var picker=new directoryBrowser;picker.show({enableNetworkSharePath:!0,callback:function callback(path,networkSharePath){path&&function addMediaLocation(page,path,networkSharePath){var pathLower=path.toLowerCase();if(!pathInfos.filter((function(p){return p.Path.toLowerCase()==pathLower})).length){var pathInfo={Path:path};networkSharePath&&(pathInfo.NetworkPath=networkSharePath),pathInfos.push(pathInfo),renderPaths(page)}}(page,path,networkSharePath),picker.close()}})}))}function getFolderHtml(pathInfo,index){var html="";return html+='<div class="listItem listItem-border lnkPath" style="padding-left:.5em;">',html+='<div class="'+(pathInfo.NetworkPath?"listItemBody two-line":"listItemBody")+'">',html+='<div class="listItemBodyText">'+pathInfo.Path+"</div>",pathInfo.NetworkPath&&(html+='<div class="listItemBodyText secondary">'+pathInfo.NetworkPath+"</div>"),html+="</div>",html+='<button type="button" is="paper-icon-button-light"" class="listItemButton btnRemovePath" data-index="'+index+'"><span class="material-icons remove_circle"></span></button>',html+="</div>"}function renderPaths(page){var foldersHtml=pathInfos.map(getFolderHtml).join(""),folderList=page.querySelector(".folderList");folderList.innerHTML=foldersHtml,foldersHtml?folderList.classList.remove("hide"):folderList.classList.add("hide")}function onRemoveClick(e){var button=dom.parentWithClass(e.target,"btnRemovePath"),index=parseInt(button.getAttribute("data-index")),locationLower=pathInfos[index].Path.toLowerCase();pathInfos=pathInfos.filter((function(p){return p.Path.toLowerCase()!=locationLower})),renderPaths(dom.parentWithClass(button,"dlg-librarycreator"))}function onDialogClosed(){currentResolve(hasChanges)}var currentResolve,currentOptions,pathInfos=[],hasChanges=!1,isCreating=!1;return function editor(){this.show=function(options){return new Promise((function(resolve,reject){currentOptions=options,currentResolve=resolve,hasChanges=!1;var xhr=new XMLHttpRequest;xhr.open("GET","components/mediaLibraryCreator/mediaLibraryCreator.template.html",!0),xhr.onload=function(e){var template=this.response,dlg=dialogHelper.createDialog({size:"small",modal:!1,removeOnClose:!0,scrollY:!1});dlg.classList.add("ui-body-a"),dlg.classList.add("background-theme-a"),dlg.classList.add("dlg-librarycreator"),dlg.classList.add("formDialog"),dlg.innerHTML=globalize.translateDocument(template),function initEditor(page,collectionTypeOptions){$("#selectCollectionType",page).html(function getCollectionTypeOptionsHtml(collectionTypeOptions){return collectionTypeOptions.map((function(i){return'<option value="'+i.value+'">'+i.name+"</option>"})).join("")}(collectionTypeOptions)).val("").on("change",(function(){var value=this.value,dlg=$(this).parents(".dialog")[0];if(libraryoptionseditor.setContentType(dlg.querySelector(".libraryOptions"),"mixed"==value?"":value),value?dlg.querySelector(".libraryOptions").classList.remove("hide"):dlg.querySelector(".libraryOptions").classList.add("hide"),"mixed"!=value){var index=this.selectedIndex;if(-1!=index){var name=this.options[index].innerHTML.replace("*","").replace("&amp;","&");$("#txtValue",dlg).val(name);var folderOption=collectionTypeOptions.filter((function(i){return i.value==value}))[0];$(".collectionTypeFieldDescription",dlg).html(folderOption.message||"")}}})),page.querySelector(".btnAddFolder").addEventListener("click",onAddButtonClick),page.querySelector(".btnSubmit").addEventListener("click",onAddLibrary),page.querySelector(".folderList").addEventListener("click",onRemoveClick),page.querySelector(".chkAdvanced").addEventListener("change",onToggleAdvancedChange)}(dlg,options.collectionTypeOptions),dlg.addEventListener("close",onDialogClosed),dialogHelper.open(dlg),dlg.querySelector(".btnCancel").addEventListener("click",(function(){dialogHelper.close(dlg)})),pathInfos=[],renderPaths(dlg),function initLibraryOptions(dlg){libraryoptionseditor.embed(dlg.querySelector(".libraryOptions")).then((function(){$("#selectCollectionType",dlg).trigger("change"),onToggleAdvancedChange.call(dlg.querySelector(".chkAdvanced"))}))}(dlg)},xhr.send()}))}}}));
//# sourceMappingURL=mediaLibraryCreator.js.map
