"use strict";define(["apphost","globalize","connectionManager","itemHelper","appRouter","playbackManager","loading","appSettings","browser","actionsheet"],(function(appHost,globalize,connectionManager,itemHelper,appRouter,playbackManager,loading,appSettings,browser,actionsheet){function getCommands(options){var item=options.item,user=options.user,canPlay=playbackManager.canPlay(item),restrictOptions=(browser.operaTv||browser.web0s)&&!user.Policy.IsAdministrator,commands=[];canPlay&&"Photo"!==item.MediaType&&(!1!==options.play&&commands.push({name:globalize.translate("Play"),id:"resume",icon:"play_arrow"}),options.playAllFromHere&&"Program"!==item.Type&&"TvChannel"!==item.Type&&commands.push({name:globalize.translate("PlayAllFromHere"),id:"playallfromhere",icon:"play_arrow"})),null!==playbackManager.getCurrentPlayer()&&(options.stopPlayback&&commands.push({name:globalize.translate("StopPlayback"),id:"stopPlayback",icon:"stop"}),options.clearQueue&&commands.push({name:globalize.translate("ClearQueue"),id:"clearQueue",icon:"clear_all"})),playbackManager.canQueue(item)&&(!1!==options.queue&&commands.push({name:globalize.translate("AddToPlayQueue"),id:"queue",icon:"playlist_add"}),!1!==options.queue&&commands.push({name:globalize.translate("PlayNext"),id:"queuenext",icon:"playlist_add"})),(item.IsFolder||"MusicArtist"===item.Type||"MusicGenre"===item.Type)&&"livetv"!==item.CollectionType&&!1!==options.shuffle&&commands.push({name:globalize.translate("Shuffle"),id:"shuffle",icon:"shuffle"}),"Audio"!==item.MediaType&&"MusicAlbum"!==item.Type&&"MusicArtist"!==item.Type&&"MusicGenre"!==item.Type||!1===options.instantMix||itemHelper.isLocalItem(item)||commands.push({name:globalize.translate("InstantMix"),id:"instantmix",icon:"explore"}),commands.length&&commands.push({divider:!0}),restrictOptions||(itemHelper.supportsAddingToCollection(item)&&commands.push({name:globalize.translate("AddToCollection"),id:"addtocollection",icon:"playlist_add"}),itemHelper.supportsAddingToPlaylist(item)&&!1!==options.playlist&&commands.push({name:globalize.translate("AddToPlaylist"),id:"addtoplaylist",icon:"playlist_add"})),"Timer"===item.Type&&user.Policy.EnableLiveTvManagement&&!1!==options.cancelTimer&&commands.push({name:globalize.translate("CancelRecording"),id:"canceltimer",icon:"cancel"}),"Recording"===item.Type&&"InProgress"===item.Status&&user.Policy.EnableLiveTvManagement&&!1!==options.cancelTimer&&commands.push({name:globalize.translate("CancelRecording"),id:"canceltimer",icon:"cancel"}),"SeriesTimer"===item.Type&&user.Policy.EnableLiveTvManagement&&!1!==options.cancelTimer&&commands.push({name:globalize.translate("CancelSeries"),id:"cancelseriestimer",icon:"cancel"}),item.CanDelete&&!1!==options.deleteItem&&("Playlist"===item.Type||"BoxSet"===item.Type?commands.push({name:globalize.translate("Delete"),id:"delete",icon:"delete"}):commands.push({name:globalize.translate("DeleteMedia"),id:"delete",icon:"delete"})),item.CanDownload&&appHost.supports("filedownload")&&"Book"!==item.Type&&(commands.push({name:globalize.translate("Download"),id:"download",icon:"file_download"}),commands.push({name:globalize.translate("CopyStreamURL"),id:"copy-stream",icon:"content_copy"})),commands.length&&commands.push({divider:!0});var canEdit=itemHelper.canEdit(user,item);if(canEdit&&!1!==options.edit&&"SeriesTimer"!==item.Type){var text="Timer"===item.Type||"SeriesTimer"===item.Type?globalize.translate("Edit"):globalize.translate("EditMetadata");commands.push({name:text,id:"edit",icon:"edit"})}return itemHelper.canEditImages(user,item)&&!1!==options.editImages&&commands.push({name:globalize.translate("EditImages"),id:"editimages",icon:"image"}),canEdit&&("Video"!==item.MediaType||"TvChannel"===item.Type||"Program"===item.Type||"Virtual"===item.LocationType||"Recording"===item.Type&&"Completed"!==item.Status||!1!==options.editSubtitles&&commands.push({name:globalize.translate("EditSubtitles"),id:"editsubtitles",icon:"closed_caption"})),!1!==options.identify&&itemHelper.canIdentify(user,item)&&commands.push({name:globalize.translate("Identify"),id:"identify",icon:"edit"}),item.MediaSources&&!1!==options.moremediainfo&&commands.push({name:globalize.translate("MoreMediaInfo"),id:"moremediainfo",icon:"info"}),"Program"===item.Type&&!1!==options.record&&item.TimerId&&commands.push({name:globalize.translate("ManageRecording"),id:"record",icon:"fiber_manual_record"}),"Program"===item.Type&&!1!==options.record&&(item.TimerId||commands.push({name:globalize.translate("Record"),id:"record",icon:"fiber_manual_record"})),itemHelper.canRefreshMetadata(item,user)&&commands.push({name:globalize.translate("RefreshMetadata"),id:"refresh",icon:"refresh"}),item.PlaylistItemId&&options.playlistId&&commands.push({name:globalize.translate("RemoveFromPlaylist"),id:"removefromplaylist",icon:"remove"}),options.collectionId&&commands.push({name:globalize.translate("RemoveFromCollection"),id:"removefromcollection",icon:"remove"}),restrictOptions||!0===options.share&&itemHelper.canShare(item,user)&&commands.push({name:globalize.translate("Share"),id:"share",icon:"share"}),!1!==options.sync&&itemHelper.canSync(user,item)&&commands.push({name:globalize.translate("Sync"),id:"sync",icon:"sync"}),!1!==options.openAlbum&&item.AlbumId&&"Photo"!==item.MediaType&&commands.push({name:globalize.translate("ViewAlbum"),id:"album",icon:"album"}),!1!==options.openArtist&&item.AlbumArtists&&item.AlbumArtists.length&&commands.push({name:globalize.translate("ViewAlbumArtist"),id:"artist",icon:"person"}),commands}function getResolveFunction(resolve,id,changed,deleted){return function(){resolve({command:id,updated:changed,deleted:deleted})}}function executeCommand(item,id,options){var itemId=item.Id,serverId=item.ServerId,apiClient=connectionManager.getApiClient(serverId);return new Promise((function(resolve,reject){switch(id){case"addtocollection":require(["collectionEditor"],(function(collectionEditor){(new collectionEditor).show({items:[itemId],serverId:serverId}).then(getResolveFunction(resolve,id,!0),getResolveFunction(resolve,id))}));break;case"addtoplaylist":require(["playlistEditor"],(function(playlistEditor){(new playlistEditor).show({items:[itemId],serverId:serverId}).then(getResolveFunction(resolve,id,!0),getResolveFunction(resolve,id))}));break;case"download":require(["fileDownloader"],(function(fileDownloader){var downloadHref=apiClient.getItemDownloadUrl(itemId);fileDownloader.download([{url:downloadHref,itemId:itemId,serverId:serverId,title:item.Name,filename:item.Path.replace(/^.*[\\\/]/,"")}]),getResolveFunction(getResolveFunction(resolve,id),id)()}));break;case"copy-stream":var downloadHref=apiClient.getItemDownloadUrl(itemId),textAreaCopy=function textAreaCopy(){var textArea=document.createElement("textarea");textArea.value=downloadHref,document.body.appendChild(textArea),textArea.focus(),textArea.select(),document.execCommand("copy")?require(["toast"],(function(toast){toast(globalize.translate("CopyStreamURLSuccess"))})):prompt(globalize.translate("CopyStreamURL"),downloadHref),document.body.removeChild(textArea)};void 0===navigator.clipboard?textAreaCopy():navigator.clipboard.writeText(downloadHref).then((function(){require(["toast"],(function(toast){toast(globalize.translate("CopyStreamURLSuccess"))}))})).catch((function(){textAreaCopy()})),getResolveFunction(resolve,id)();break;case"editsubtitles":require(["subtitleEditor"],(function(subtitleEditor){subtitleEditor.show(itemId,serverId).then(getResolveFunction(resolve,id,!0),getResolveFunction(resolve,id))}));break;case"edit":(function editItem(apiClient,item){return new Promise((function(resolve,reject){var serverId=apiClient.serverInfo().Id;"Timer"===item.Type?require(["recordingEditor"],(function(recordingEditor){recordingEditor.show(item.Id,serverId).then(resolve,reject)})):"SeriesTimer"===item.Type?require(["seriesRecordingEditor"],(function(recordingEditor){recordingEditor.show(item.Id,serverId).then(resolve,reject)})):require(["metadataEditor"],(function(metadataEditor){metadataEditor.show(item.Id,serverId).then(resolve,reject)}))}))})(apiClient,item).then(getResolveFunction(resolve,id,!0),getResolveFunction(resolve,id));break;case"editimages":require(["imageEditor"],(function(imageEditor){imageEditor.show({itemId:itemId,serverId:serverId}).then(getResolveFunction(resolve,id,!0),getResolveFunction(resolve,id))}));break;case"identify":require(["itemIdentifier"],(function(itemIdentifier){itemIdentifier.show(itemId,serverId).then(getResolveFunction(resolve,id,!0),getResolveFunction(resolve,id))}));break;case"moremediainfo":require(["itemMediaInfo"],(function(itemMediaInfo){itemMediaInfo.show(itemId,serverId).then(getResolveFunction(resolve,id),getResolveFunction(resolve,id))}));break;case"refresh":!function refresh(apiClient,item){require(["refreshDialog"],(function(refreshDialog){new refreshDialog({itemIds:[item.Id],serverId:apiClient.serverInfo().Id,mode:"CollectionFolder"===item.Type?"scan":null}).show()}))}(apiClient,item),getResolveFunction(resolve,id)();break;case"open":appRouter.showItem(item),getResolveFunction(resolve,id)();break;case"play":play(item,!1),getResolveFunction(resolve,id)();break;case"resume":play(item,!0),getResolveFunction(resolve,id)();break;case"queue":play(item,!1,!0),getResolveFunction(resolve,id)();break;case"queuenext":play(item,!1,!0,!0),getResolveFunction(resolve,id)();break;case"stopPlayback":playbackManager.stop();break;case"clearQueue":playbackManager.clearQueue();break;case"record":require(["recordingCreator"],(function(recordingCreator){recordingCreator.show(itemId,serverId).then(getResolveFunction(resolve,id,!0),getResolveFunction(resolve,id))}));break;case"shuffle":playbackManager.shuffle(item),getResolveFunction(resolve,id)();break;case"instantmix":playbackManager.instantMix(item),getResolveFunction(resolve,id)();break;case"delete":(function deleteItem(apiClient,item){return new Promise((function(resolve,reject){require(["deleteHelper"],(function(deleteHelper){deleteHelper.deleteItem({item:item,navigate:!1}).then((function(){resolve(!0)}),reject)}))}))})(0,item).then(getResolveFunction(resolve,id,!0,!0),getResolveFunction(resolve,id));break;case"share":navigator.share({title:item.Name,text:item.Overview,url:"".concat(apiClient.serverAddress(),"/web/index.html#!/").concat(appRouter.getRouteUrl(item))});break;case"album":appRouter.showItem(item.AlbumId,item.ServerId),getResolveFunction(resolve,id)();break;case"artist":appRouter.showItem(item.AlbumArtists[0].Id,item.ServerId),getResolveFunction(resolve,id)();break;case"playallfromhere":case"queueallfromhere":getResolveFunction(resolve,id)();break;case"removefromplaylist":apiClient.ajax({url:apiClient.getUrl("Playlists/"+options.playlistId+"/Items",{EntryIds:[item.PlaylistItemId].join(",")}),type:"DELETE"}).then((function(){getResolveFunction(resolve,id,!0)()}));break;case"removefromcollection":apiClient.ajax({type:"DELETE",url:apiClient.getUrl("Collections/"+options.collectionId+"/Items",{Ids:[item.Id].join(",")})}).then((function(){getResolveFunction(resolve,id,!0)()}));break;case"canceltimer":!function deleteTimer(apiClient,item,resolve,command){require(["recordingHelper"],(function(recordingHelper){var timerId=item.TimerId||item.Id;recordingHelper.cancelTimerWithConfirmation(timerId,item.ServerId).then((function(){getResolveFunction(resolve,command,!0)()}))}))}(0,item,resolve,id);break;case"cancelseriestimer":!function deleteSeriesTimer(apiClient,item,resolve,command){require(["recordingHelper"],(function(recordingHelper){recordingHelper.cancelSeriesTimerWithConfirmation(item.Id,item.ServerId).then((function(){getResolveFunction(resolve,command,!0)()}))}))}(0,item,resolve,id);break;default:reject()}}))}function play(item,resume,queue,queueNext){var method=queue?queueNext?"queueNext":"queue":"play",startPosition=0;resume&&item.UserData&&item.UserData.PlaybackPositionTicks&&(startPosition=item.UserData.PlaybackPositionTicks),"Program"===item.Type?playbackManager[method]({ids:[item.ChannelId],startPositionTicks:startPosition,serverId:item.ServerId}):playbackManager[method]({items:[item],startPositionTicks:startPosition})}return{getCommands:getCommands,show:function show(options){var commands=getCommands(options);return commands.length?actionsheet.show({items:commands,positionTo:options.positionTo,resolveOnClick:["share"]}).then((function(id){return executeCommand(options.item,id,options)})):Promise.reject()}}}));
//# sourceMappingURL=itemContextMenu.js.map
