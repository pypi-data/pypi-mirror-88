{"version":3,"sources":["components/userdatabuttons/userdatabuttons.js"],"names":["define","connectionManager","globalize","dom","itemHelper","userDataMethods","markPlayed","link","id","getAttribute","serverId","classList","contains","played","remove","add","markDislike","clearLike","likes","parentNode","querySelector","markLike","markFavorite","markAsFavorite","favorite","getUserDataButtonHtml","method","itemId","buttonCssClass","iconCssClass","icon","tooltip","style","className","onContainerClick","e","btnUserData","parentWithClass","target","getIconsHtml","options","item","includePlayed","cssClass","html","userData","UserData","Id","isLocalItem","btnCssClass","ServerId","tooltipPlayed","translate","canMarkPlayed","Played","tooltipFavorite","IsFavorite","isLiked","apiClient","getApiClient","updateUserItemRating","getCurrentUserId","isPlayed","Date","isFavorite","updateFavoriteStatus","clearUserItemRating","fill","fillMode","element","insertAdjacentHTML","insertLocation","innerHTML","removeEventListener","passive","addEventListener","destroy"],"mappings":"AAAA,aAAAA,OAAO,CAAC,oBAAqB,YAAa,MAAO,aAAc,0BAA2B,iBAAkB,cAAe,0BAA0B,SAAUC,kBAAmBC,UAAWC,IAAKC,YAG9L,IAAIC,gBAAkB,CAClBC,WAmMJ,SAASA,WAAWC,MAEhB,IAAIC,GAAKD,KAAKE,aAAa,eACvBC,SAAWH,KAAKE,aAAa,iBAE5BF,KAAKI,UAAUC,SAAS,kBAQzBC,OAAOL,GAAIE,UAAU,GAErBH,KAAKI,UAAUG,OAAO,mBARtBD,OAAOL,GAAIE,UAAU,GAErBH,KAAKI,UAAUI,IAAI,mBA3MvBC,YA6KJ,SAASA,YAAYT,MAEjB,IAAIC,GAAKD,KAAKE,aAAa,eACvBC,SAAWH,KAAKE,aAAa,iBAE5BF,KAAKI,UAAUC,SAAS,kBAQzBK,UAAUT,GAAIE,UAEdH,KAAKI,UAAUG,OAAO,mBARtBI,MAAMV,GAAIE,UAAU,GAEpBH,KAAKI,UAAUI,IAAI,kBASvBR,KAAKY,WAAWC,cAAc,YAAYT,UAAUG,OAAO,kBA9L3DO,SAuJJ,SAASA,SAASd,MAEd,IAAIC,GAAKD,KAAKE,aAAa,eACvBC,SAAWH,KAAKE,aAAa,iBAE5BF,KAAKI,UAAUC,SAAS,kBAQzBK,UAAUT,GAAIE,UAEdH,KAAKI,UAAUG,OAAO,mBARtBI,MAAMV,GAAIE,UAAU,GAEpBH,KAAKI,UAAUI,IAAI,kBASvBR,KAAKY,WAAWC,cAAc,eAAeT,UAAUG,OAAO,kBAxK9DQ,aAsIJ,SAASA,aAAaf,MAElB,IAAIC,GAAKD,KAAKE,aAAa,eACvBC,SAAWH,KAAKE,aAAa,iBAE7Bc,gBAAkBhB,KAAKI,UAAUC,SAAS,iBAE9CY,SAAShB,GAAIE,SAAUa,gBAEnBA,eACAhB,KAAKI,UAAUI,IAAI,iBAEnBR,KAAKI,UAAUG,OAAO,mBA/I9B,SAASW,sBAAsBC,OAAQC,OAAQjB,SAAUkB,eAAgBC,aAAcC,KAAMC,QAASC,OAEpF,aAAVA,QACAA,MAAQ,MACRJ,eAAiBA,eAAkBA,eAAiB,QAAW,QAGnE,IACIK,UAAsB,QAAVD,MAAkB,eAAiB,WAcnD,OAZIJ,iBACAK,WAAa,IAAML,gBAGnBC,aACAA,cAAgB,IAEhBA,aAAe,GAKZ,kBAAoBE,QAAU,kBAAoBJ,OAAS,oBAAsBjB,SAAW,UAfhF,QAAVsB,MAAkB,cAAgB,2BAewE,kBAAoBN,OAAS,YAAcO,UAAY,mBAF1KJ,cAAgB,kBAE6L,IAAMC,KAAO,qBAG9N,SAASI,iBAAiBC,GAEtB,IAAIC,YAAcjC,IAAIkC,gBAAgBF,EAAEG,OAAQ,eAEhD,GAAKF,YAAL,CAIA,IAAIV,OAASU,YAAY3B,aAAa,eACtCJ,gBAAgBqB,QAAQU,cA+B5B,SAASG,aAAaC,SAElB,IAAIC,KAAOD,QAAQC,KACfC,cAAgBF,QAAQE,cACxBC,SAAWH,QAAQG,SACnBX,MAAQQ,QAAQR,MAEhBY,KAAO,GAEPC,SAAWJ,KAAKK,UAAY,GAE5BnB,OAASc,KAAKM,GAElB,GAAI3C,WAAW4C,YAAYP,MACvB,OAAOG,KAGX,IAAIK,YAAc,cAEdN,WACAM,aAAe,IAAMN,UAGzB,IAAId,aAAeW,QAAQX,aAEvBnB,SAAW+B,KAAKS,SAEpB,IAAsB,IAAlBR,cAAyB,CACzB,IAAIS,cAAgBjD,UAAUkD,UAAU,cAEpChD,WAAWiD,cAAcZ,QACrBI,SAASS,OACTV,MAAQnB,sBAAsB,aAAcE,OAAQjB,SAAUuC,YAAc,iBAAkBpB,aAAc,QAASsB,cAAenB,OAEpIY,MAAQnB,sBAAsB,aAAcE,OAAQjB,SAAUuC,YAAapB,aAAc,QAASsB,cAAenB,QAqB7H,IAAIuB,gBAAkBrD,UAAUkD,UAAU,YAQ1C,OAPIP,SAASW,WAETZ,MAAQnB,sBAAsB,eAAgBE,OAAQjB,SAAUuC,YAAc,6BAA8BpB,aAAc,WAAY0B,gBAAiBvB,OAEvJY,MAAQnB,sBAAsB,eAAgBE,OAAQjB,SAAUuC,YAAc,eAAgBpB,aAAc,WAAY0B,gBAAiBvB,OAGtIY,KAgFX,SAAS1B,MAAMV,GAAIE,SAAU+C,SACzB,IAAIC,UAAYzD,kBAAkB0D,aAAajD,UAC/C,OAAOgD,UAAUE,qBAAqBF,UAAUG,mBAAoBrD,GAAIiD,SAG5E,SAAS5C,OAAOL,GAAIE,SAAUoD,UAC1B,IAAIJ,UAAYzD,kBAAkB0D,aAAajD,UAI/C,OAAOgD,UAFMI,SAAW,aAAe,gBAEdJ,UAAUG,mBAAoBrD,GAAI,IAAIuD,MAGnE,SAASvC,SAAShB,GAAIE,SAAUsD,YAC5B,IAAIN,UAAYzD,kBAAkB0D,aAAajD,UAE/C,OAAOgD,UAAUO,qBAAqBP,UAAUG,mBAAoBrD,GAAIwD,YAG5E,SAAS/C,UAAUT,GAAIE,UAEnB,IAAIgD,UAAYzD,kBAAkB0D,aAAajD,UAE/C,OAAOgD,UAAUQ,oBAAoBR,UAAUG,mBAAoBrD,IAGvE,MAAO,CACH2D,KAtMJ,SAASA,KAAK3B,SAEV,IAAII,KAAOL,aAAaC,SAEC,mBAArBA,QAAQ4B,SACR5B,QAAQ6B,QAAQC,mBAAmB9B,QAAQ+B,gBAAkB,YAAa3B,MAE1EJ,QAAQ6B,QAAQG,UAAY5B,KAGhCzC,IAAIsE,oBAAoBjC,QAAQ6B,QAAS,QAASnC,iBAAkB,CAChEwC,SAAS,IAGbvE,IAAIwE,iBAAiBnC,QAAQ6B,QAAS,QAASnC,iBAAkB,CAC7DwC,SAAS,KAwLbE,QApLJ,SAASA,QAAQpC,SAEbA,QAAQ6B,QAAQG,UAAY,GAE5BrE,IAAIsE,oBAAoBjC,QAAQ6B,QAAS,QAASnC,iBAAkB,CAChEwC,SAAS,KAgLbnC,aAAcA","file":"userdatabuttons.js","sourcesContent":["define(['connectionManager', 'globalize', 'dom', 'itemHelper', 'paper-icon-button-light', 'material-icons', 'emby-button', 'css!./userdatabuttons'], function (connectionManager, globalize, dom, itemHelper) {\n    'use strict';\n\n    var userDataMethods = {\n        markPlayed: markPlayed,\n        markDislike: markDislike,\n        markLike: markLike,\n        markFavorite: markFavorite\n    };\n\n    function getUserDataButtonHtml(method, itemId, serverId, buttonCssClass, iconCssClass, icon, tooltip, style) {\n\n        if (style === 'fab-mini') {\n            style = 'fab';\n            buttonCssClass = buttonCssClass ? (buttonCssClass + ' mini') : 'mini';\n        }\n\n        var is = style === 'fab' ? 'emby-button' : 'paper-icon-button-light';\n        var className = style === 'fab' ? 'autoSize fab' : 'autoSize';\n\n        if (buttonCssClass) {\n            className += ' ' + buttonCssClass;\n        }\n\n        if (iconCssClass) {\n            iconCssClass += ' ';\n        } else {\n            iconCssClass = '';\n        }\n\n        iconCssClass += 'material-icons';\n\n        return '<button title=\"' + tooltip + '\" data-itemid=\"' + itemId + '\" data-serverid=\"' + serverId + '\" is=\"' + is + '\" data-method=\"' + method + '\" class=\"' + className + '\"><span class=\"' + iconCssClass + ' ' + icon + '\"></span></button>';\n    }\n\n    function onContainerClick(e) {\n\n        var btnUserData = dom.parentWithClass(e.target, 'btnUserData');\n\n        if (!btnUserData) {\n            return;\n        }\n\n        var method = btnUserData.getAttribute('data-method');\n        userDataMethods[method](btnUserData);\n    }\n\n    function fill(options) {\n\n        var html = getIconsHtml(options);\n\n        if (options.fillMode === 'insertAdjacent') {\n            options.element.insertAdjacentHTML(options.insertLocation || 'beforeend', html);\n        } else {\n            options.element.innerHTML = html;\n        }\n\n        dom.removeEventListener(options.element, 'click', onContainerClick, {\n            passive: true\n        });\n\n        dom.addEventListener(options.element, 'click', onContainerClick, {\n            passive: true\n        });\n    }\n\n    function destroy(options) {\n\n        options.element.innerHTML = '';\n\n        dom.removeEventListener(options.element, 'click', onContainerClick, {\n            passive: true\n        });\n    }\n\n    function getIconsHtml(options) {\n\n        var item = options.item;\n        var includePlayed = options.includePlayed;\n        var cssClass = options.cssClass;\n        var style = options.style;\n\n        var html = '';\n\n        var userData = item.UserData || {};\n\n        var itemId = item.Id;\n\n        if (itemHelper.isLocalItem(item)) {\n            return html;\n        }\n\n        var btnCssClass = 'btnUserData';\n\n        if (cssClass) {\n            btnCssClass += ' ' + cssClass;\n        }\n\n        var iconCssClass = options.iconCssClass;\n\n        var serverId = item.ServerId;\n\n        if (includePlayed !== false) {\n            var tooltipPlayed = globalize.translate('MarkPlayed');\n\n            if (itemHelper.canMarkPlayed(item)) {\n                if (userData.Played) {\n                    html += getUserDataButtonHtml('markPlayed', itemId, serverId, btnCssClass + ' btnUserDataOn', iconCssClass, 'check', tooltipPlayed, style);\n                } else {\n                    html += getUserDataButtonHtml('markPlayed', itemId, serverId, btnCssClass, iconCssClass, 'check', tooltipPlayed, style);\n                }\n            }\n        }\n\n        //var tooltipLike = globalize.translate('Like');\n        //var tooltipDislike = globalize.translate('Dislike');\n\n        //if (typeof userData.Likes == \"undefined\") {\n        //    html += getUserDataButtonHtml('markDislike', itemId, serverId, btnCssClass + ' btnUserData btnDislike', 'thumb-down', tooltipDislike);\n        //    html += getUserDataButtonHtml('markLike', itemId, serverId, btnCssClass + ' btnUserData btnLike', 'thumb-up', tooltipLike);\n        //}\n        //else if (userData.Likes) {\n        //    html += getUserDataButtonHtml('markDislike', itemId, serverId, btnCssClass + ' btnUserData btnDislike', 'thumb-down', tooltipDislike);\n        //    html += getUserDataButtonHtml('markLike', itemId, serverId, btnCssClass + ' btnUserData btnLike btnUserDataOn', 'thumb-up', tooltipLike);\n        //}\n        //else {\n        //    html += getUserDataButtonHtml('markDislike', itemId, serverId, btnCssClass + ' btnUserData btnDislike btnUserDataOn', 'thumb-down', tooltipDislike);\n        //    html += getUserDataButtonHtml('markLike', itemId, serverId, btnCssClass + ' btnUserData btnLike', 'thumb-up', tooltipLike);\n        //}\n\n        var tooltipFavorite = globalize.translate('Favorite');\n        if (userData.IsFavorite) {\n\n            html += getUserDataButtonHtml('markFavorite', itemId, serverId, btnCssClass + ' btnUserData btnUserDataOn', iconCssClass, 'favorite', tooltipFavorite, style);\n        } else {\n            html += getUserDataButtonHtml('markFavorite', itemId, serverId, btnCssClass + ' btnUserData', iconCssClass, 'favorite', tooltipFavorite, style);\n        }\n\n        return html;\n    }\n\n    function markFavorite(link) {\n\n        var id = link.getAttribute('data-itemid');\n        var serverId = link.getAttribute('data-serverid');\n\n        var markAsFavorite = !link.classList.contains('btnUserDataOn');\n\n        favorite(id, serverId, markAsFavorite);\n\n        if (markAsFavorite) {\n            link.classList.add('btnUserDataOn');\n        } else {\n            link.classList.remove('btnUserDataOn');\n        }\n    }\n\n    function markLike(link) {\n\n        var id = link.getAttribute('data-itemid');\n        var serverId = link.getAttribute('data-serverid');\n\n        if (!link.classList.contains('btnUserDataOn')) {\n\n            likes(id, serverId, true);\n\n            link.classList.add('btnUserDataOn');\n\n        } else {\n\n            clearLike(id, serverId);\n\n            link.classList.remove('btnUserDataOn');\n        }\n\n        link.parentNode.querySelector('.btnDislike').classList.remove('btnUserDataOn');\n    }\n\n    function markDislike(link) {\n\n        var id = link.getAttribute('data-itemid');\n        var serverId = link.getAttribute('data-serverid');\n\n        if (!link.classList.contains('btnUserDataOn')) {\n\n            likes(id, serverId, false);\n\n            link.classList.add('btnUserDataOn');\n\n        } else {\n\n            clearLike(id, serverId);\n\n            link.classList.remove('btnUserDataOn');\n        }\n\n        link.parentNode.querySelector('.btnLike').classList.remove('btnUserDataOn');\n    }\n\n    function markPlayed(link) {\n\n        var id = link.getAttribute('data-itemid');\n        var serverId = link.getAttribute('data-serverid');\n\n        if (!link.classList.contains('btnUserDataOn')) {\n\n            played(id, serverId, true);\n\n            link.classList.add('btnUserDataOn');\n\n        } else {\n\n            played(id, serverId, false);\n\n            link.classList.remove('btnUserDataOn');\n        }\n    }\n\n    function likes(id, serverId, isLiked) {\n        var apiClient = connectionManager.getApiClient(serverId);\n        return apiClient.updateUserItemRating(apiClient.getCurrentUserId(), id, isLiked);\n    }\n\n    function played(id, serverId, isPlayed) {\n        var apiClient = connectionManager.getApiClient(serverId);\n\n        var method = isPlayed ? 'markPlayed' : 'markUnplayed';\n\n        return apiClient[method](apiClient.getCurrentUserId(), id, new Date());\n    }\n\n    function favorite(id, serverId, isFavorite) {\n        var apiClient = connectionManager.getApiClient(serverId);\n\n        return apiClient.updateFavoriteStatus(apiClient.getCurrentUserId(), id, isFavorite);\n    }\n\n    function clearLike(id, serverId) {\n\n        var apiClient = connectionManager.getApiClient(serverId);\n\n        return apiClient.clearUserItemRating(apiClient.getCurrentUserId(), id);\n    }\n\n    return {\n        fill: fill,\n        destroy: destroy,\n        getIconsHtml: getIconsHtml\n    };\n\n});\n"]}