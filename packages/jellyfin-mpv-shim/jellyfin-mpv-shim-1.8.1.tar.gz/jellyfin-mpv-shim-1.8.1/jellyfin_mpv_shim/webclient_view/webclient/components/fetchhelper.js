define(["exports"],(function(_exports){"use strict";function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(arr)))return;var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function getFetchPromise(request){var headers=request.headers||{};"json"===request.dataType&&(headers.accept="application/json");var fetchRequest={headers:headers,method:request.type,credentials:"same-origin"},contentType=request.contentType;request.data&&("string"==typeof request.data?fetchRequest.body=request.data:(fetchRequest.body=paramsToString(request.data),contentType=contentType||"application/x-www-form-urlencoded; charset=UTF-8")),contentType&&(headers["Content-Type"]=contentType);var url=request.url;if(request.query){var paramString=paramsToString(request.query);paramString&&(url+="?".concat(paramString))}return request.timeout?function fetchWithTimeout(url,options,timeoutMs){return console.debug("fetchWithTimeout: timeoutMs: ".concat(timeoutMs,", url: ").concat(url)),new Promise((function(resolve,reject){var timeout=setTimeout(reject,timeoutMs);(options=options||{}).credentials="same-origin",fetch(url,options).then((function(response){clearTimeout(timeout),console.debug("fetchWithTimeout: succeeded connecting to url: ".concat(url)),resolve(response)}),(function(error){clearTimeout(timeout),console.debug("fetchWithTimeout: timed out connecting to url: ".concat(url)),reject(error)}))}))}(url,fetchRequest,request.timeout):fetch(url,fetchRequest)}function paramsToString(params){return Object.entries(params).filter((function(_ref){var _ref2=_slicedToArray(_ref,2),v=(_ref2[0],_ref2[1]);return null!=v&&""!==v})).map((function(_ref3){var _ref4=_slicedToArray(_ref3,2),k=_ref4[0],v=_ref4[1];return"".concat(encodeURIComponent(k),"=").concat(encodeURIComponent(v))})).join("&")}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.getFetchPromise=getFetchPromise,_exports.ajax=function ajax(request){if(!request)throw new Error("Request cannot be null");return request.headers=request.headers||{},console.debug("requesting url: ".concat(request.url)),getFetchPromise(request).then((function(response){return console.debug("response status: ".concat(response.status,", url: ").concat(request.url)),response.status<400?"json"===request.dataType||"application/json"===request.headers.accept?response.json():"text"===request.dataType||(response.headers.get("Content-Type")||"").toLowerCase().startsWith("text/")?response.text():response:Promise.reject(response)}),(function(err){throw console.error("request failed to url: ".concat(request.url)),err}))}}));
//# sourceMappingURL=fetchhelper.js.map
