{"version":3,"sources":["components/playback/brightnessosd.js"],"names":["define","_events","_playbackManager","_dom","_browser","_iconosd","_materialIcons","_interopRequireDefault","obj","__esModule","default","currentPlayer","osdElement","iconElement","progressElement","enableAnimation","hideTimeout","onHideComplete","this","classList","add","clearHideTimeout","clearTimeout","hideOsd","elem","offsetWidth","requestAnimationFrame","dom","addEventListener","whichTransitionEvent","once","call","setIcon","icon","remove","onBrightnessChanged","e","ensureOsdElement","browser","supportsCssAnimation","document","createElement","innerHTML","getOsdElementHtml","html","querySelector","body","appendChild","updateElementsFromPlayer","brightness","style","width","playbackManager","getBrightness","showOsd","removeEventListener","setTimeout","bindToPlayer","player","releaseCurrentPlayer","events","off","on","getCurrentPlayer"],"mappings":"AAAAA,OAAO,CAAC,SAAU,kBAAmB,MAAO,UAAW,gBAAiB,mBAAmB,SAAUC,QAASC,iBAAkBC,KAAMC,SAAUC,SAAUC,gBACxJ,aAOA,SAASC,uBAAuBC,KAAO,OAAOA,KAAOA,IAAIC,WAAaD,IAAM,CAAEE,QAASF,KADzF,IAAIG,cACAC,WACAC,YACAC,gBAEAC,gBAsCAC,YAJJ,SAASC,iBACLC,KAAKC,UAAUC,IAAI,QA0BvB,SAASC,mBACDL,cACAM,aAAaN,aACbA,YAAc,MAItB,SAASO,UAELF,mBAEA,IAAIG,KAAOZ,WACPY,OAEIT,iBAEKS,KAAKC,YAEVC,uBAAsB,WAClBF,KAAKL,UAAUC,IAAI,kBAEnBO,KAAAA,QAAIC,iBAAiBJ,KAAMG,KAAAA,QAAIE,uBAAwBZ,eAAgB,CACnEa,MAAM,QAIdb,eAAec,KAAKP,OAKhC,SAASQ,QAAQnB,YAAaoB,MAC1BpB,YAAYM,UAAUe,OAAO,kBAAmB,oBAAqB,kBACrErB,YAAYM,UAAUC,IAAIa,MA8B9B,SAASE,oBAAoBC,IAhH7B,SAASC,mBAEL,IAAIb,KAAOZ,WACNY,OAEDT,gBAAkBuB,SAAAA,QAAQC,wBAE1Bf,KAAOgB,SAASC,cAAc,QACzBtB,UAAUC,IAAI,QACnBI,KAAKL,UAAUC,IAAI,WACnBI,KAAKL,UAAUC,IAAI,kBACnBI,KAAKL,UAAUC,IAAI,iBACnBI,KAAKkB,UAtBb,SAASC,oBAOL,MAJQ,mEAEA,8GAARC,8KAiBqBD,GAEjB9B,YAAcW,KAAKqB,cAAc,mBACjC/B,gBAAkBU,KAAKqB,cAAc,yBAErCL,SAASM,KAAKC,YAAYvB,MAC1BZ,WAAaY,MAkGjBa,GA/BJ,SAASW,yBAAyBC,YAE1BpC,aAEImB,QAAQnB,YADRoC,YAAc,GACO,kBACdA,YAAc,GACA,oBAEA,kBAGzBnC,kBACAA,gBAAgBoC,MAAMC,OAASF,YAAc,GAAK,KAqBtDD,CAAyBI,iBAAAA,QAAgBC,cAJ5BnC,OAvFjB,SAASoC,UAELjC,mBAEA,IAAIG,KAAOZ,WAEXe,KAAAA,QAAI4B,oBAAoB/B,KAAMG,KAAAA,QAAIE,uBAAwBZ,eAAgB,CACtEa,MAAM,IAGVN,KAAKL,UAAUe,OAAO,QAGjBV,KAAKC,YAEVC,uBAAsB,WAClBF,KAAKL,UAAUe,OAAO,kBAEtBlB,YAAcwC,WAAWjC,QAAS,QA2EtC+B,GAGJ,SAASG,aAAaC,QAEdA,SAAW/C,iBAxBnB,SAASgD,uBAEL,IAAID,OAAS/C,cAET+C,SACAE,QAAAA,QAAOC,IAAIH,OAAQ,mBAAoBvB,qBACvCyB,QAAAA,QAAOC,IAAIH,OAAQ,eAAgBnC,SACnCZ,cAAgB,MAqBpBgD,GAEAhD,cAAgB+C,OAEXA,SAILnC,UACAqC,QAAAA,QAAOE,GAAGJ,OAAQ,mBAAoBvB,qBACtCyB,QAAAA,QAAOE,GAAGJ,OAAQ,eAAgBnC,WAnKtCtB,QAAAM,uBAAAN,SACAC,iBAAAK,uBAAAL,kBACAC,KAAAI,uBAAAJ,MACAC,SAAAG,uBAAAH,UAmKAwD,QAAAA,QAAOE,GAAGV,iBAAAA,QAAiB,gBAAgB,WACvCK,aAAaL,iBAAAA,QAAgBW,uBAGjCN,aAAaL,iBAAAA,QAAgBW","file":"brightnessosd.js","sourcesContent":["import events from 'events';\nimport playbackManager from 'playbackManager';\nimport dom from 'dom';\nimport browser from 'browser';\nimport 'css!./iconosd';\nimport 'material-icons';\n\nvar currentPlayer;\nvar osdElement;\nvar iconElement;\nvar progressElement;\n\nvar enableAnimation;\n\nfunction getOsdElementHtml() {\n    var html = '';\n\n    html += '<span class=\"material-icons iconOsdIcon brightness_high\"></span>';\n\n    html += '<div class=\"iconOsdProgressOuter\"><div class=\"iconOsdProgressInner brightnessOsdProgressInner\"></div></div>';\n\n    return html;\n}\n\nfunction ensureOsdElement() {\n\n    var elem = osdElement;\n    if (!elem) {\n\n        enableAnimation = browser.supportsCssAnimation();\n\n        elem = document.createElement('div');\n        elem.classList.add('hide');\n        elem.classList.add('iconOsd');\n        elem.classList.add('iconOsd-hidden');\n        elem.classList.add('brightnessOsd');\n        elem.innerHTML = getOsdElementHtml();\n\n        iconElement = elem.querySelector('.material-icons');\n        progressElement = elem.querySelector('.iconOsdProgressInner');\n\n        document.body.appendChild(elem);\n        osdElement = elem;\n    }\n}\n\nfunction onHideComplete() {\n    this.classList.add('hide');\n}\n\nvar hideTimeout;\nfunction showOsd() {\n\n    clearHideTimeout();\n\n    var elem = osdElement;\n\n    dom.removeEventListener(elem, dom.whichTransitionEvent(), onHideComplete, {\n        once: true\n    });\n\n    elem.classList.remove('hide');\n\n    // trigger reflow\n    void elem.offsetWidth;\n\n    requestAnimationFrame(function () {\n        elem.classList.remove('iconOsd-hidden');\n\n        hideTimeout = setTimeout(hideOsd, 3000);\n    });\n}\n\nfunction clearHideTimeout() {\n    if (hideTimeout) {\n        clearTimeout(hideTimeout);\n        hideTimeout = null;\n    }\n}\n\nfunction hideOsd() {\n\n    clearHideTimeout();\n\n    var elem = osdElement;\n    if (elem) {\n\n        if (enableAnimation) {\n            // trigger reflow\n            void elem.offsetWidth;\n\n            requestAnimationFrame(function () {\n                elem.classList.add('iconOsd-hidden');\n\n                dom.addEventListener(elem, dom.whichTransitionEvent(), onHideComplete, {\n                    once: true\n                });\n            });\n        } else {\n            onHideComplete.call(elem);\n        }\n    }\n}\n\nfunction setIcon(iconElement, icon) {\n    iconElement.classList.remove('brightness_high', 'brightness_medium', 'brightness_low');\n    iconElement.classList.add(icon);\n}\n\nfunction updateElementsFromPlayer(brightness) {\n\n    if (iconElement) {\n        if (brightness >= 80) {\n            setIcon(iconElement, 'brightness_high');\n        } else if (brightness >= 20) {\n            setIcon(iconElement, 'brightness_medium');\n        } else {\n            setIcon(iconElement, 'brightness_low');\n        }\n    }\n    if (progressElement) {\n        progressElement.style.width = (brightness || 0) + '%';\n    }\n}\n\nfunction releaseCurrentPlayer() {\n\n    var player = currentPlayer;\n\n    if (player) {\n        events.off(player, 'brightnesschange', onBrightnessChanged);\n        events.off(player, 'playbackstop', hideOsd);\n        currentPlayer = null;\n    }\n}\n\nfunction onBrightnessChanged(e) {\n\n    var player = this;\n\n    ensureOsdElement();\n\n    updateElementsFromPlayer(playbackManager.getBrightness(player));\n\n    showOsd();\n}\n\nfunction bindToPlayer(player) {\n\n    if (player === currentPlayer) {\n        return;\n    }\n\n    releaseCurrentPlayer();\n\n    currentPlayer = player;\n\n    if (!player) {\n        return;\n    }\n\n    hideOsd();\n    events.on(player, 'brightnesschange', onBrightnessChanged);\n    events.on(player, 'playbackstop', hideOsd);\n}\n\nevents.on(playbackManager, 'playerchange', function () {\n    bindToPlayer(playbackManager.getCurrentPlayer());\n});\n\nbindToPlayer(playbackManager.getCurrentPlayer());\n"]}