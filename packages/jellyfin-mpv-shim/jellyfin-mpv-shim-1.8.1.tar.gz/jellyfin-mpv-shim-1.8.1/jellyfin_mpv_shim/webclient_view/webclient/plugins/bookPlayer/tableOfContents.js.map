{"version":3,"sources":["plugins/bookPlayer/tableOfContents.js"],"names":["define","_exports","_dialogHelper","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","value","default","_interopRequireDefault","obj","__esModule","TableOfContents","bookPlayer","_classCallCheck","instance","Constructor","TypeError","this","_bookPlayer","_rendition","onDialogClosed","bind","createMediaElement","_createClass","protoProps","staticProps","prototype","destroy","elem","_elem","unbindEvents","dialogHelper","close","_tocElement","bindEvents","addEventListener","once","querySelector","removeEventListener","replaceLinks","contents","f","querySelectorAll","forEach","link","href","getAttribute","onclick","_this","rendition","createDialog","size","autoFocus","removeOnClose","id","tocHtml","book","navigation","chapter","startsWith","substr","concat","path","directory","label","innerHTML","relative","display","open"],"mappings":"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","file":"tableOfContents.js","sourcesContent":["import dialogHelper from 'dialogHelper';\n\nexport default class TableOfContents {\n    constructor(bookPlayer) {\n        this._bookPlayer = bookPlayer;\n        this._rendition = bookPlayer._rendition;\n\n        this.onDialogClosed = this.onDialogClosed.bind(this);\n\n        this.createMediaElement();\n    }\n\n    destroy() {\n        let elem = this._elem;\n        if (elem) {\n            this.unbindEvents();\n            dialogHelper.close(elem);\n        }\n\n        this._bookPlayer._tocElement = null;\n    }\n\n    bindEvents() {\n        let elem = this._elem;\n\n        elem.addEventListener('close', this.onDialogClosed, {once: true});\n        elem.querySelector('.btnBookplayerTocClose').addEventListener('click', this.onDialogClosed, {once: true});\n    }\n\n    unbindEvents() {\n        let elem = this._elem;\n\n        elem.removeEventListener('close', this.onDialogClosed);\n        elem.querySelector('.btnBookplayerTocClose').removeEventListener('click', this.onDialogClosed);\n    }\n\n    onDialogClosed() {\n        this.destroy();\n    }\n\n    replaceLinks(contents, f) {\n        let links = contents.querySelectorAll('a[href]');\n\n        links.forEach((link) => {\n            let href = link.getAttribute('href');\n\n            link.onclick = () => {\n                f(href);\n                return false;\n            };\n        });\n    }\n\n    createMediaElement() {\n        let rendition = this._rendition;\n\n        let elem = dialogHelper.createDialog({\n            size: 'small',\n            autoFocus: false,\n            removeOnClose: true\n        });\n\n        elem.id = 'dialogToc';\n\n        let tocHtml = '<div class=\"topRightActionButtons\">';\n        tocHtml += '<button is=\"paper-icon-button-light\" class=\"autoSize bookplayerButton btnBookplayerTocClose hide-mouse-idle-tv\" tabindex=\"-1\"><span class=\"material-icons bookplayerButtonIcon close\"></span></button>';\n        tocHtml += '</div>';\n        tocHtml += '<ul class=\"toc\">';\n        rendition.book.navigation.forEach((chapter) => {\n            tocHtml += '<li>';\n            // Remove '../' from href\n            let link = chapter.href.startsWith('../') ? chapter.href.substr(3) : chapter.href;\n            tocHtml += `<a href=\"${rendition.book.path.directory + link}\">${chapter.label}</a>`;\n            tocHtml += '</li>';\n        });\n\n        tocHtml += '</ul>';\n        elem.innerHTML = tocHtml;\n\n        this.replaceLinks(elem, (href) => {\n            let relative = rendition.book.path.relative(href);\n            rendition.display(relative);\n            this.destroy();\n        });\n\n        this._elem = elem;\n\n        this.bindEvents();\n        dialogHelper.open(elem);\n    }\n}\n"]}