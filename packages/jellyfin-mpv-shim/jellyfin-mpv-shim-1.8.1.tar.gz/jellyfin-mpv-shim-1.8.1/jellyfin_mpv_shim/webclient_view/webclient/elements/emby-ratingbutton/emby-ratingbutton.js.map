{"version":3,"sources":["elements/emby-ratingbutton/emby-ratingbutton.js"],"names":["define","connectionManager","serverNotifications","events","globalize","EmbyButtonPrototype","onClick","e","button","this","id","getAttribute","serverId","apiClient","getApiClient","likes","showPicker","itemId","isFavorite","updateFavoriteStatus","getCurrentUserId","then","userData","setState","Likes","IsFavorite","onUserDataChanged","ItemId","updateAttribute","icon","querySelector","classList","add","remove","setAttribute","clearEvents","removeEventListener","removeNotificationEvent","instance","name","handler","off","bindEvents","addEventListener","addNotificationEvent","localHandler","bind","on","EmbyRatingButtonPrototype","Object","create","createdCallback","call","attachedCallback","setTitle","title","translate","text","innerHTML","detachedCallback","setItem","item","Id","ServerId","UserData","removeAttribute","document","registerElement","prototype","extends"],"mappings":"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","file":"emby-ratingbutton.js","sourcesContent":["define(['connectionManager', 'serverNotifications', 'events', 'globalize', 'emby-button'], function (connectionManager, serverNotifications, events, globalize, EmbyButtonPrototype) {\n    'use strict';\n\n    function addNotificationEvent(instance, name, handler) {\n\n        var localHandler = handler.bind(instance);\n        events.on(serverNotifications, name, localHandler);\n        instance[name] = localHandler;\n    }\n\n    function removeNotificationEvent(instance, name) {\n\n        var handler = instance[name];\n        if (handler) {\n            events.off(serverNotifications, name, handler);\n            instance[name] = null;\n        }\n    }\n\n    function showPicker(button, apiClient, itemId, likes, isFavorite) {\n\n        return apiClient.updateFavoriteStatus(apiClient.getCurrentUserId(), itemId, !isFavorite);\n    }\n\n    function onClick(e) {\n\n        var button = this;\n        var id = button.getAttribute('data-id');\n        var serverId = button.getAttribute('data-serverid');\n        var apiClient = connectionManager.getApiClient(serverId);\n\n        var likes = this.getAttribute('data-likes');\n        var isFavorite = this.getAttribute('data-isfavorite') === 'true';\n        if (likes === 'true') {\n            likes = true;\n        } else if (likes === 'false') {\n            likes = false;\n        } else {\n            likes = null;\n        }\n\n        showPicker(button, apiClient, id, likes, isFavorite).then(function (userData) {\n\n            setState(button, userData.Likes, userData.IsFavorite);\n        });\n    }\n\n    function onUserDataChanged(e, apiClient, userData) {\n\n        var button = this;\n\n        if (userData.ItemId === button.getAttribute('data-id')) {\n\n            setState(button, userData.Likes, userData.IsFavorite);\n        }\n    }\n\n    function setState(button, likes, isFavorite, updateAttribute) {\n\n        var icon = button.querySelector('.material-icons');\n\n        if (isFavorite) {\n\n            if (icon) {\n                icon.classList.add('favorite');\n                icon.classList.add('ratingbutton-icon-withrating');\n            }\n\n            button.classList.add('ratingbutton-withrating');\n\n        } else if (likes) {\n\n            if (icon) {\n                icon.classList.add('favorite');\n                icon.classList.remove('ratingbutton-icon-withrating');\n                //icon.innerHTML = 'thumb_up';\n            }\n            button.classList.remove('ratingbutton-withrating');\n\n        } else if (likes === false) {\n\n            if (icon) {\n                icon.classList.add('favorite');\n                icon.classList.remove('ratingbutton-icon-withrating');\n                //icon.innerHTML = 'thumb_down';\n            }\n            button.classList.remove('ratingbutton-withrating');\n\n        } else {\n\n            if (icon) {\n                icon.classList.add('favorite');\n                icon.classList.remove('ratingbutton-icon-withrating');\n                //icon.innerHTML = 'thumbs_up_down';\n            }\n            button.classList.remove('ratingbutton-withrating');\n        }\n\n        if (updateAttribute !== false) {\n            button.setAttribute('data-isfavorite', isFavorite);\n\n            button.setAttribute('data-likes', (likes === null ? '' : likes));\n        }\n    }\n\n    function setTitle(button) {\n        button.title = globalize.translate('Favorite');\n\n        var text = button.querySelector('.button-text');\n        if (text) {\n            text.innerHTML = button.title;\n        }\n    }\n\n    function clearEvents(button) {\n\n        button.removeEventListener('click', onClick);\n        removeNotificationEvent(button, 'UserDataChanged');\n    }\n\n    function bindEvents(button) {\n\n        clearEvents(button);\n\n        button.addEventListener('click', onClick);\n        addNotificationEvent(button, 'UserDataChanged', onUserDataChanged);\n    }\n\n    var EmbyRatingButtonPrototype = Object.create(EmbyButtonPrototype);\n\n    EmbyRatingButtonPrototype.createdCallback = function () {\n\n        // base method\n        if (EmbyButtonPrototype.createdCallback) {\n            EmbyButtonPrototype.createdCallback.call(this);\n        }\n    };\n\n    EmbyRatingButtonPrototype.attachedCallback = function () {\n\n        // base method\n        if (EmbyButtonPrototype.attachedCallback) {\n            EmbyButtonPrototype.attachedCallback.call(this);\n        }\n\n        var itemId = this.getAttribute('data-id');\n        var serverId = this.getAttribute('data-serverid');\n        if (itemId && serverId) {\n\n            var likes = this.getAttribute('data-likes');\n            var isFavorite = this.getAttribute('data-isfavorite') === 'true';\n            if (likes === 'true') {\n                likes = true;\n            } else if (likes === 'false') {\n                likes = false;\n            } else {\n                likes = null;\n            }\n\n            setState(this, likes, isFavorite, false);\n            bindEvents(this);\n        }\n\n        setTitle(this);\n    };\n\n    EmbyRatingButtonPrototype.detachedCallback = function () {\n\n        // base method\n        if (EmbyButtonPrototype.detachedCallback) {\n            EmbyButtonPrototype.detachedCallback.call(this);\n        }\n\n        clearEvents(this);\n    };\n\n    EmbyRatingButtonPrototype.setItem = function (item) {\n\n        if (item) {\n\n            this.setAttribute('data-id', item.Id);\n            this.setAttribute('data-serverid', item.ServerId);\n\n            var userData = item.UserData || {};\n            setState(this, userData.Likes, userData.IsFavorite);\n            bindEvents(this);\n\n        } else {\n\n            this.removeAttribute('data-id');\n            this.removeAttribute('data-serverid');\n            this.removeAttribute('data-likes');\n            this.removeAttribute('data-isfavorite');\n            clearEvents(this);\n        }\n    };\n\n    document.registerElement('emby-ratingbutton', {\n        prototype: EmbyRatingButtonPrototype,\n        extends: 'button'\n    });\n});\n"]}