{"version":3,"sources":["controllers/dashboard/metadatanfo.js"],"names":["define","$","loading","libraryMenu","globalize","onSubmit","show","form","this","ApiClient","getNamedConfiguration","metadataKey","then","config","UserId","val","ReleaseDateFormat","SaveImagePathsInNfo","querySelector","checked","EnablePathSubstitution","EnableExtraThumbsDuplication","updateNamedConfiguration","Dashboard","processServerConfigurationUpdateResult","showConfirmMessage","msg","push","translate","require","alert","text","join","getTabs","href","name","document","on","off","setTabs","page","promise1","getUsers","promise2","Promise","all","responses","loadPage","users","html","map","user","Id","Name","hide"],"mappings":"AAAA,aAAAA,OAAO,CAAC,SAAU,UAAW,cAAe,cAAc,SAAUC,EAAGC,QAASC,YAAaC,WAgBzF,SAASC,WACLH,QAAQI,OACR,IAAIC,KAAOC,KAYX,OAXAC,UAAUC,sBAAsBC,aAAaC,MAAK,SAAUC,QACxDA,OAAOC,OAASb,EAAE,cAAeM,MAAMQ,OAAS,KAChDF,OAAOG,kBAAoBf,EAAE,2BAA4BM,MAAMQ,MAC/DF,OAAOI,oBAAsBV,KAAKW,cAAc,sBAAsBC,QACtEN,OAAOO,uBAAyBb,KAAKW,cAAc,8BAA8BC,QACjFN,OAAOQ,6BAA+Bd,KAAKW,cAAc,yBAAyBC,QAClFV,UAAUa,yBAAyBX,YAAaE,QAAQD,MAAK,WACzDW,UAAUC,yCAOtB,SAASC,mBAAmBZ,QACxB,IAAIa,IAAM,GACVA,IAAIC,KAAKvB,UAAUwB,UAAU,8BAE7BC,QAAQ,CAAC,UAAU,SAAUC,OACzBA,MAAM,CACFC,KAAML,IAAIM,KAAK,mBAZfP,UAGD,EAcX,SAASQ,UACL,MAAO,CAAC,CACJC,KAAM,eACNC,KAAM/B,UAAUwB,UAAU,oBAC3B,CACCM,KAAM,sBACNC,KAAM/B,UAAUwB,UAAU,eAC3B,CACCM,KAAM,sBACNC,KAAM/B,UAAUwB,UAAU,gBAC3B,CACCM,KAAM,mBACNC,KAAM/B,UAAUwB,UAAU,oBAIlC,IAAIjB,YAAc,eAClBV,EAAEmC,UAAUC,GAAG,WAAY,oBAAoB,WAC3CpC,EAAE,oBAAoBqC,IAAI,SAAUjC,UAAUgC,GAAG,SAAUhC,aAC5DgC,GAAG,WAAY,oBAAoB,WAClClC,YAAYoC,QAAQ,WAAY,EAAGN,SACnC/B,QAAQI,OACR,IAAIkC,KAAOhC,KACPiC,SAAWhC,UAAUiC,WACrBC,SAAWlC,UAAUC,sBAAsBC,aAC/CiC,QAAQC,IAAI,CAACJ,SAAUE,WAAW/B,MAAK,SAAUkC,YAlErD,SAASC,SAASP,KAAM3B,OAAQmC,OAC5B,IAAIC,KAAO,wCAA0C7C,UAAUwB,UAAU,cAAgB,YACzFqB,MAAQD,MAAME,KAAI,SAAUC,MACxB,MAAO,kBAAoBA,KAAKC,GAAK,KAAOD,KAAKE,KAAO,eACzDrB,KAAK,IACR/B,EAAE,cAAeuC,MAAMS,KAAKA,MAAMlC,IAAIF,OAAOC,QAAU,IACvDb,EAAE,2BAA4BuC,MAAMzB,IAAIF,OAAOG,mBAC/CwB,KAAKtB,cAAc,sBAAsBC,QAAUN,OAAOI,oBAC1DuB,KAAKtB,cAAc,8BAA8BC,QAAUN,OAAOO,uBAClEoB,KAAKtB,cAAc,yBAAyBC,QAAUN,OAAOQ,6BAC7DnB,QAAQoD,OAyDJP,CAASP,KAAMM,UAAU,GAAIA,UAAU","file":"metadatanfo.js","sourcesContent":["define(['jQuery', 'loading', 'libraryMenu', 'globalize'], function ($, loading, libraryMenu, globalize) {\n    'use strict';\n\n    function loadPage(page, config, users) {\n        var html = '<option value=\"\" selected=\"selected\">' + globalize.translate('OptionNone') + '</option>';\n        html += users.map(function (user) {\n            return '<option value=\"' + user.Id + '\">' + user.Name + '</option>';\n        }).join('');\n        $('#selectUser', page).html(html).val(config.UserId || '');\n        $('#selectReleaseDateFormat', page).val(config.ReleaseDateFormat);\n        page.querySelector('#chkSaveImagePaths').checked = config.SaveImagePathsInNfo;\n        page.querySelector('#chkEnablePathSubstitution').checked = config.EnablePathSubstitution;\n        page.querySelector('#chkEnableExtraThumbs').checked = config.EnableExtraThumbsDuplication;\n        loading.hide();\n    }\n\n    function onSubmit() {\n        loading.show();\n        var form = this;\n        ApiClient.getNamedConfiguration(metadataKey).then(function (config) {\n            config.UserId = $('#selectUser', form).val() || null;\n            config.ReleaseDateFormat = $('#selectReleaseDateFormat', form).val();\n            config.SaveImagePathsInNfo = form.querySelector('#chkSaveImagePaths').checked;\n            config.EnablePathSubstitution = form.querySelector('#chkEnablePathSubstitution').checked;\n            config.EnableExtraThumbsDuplication = form.querySelector('#chkEnableExtraThumbs').checked;\n            ApiClient.updateNamedConfiguration(metadataKey, config).then(function () {\n                Dashboard.processServerConfigurationUpdateResult();\n                showConfirmMessage(config);\n            });\n        });\n        return false;\n    }\n\n    function showConfirmMessage(config) {\n        var msg = [];\n        msg.push(globalize.translate('MetadataSettingChangeHelp'));\n\n        require(['alert'], function (alert) {\n            alert({\n                text: msg.join('<br/><br/>')\n            });\n        });\n    }\n\n    function getTabs() {\n        return [{\n            href: 'library.html',\n            name: globalize.translate('HeaderLibraries')\n        }, {\n            href: 'librarydisplay.html',\n            name: globalize.translate('TabDisplay')\n        }, {\n            href: 'metadataimages.html',\n            name: globalize.translate('TabMetadata')\n        }, {\n            href: 'metadatanfo.html',\n            name: globalize.translate('TabNfoSettings')\n        }];\n    }\n\n    var metadataKey = 'xbmcmetadata';\n    $(document).on('pageinit', '#metadataNfoPage', function () {\n        $('.metadataNfoForm').off('submit', onSubmit).on('submit', onSubmit);\n    }).on('pageshow', '#metadataNfoPage', function () {\n        libraryMenu.setTabs('metadata', 3, getTabs);\n        loading.show();\n        var page = this;\n        var promise1 = ApiClient.getUsers();\n        var promise2 = ApiClient.getNamedConfiguration(metadataKey);\n        Promise.all([promise1, promise2]).then(function (responses) {\n            loadPage(page, responses[1], responses[0]);\n        });\n    });\n});\n"]}