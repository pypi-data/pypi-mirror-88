"use strict";define(["jQuery","loading","globalize","emby-checkbox","emby-textarea","emby-input","emby-select","emby-button"],(function($,loading,globalize){function onSubmit(){loading.show();var form=this;return $(form).parents(".page"),ApiClient.getServerConfiguration().then((function(config){config.ServerName=$("#txtServerName",form).val(),config.UICulture=$("#selectLocalizationLanguage",form).val(),config.CachePath=form.querySelector("#txtCachePath").value,config.MetadataPath=$("#txtMetadataPath",form).val(),config.MetadataNetworkPath=$("#txtMetadataNetworkPath",form).val();var requiresReload=config.UICulture!==currentLanguage;ApiClient.updateServerConfiguration(config).then((function(){ApiClient.getNamedConfiguration(brandingConfigKey).then((function(brandingConfig){brandingConfig.LoginDisclaimer=form.querySelector("#txtLoginDisclaimer").value,brandingConfig.CustomCss=form.querySelector("#txtCustomCss").value,currentBrandingOptions&&brandingConfig.CustomCss!==currentBrandingOptions.CustomCss&&(requiresReload=!0),ApiClient.updateNamedConfiguration(brandingConfigKey,brandingConfig).then((function(){Dashboard.processServerConfigurationUpdateResult(),requiresReload&&!AppInfo.isNativeApp&&window.location.reload(!0)}))}))}),(function(){require(["alert"],(function(alert){alert(globalize.translate("DefaultErrorMessage"))})),Dashboard.processServerConfigurationUpdateResult()}))})),!1}var currentBrandingOptions,currentLanguage,brandingConfigKey="branding";return function(view,params){$("#btnSelectCachePath",view).on("click.selectDirectory",(function(){require(["directorybrowser"],(function(directoryBrowser){var picker=new directoryBrowser;picker.show({callback:function callback(path){path&&(view.querySelector("#txtCachePath").value=path),picker.close()},validateWriteable:!0,header:globalize.translate("HeaderSelectServerCachePath"),instruction:globalize.translate("HeaderSelectServerCachePathHelp")})}))})),$("#btnSelectMetadataPath",view).on("click.selectDirectory",(function(){require(["directorybrowser"],(function(directoryBrowser){var picker=new directoryBrowser;picker.show({path:$("#txtMetadataPath",view).val(),networkSharePath:$("#txtMetadataNetworkPath",view).val(),callback:function callback(path,networkPath){path&&$("#txtMetadataPath",view).val(path),networkPath&&$("#txtMetadataNetworkPath",view).val(networkPath),picker.close()},validateWriteable:!0,header:globalize.translate("HeaderSelectMetadataPath"),instruction:globalize.translate("HeaderSelectMetadataPathHelp"),enableNetworkSharePath:!0})}))})),$(".dashboardGeneralForm",view).off("submit",onSubmit).on("submit",onSubmit),view.addEventListener("viewshow",(function(){var promiseConfig=ApiClient.getServerConfiguration(),promiseLanguageOptions=ApiClient.getJSON(ApiClient.getUrl("Localization/Options")),promiseSystemInfo=ApiClient.getSystemInfo();Promise.all([promiseConfig,promiseLanguageOptions,promiseSystemInfo]).then((function(responses){!function loadPage(page,config,languageOptions,systemInfo){page.querySelector("#txtServerName").value=systemInfo.ServerName,page.querySelector("#txtCachePath").value=systemInfo.CachePath||"",$("#txtMetadataPath",page).val(systemInfo.InternalMetadataPath||""),$("#txtMetadataNetworkPath",page).val(systemInfo.MetadataNetworkPath||""),$("#selectLocalizationLanguage",page).html(languageOptions.map((function(language){return'<option value="'+language.Value+'">'+language.Name+"</option>"}))).val(config.UICulture),currentLanguage=config.UICulture,loading.hide()}(view,responses[0],responses[1],responses[2])})),ApiClient.getNamedConfiguration(brandingConfigKey).then((function(config){currentBrandingOptions=config,view.querySelector("#txtLoginDisclaimer").value=config.LoginDisclaimer||"",view.querySelector("#txtCustomCss").value=config.CustomCss||""}))}))}}));
//# sourceMappingURL=general.js.map
