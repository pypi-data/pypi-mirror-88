{"version":3,"sources":["controllers/shows/tvrecommended.js"],"names":["define","events","inputManager","libraryMenu","layoutManager","loading","dom","userSettings","cardBuilder","playbackManager","mainTabsManager","globalize","getTabs","name","translate","cssClass","setScrollClasses","elem","scrollX","classList","add","tv","remove","view","params","reload","show","loadResume","parentId","getTopParentId","options","SortBy","SortOrder","IncludeItemTypes","Filters","Limit","getWindowSize","innerWidth","Recursive","Fields","ExcludeLocationTypes","ParentId","ImageTypeLimit","EnableImageTypes","EnableTotalRecordCount","ApiClient","getItems","getCurrentUserId","then","result","Items","length","querySelector","allowBottomPadding","enableScrollX","container","buildCards","itemsContainer","preferThumb","shape","scalable","showTitle","showParentTitle","overlayText","centerText","overlayPlayButton","cardLayout","loadNextUp","query","UserId","getNextUpEpisodes","hide","require","autoFocuser","autoFocus","desktop","onBeforeTabChange","e","preLoadTab","page","index","getTabController","controller","renderedTabs","indexOf","preRender","parseInt","detail","selectedTabIndex","onTabChange","newIndex","loadTab","currentTabIndex","push","renderTab","getTabContainers","querySelectorAll","callback","depends","controllerFactory","tabContent","self","tabControllers","collectionType","topParentId","initTab","onPlaybackStop","state","NowPlayingItem","MediaType","getTabsElement","triggerTabChange","onWebSocketMessage","data","msg","MessageType","Data","onInputCommand","command","preventDefault","Dashboard","navigate","this","tab","getDefaultTabIndex","folderId","get","addEventListener","isRestored","initTabs","setTabs","getAttribute","getItem","item","setAttribute","Name","setTitle","on","window","off","forEach","t","destroy"],"mappings":"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","file":"tvrecommended.js","sourcesContent":["define(['events', 'inputManager', 'libraryMenu', 'layoutManager', 'loading', 'dom', 'userSettings', 'cardBuilder', 'playbackManager', 'mainTabsManager', 'globalize', 'scrollStyles', 'emby-itemscontainer', 'emby-button'], function (events, inputManager, libraryMenu, layoutManager, loading, dom, userSettings, cardBuilder, playbackManager, mainTabsManager, globalize) {\n    'use strict';\n\n    function getTabs() {\n        return [{\n            name: globalize.translate('TabShows')\n        }, {\n            name: globalize.translate('TabSuggestions')\n        }, {\n            name: globalize.translate('TabLatest')\n        }, {\n            name: globalize.translate('TabUpcoming')\n        }, {\n            name: globalize.translate('TabGenres')\n        }, {\n            name: globalize.translate('TabNetworks')\n        }, {\n            name: globalize.translate('TabEpisodes')\n        }, {\n            name: globalize.translate('ButtonSearch'),\n            cssClass: 'searchTabButton'\n        }];\n    }\n\n    function getDefaultTabIndex(folderId) {\n        switch (userSettings.get('landing-' + folderId)) {\n            case 'suggestions':\n                return 1;\n\n            case 'latest':\n                return 2;\n\n            case 'favorites':\n                return 1;\n\n            case 'genres':\n                return 4;\n\n            default:\n                return 0;\n        }\n    }\n\n    function setScrollClasses(elem, scrollX) {\n        if (scrollX) {\n            elem.classList.add('hiddenScrollX');\n\n            if (layoutManager.tv) {\n                elem.classList.add('smoothScrollX');\n            }\n\n            elem.classList.add('scrollX');\n            elem.classList.remove('vertical-wrap');\n        } else {\n            elem.classList.remove('hiddenScrollX');\n            elem.classList.remove('smoothScrollX');\n            elem.classList.remove('scrollX');\n            elem.classList.add('vertical-wrap');\n        }\n    }\n\n    return function (view, params) {\n        function reload() {\n            loading.show();\n            loadResume();\n            loadNextUp();\n        }\n\n        function loadNextUp() {\n            var query = {\n                Limit: 24,\n                Fields: 'PrimaryImageAspectRatio,SeriesInfo,DateCreated,BasicSyncInfo',\n                UserId: ApiClient.getCurrentUserId(),\n                ImageTypeLimit: 1,\n                EnableImageTypes: 'Primary,Backdrop,Thumb',\n                EnableTotalRecordCount: false\n            };\n            query.ParentId = libraryMenu.getTopParentId();\n            ApiClient.getNextUpEpisodes(query).then(function (result) {\n                if (result.Items.length) {\n                    view.querySelector('.noNextUpItems').classList.add('hide');\n                } else {\n                    view.querySelector('.noNextUpItems').classList.remove('hide');\n                }\n\n                var container = view.querySelector('#nextUpItems');\n                cardBuilder.buildCards(result.Items, {\n                    itemsContainer: container,\n                    preferThumb: true,\n                    shape: 'backdrop',\n                    scalable: true,\n                    showTitle: true,\n                    showParentTitle: true,\n                    overlayText: false,\n                    centerText: true,\n                    overlayPlayButton: true,\n                    cardLayout: false\n                });\n                loading.hide();\n\n                require(['autoFocuser'], function (autoFocuser) {\n                    autoFocuser.autoFocus(view);\n                });\n            });\n        }\n\n        function enableScrollX() {\n            return !layoutManager.desktop;\n        }\n\n        function getThumbShape() {\n            return enableScrollX() ? 'overflowBackdrop' : 'backdrop';\n        }\n\n        function loadResume() {\n            var parentId = libraryMenu.getTopParentId();\n            var screenWidth = dom.getWindowSize().innerWidth;\n            var limit = screenWidth >= 1600 ? 5 : 6;\n            var options = {\n                SortBy: 'DatePlayed',\n                SortOrder: 'Descending',\n                IncludeItemTypes: 'Episode',\n                Filters: 'IsResumable',\n                Limit: limit,\n                Recursive: true,\n                Fields: 'PrimaryImageAspectRatio,SeriesInfo,UserData,BasicSyncInfo',\n                ExcludeLocationTypes: 'Virtual',\n                ParentId: parentId,\n                ImageTypeLimit: 1,\n                EnableImageTypes: 'Primary,Backdrop,Thumb',\n                EnableTotalRecordCount: false\n            };\n            ApiClient.getItems(ApiClient.getCurrentUserId(), options).then(function (result) {\n                if (result.Items.length) {\n                    view.querySelector('#resumableSection').classList.remove('hide');\n                } else {\n                    view.querySelector('#resumableSection').classList.add('hide');\n                }\n\n                var allowBottomPadding = !enableScrollX();\n                var container = view.querySelector('#resumableItems');\n                cardBuilder.buildCards(result.Items, {\n                    itemsContainer: container,\n                    preferThumb: true,\n                    shape: getThumbShape(),\n                    scalable: true,\n                    showTitle: true,\n                    showParentTitle: true,\n                    overlayText: false,\n                    centerText: true,\n                    overlayPlayButton: true,\n                    allowBottomPadding: allowBottomPadding,\n                    cardLayout: false\n                });\n            });\n        }\n\n        function onBeforeTabChange(e) {\n            preLoadTab(view, parseInt(e.detail.selectedTabIndex));\n        }\n\n        function onTabChange(e) {\n            var newIndex = parseInt(e.detail.selectedTabIndex);\n            loadTab(view, newIndex);\n        }\n\n        function getTabContainers() {\n            return view.querySelectorAll('.pageTabContent');\n        }\n\n        function initTabs() {\n            mainTabsManager.setTabs(view, currentTabIndex, getTabs, getTabContainers, onBeforeTabChange, onTabChange);\n        }\n\n        function getTabController(page, index, callback) {\n            var depends = [];\n\n            switch (index) {\n                case 0:\n                    depends.push('controllers/shows/tvshows');\n                    break;\n\n                case 1:\n                    break;\n\n                case 2:\n                    depends.push('controllers/shows/tvlatest');\n                    break;\n\n                case 3:\n                    depends.push('controllers/shows/tvupcoming');\n                    break;\n\n                case 4:\n                    depends.push('controllers/shows/tvgenres');\n                    break;\n\n                case 5:\n                    depends.push('controllers/shows/tvstudios');\n                    break;\n\n                case 6:\n                    depends.push('controllers/shows/episodes');\n                    break;\n\n                case 7:\n                    depends.push('scripts/searchtab');\n            }\n\n            require(depends, function (controllerFactory) {\n                var tabContent;\n\n                if (index === 1) {\n                    tabContent = view.querySelector(\".pageTabContent[data-index='\" + index + \"']\");\n                    self.tabContent = tabContent;\n                }\n\n                var controller = tabControllers[index];\n\n                if (!controller) {\n                    tabContent = view.querySelector(\".pageTabContent[data-index='\" + index + \"']\");\n\n                    if (index === 1) {\n                        controller = self;\n                    } else if (index === 7) {\n                        controller = new controllerFactory(view, tabContent, {\n                            collectionType: 'tvshows',\n                            parentId: params.topParentId\n                        });\n                    } else {\n                        controller = new controllerFactory(view, params, tabContent);\n                    }\n\n                    tabControllers[index] = controller;\n\n                    if (controller.initTab) {\n                        controller.initTab();\n                    }\n                }\n\n                callback(controller);\n            });\n        }\n\n        function preLoadTab(page, index) {\n            getTabController(page, index, function (controller) {\n                if (renderedTabs.indexOf(index) == -1 && controller.preRender) {\n                    controller.preRender();\n                }\n            });\n        }\n\n        function loadTab(page, index) {\n            currentTabIndex = index;\n            getTabController(page, index, function (controller) {\n                initialTabIndex = null;\n\n                if (renderedTabs.indexOf(index) == -1) {\n                    renderedTabs.push(index);\n                    controller.renderTab();\n                }\n            });\n        }\n\n        function onPlaybackStop(e, state) {\n            if (state.NowPlayingItem && state.NowPlayingItem.MediaType == 'Video') {\n                renderedTabs = [];\n                mainTabsManager.getTabsElement().triggerTabChange();\n            }\n        }\n\n        function onWebSocketMessage(e, data) {\n            var msg = data;\n\n            if (msg.MessageType === 'UserDataChanged' && msg.Data.UserId == ApiClient.getCurrentUserId()) {\n                renderedTabs = [];\n            }\n        }\n\n        function onInputCommand(e) {\n            switch (e.detail.command) {\n                case 'search':\n                    e.preventDefault();\n                    Dashboard.navigate('search.html?collectionType=tv&parentId=' + params.topParentId);\n            }\n        }\n\n        var isViewRestored;\n        var self = this;\n        var currentTabIndex = parseInt(params.tab || getDefaultTabIndex(params.topParentId));\n        var initialTabIndex = currentTabIndex;\n\n        self.initTab = function () {\n            var tabContent = self.tabContent;\n            setScrollClasses(tabContent.querySelector('#resumableItems'), enableScrollX());\n        };\n\n        self.renderTab = function () {\n            reload();\n        };\n\n        var tabControllers = [];\n        var renderedTabs = [];\n        setScrollClasses(view.querySelector('#resumableItems'), enableScrollX());\n        view.addEventListener('viewshow', function (e) {\n            isViewRestored = e.detail.isRestored;\n            initTabs();\n            if (!view.getAttribute('data-title')) {\n                var parentId = params.topParentId;\n\n                if (parentId) {\n                    ApiClient.getItem(ApiClient.getCurrentUserId(), parentId).then(function (item) {\n                        view.setAttribute('data-title', item.Name);\n                        libraryMenu.setTitle(item.Name);\n                    });\n                } else {\n                    view.setAttribute('data-title', globalize.translate('TabShows'));\n                    libraryMenu.setTitle(globalize.translate('TabShows'));\n                }\n            }\n\n            events.on(playbackManager, 'playbackstop', onPlaybackStop);\n            events.on(ApiClient, 'message', onWebSocketMessage);\n            inputManager.on(window, onInputCommand);\n        });\n        view.addEventListener('viewbeforehide', function (e) {\n            inputManager.off(window, onInputCommand);\n            events.off(playbackManager, 'playbackstop', onPlaybackStop);\n            events.off(ApiClient, 'message', onWebSocketMessage);\n        });\n        view.addEventListener('viewdestroy', function (e) {\n            tabControllers.forEach(function (t) {\n                if (t.destroy) {\n                    t.destroy();\n                }\n            });\n        });\n    };\n});\n"]}