{"version":3,"sources":["controllers/dashboard/metadataImages.js"],"names":["define","$","dom","loading","libraryMenu","globalize","populateCountries","select","ApiClient","getCountries","then","allCountries","html","i","length","culture","TwoLetterISORegionName","DisplayName","innerHTML","onSubmit","form","this","show","getServerConfiguration","config","PreferredMetadataLanguage","querySelector","value","MetadataCountryCode","updateServerConfiguration","Dashboard","processServerConfigurationUpdateResult","getTabs","href","name","translate","document","on","off","setTabs","loadPage","page","promises","getCultures","languages","TwoLetterISOLanguageName","Promise","all","responses","hide"],"mappings":"AAAA,aAAAA,OAAO,CAAC,SAAU,MAAO,UAAW,cAAe,YAAa,kBAAkB,SAASC,EAAGC,IAAKC,QAASC,YAAaC,WAerH,SAASC,kBAAkBC,QACvB,OAAOC,UAAUC,eAAeC,MAAK,SAASC,cAC1C,IAAIC,KAAO,GACXA,MAAQ,6BACR,IAAK,IAAIC,EAAI,EAAGC,OAASH,aAAaG,OAAQD,EAAIC,OAAQD,IAAK,CAC3D,IAAIE,QAAUJ,aAAaE,GAC3BD,MAAQ,kBAAoBG,QAAQC,uBAAyB,KAAOD,QAAQE,YAAc,YAE9FV,OAAOW,UAAYN,QAc3B,SAASO,WACL,IAAIC,KAAOC,KACX,OAAOlB,QAAQmB,OAAQd,UAAUe,yBAAyBb,MAAK,SAASc,QACpEA,OAAOC,0BAA4BL,KAAKM,cAAc,mBAAmBC,MACzEH,OAAOI,oBAAsBR,KAAKM,cAAc,kBAAkBC,MAClEnB,UAAUqB,0BAA0BL,QAAQd,KAAKoB,UAAUC,4CAC3D,EAGR,SAASC,UACL,MAAO,CAAC,CACJC,KAAM,eACNC,KAAM7B,UAAU8B,UAAU,oBAC3B,CACCF,KAAM,sBACNC,KAAM7B,UAAU8B,UAAU,eAC3B,CACCF,KAAM,sBACNC,KAAM7B,UAAU8B,UAAU,gBAC3B,CACCF,KAAM,mBACNC,KAAM7B,UAAU8B,UAAU,oBAIlClC,EAAEmC,UAAUC,GAAG,WAAY,oCAAoC,WAC3DpC,EAAE,oCAAoCqC,IAAI,SAAUnB,UAAUkB,GAAG,SAAUlB,aAC5EkB,GAAG,WAAY,oCAAoC,WAClDjC,YAAYmC,QAAQ,WAAY,EAAGP,SACnC7B,QAAQmB,OAvCZ,SAASkB,SAASC,MACd,IAzBuBlC,OAyBnBmC,SAAW,CAAClC,UAAUe,0BAzBHhB,OAyB+CkC,KAAKf,cAAc,mBAxBlFlB,UAAUmC,cAAcjC,MAAK,SAASkC,WACzC,IAAIhC,KAAO,GACXA,MAAQ,6BACR,IAAK,IAAIC,EAAI,EAAGC,OAAS8B,UAAU9B,OAAQD,EAAIC,OAAQD,IAAK,CACxD,IAAIE,QAAU6B,UAAU/B,GACxBD,MAAQ,kBAAoBG,QAAQ8B,yBAA2B,KAAO9B,QAAQE,YAAc,YAEhGV,OAAOW,UAAYN,SAiBuFN,kBAAkBmC,KAAKf,cAAc,oBACnJoB,QAAQC,IAAIL,UAAUhC,MAAK,SAASsC,WAChC,IAAIxB,OAASwB,UAAU,GACvBP,KAAKf,cAAc,mBAAmBC,MAAQH,OAAOC,2BAA6B,GAClFgB,KAAKf,cAAc,kBAAkBC,MAAQH,OAAOI,qBAAuB,GAC3EzB,QAAQ8C,UAkCZT,CAASnB","file":"metadataImages.js","sourcesContent":["define(['jQuery', 'dom', 'loading', 'libraryMenu', 'globalize', 'listViewStyle'], function($, dom, loading, libraryMenu, globalize) {\n    'use strict';\n\n    function populateLanguages(select) {\n        return ApiClient.getCultures().then(function(languages) {\n            var html = '';\n            html += \"<option value=''></option>\";\n            for (var i = 0, length = languages.length; i < length; i++) {\n                var culture = languages[i];\n                html += \"<option value='\" + culture.TwoLetterISOLanguageName + \"'>\" + culture.DisplayName + '</option>';\n            }\n            select.innerHTML = html;\n        });\n    }\n\n    function populateCountries(select) {\n        return ApiClient.getCountries().then(function(allCountries) {\n            var html = '';\n            html += \"<option value=''></option>\";\n            for (var i = 0, length = allCountries.length; i < length; i++) {\n                var culture = allCountries[i];\n                html += \"<option value='\" + culture.TwoLetterISORegionName + \"'>\" + culture.DisplayName + '</option>';\n            }\n            select.innerHTML = html;\n        });\n    }\n\n    function loadPage(page) {\n        var promises = [ApiClient.getServerConfiguration(), populateLanguages(page.querySelector('#selectLanguage')), populateCountries(page.querySelector('#selectCountry'))];\n        Promise.all(promises).then(function(responses) {\n            var config = responses[0];\n            page.querySelector('#selectLanguage').value = config.PreferredMetadataLanguage || '';\n            page.querySelector('#selectCountry').value = config.MetadataCountryCode || '';\n            loading.hide();\n        });\n    }\n\n    function onSubmit() {\n        var form = this;\n        return loading.show(), ApiClient.getServerConfiguration().then(function(config) {\n            config.PreferredMetadataLanguage = form.querySelector('#selectLanguage').value;\n            config.MetadataCountryCode = form.querySelector('#selectCountry').value;\n            ApiClient.updateServerConfiguration(config).then(Dashboard.processServerConfigurationUpdateResult);\n        }), !1;\n    }\n\n    function getTabs() {\n        return [{\n            href: 'library.html',\n            name: globalize.translate('HeaderLibraries')\n        }, {\n            href: 'librarydisplay.html',\n            name: globalize.translate('TabDisplay')\n        }, {\n            href: 'metadataimages.html',\n            name: globalize.translate('TabMetadata')\n        }, {\n            href: 'metadatanfo.html',\n            name: globalize.translate('TabNfoSettings')\n        }];\n    }\n\n    $(document).on('pageinit', '#metadataImagesConfigurationPage', function() {\n        $('.metadataImagesConfigurationForm').off('submit', onSubmit).on('submit', onSubmit);\n    }).on('pageshow', '#metadataImagesConfigurationPage', function() {\n        libraryMenu.setTabs('metadata', 2, getTabs);\n        loading.show();\n        loadPage(this);\n    });\n});\n"]}