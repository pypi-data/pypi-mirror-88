"use strict";define(["loading","layoutManager","userSettings","events","libraryBrowser","alphaPicker","listView","cardBuilder","globalize","emby-itemscontainer"],(function(loading,layoutManager,userSettings,events,libraryBrowser,alphaPicker,listView,cardBuilder,globalize){return function(view,params,tabContent,options){function onViewStyleChange(){"List"==self.getCurrentViewStyle()?(itemsContainer.classList.add("vertical-list"),itemsContainer.classList.remove("vertical-wrap")):(itemsContainer.classList.remove("vertical-list"),itemsContainer.classList.add("vertical-wrap")),itemsContainer.innerHTML=""}function updateFilterControls(){self.alphaPicker&&self.alphaPicker.value(query.NameStartsWithOrGreater)}function fetchData(){return isLoading=!0,loading.show(),ApiClient.getItems(ApiClient.getCurrentUserId(),query)}function afterRefresh(result){function onNextPageClick(){isLoading||(userSettings.libraryPageSize()>0&&(query.StartIndex+=query.Limit),itemsContainer.refreshItems())}function onPreviousPageClick(){isLoading||(userSettings.libraryPageSize()>0&&(query.StartIndex=Math.max(0,query.StartIndex-query.Limit)),itemsContainer.refreshItems())}window.scrollTo(0,0),updateFilterControls();var i,length,pagingHtml=libraryBrowser.getQueryPagingHtml({startIndex:query.StartIndex,limit:query.Limit,totalRecordCount:result.TotalRecordCount,showLimit:!1,updatePageSizeSetting:!1,addLayoutButton:!1,sortButton:!1,filterButton:!1}),elems=tabContent.querySelectorAll(".paging");for(i=0,length=elems.length;i<length;i++)elems[i].innerHTML=pagingHtml;for(i=0,length=(elems=tabContent.querySelectorAll(".btnNextPage")).length;i<length;i++)elems[i].addEventListener("click",onNextPageClick);for(i=0,length=(elems=tabContent.querySelectorAll(".btnPreviousPage")).length;i<length;i++)elems[i].addEventListener("click",onPreviousPageClick);isLoading=!1,loading.hide(),require(["autoFocuser"],(function(autoFocuser){autoFocuser.autoFocus(tabContent)}))}function getItemsHtml(items){var viewStyle=self.getCurrentViewStyle();return"Thumb"==viewStyle?cardBuilder.getCardsHtml({items:items,shape:"backdrop",preferThumb:!0,context:"movies",lazy:!0,overlayPlayButton:!0,showTitle:!0,showYear:!0,centerText:!0}):"ThumbCard"==viewStyle?cardBuilder.getCardsHtml({items:items,shape:"backdrop",preferThumb:!0,context:"movies",lazy:!0,cardLayout:!0,showTitle:!0,showYear:!0,centerText:!0}):"Banner"==viewStyle?cardBuilder.getCardsHtml({items:items,shape:"banner",preferBanner:!0,context:"movies",lazy:!0}):"List"==viewStyle?listView.getListViewHtml({items:items,context:"movies",sortBy:query.SortBy}):"PosterCard"==viewStyle?cardBuilder.getCardsHtml({items:items,shape:"portrait",context:"movies",showTitle:!0,showYear:!0,centerText:!0,lazy:!0,cardLayout:!0}):cardBuilder.getCardsHtml({items:items,shape:"portrait",context:"movies",overlayPlayButton:!0,showTitle:!0,showYear:!0,centerText:!0})}var self=this,itemsContainer=tabContent.querySelector(".itemsContainer"),savedQueryKey=params.topParentId+"-"+options.mode,savedViewKey=savedQueryKey+"-view",query={SortBy:"SortName,ProductionYear",SortOrder:"Ascending",IncludeItemTypes:"Movie",Recursive:!0,Fields:"PrimaryImageAspectRatio,MediaSourceCount,BasicSyncInfo",ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb",StartIndex:0,ParentId:params.topParentId};userSettings.libraryPageSize()>0&&(query.Limit=userSettings.libraryPageSize());var isLoading=!1;"favorites"===options.mode&&(query.IsFavorite=!0),query=userSettings.loadQuerySettings(savedQueryKey,query),self.showFilterMenu=function(){require(["components/filterdialog/filterdialog"],(function(_ref){var filterDialog=new(0,_ref.default)({query:query,mode:"movies",serverId:ApiClient.serverId()});events.on(filterDialog,"filterchange",(function(){query.StartIndex=0,itemsContainer.refreshItems()})),filterDialog.show()}))},self.getCurrentViewStyle=function(){return userSettings.get(savedViewKey)||"Poster"},self.initTab=function(){!function initPage(tabContent){itemsContainer.fetchData=fetchData,itemsContainer.getItemsHtml=getItemsHtml,itemsContainer.afterRefresh=afterRefresh;var alphaPickerElement=tabContent.querySelector(".alphaPicker");alphaPickerElement&&(alphaPickerElement.addEventListener("alphavaluechanged",(function(e){var newValue=e.detail.value;query.NameStartsWithOrGreater=newValue,query.StartIndex=0,itemsContainer.refreshItems()})),self.alphaPicker=new alphaPicker({element:alphaPickerElement,valueChangeEvent:"click"}),tabContent.querySelector(".alphaPicker").classList.add("alphabetPicker-right"),alphaPickerElement.classList.add("alphaPicker-fixed-right"),itemsContainer.classList.add("padded-right-withalphapicker"));var btnFilter=tabContent.querySelector(".btnFilter");btnFilter&&btnFilter.addEventListener("click",(function(){self.showFilterMenu()}));var btnSort=tabContent.querySelector(".btnSort");btnSort&&btnSort.addEventListener("click",(function(e){libraryBrowser.showSortMenu({items:[{name:globalize.translate("OptionNameSort"),id:"SortName,ProductionYear"},{name:globalize.translate("OptionImdbRating"),id:"CommunityRating,SortName,ProductionYear"},{name:globalize.translate("OptionCriticRating"),id:"CriticRating,SortName,ProductionYear"},{name:globalize.translate("OptionDateAdded"),id:"DateCreated,SortName,ProductionYear"},{name:globalize.translate("OptionDatePlayed"),id:"DatePlayed,SortName,ProductionYear"},{name:globalize.translate("OptionParentalRating"),id:"OfficialRating,SortName,ProductionYear"},{name:globalize.translate("OptionPlayCount"),id:"PlayCount,SortName,ProductionYear"},{name:globalize.translate("OptionReleaseDate"),id:"PremiereDate,SortName,ProductionYear"},{name:globalize.translate("OptionRuntime"),id:"Runtime,SortName,ProductionYear"}],callback:function callback(){query.StartIndex=0,userSettings.saveQuerySettings(savedQueryKey,query),itemsContainer.refreshItems()},query:query,button:e.target})}));var btnSelectView=tabContent.querySelector(".btnSelectView");btnSelectView.addEventListener("click",(function(e){libraryBrowser.showLayoutMenu(e.target,self.getCurrentViewStyle(),"Banner,List,Poster,PosterCard,Thumb,ThumbCard".split(","))})),btnSelectView.addEventListener("layoutchange",(function(e){var viewStyle=e.detail.viewStyle;userSettings.set(savedViewKey,viewStyle),query.StartIndex=0,onViewStyleChange(),itemsContainer.refreshItems()}))}(tabContent),onViewStyleChange()},self.renderTab=function(){itemsContainer.refreshItems(),updateFilterControls()},self.destroy=function(){itemsContainer=null}}}));
//# sourceMappingURL=movies.js.map
